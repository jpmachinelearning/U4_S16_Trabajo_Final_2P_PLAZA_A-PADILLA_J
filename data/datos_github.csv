tipo,numero,titulo,descripcion,comentarios
Issue,4793,MOD347 : Error E010330 Caracteres no válidos 'Número de convocatoria BDNS',"module: l10n_es_aeat_mod347
version: 18.0

## Steps to reproduce
1. Create a Modelo 347 report.
2. Generate the BOE file.
3. Upload the BOE file in the AEAT (Hacienda) application.

## Current behavior
When uploading the file in the AEAT application, all records return the same error:

**E010330 - Caracteres no válidos: 'Número de convocatoria BDNS'**

<img width=""1115"" height=""398"" alt=""Image"" src=""https://github.com/user-attachments/assets/3f01f163-4a42-4728-bf27-f65919819c8d"" />

## Expected behavior
The BOE file should be accepted by the AEAT website without validation errors.

## Notes / hints
- It looks like the generated file includes the text `Número de convocatoria BDNS`, which contains characters that are not allowed in the BOE format (or in the expected encoding).
- Please confirm where this value is coming from (partner name, invoice line description, narration/notes, etc.) and ensure it is properly sanitized/encoded before generating the BOE file.
",Siendo tratado en #4784 
Issue,4760,Actualizar modelo 190 en rama 16.0,"Actualmente, al generar el fichero del modelo 190 desde Odoo 16.0 (rama 16.0) utilizando el módulo l10n_es_aeat_mod190, se están produciendo errores al intentar importar dicho fichero en la sede electrónica de la AEAT para el ejercicio 2025.
El error devuelto por Hacienda está relacionado con los campos correspondientes a prestaciones de jubilación, viudedad, pensiones por incapacidad y percepciones similares, que para el ejercicio 2025 son requeridos por la AEAT y no parecen estar contemplados en esta versión del módulo.
Si es posible, se solicita la actualización del módulo ""l10n_es_aeat_mod190"" en la rama 16.0 para incorporar los campos y claves necesarios para el ejercicio 2025, especialmente aquellos relacionados con prestaciones de jubilación, viudedad, pensiones por incapacidad y percepciones asociadas.
Estos campos ya han sido incorporados en la rama 18.0, por lo que un backport de dichos cambios permitiría mantener la compatibilidad del modelo 190 en Odoo 16.0.

Gracias.","Además, hemos podido comprobar que el mismo problema se reproduce en Odoo 17.0, utilizando el módulo l10n_es_aeat_mod190 en la rama 17.0.

Al generar el fichero del modelo 190 desde Odoo 17.0 para el ejercicio 2025, la sede electrónica de la AEAT devuelve errores similares, relacionados con la falta de los campos obligatorios correspondientes a prestaciones de jubilación, viudedad, pensiones por incapacidad y percepciones asimiladas, que son requeridos por la AEAT para dicho ejercicio.

Actualmente, dichos campos no parecen estar contemplados tampoco en la rama 17.0 del módulo, provocando que el fichero generado no sea válido para su importación.

Dado que estos campos ya han sido incorporados en la rama 18.0, consideramos que un backport de los cambios desde 18.0 hacia 17.0 (y 16.0) permitiría mantener la compatibilidad del modelo 190 con los requisitos de la AEAT para el ejercicio 2025.

Gracias por vuestro trabajo y soporte. [SEP] Sí, desde luego la solución pasa por llevar esos cambios a ambas ramas. La cuestión es que quien esté interesado en ello debe hacerlo, financiar para que lo hagan, o esperar a que otros lo hagan, ya que así es como funciona el software abierto: se contribuye voluntariamente y donde es posible hacerlo. Lo ideal sería que quien contribuye el parche, lo haga para todas las versiones posibles, pero no se le puede exigir que así lo haga. Cuando el parche se pone en una versión intermedia, sí que solemos pedir que por lo menos lo lleven a todas las versiones superiores para mantener todo sincronizado. En este caso, es al revés, habiendo sido puesto en la última versión disponible, pero no estando en las versiones anteriores.

La mayoría de trabajo está hecho, así que solo falta ese último empujón. ¿Os animáis? [SEP] @pedrobaeza Gracias por la aclaración.
De acuerdo, nos pondremos con el backport de los cambios desde 18.0 a las ramas 16.0 y 17.0 para cubrir los requisitos del ejercicio 2025, intentaremos hacerlo lo antes posible.
 
Gracias. 🙂"
Issue,4743,[IMP][16.0] l10n_es_igic IGIC: Nuevo Tipo (1%): Introducido para petróleo y derivados del refinado.,Según https://www.gobiernodecanarias.org/boc/2025/256/4414.html hay nuevos tipos impositivos en el IGIC y modificaciones en algunos. Sería posible la implementación. Gracias.,
Issue,4681,[17.0] ImporteTotal=0.0 verifactu intracomunitarias,"## Module
l10n_es_verifactu_oca

## Describe the bug
Cuando se envían las facturas de clientes intracomunitarios a Verifactu, devuelve AceptadoConErrores código 2005. La razón del error es que los datos de factura que se envían tienen ImporteTotal"": 0.0 cuando la BaseImponibleOimporteNoSujeto"": 78.0

## To Reproduce
No sé si se pudiera deber a una migración realizada de V16 a V17 ya que he comparado para un mismo cliente:
- Registro premigración ""BaseImponibleOimporteNoSujeto"": 42.0, ""CuotaRepercutida"": 0}]}, ""CuotaTotal"": 0.0, ""ImporteTotal"": 42.0
- Registro postmigración ""BaseImponibleOimporteNoSujeto"": 78.0, ""CuotaRepercutida"": 0}]}, ""CuotaTotal"": 0.0, ""ImporteTotal"": 0.0

He buscado pero no he encuentro ningún reporte similar en V17, así que entiendo que algo ha debido pasar al migrar la BD","Hola.

Agradecería si alguien puede confirmar que también tiene este problema en Verifactu en V17. He buscado razones para que funcionara correctamente en V16 y tras migrar a V17 apareciera este error, pero no he encontrado nada.

Gracias "
Issue,4677,Retención IRPF No residentes UE 24% con ISP,"Hola a todos, 

Tengo una consulta sobre una compra de servicios a Guatemala con retención del 24%, para ello, voy usar la posición fiscal ""Retención IRPF No residentes UE 24%"", entonces mis dudas son:  

- En ""21% S (Compras) (Servicios)"", no debería mapearse contra ""IVA 21% Compra con Inversión del Sujeto Pasivo Nacional""?

- Y a su vez, en ""IVA 21% Compra con Inversión del Sujeto Pasivo Nacional"", para el modelo 390, no faltaría mapear las casillas 27 y 28?

Un saludo y gracias de antemano",
Issue,4666,[18.0] Problema en el tablero de contabilidad,"Buenas a todos, desde que realice la migración de varias bbdd de la v12 y la v14 a la v18, me he encontrado una diferencia sustancial entre estas, y es que la bbdd que viene de la v14 al acceder al tablero de contabilidad y seleccionar el diario del banco, por ejemplo BBVA, este me muestra las líneas del extracto bancario tal y como muestro en la siguiente captura: https://ibb.co/v6Y4Lx61 (he eliminado de la imágen datos, es simplemente para que se vea la estructura), en cambio cuando yo me voy a mi bbdd que traigo de mi v12, si accedo al tablero de contabilidad desde odoo18, donde se aloja también la bbdd que traigo de la v14, este me muestra una vista diferente, en vez de las líneas de extracto bancario solo me muestra el extracto bancario, como muestro en la siguiente imagen: https://ibb.co/8nqnmGws

Como se ve en las imágenes, el action al que se llama es diferente, no se si eso puede ser el causante de este problema.

Sabéis alguna manera de poder resolverlo?

Gracias de antemano!","Ya he podido solucionarlo, en la v12 existía en el core de odoo la reconciliación, a partir de la v14, ya no existe y se hace mediante los módulos de oca, y es por eso que ese módulo al llegar a la v18 y desplegar la bbdd actualizada, no mostraba lo mismo ya que no tenía el módulo de reconciliación.

Por si a alguien le sirve aquí estaba la solución.

Gracias!"
Issue,4652,[17.0][‎‎l10n_es_vat_book] DUA grouped tax error,"The VAT book calculation gives an error when grouped taxes are used.

## Module
l10n_es_vat_book

## Describe the bug
The VAT ledger calculation returns an error when grouped taxes are used. The system attempts to find the grouped tax used in the invoice line within the journal entries and returns a key error.
https://github.com/OCA/l10n-spain/blob/8af041d43cd184373e75b8546b94222896a614e0/l10n_es_vat_book/models/l10n_es_vat_book.py#L281

## To Reproduce
All those that contain the following commit-> https://github.com/OCA/l10n-spain/commit/8744339c6d84fbe2e74d4c5c5a86dc65dd1e6e67

Steps to reproduce the behavior:
1. Create an invoice with a grouped tax (DUA).
2. Validate the invoice.
3. Generate a VAT ledger for the invoice period.
4. A key error will be displayed.

## Error/debug line
Contents of the ""res"" dictionary:
```
2025-12-05 10:11:00,281 1 ERROR test_02_12_25 root: {account.tax(9,): {'tax': account.tax(9,), 'base': 10653.28, 'amount': 0, 'deductible_amount': 0}, account.tax(154,): {'tax': account.tax(154,), 'base': 10653.28, 'amount': 0, 'deductible_amount': 0}} 
```

Error returned by the system:
```
File ""/opt/odoo/auto/addons/l10n_es_vat_book/models/l10n_es_vat_book.py"", line 283, in upsert_book_line_tax
odoo-1        |     vat_book_line[""base_amount""] += res[tax][""base""]
odoo-1        | KeyError: account.tax(157,)
```

As can see, the system tries to search for the tax grouped by the tax breakdowns. Something at this point has not been changed correctly in the commit.","@HaraldPanten  [SEP] @pedrobaeza tiene que ver con los cambios que llevasteis a cabo no hace mucho. Está causando ralentización y errores cuando se utilizan grupos de impuestos. En este caso el DUA, concretamente.

Ya nos das feedback. [SEP] @pedrobaeza Pudiste echarle un ojo a los comentarios en esta incidencia?

Gracias. [SEP] No, lo siento. [SEP] @pedrobaeza Podéis echarle un ojo? O proponemos parche directamente? [SEP] Si podéis vosotros proponer parche, os lo agradecería. Con el fin de año estoy desbordado. [SEP] El PR propuesto https://github.com/OCA/l10n-spain/pull/4674 da una solución a la incompatibilidad, pero no se aceptará debido a que el módulo necesita un refactoring, se tendrá en cuenta más adelante, quien quiere utilizarlo es totalmente viable.
Por mi parte dejaría la Issue abierta para que haya una referencia.  [SEP] @pedrobaeza Dejamos esta issue abierta, para que el resto de usuarios tengan más facilidad para encontrar la traza, etc. Cuando más adelante se plantee refactoring, ya cerramos.

Gracias."
Issue,4650,[17.0] l10n_es_reav Error al enviar facturas al SII con clave 05 (Agencia de Viajes),"Módulo: l10n_es_reav

Cuándo realizamos el envío al SII de una factura emitida haciendo uso del módulo REAV, se muestra un error indicando que no se cumple el esquema.

Fault('Codigo[4102].El XML no cumple el esquema. Falta informar campo obligatorio.: DesgloseTipoOperacion')

Buscando información observamos que la AEAT indica a mediados de 2023 la normativa cambia y que en facturas con clave 5, debe constar también el desglose:
"" Los campos base imponible (margen), tipo y cuota repercutida son obligatorios. El campo cuota repercutida debe ser igual a la base imponible por el tipo. Asimismo, se deberá consignar el “importe total de la factura”.""

https://sede.agenciatributaria.gob.es/Sede/impuestos-tasas/iva/iva-libros-registro-iva-traves-aeat/preguntas-frecuentes/9-cuestiones-especificas-regimen-especial-viaje.html?utm_source=chatgpt.com&faqId=5b95a7eab67eb510VgnVCM100000dc381e0aRCRD

Hasta dónde observo el módulo no cumple este requerimiento. Simplemente confirmarlo, para agregar esta funcionalidad y descartar repetir trabajo.

Gracias!


","Faltaría un módulo `l10n_es_sii_reav` que añada los mapeos donde correspondan, y tal vez trate la clave adecuada en la posición fiscal."
Issue,4649,Nuevo formato modelo 303 para 4T-12/2025 y 2026,"https://sede.agenciatributaria.gob.es/static_files/Sede/Disenyo_registro/DR_300_399/archivos_25/DR303e25.xlsx
https://sede.agenciatributaria.gob.es/Sede/ayuda/disenos-registro/modelos-300-399.html
https://preportal.aeat.es/PRE-Exteriores/Inicio/_menu_/IVA/Modelo_303/Modelo_303.html",PR para 4T-12/2025: https://github.com/OCA/l10n-spain/pull/4691
Issue,4642,l10n_es_verifactu_oca - Rectificativas que provienen de albarán de devolución,"No es del todo del ámbito de verifactu, pero se ve afectado.

En el envío de verifactu de las facturas rectificativas se requiere que se indique las facturas rectificadas en el envio.

Cuando una factura rectificativa se genera desde un albarán de devolución por que el albarán de entrega ya ha sido facturado, no se rellena las facturas rectificadas por lo que el enví0 a verifactu se queda 
""FacturasRectificadas"": [], 
No da error, pero nunca se llega a enviar a verifactu, y se bloquea el tratamiento de esta factura.

No se si seria la solución permitir indicar en algún campo que factura se esta rectificando mas que ir a buscar la factura original



 ","¿Pero y cuando sea factura de rappel? ¿O se rectifique una factura no introducida en Odoo (por ejemplo, por cambio de software)? ¿Qué pasa si no se envía `""FacturasRectificadas"": [],`? ¿No debería ser ése el parche? [SEP] Igual si, igual el parche es enviarlas sin ""FacturasRectificadas"": [], aunque lo marca en en diseño del registro como obligatorio, pero si no lo envías lo acepta.
Asi NO se envia a verifactu
        ""TipoFactura"": ""R1"",
        ""TipoRectificativa"": ""I"",
        ""FacturasRectificadas"": [],
Asi SI se envia a verifactu
       ""TipoFactura"": ""R1"",
        ""TipoRectificativa"": false,
        ""DescripcionOperacion"": ""/"",

Pero que no se envíe creo que es propio del módulo de verifactu. No es que aeat lo rechace, realmente no se envia. Pero el cron tampoco da error visible. [SEP] Hola. Tenemos una instalación de Odoo 17 con verifactu, en la cual un usuario, por mala costumbre desde antes de verifactu, realizó una factura rectificativa directamente sin crearla desde la factura de venta original.

El resultado es el mismo que se está comentando en este issue. ¿Ahora que ya la factura rectificativa está creada cuál es la mejor solución? 

Entiendo que lo que está esperando verifactu y le falta es:
```
""FacturasRectificadas"": [
            {
                ""IDFacturaRectificada"": {
                    ""IDEmisorFactura"": ""BXXXXXXXX"",
                    ""NumSerieFactura"": ""SIXXXXX"",
                    ""FechaExpedicionFactura"": ""01-01-2026""
                }
            }
        ]
``` 

¿Podría meterlo a través de BD, o hay alguna otra solución mejor?

Gracias [SEP] Hola. Únicamente confirmar que introduciendo en BD el reversed_entry_id de la factura original que está relacionada con la rectificativa, soluciona el problema puntual.

Entiendo que la solución definitiva es que si verifactu está instalado y habilitado, no se permita a los usuarios crear facturas rectificativas directamente, al igual que no se permite la cancelación de las facturas.

Un saludo y muchas gracias"
Issue,4641,Nuevo formato modelo 390 para 2025,"https://sede.agenciatributaria.gob.es/Sede/ayuda/disenos-registro/modelos-300-399.html

https://sede.agenciatributaria.gob.es/static_files/Sede/Disenyo_registro/DR_300_399/archivos_25/dr390e2025.xlsx",PR: https://github.com/OCA/l10n-spain/pull/4690 [SEP] Implementado.
Issue,4639,[18.0] l10n_es_facturae error al validar las facturas con etiquetas vacias,"## Modulo
l10n_es_facturae

## Descripción de error
Error al validar facturas generadas para FACE

## Versión
18.0

## Pasos para reproducir:
1. Generar factura con FACE
2. Validar la factura en https://face.gob.es/es/facturas/validar-visualizar-facturas
3. Se obtiene un error del tipo :
El formato de la factura es incorrecto
Línea 50: Element 'CnoCnae': [facet 'length'] The value has a length of '0'; this differs from the allowed length of '5'.

","El validador no parece funcionar correctamente, ya que el XSD sí se cumple, y las facturas suben a FACe. ¿Has probado a subir alguna? [SEP] Si, este es el error que me da al intentar subir.

<img width=""1600"" height=""860"" alt=""Image"" src=""https://github.com/user-attachments/assets/231c20f1-dbd5-4084-8c13-1cfc282ce151"" /> [SEP] Creo que puede ser por los experimentos con el nuevo sistema FACe que están haciendo. @etobella tú tienes problemas? [SEP] Con la integración directa no he visto errores en mis clientes. Por lo que veo del error, se queja de que la etiqueta CnoCnae está definida pero debería estar vacía, pero esto en teoría no se rellena y se vacía automáticamente. [SEP] @etobella se queja de todas las etiquetas que estan vacias, yo he hecho un fix para que las que estan vacias no las ponga en el fichero y ya me deja subir bien, pero creo que se debe de corregir en el módulo. [SEP] @manuelcalerosolis La limpieza ya se hace automáticamente aquí y está así desde hace tiempo. Los ficheros firmados desde el Odoo deberían salir limpios.

https://github.com/OCA/l10n-spain/blob/18.0/l10n_es_facturae/reports/report_facturae.py#L45 [SEP] Mis clientes lo estan exportando sin firmar, tambien deben de salir limpios, ¿no? [SEP] No lo sé, nunca los he usado así, ya que te complicas mucho la vida. Si lo ves necesario puedes proponer un PR 😉 "
Issue,4637,[14.0][FIX] l10n_es_verifactu_oca: verifactu mixin macrodata computation,"https://github.com/OCA/l10n-spain/blob/9b36a6849d6e56d1b30eb0bb8b2816fa8ede7cf6/l10n_es_verifactu_oca/models/verifactu_mixin.py#L129

Este método ya no existe,  al parecer se sustituye por _get_verifactu_taxes_and_total() , si lo confirman corregimos 

",Debéis hacer backport de #4602 
Issue,4632,[16.0] l10n_es_verifactu_oca: Error bloqueante de envío de facturas sin detalle,"## Module
l10n_es_verifactu_oca

## Describe the bug
El sistema permite crear facturas sin DetalleDesglose. 

{
...
        ""Desglose"": {
            ""DetalleDesglose"": []
        },
...
}

El XML que se genera no pasa validación del  xsd de hacienda y deja la factura en cuestión not sent y sin posibilidad de pasar adelante:

*** zeep.exceptions.ValidationError: Expected at least 1 items (minOccurs check) 0 items found. (RegFactuSistemaFacturacion.RegistroFactura.Desglose.DetalleDesglose)


**Esto acaba provocando un fallo en cadena de tal forma que a partir de esa factura no es envía nada a verifactu**


## To Reproduce

Simplemente poner una factura con una sola linia que tenga impuesto IVA ""IVA Exento No Sujeto""

## Expected behavior

- Que el impuesto ""IVA Exento No Sujeto"" genere información de desglose (ni que sea a 0)
   Esta es la forma fácil de reproducir el error

- Que durante la validación de factura se verifique que cumple con el xsd de hacienda.
   Esto permitiria controlar errrores que ahora mismo no se hayan encontrado y ser mas seguras de cara a un futuro cambio en el xsd de hacienda.

- Que en caso de error de zeep no se pueda validar dee un error más concreto que ""Connection error with VERI*FACTU"" ya que a demás no es cierto. En todo caso debería ser ""Error validating information"". Si a demás se pudiera anexar el error que arroja el zeep ya sería fantástico.

- Alternativa que no sé si sería válida según verifactu. No mandar información para facturas que no tengan DetalleDesglose
",
Issue,4631,[16.0][FIX] l10n_es_verifactu_oca,"<!-- Provide a general summary of the issue in the Title above.
Before opening the issue, please check that there isn't another issue addressing the same problem already created -->

## Module
l10n_es_verifactu_oca

## Describe the bug
El módulo permite crear diarios de venta sin activar la casilla ""Verifactu"".
Esto provoca que, de forma implícita, se puedan emitir facturas mediante esos diarios sin cumplir el reglamento Verifactu, aun cuando el entorno ya está desplegado y funcionando con el módulo.

En la práctica, el sistema no garantiza que todos los diarios de ventas estén sujetos a Verifactu una vez el módulo está en uso, lo que puede generar incumplimientos regulatorios.

## To Reproduce
**Affected versions**:
16.0

Steps to reproduce the behavior:
Instalar y configurar el módulo l10n_es_verifactu_oca.

Emitir facturas con el check de verifactu activado en el diario

Crear **OTRO** diario de tipo ""Ventas"".

Observar que la casilla ""Verifactu"" no está activada por defecto. Permite **no** activarla

Emitir una factura usando ese nuevo diario.

La factura se genera connormalidad sin pasar por el flujo Verifactu.

**Expected behavior**
Una vez desplegado el módulo Verifactu, se espera que:

Todos los diarios de ventas estén obligatoriamente vinculados a Verifactu.

O, alternativamente, que el sistema impida crear diarios de ventas sin activar el check.

O que el sistema bloquee la emisión de facturas desde diarios sin Verifactu si la base está configurada para ello.

El comportamiento esperado debe evitar en todo caso la posibilidad de emitir facturas fuera del cumplimiento del reglamento.

**Additional context**
Odoo permite la creación de diarios de ventas manuales sin marcar la opción Verifactu.

Esto puede provocar incumplimiento normativo si un usuario emite facturas desde un diario sin Verifactu activado.","Yo por mi parte no veo bug aquí. Sí podría ser interesante que, cuando se crean nuevos diarios de venta, se genere alguna alerta del tipo ""Por favor, revise si debe activar la comunicación Verifactu en este diario"".

Hay casos en los que se necesitan registrar / importar en Odoo facturas de venta que han sido generadas desde otro SIF y, por lo tanto, ya han sido comunicadas a Verifactu en ese otro sistema.
 [SEP] El SIF debe cumplir la normativa siempre.
Permitir crear facturas sin ese check activado no cumple el reglamento de facturacion

Ahí esta mi preocupación [SEP] La verdad es que aunque haya casuísticas que puedan justificar no enviar a VERI\*FACTU, esto es la puerta abierta a tener un diario de ""caja B"". @almumu @anmarmo1 @SoniaViciana recordáis cuál fue la razón inicial de habilitar VERI\*FACTU por diarios? O fue solo por mimetizar con el SII?

Y lo mismo podría plantearse de las posiciones fiscales. [SEP] Disculpas si convenís que esto aquí no procede

Pero si viene a colación

Hay una casuística que igual puede ser tenida en cuenta

Cuando el destinatario de las operaciones es quien emite la factura en nombre del emisor

El destinatario envía a la AEAT pues es él quien la ha generado con un SIF y esa AUTOfactura se la envía al emisor

Vamos a necesitar introducir en odoo esa factura para contabilizarla, pero esa factura ya ha sido enviada, ya tiene una serie y un número

Se podría limitar o modificar algún elemento de todos los registros account.move que pertenezcan a esos diarios concretos para que no generen facturas a través de la modificación del reporte

 [SEP] Pongo un escenario real:

-Empresa del sector eléctrico que utiliza Odoo como ERP para su operativa general (contabilidad, compras, facturación propia, etc.).
-Además, subcontrata un SIF externo para la emisión de determinadas facturas en su nombre.

Ese SIF externo:

-Genera su propia serie y numeración,
-Remite esas facturas a Verifactu, cumpliendo con las obligaciones técnicas de envío establecidas en el reglamento.

Para poder llevar la contabilidad consolidada en Odoo, la empresa debe importar periódicamente esas facturas ya emitidas en el sistema externo. Deben existir como facturas en Odoo (por IVA, libros, modelos fiscales, conciliaciones…), pero no deberían reenviarse a Verifactu, ya que ese envío ya se realizó correctamente desde el primer SIF.

Por ese motivo, veo lógico que el módulo de OCA permita configurar diarios en los que:

-Se registren e integren esas facturas externas,
-Pero con Verifactu desactivado para evitar duplicidades en la AEAT.

Desde mi punto de vista, la configuración por diario no es un error, sino que permite cubrir escenarios en los que una empresa factura desde varios SIF y, aun así, centraliza toda su contabilidad en Odoo.

En este contexto existirían dos SIF diferenciados:

-El SIF externo, que emite y, por tanto, es responsable de enviar a Verifactu lo que él mismo genera.
-Odoo, que actúa como SIF únicamente respecto a las facturas emitidas efectivamente en Odoo. Los diarios “no Verifactu” no emiten; simplemente contabilizan facturas originadas en otros sistemas.

Coincido con Pedro en que esta flexibilidad podría malutilizarse para crear diarios “opacos”, pero entiendo que ese riesgo existe en prácticamente cualquier ERP y no deriva de la funcionalidad en sí, sino del control interno y los procesos de cada empresa.
 [SEP] Con ese planteamiento

Se permite emitir facturas al margen del reglamento

No es viable [SEP] FAQ para desarrolladores de la AEAT: https://www.agenciatributaria.es/static_files/AEAT_Desarrolladores/EEDD/IVA/VERI-FACTU/FAQs-Desarrolladores.pdf

El punto 10, importación de facturas, creo que da la pista sobre el tema. Pongo este extracto:

[...]Por lo tanto, en los sistemas del empresario,
efectivamente, este tendrá facturas de dos clases: las producidas con su SIF y las
producidas con el SIF del empresario al que delegue esa facturación. Esas otras
facturas, naturalmente no se tienen ni que volver a imprimir con QR, ni mucho menos
volver a enviarlas a la Sede Electrónica de la AEAT. Ambas funcionalidades las habrá
realizado el SIF de la empresa que materialmente las haya emitido.[...]


 [SEP] El módulo de odoo SA para 18 por ejemplo , no permite desconectar verifactu en un diario de ventas si verifactu está activado [SEP] Sin embargo, el módulo de odoo SA no bloquea el diario de ventas con el hash de odoo (esto sería otra cuestion) [SEP] Propuesta de solución

En aquellos deployments donde Verifactu esté activado a nivel de compañía —como sucede actualmente— puede darse el caso de que existan diarios con la opción Verifactu activada y otros diarios donde dicha opción no esté activada.

Para garantizar el cumplimiento normativo y evitar inconsistencias, se propone aplicar una restricción directa sobre los movimientos contables (account.move) que pertenezcan a diarios con Verifactu desactivado.

Restricción propuesta

Para los registros de account.move cuyo diario no tenga habilitada la opción Verifactu, se aplicarán los siguientes bloqueos:

1. No permitir imprimir

Los documentos contables asociados a estos diarios no podrán ser impresos bajo ninguna circunstancia.
Esto evita que se generen versiones impresas que puedan interpretarse como documentos oficiales cuando no cumplen con los requisitos Verifactu.

2. No permitir enviar

Del mismo modo, estos documentos no podrán enviarse a terceros (por email u otros medios) desde el sistema.
El objetivo es impedir que se distribuyan documentos que no estén validados conforme al estándar Verifactu.

Resultado esperado

Con esta limitación:

Los diarios con Verifactu activado seguirán funcionando con todas las características previstas (envío, impresión, informes…).

Los diarios sin Verifactu activado quedarán claramente diferenciados, sin posibilidad de imprimir ni enviar sus movimientos.

Se evita cualquier uso indebido o interpretación errónea de documentos no validados según Verifactu.

Se garantiza un funcionamiento coherente dentro del mismo deployment mixto. [SEP] > La verdad es que aunque haya casuísticas que puedan justificar no enviar a VERI*FACTU, esto es la puerta abierta a tener un diario de ""caja B"". [@almumu](https://github.com/almumu) [@anmarmo1](https://github.com/anmarmo1) [@SoniaViciana](https://github.com/SoniaViciana) recordáis cuál fue la razón inicial de habilitar VERI*FACTU por diarios? O fue solo por mimetizar con el SII?
> 
> Y lo mismo podría plantearse de las posiciones fiscales.

Hola Pedro, lo dejamos abierto por que se planteo el tema de las auto-facturas y posibles casos en los que no se tuviesen que remitir a AEAT, Realmente, no se si realmente hay casos en los que no aplique el verifactu a parte de diarios que se utilicen para importar ventas y cosas asi, pero personalmente yo no lo contemplaría en un diario de venta ya que si lo tratamos como factura nos obliga a tener un registro de facturacion aunque no se envie a AEAT y la implementacion de eso se complica, el registro de facturacion no es la propia factura en el documento de faq's en el punto 10 ""Cada factura tiene un Registro de Facturación (RF). En la configuración de dicho RF se incluye la identidad del SIF emisor. Por lo tanto, las facturas, mejor dicho los Registros
de Facturación, que se encuentren soportados en un sistema de Gestión, pero que no
hayan sido producidos por el SIF del empresario, son fácilmente identificables como
RFs importados para dicha gestión"" Eso implica que guardemos la identificación del SIF original [SEP] En ese sentido, quizás sería interesante habilitar un campo de la cabecera de la factura, para diarios de venta No Verifactu, en el que se pueda informar la identificación del SIF original.
 [SEP] Y, también, lo que indica cesarsc79 tiene sentido: si se trata de facturas importadas desde otro SIF, hacia un diario de ventas de Odoo No Verifactu, quizás se podría plantear la posibilidad de impedir que se pueda imprimir o enviar una factura, estas facturas solo deberían existir en Odoo con propósitos de gestión contable, declaración de impuestos... Pero no para reimpresión (al menos el Qr ya no sale) o para envío.  [SEP] Cuantas más vueltas le doy, más se debería prohibir estos diarios que no envíen a VERI*FACTU. Si alguien importa, que en su proceso de importación neutralice esas facturas para que no se envíen otra vez (por ejemplo, tocando el estado VERI*FACTU y poniéndolo a enviado). [SEP] Esos diarios serán necesarios en varios escenarios

Autofacturas
Facturas emitidas con otro SIF

Debemos tener en cuenta que este reglamento está orientado más al fabricante de software que al cliente final. Solo hay que ver las sanciones

Lo de la declaración responsable firmada por el propio cliente, no es una solución [SEP] Creo que aquellos que quieran bajo su riesgo tener esos diarios, debería ser mediante un módulo extra que lo habilite, pero no en el módulo base. ¿Estáis de acuerdo los que habéis intervenido en el desarrollo? [SEP] La solución que comentas, Pedro, me parece la solución ideal: módulo base restrictivo y plenamente orientado a la norma. Módulo extra, permitirá que quienes usen Odoo como SIF pero también deban importar de SIF diferentes (imprescindible en determinadas operativas o sectores), tengan una solución para ello. [SEP] > Creo que aquellos que quieran bajo su riesgo tener esos diarios, debería ser mediante un módulo extra que lo habilite, pero no en el módulo base. ¿Estáis de acuerdo los que habéis intervenido en el desarrollo?

A colación de lo que dices, he estado pensando otra posible solución que tiene en cuenta tus comentarios.......


### 📝 PROPUESTA FUNCIONAL Y TÉCNICA PARA `l10n_es_verifactu_oca

A raíz del debate sobre la posibilidad de crear diarios de ventas sin Verifactu aun teniendo Verifactu activo en la compañía, y considerando además la necesidad de gestionar **facturas emitidas por otros SIF** (autofacturas, delegación de facturación, SIF sectoriales…), propongo la siguiente solución dividida en dos niveles:

---

# 1️⃣ PROPUESTA FUNCIONAL

## 1.1. Comportamiento del módulo base `l10n_es_verifactu_oca` (estricto y seguro)

Cuando una compañía tenga Verifactu activado:

1. **Todos los diarios de tipo “Ventas” deben ser Verifactu por defecto**  
   - Al crear un diario con `type = sale`, el check Verifactu debe venir marcado automáticamente.  
   - No debería ser posible desmarcarlo desde el módulo base.

2. **No se deben poder validar facturas de venta fuera del flujo Verifactu**  
   - Si la compañía tiene Verifactu activo y se valida una factura de cliente (`out_invoice` / `out_refund`):
     - El diario debe tener Verifactu activado.  
     - Si no lo tiene → error.
   - Mensaje propuesto:
     > “No se pueden validar facturas de venta en un diario sin Verifactu cuando la compañía tiene Verifactu activado.”

3. **Sin modalidad “NO Verifactu” en el módulo base**  
   - En Odoo 16 (OCA) solo contemplamos la modalidad “Verifactu”.  
   - Toda factura emitida desde un diario de venta normal debe pasar por Verifactu.

Este comportamiento evita:
- la emisión de facturas de “caja B”,
- inconsistencias en la traza Verifactu,
- errores involuntarios por parte del usuario.

---

## 1.2. Módulo adicional OCA (nuevo): gestión de **facturas importadas desde otros SIF**

La AEAT, en la FAQ 10 (“Importación de facturas desde otros sistemas”), especifica que pueden coexistir:

- facturas emitidas por el SIF del empresario (Odoo), y  
- facturas emitidas por otro SIF (delegado, del destinatario, sectorial…).  

Estas facturas **no deben reenviarse a AEAT ni reimprimirse con QR**, pero sí deben almacenarse indicando el **SIF emisor original**.

Para cubrir estos escenarios, se propone un módulo adicional (p. ej. `l10n_es_verifactu_oca_import`) con:

### a) Nuevo modo de diario:  
**“Diario de importación desde otro SIF”**

Campo nuevo en `account.journal` (solo tipo `sale`):

- `verifactu_import_journal = True` → el diario se usa para **registrar facturas emitidas por otro SIF**, no por Odoo.

Al activarlo:
- La opción Verifactu del diario se desactiva (este diario no actúa como SIF).  
- Odoo no debe generar RF ni enviar nada a AEAT para estas facturas.

### b) Nuevos campos en la factura (`account.move`)

Para facturas en diarios de importación:

- `external_sif_id` – Identificador del SIF original.  
- `external_sif_installation` – Nº de instalación del SIF original.  
- `external_rf_identifier` – Identificador del RF original (si se tiene).  
- `is_external_invoice` (compute) – Indica que es una factura importada.

Esto permite cumplir la trazabilidad prevista en la FAQ 10.

### c) Restricciones: sin impresión ni envío

Para `is_external_invoice = True`:

- No se permite **imprimir** la factura desde Odoo.  
- No se permite **enviarla por email** desde Odoo.

La impresión y entrega al cliente ya la realizó el SIF original.

### d) Exclusión del flujo Verifactu

Las facturas importadas:

- No deben generar RF Verifactu.  
- No entran en el hash encadenado.  
- No se seleccionan para envío a AEAT.  
- Pueden existir para contabilidad, libros de IVA y modelos fiscales.

---

# 2️⃣ PROPUESTA TÉCNICA

## 2.1. Módulo base

### `account.journal`
- En `create` / `write`:
  - Si `type == 'sale'` y Verifactu está activo en la compañía:
    - Forzar `verifactu = True` salvo que el módulo extra marque explícitamente el diario como `verifactu_import_journal`.

### `account.move`
- En `action_post`:
  - Si es factura de cliente y:
    - diario es tipo `sale`,
    - Verifactu está activo a nivel de compañia,
    - Verifactu no activado en el diario
    - y **NO** es diario de importación → error.

---

## 2.2. Módulo adicional `l10n_es_verifactu_oca_import`

### Nuevos campos en `account.journal`
```python
verifactu_import_journal = fields.Boolean(
    string=""Diario de importación desde otro SIF"",
    help=""Para registrar facturas ya emitidas por otro SIF y enviadas a AEAT.""
)
```

Al marcarlo:
```python
if self.type == 'sale' and self.verifactu_import_journal:
    self.verifactu_enabled = False
```

### Nuevos campos en `account.move`
```python
external_sif_id = fields.Char()
external_sif_installation = fields.Char()
external_rf_identifier = fields.Char()
is_external_invoice = fields.Boolean(compute=""_compute_is_external_invoice"", store=True)
```

### Bloqueo de impresión y envío
```python
def action_print(self):
    if self.is_external_invoice:
        raise UserError(""No se puede imprimir una factura emitida por otro SIF desde Odoo."")
    return super().action_print()

def action_invoice_sent(self):
    if self.is_external_invoice:
        raise UserError(""No se puede enviar por email una factura emitida por otro SIF."")
    return super().action_invoice_sent()
```

### Exclusión del flujo Verifactu
En el método que prepara envíos:
```python
moves = moves.filtered(lambda m: not m.is_external_invoice)
```

---

# 3️⃣ BENEFICIOS

- Cumple estrictamente con Verifactu y evita riesgos de “caja B”.
- Respeta la normativa sobre RF importados descrita en la FAQ 10.
- Permite a las empresas que trabajan con varios SIF integrar facturas sin duplicidad en AEAT.
- Mantiene una arquitectura modular:  
  - el módulo base es seguro y normativo,  
  - el módulo extra añade flexibilidad para quien realmente la necesita.


 [SEP] Vamos a empezar quitando la opción de desactivarlo, y luego se hace el módulo extra. Si quieres ir con ello, adelante. [SEP] Estoy de acuerdo con desactivar la opción creo que si alguien realmente lo necesita habria que hacer otro módulo como decis. [SEP] En todo caso... Creo que podremos pensar en todo esto de forma más pausada, con el aplazamiento. Como se suele decir: ""para mear y no echar gota"". Estoy en shock. [SEP] Noticia del aplazamiento.

[https://www.eleconomista.es/legal/noticias/13672020/12/25/hacienda-da-un-respiro-a-empresas-y-autonomos-y-retrasa-verifactu-a-2027.html](url)

Cuando este publicado en el boe, seguimos [SEP] ¿como quedó esto?
Verifactu sigue siendo obligatorio desde el verano pasado para la gente que empiece a usar el SIF [SEP] Sí, Odoo cuenta con VERI*FACTU. Otra cosa es que no se active hasta que no haga falta."
Issue,4626,verifactu v14 problemas con facturas validadas por error en extracomuinitario siendo intracomunitarias,"en el caso de clientes por ejemplo de andorra, si la posición fiscal es extracomunitario, la factura da error por el tipo de impuesto, y no deja subirla ni cambiar los impuestos, estos clientes suben correctamente como intracomunitario, pero si el cliente se equivoca en la posición fiscal la factura no sube, hay manera de solucionar esto , como se debería de actuar en tal caso? entiendo que debería de poderse cambiar la posición fiscal en facturas validadas para mandarlas de nuevo",
Issue,4623,[16.0] l10n_es_verifactu_oca: verifactu rechaza factura si el NIF lleva ES como prefijo,"Estamos con las pruebas en nuestro Odoo 16, donde un conector externo importa pedidos de Prestashop. Todo funciona correctamente, pero hay ocasiones donde el cliente pone ES delante de su CIF, como ESB00000000 en lugar de B00000000.

Esto es correcto de cara a Odoo, pero el módulo lo envía tal cual a verifactu, y el sistema lo rechaza indicando que el NIF no es válido.

Si esto viola la normativa, estaría bien que el módulo l10n_es_verifactu_oca limpiara los datos para comprobar que están en el formato correcto.

Carga enviada con ES:

```
""Destinatarios"": {
            ""IDDestinatario"": {
                ""NombreRazon"": ""xxxx ,S.COOP"",
                ""NIF"": ""ESF00000000""
            }
        },
```

Respuesta de VERI*FACTU:
```
{
    'IDFactura': {
        'IDEmisorFactura': 'B00000000',
        'NumSerieFactura': 'INV/2025/11/0344',
        'FechaExpedicionFactura': '26-11-2025'
    },
    'Operacion': {
        'TipoOperacion': 'Alta',
        'Subsanacion': None,
        'RechazoPrevio': None,
        'SinRegistroPrevio': None
    },
    'RefExterna': None,
    'EstadoRegistro': 'Incorrecto',
    'CodigoErrorRegistro': 1100,
    'DescripcionErrorRegistro': 'Valor o tipo incorrecto del campo.: NIF',
    'RegistroDuplicado': None
}
```

Modificamos el cliente para quitar el ES:

```
""Destinatarios"": {
            ""IDDestinatario"": {
                ""NombreRazon"": ""xxxx ,S.COOP"",
                ""NIF"": ""F00000000""
            }
        },
```

Y VERI*FACTU acepta la factura:
```

{
    'IDFactura': {
        'IDEmisorFactura': 'B00000000',
        'NumSerieFactura': 'INV/2025/11/0344',
        'FechaExpedicionFactura': '26-11-2025'
    },
    'Operacion': {
        'TipoOperacion': 'Alta',
        'Subsanacion': 'S',
        'RechazoPrevio': 'X',
        'SinRegistroPrevio': None
    },
    'RefExterna': None,
    'EstadoRegistro': 'Correcto',
    'CodigoErrorRegistro': None,
    'DescripcionErrorRegistro': None,
    'RegistroDuplicado': None
}
```
",
Issue,4620,Codigo del desarollador,"Hola, he instalado el modulo verifactu en la version 16 y me pide como configuracion en las compañias el codigo del desarrollador, como pudiera obtener ese codigo, Gracias",Revisa por favor las discusiones que hay en este repositorio donde ya se ha preguntado y contestado. Cierro al no ser una issue del código.
Issue,4618,l10n_es_verifactu_oca: Envios de cron en BBDD neutralizadas,"Buenas. Realizando pruebas con una base de datos neutralizada copiada de un despliegue en producción, he notado que el módulo de VERI*FACTU OCA continua comunicándose con los servidores de AEAT (en el log aparece `Starting job 'Send invoices to VERI*FACTU'.` y en el registro aparecen respuestas de los servidores).

Dado que los despliegues con bases de datos neutralizadas no suelen comunicarse con el exterior, tal vez sería más adecuado que el módulo inhabilitara las tareas de cron en ese caso. De otra forma, alguien podría crear facturas en el entorno neutralizado, a modo de prueba, pero estas romperían el encadenamiento del despliegue de producción al aparecer facturas de prueba desconocidas para éste. En caso de querer probar las comunicaciones con los servidores (bajo resposabilidad propia, por supuesto), las tareas podrían ser habilitadas manualmente.

Tal vez no haya entendido bien el propósito de las BBDD neutralizadas, o este comportamiento del módulo tiene algún motivo específico que no es evidente, en cuyo caso podría ser suficiente con documentarlo en el readme.

Gracias y saludos","Hola @ivilata cuando realizas un restore con el neutralice todos los CRON deberían quedar desactivados, por lo tanto revisa que el de VERI*FACTU se queda de esa manera, esto te garantiza que no se envía nada. [SEP] Es lo que comenta Mario. Cierro. [SEP] ¡Gracias @syci y @pedrobaeza! He vuelto a realizar la prueba reimportando la BDD como neutralizada (antes también lo estaba), y esta vez las tareas de cron no se han ejecutado. Creo que durante mis pruebas, como reinstalé el módulo de VERI*FACTU sobre la BDD neutralizada, tal vez se volvió a crear o actualizar la tarea, activa esta vez. Imagino que es el comportamiento esperado en este caso, así que nada.

Gracias de nuevo y disculpad por el ruido. 🙂 "
Issue,4615,[18.0] l10n_es_verifactu_oca: Facturas de España sin NIF o VAT,"A la hora de remitir facturas a VERI*FACTU, para destinatarios con país España pero de los que desconocemos o no podemos establecer en NIF, se envía la siguiente información a la AEAT.

```
""Destinatarios"": {
    ""IDDestinatario"": {
        ""NombreRazon"": ""XXX"",
        ""IDOtro"": {
            ""CodigoPais"": ""ES"",
             ""IDType"": ""06"",
             ""ID"": ""ESNO_DISPONIBLE"",
        }
    }
}
```

Lo que nos devuelve el siguiente error: _1126 - 'El valor del CodigoPais solo puede ser ES cuando el IDType sea Pasaporte (03) o No Censado (07). Si IDType es No Censado (07) el CodigoPais debe ser ES (España)._

¿En estos casos donde no conocemos o podemos establecer el NIF, se deberían mandar siempre las facturas como simplificadas a VERI*FACTU (marcándolo así en el contacto)? ¿O hay que hacerlo de alguna otra manera que aún no está contemplada o implementada en el módulo?

¡Gracias de antemano! :)","Si hay que hacer algún fix o improvement podría ponerme yo misma. @pedrobaeza @almumu  [SEP] Habría que marcar la casilla de simplificada en el contacto, sí. Creo que poner que haga eso automático podría ser algo arriesgado, ¿no creéis? [SEP] Sí, me parece bien que se haga de forma manual, así tenemos más control. ¡Mil gracias @pedrobaeza! Cierro la issue."
Issue,4613,[16.0] l10n_es_verifactu_oca: Permitir la modificación de cuentas contables en account.move con VeriFactu activado,"**### Descripción del problema**
Al validar una factura con VeriFactu activado, el documento queda completamente bloqueado. Esto implica que no es posible modificar los apuntes contables, incluyendo cambios en las cuentas contables asignadas.

En muchas empresas, las personas que emiten facturas no son las mismas que el equipo contable, y es habitual que posteriormente se detecten errores en la imputación contable (cuentas de gasto/ingreso incorrectas, cuentas analíticas, etc.).
Sin embargo, con VeriFactu activado, el contable no puede corregir estas cuentas, obligándole a emitir una factura rectificativa únicamente para ajustar asientos, lo cual:

No es operativo

Genera ruido administrativo innecesario

Produce documentos rectificativos que no reflejan un cambio real en la factura, sino solo en la contabilidad

Dificulta la operativa diaria en los departamentos contables

**### Solución preferida**

Permitir que, aun con VeriFactu activado y la factura validada, sea posible:

✔️ Modificar las cuentas contables de los apuntes líquidos en account.move.line
✔️ Permitir ajustes estrictamente contables sin afectar a los datos Verifactu (totales, bases, impuestos, cliente, fecha, etc.)
✔️ Mantener el bloqueo de todos los campos relacionados con la lógica y normativa VeriFactu, evitando cualquier modificación fiscal o de contenido de la factura

El objetivo es que solo los elementos puramente contables puedan ajustarse tras la validación.

**### Alternativas consideradas**

Realizar una factura rectificativa solo para corregir cuentas contables: no es aceptable operativamente porque no refleja una corrección del documento comercial, sino una necesidad contable interna.

Crear un asiento manual de ajuste: no es adecuado, ya que desvirtúa el vínculo entre factura y asiento contable.

Ninguna de las alternativas mantiene correctamente la trazabilidad ni se ajusta a la realidad operativa de las empresas.

**### Contexto adicional**

El propósito del bloqueo de VeriFactu es garantizar la integridad de la información fiscal y del documento legal. Sin embargo, las cuentas contables internas no forman parte de la información fiscal protegida por VeriFactu, y restricciones actuales limitan la operatividad contable sin motivo jurídico.

Sería ideal habilitar un mecanismo seguro para permitir estos ajustes contables posteriores.","Las correcciones se pueden hacer en asientos manuales, por ejemplo:
Se hicieron 5 facturas de 1000 euros en la cuenta 705000 cuando debía haber sido 700000.

Se hace un asiento manual

5000€ 705000   a   700000 5000€


Y queda mas robusto el verifactu siendo inmodificable [SEP] Efectivamente, ése sería el procedimiento. [SEP] Gracias"
Issue,4605,[16.0] l10n_es_aeat_sii_oca: wrong calculation for invoices with oss taxes,"Se realizó un cambio reciente en el módulo l10n_es_vat_book_oss
https://github.com/OCA/l10n-spain/commit/fa02f05b86cf2b16c42491bcb49143d6d6be5bb8


https://github.com/OCA/l10n-spain/blob/616ff6070c356087a40962517d7de957377d3dfd/l10n_es_vat_book_oss/models/account_move.py#L16

El libro de iva ahora utiliza esa función para el cálculo
https://github.com/OCA/l10n-spain/blob/616ff6070c356087a40962517d7de957377d3dfd/l10n_es_vat_book/models/l10n_es_vat_book.py#L271

Pero no se tuvo en cuenta que con ese cambio al enviar al sii , aunque se buscan los impuestos del oss para restarlos del total
https://github.com/OCA/l10n-spain/blob/3df1c7be67052c5ec7fe8b599f4860ae951750c8/l10n_es_aeat_sii_oss/models/account_move.py#L14
no se resta el importe del NotIncludedInTotal, porque se está cogiendo el dato ""amount"" y amount ahora siempre es 0
 https://github.com/OCA/l10n-spain/blob/3df1c7be67052c5ec7fe8b599f4860ae951750c8/l10n_es_aeat_sii_oca/models/account_move.py#L249


Por lo que las facturas enviadas al sii con impuestos OSS están devolviendo el error:

<img width=""410"" height=""195"" alt=""Image"" src=""https://github.com/user-attachments/assets/934f137f-8e6a-4d27-bc54-ac25e039ee6c"" />

 'CodigoErrorRegistro': 2025,
            'DescripcionErrorRegistro': 'Cuando el importe total está cumplimentado, debe ser igual a la suma de las bases imponibles más las cuotas repercutidas, más las cuotas recargo equivalencia del bloque Sujeta No Exenta, más la suma de las bases imponibles del bloque Sujeta Exenta, más la suma del ImportePorArticulos7_14_Otros, más la suma del ImporteTAIReglasLocalizacion',


","probablemente este cambio también afecte a verifactu, o a otros módulos que llamen a la función _get_aeat_tax_info
https://github.com/OCA/l10n-spain/blob/3df1c7be67052c5ec7fe8b599f4860ae951750c8/l10n_es_verifactu_oca/models/account_move.py#L371



 [SEP] @pedrobaeza  [SEP] esto podría ser una posible solución https://github.com/OCA/l10n-spain/pull/4606"
Issue,4604,[17.0] l10n_es_verifactu_oca: Error al crear verifactu.invoice.entry,"<!-- Provide a general summary of the issue in the Title above.
Before opening the issue, please check that there isn't another issue addressing the same problem already created -->

## Module
l10n_es_verifactu_oca

## Describe the bug
Cuando se confirma un asiento se produce el siguiente error:
```
2025-11-23 20:21:32,416 1346439 ERROR bbdd_hidden_name odoo.sql_db: bad query: INSERT INTO ""verifactu_invoice_entry"" (""company_id"", ""create_date"", ""create_uid"", ""document_hash"", ""document_id"", ""document_name"", ""entry_type"", ""model"", ""previous_invoice_entry_id"", ""send_attempt"", ""send_state"", ""verifactu_chaining_id"", ""write_date"", ""write_uid"") VALUES (2, '2025-11-23 20:21:23.093403', 2, '', 393, 'INV/2025/00089', 'register', 'account.move', 263, 0, 'not_sent', 4, '2025-11-23 20:21:23.093403', 2) RETURNING ""id""
ERROR: could not serialize access due to concurrent update
CONTEXT:  SQL statement ""SELECT 1 FROM ONLY ""public"".""verifactu_invoice_entry"" x WHERE ""id"" OPERATOR(pg_catalog.=) $1 FOR KEY SHARE OF x""
```
Y no genera el entry correspondiente por lo que la factura nunca se envía a VERI*FACTU.

## To Reproduce
**Affected versions**: 17.0
Es un poco específico ya que es una integración contra un eCommerce que importa pedidos cada X minutos. Pero lo que realiza la cron que importa pedidos es lo siguiente:

1. Crea pedido de venta (pos.order)
2. Genera su factura (account.move)
3. Confirma la factura. Es aquí dónde surge el error pero permite generar la factura igualmente.

No pasa en todas las facturas.

**Expected behavior**
Debería dar un error y no permitir confirmar la factura si no se crea un verifactu.invoice.entry.

**Additional context**
En la instalación a reproducir hay asignados 2 workers para las crons.",
Issue,4603,[16.0]l10n_es_verifactu_oca: permite confirmar facturas con campos obligatorios vacios,"**Is your feature request related to a problem?**
Cuando se factura a un cliente que no tiene pais establecido en el contacto, el envio falla con error 1100

**Describe the solution you'd like**
- Que no permitiese confirmar facturas si el contacto no tiene pais definido
- Idealmente, que diese un aviso en el chatter

**Describe alternatives you've considered**
Usar un módulo de terceros, hacer obligatorio el campo país en los contactos
",
Issue,4596,[17.0][l10n_es_account_statement_import_n43] Invalid field 'creation_context' al importar un fichero N43,"El módulo está intentando pasar el campo creation_context al crear registros de account.bank.statement, pero este campo no existe en el modelo estándar de Odoo. Esto provoca el siguiente error:

`File ""/opt/odoo/addons/account/models/[account_bank_statement.py](https://account_bank_statement.py/)"", line 352, in createcontainer['records'] = stmts = super().create(vals_list)`
`ValueError: Invalid field 'creation_context' on model 'account.bank.statement'`


Parece que el problema está en la línea 393 del archivo [wizards/account_statement_import_n43.py](https://github.com/OCA/l10n-spain/blob/33602567180e10245e20b1cf51b0b23bcf0ea5e6/l10n_es_account_statement_import_n43/wizards/account_statement_import_n43.py#L393)

```
vals_bank_statement = {
    ""transactions"": transactions,
    ""balance_start"": n43 and n43[0][""saldo_ini""] or 0.0,
    ""balance_end_real"": n43 and n43[-1][""saldo_fin""] or 0.0,
    ""creation_context"": {""skip_retrieve_partner"": True},  # ← Valor problemático
}
```

No estoy completamente seguro de si me estoy perdiendo algo (quizás alguna dependencia que añada este campo o alguna versión específica de Odoo que lo soporte), pero tras revisar el código de Odoo 17.0 no encuentro ninguna referencia a este campo.

La revisión de Odoo es la [fed8de2](https://github.com/odoo/odoo/commit/fed8de21c5bf47344050c54eefc5388f26e82e12), y la del l10n_es_account_statement_import_n43es la que ya dejé con el enlace del vals problemático.

Muchas gracias de antemano.","A mi me salió en la 16 el mismo error, tuve que actualizar el bank-statement-import y luego el account_statement_input_file eso es porque no existe como dices, pero no es solo al completo. [SEP] Efectivamente. Tenéis que actualizar todo el código fuente a la vez. No se pueden actualizar unos repositorios sí, y otro no.

Cierro porque no existe realmente el error. Es un problema de despliegue."
Issue,4591,[18.0] l10n_es_verifactu_oca: No error log when invoice call throws an error,"## Module
l10n_es_verifactu_oca

## Describe the bug
Cuando falla la llamada a enviar factura a la AEAT, no se muestra ningún tipo de error en la web, solo una respuesta vacía. Creo que es un bug porque de alguna forma habría que decirle al usuario qué es lo que ha fallado, por lo menos la respuesta de la llamada.

Mi idea es que aparezca quizá en la parte de ""Otros detalles"" que por ahora está vacía, no sé si habrán otros planes para esa sección, perdonen mi ignorancia.

Pongo este bug para que se tenga en cuenta, y si se confirma que no es un error por mi parte puedo subir yo mismo el parche.

En este caso era que por un problema con el acceso al certificado, pero hasta que no he hecho el hotfix en local no he tenido forma de ver por qué pasaba.

<img width=""1390"" height=""316"" alt=""Image"" src=""https://github.com/user-attachments/assets/d172b47d-38e4-453b-a529-0ae29e5b4117"" />

Esta segunda imagen es la ""solución"" rápida que podría ser interesante.

<img width=""1411"" height=""293"" alt=""Image"" src=""https://github.com/user-attachments/assets/1b9bca78-154d-4fc0-87ee-24684abe407c"" />",
Issue,4589,[16.0] Problema tras actualización de VERI*FACTU (v16.0.1.1.0),"Hola Pedro y compis,

Acabo de actualizar a la nueva versión de VERI*FACTU:
    ""name"": ""Comunicación VERI*FACTU"",
    ""version"": ""16.0.1.1.0""

Desde entonces, estoy experimentando el siguiente comportamiento:
1.	Con clientes nuevos
      o	Creo un cliente y su factura correspondiente.
      o	Al intentar enviar la factura a VERI*FACTU, no se envía y recibo el siguiente error:

error que lanza:

      

        >  _OwlError: An error occured in the owl lifecycle (see this Error's ""cause"" property)
        >       Error: An error occured in the owl lifecycle (see this Error's ""cause"" property)
        >           at handleError (https://erpformacion.difadigestion.com/web/assets/145-  143a231/web.assets_common.min.js:1377:101)
        >           at App.handleError (https://erpformacion.difadigestion.com/web/assets/145-143a231/web.assets_common.min.js:2024:29)
        >           at Fiber._render (https://erpformacion.difadigestion.com/web/assets/145-143a231/web.assets_common.min.js:1402:19)
        >           at Fiber.render (https://erpformacion.difadigestion.com/web/assets/145-143a231/web.assets_common.min.js:1400:6)
        >           at ComponentNode.initiateRender (https://erpformacion.difadigestion.com/web/assets/145-143a231/web.assets_common.min.js:1470:47)
        
          
        >   Caused by: TypeError: Cannot read properties of undefined (reading '1')
        >       at get string (https://erpformacion.difadigestion.com/web/assets/234-4c88619/web.assets_backend.min.js:3702:195)
        >       at SelectionField.template (eval at compile (https://erpformacion.difadigestion.com/web/assets/145-143a231/web.assets_common.min.js:1979:421), <anonymous>:15:21)
        >       at Fiber._render (https://erpformacion.difadigestion.com/web/assets/145-143a231/web.assets_common.min.js:1401:96)
        >       at Fiber.render (https://erpformacion.difadigestion.com/web/assets/145-143a231/web.assets_common.min.js:1400:6)
        >       at ComponentNode.initiateRender (https://erpformacion.difadigestion.com/web/assets/145-143a231/web.assets_common.min.js:1470:47_
        >   

2.	Con clientes existentes
      o	Creo una factura para un cliente antiguo.
      o	La factura parece enviarse (en estado “Envío” no marca nada).
      o	Pero al intentar acceder al historial de la factura enviada, aparece el mismo error que antes:

error que lanza:

   ```

        >     OwlError: An error occured in the owl lifecycle (see this Error's ""cause"" property)
        >       Error: An error occured in the owl lifecycle (see this Error's ""cause"" property)
        >           at handleError (https://erpformacion.difadigestion.com/web/assets/145-143a231/web.assets_common.min.js:1377:101)
        >           at App.handleError (https://erpformacion.difadigestion.com/web/assets/145-143a231/web.assets_common.min.js:2024:29)
        >           at Fiber._render (https://erpformacion.difadigestion.com/web/assets/145-143a231/web.assets_common.min.js:1402:19)
        >           at Fiber.render (https://erpformacion.difadigestion.com/web/assets/145-143a231/web.assets_common.min.js:1400:6)
        >           at ComponentNode.initiateRender (https://erpformacion.difadigestion.com/web/assets/145-143a231/web.assets_common.min.js:1470:47)
        >   
        >   Caused by: TypeError: Cannot read properties of undefined (reading '1')
        >       at get string (https://erpformacion.difadigestion.com/web/assets/234-4c88619/web.assets_backend.min.js:3702:195)
        >       at SelectionField.template (eval at compile (https://erpformacion.difadigestion.com/web/assets/145-143a231/web.assets_common.min.js:1979:421), <anonymous>:15:21)
        >       at Fiber._render (https://erpformacion.difadigestion.com/web/assets/145-143a231/web.assets_common.min.js:1401:96)
        >       at Fiber.render (https://erpformacion.difadigestion.com/web/assets/145-143a231/web.assets_common.min.js:1400:6)
        >       at ComponentNode.initiateRender (https://erpformacion.difadigestion.com/web/assets/145-143a231/web.assets_common.min.js:1470:47

```

Observaciones:
       •	Esto no ocurría antes de la actualización.
       •	Por la naturaleza del error (TypeError: Cannot read properties of undefined (reading '1') en SelectionField),  parece estar relacionado con campos de selección que ahora son obligatorios en la versión actualizada, tanto en clientes como en facturas.
       •	Posiblemente algunos registros existentes no tienen valores asignados para estos campos, ¿puede ser?

¿Podrías decidme  por qué ocurre esto y cómo solucionarlo?
","Hola, ¿has actualizado también el módulo dentro del propio Odoo, o solo has actualizado el código? [SEP] Buenos días Pedro, ¿a que te refieres? he actualizado el modulo con todas sus dependencias :
-l10n_es_verifactu_oca
-l10n_es_aeat
-account_tax_balance
-date_range
-account_invoice_refund_link

estos son los módulos que actualice y posteriormente actualice por interfaz...  

si modifico el código si que me va:

Original  (no va)

```python
 def reverse_moves(self):
        res = super().reverse_moves()
        self.move_ids.filtered(lambda mov: mov.move_type == ""out_invoice"").mapped(
            ""reversal_move_id""
        ).write({""verifactu_refund_type"": ""I""})
        return res
```
    
Modificaco (si va)

```python
    def refund_moves(self):

         return self.reverse_moves()
```

lo he dejado con el código ORIGINAL.. 

Ya me dices algo cuándo puedas y mil gracias Pedro.  [SEP] @alvrico esto último que envías no sé qué tiene que ver con lo primero que pusiste, porque este código que pones es para cuando haces una rectificativa. [SEP] Buenas Pedro, me he liado con otro problema qeu tenia... 

lo que he actualizado ha sido esto:

Buenos días Pedro, ¿a que te refieres? he actualizado el modulo con todas sus dependencias :
-l10n_es_verifactu_oca
-l10n_es_aeat
-account_tax_balance
-date_range
-account_invoice_refund_link

estos son los módulos que actualice y posteriormente actualice por interfaz...


no se si sabrás porque me pasa.. y perdona que me he liado con otro problema que me ha surgido [SEP] Ahora mismo la verdad es que no sabría decirte, porque no es un error ""normal"". Prueba a instalar el módulo en una instancia limpia a ver. [SEP] buenas Pedro, por arte de magia ya funciona.. va todo perfecto.. 

mil gracias de nuevo "
Issue,4586,"Vale, creo que lo he entendido.","Vale, creo que lo he entendido.
Quedo entonces a la espera de que revisen el PR para su aprobación, y sobre todo daros las gracias a todos los que estáis haciendo esta implementación porque es un currazo

_Originally posted by @andresdrew33 in https://github.com/OCA/l10n-spain/discussions/4578#discussioncomment-14958924_",Cierro porque ya se está tratando en el PR y esto añade ruido.
Issue,4550,[17.0] l10n_es_pos_oca: Solapamiento en sequencia de facturas simplificada de tpv,"Se solapan las sequencias de facturas simplificadas generadas en el módulo l10n_es_pos_oca

## Pasos para reproducir el comportamiento:

1. Abrir sesión de TPV y realizar ventas
2. Para servidor
3. Seguir realizando pedidos (La factura simplificada funciona correctamente)
4. Refrescar TPV con F5 
5. Levantar el servidor 
6. Realizar una venta inmediatamente 

Al tener ordenes pendientes usa la última secuencia almacenada en el servidor y solapa con un pedido ya existente aún no sincronizado

**Contexto**
Workers  activos


<img width=""1252"" height=""430"" alt=""Image"" src=""https://github.com/user-attachments/assets/2e361e01-136d-4a13-b6fa-2d4d53a278d2"" />",
Issue,4534,[16.0] ln_es_igic_verifactu_oca - l10n_es_igic," ln_es_igic_verifactu_oca 
Buenas, a la hora de instalar el módulo me da error que no existe l10n_es_igic.account_tax_template_igic_r_5, no se si alguno más, se queda ahí. El módulo instalado de IGIC  ""name"": ""IGIC (Impuesto General Indirecto Canario"",
    ""version"": ""16.0.1.4.0"", veo en los archivos DATA los impuestos, pero en el Odoo no veo los de 5%.


","Tu Odoo no debe estar totalmente actualizado. Descárgate el último código de todo, y actualiza los módulos en tu BD. Cierro por ser una cuestión de despliegue, no del módulo en si. [SEP] Eso es lo que me pregunto, está completamente actualizado. [SEP] Prueba en el [runboat de 16.0 de OCA/l10n-spain](https://runboat.odoo-community.org/builds?repo=OCA/l10n-spain&target_branch=16.0) si eres capaz de reproducir el problema.
 [SEP] Tenias razón, fallo de despliegue, no recuerdo y no se porque motivo tenia dos carpetas de addons diferente path, mismo contenido, actualicé el contenido del modulo de IGIC, pero no de la ubicación correcta. Muchas gracias. Solucionado."
Issue,4507,[17.0] l10n_es_verifactu_oca: Error de comunicación AEAT,"Estoy haciendo pruebas del módulo en Odoo17 montado en un contenedor docker y todo ha funcionado correctamente, pero hoy he actualizado la imagen de Odoo del contenedor y desde entonces me da error de comunicación con Verifactu. 

La versión de Odoo que se ha instalado es la siguiente: Odoo 17.0-20251021 (Edición Community)",El error que obtengo es: Codigo[20009].Error interno en el servidor [SEP] Tiene toda la pinta de ser un problema de la propia AEAT. [SEP] Cierro por falta de respuesta.
Issue,4497,l10n_es_verifactu_oca V17 error de conexión a AEAT,"
Hola a todos, 
He isntalado el modulo de Verifactu v17, y aunque he realizado todas las pruebas posibles, no soy capaz de solucionar el problema de conexión que me aparece, impidiendo así, que las facturas le lleguen a AEAT y recibiendo como respuesta ""no send"". 
Las acciones y comprobaciones realizadas para confirmar que no es un error de la BD:
- Verificación de certificado en BD
- Actualizar rutas de certificados (2 veces)
- Hemos usado 2 certificados diferentes
- Verificado URLs y endpoints
- Verificado configuración de Verifactu
- Verificado desarrollador y agencia tributaria
Todo está correctamente configurado en Odoo, pero el módulo sigue sin poder conectarse. 

Agradezco la ayuda de antemano,
",
Issue,4489,Error al crear facturas face. xml incorrecto,"## Module
l10n_es_facturae
versión odoo 18

## Describe the bug
Al intentar crear cualquier archivo facturae, se crea correctamente pero no es válido.
Estoy pasando el archivo por https://face.gob.es/es/facturas/validar-visualizar-facturas

Este es el listado de errores que aparece:

El formato de la factura es incorrecto
Línea 49: Element 'CnoCnae': [facet 'length'] The value has a length of '0'; this differs from the allowed length of '5'.
Línea 49: Element 'CnoCnae': [facet 'pattern'] The value '' is not accepted by the pattern '\d{5}'.
Línea 49: Element 'CnoCnae': '' is not a valid value of the atomic type '{http://www.facturae.gob.es/formato/Versiones/Facturaev3_2_2.xml}CnoCnaeType'.
Línea 79: Element 'CnoCnae': [facet 'length'] The value has a length of '0'; this differs from the allowed length of '5'.
Línea 79: Element 'CnoCnae': [facet 'pattern'] The value '' is not accepted by the pattern '\d{5}'.
Línea 79: Element 'CnoCnae': '' is not a valid value of the atomic type '{http://www.facturae.gob.es/formato/Versiones/Facturaev3_2_2.xml}CnoCnaeType'.
Línea 103: Element 'CnoCnae': [facet 'length'] The value has a length of '0'; this differs from the allowed length of '5'.
Línea 103: Element 'CnoCnae': [facet 'pattern'] The value '' is not accepted by the pattern '\d{5}'.
Línea 103: Element 'CnoCnae': '' is not a valid value of the atomic type '{http://www.facturae.gob.es/formato/Versiones/Facturaev3_2_2.xml}CnoCnaeType'.
Línea 127: Element 'CnoCnae': [facet 'length'] The value has a length of '0'; this differs from the allowed length of '5'.
Línea 127: Element 'CnoCnae': [facet 'pattern'] The value '' is not accepted by the pattern '\d{5}'.
Línea 127: Element 'CnoCnae': '' is not a valid value of the atomic type '{http://www.facturae.gob.es/formato/Versiones/Facturaev3_2_2.xml}CnoCnaeType'.
Línea 152: Element 'CnoCnae': [facet 'length'] The value has a length of '0'; this differs from the allowed length of '5'.
Línea 152: Element 'CnoCnae': [facet 'pattern'] The value '' is not accepted by the pattern '\d{5}'.
Línea 152: Element 'CnoCnae': '' is not a valid value of the atomic type '{http://www.facturae.gob.es/formato/Versiones/Facturaev3_2_2.xml}CnoCnaeType'.
Línea 169: Element 'OperationDate': '' is not a valid value of the atomic type 'xs:date'.
Línea 170: Element 'PlaceOfIssue': Missing child element(s). Expected is ( PostCode ).
Línea 187: Element 'SpecialTaxableBase': Missing child element(s). Expected is ( TotalAmount ).
Línea 188: Element 'SpecialTaxAmount': Missing child element(s). Expected is ( TotalAmount ).
Línea 189: Element 'EquivalenceSurcharge': '' is not a valid value of the atomic type '{http://www.facturae.gob.es/formato/Versiones/Facturaev3_2_2.xml}DoubleTwoDecimalType'.
Línea 190: Element 'EquivalenceSurchargeAmount': Missing child element(s). Expected is ( TotalAmount ).
Línea 195: Element 'GeneralDiscounts': Missing child element(s). Expected is ( Discount ).
Línea 196: Element 'GeneralSurcharges': Missing child element(s). Expected is ( Charge ).
Línea 197: Element 'TotalGeneralDiscounts': '' is not a valid value of the atomic type '{http://www.facturae.gob.es/formato/Versiones/Facturaev3_2_2.xml}DoubleUpToEightDecimalType'.
Línea 198: Element 'TotalGeneralSurcharges': '' is not a valid value of the atomic type '{http://www.facturae.gob.es/formato/Versiones/Facturaev3_2_2.xml}DoubleUpToEightDecimalType'.
Línea 203: Element 'Subsidies': Missing child element(s). Expected is ( Subsidy ).
Línea 204: Element 'PaymentsOnAccount': Missing child element(s). Expected is ( PaymentOnAccount ).
Línea 205: Element 'ReimbursableExpenses': Missing child element(s). Expected is ( ReimbursableExpenses ).
Línea 206: Element 'TotalFinancialExpenses': '' is not a valid value of the atomic type '{http://www.facturae.gob.es/formato/Versiones/Facturaev3_2_2.xml}DoubleTwoDecimalType'.
Línea 208: Element 'TotalPaymentsOnAccount': '' is not a valid value of the atomic type '{http://www.facturae.gob.es/formato/Versiones/Facturaev3_2_2.xml}DoubleUpToEightDecimalType'.
Línea 210: Element 'TotalReimbursableExpenses': '' is not a valid value of the atomic type '{http://www.facturae.gob.es/formato/Versiones/Facturaev3_2_2.xml}DoubleUpToEightDecimalType'.
Línea 213: Element 'PaymentInKindAmount': '' is not a valid value of the atomic type '{http://www.facturae.gob.es/formato/Versiones/Facturaev3_2_2.xml}DoubleUpToEightDecimalType'.
Línea 218: Element 'SequenceNumber': '' is not a valid value of the atomic type 'xs:double'.
Línea 219: Element 'DeliveryNotesReferences': Missing child element(s). Expected is ( DeliveryNote ).
Línea 222: Element 'UnitOfMeasure': [facet 'enumeration'] The value '' is not an element of the set {'01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23', '24', '25', '26', '27', '28', '29', '30', '31', '32', '33', '34', '35', '36'}.
Línea 222: Element 'UnitOfMeasure': '' is not a valid value of the atomic type '{http://www.facturae.gob.es/formato/Versiones/Facturaev3_2_2.xml}UnitOfMeasureType'.
Línea 225: Element 'Charges': Missing child element(s). Expected is ( Charge ).
Línea 242: Element 'SpecialTaxableEvent': Missing child element(s). Expected is ( SpecialTaxableEventCode ).
Línea 246: Element 'SequenceNumber': '' is not a valid value of the atomic type 'xs:double'.
Línea 247: Element 'DeliveryNotesReferences': Missing child element(s). Expected is ( DeliveryNote ).
Línea 250: Element 'UnitOfMeasure': [facet 'enumeration'] The value '' is not an element of the set {'01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23', '24', '25', '26', '27', '28', '29', '30', '31', '32', '33', '34', '35', '36'}.
Línea 250: Element 'UnitOfMeasure': '' is not a valid value of the atomic type '{http://www.facturae.gob.es/formato/Versiones/Facturaev3_2_2.xml}UnitOfMeasureType'.
Línea 253: Element 'Charges': Missing child element(s). Expected is ( Charge ).
Línea 270: Element 'SpecialTaxableEvent': Missing child element(s). Expected is ( SpecialTaxableEventCode ).
Línea 280: Element 'RegulatoryReportingData': [facet 'length'] The value has a length of '0'; this differs from the allowed length of '6'.
Línea 280: Element 'RegulatoryReportingData': '' is not a valid value of the atomic type '{http://www.facturae.gob.es/formato/Versiones/Facturaev3_2_2.xml}RegulatoryReportingDataType'.

A alguien le ha pasado esto??
Tengo que emitir facturas a administración pública y sin este módulo no puedo hacerlo.","Has seleccionado la versión 3.2.2 en el formato de Facturae? [SEP] Buenas gracias por tu pronta respuesta.
He probado las 3 versiones posibles y sigue igual. [SEP] Yo hice una factura hace una semana con el módulo y lo subí a FACe sin tener ningún problema. ¿Por qué no la subes directamente a ver? [SEP] La he firmado con odoo y he probado a subirla.
He probado añadiendo y quitando el ES delante del dni de la compañia.

6 - 447 - El DNI del emisor es incorrecto
"
Issue,4472,[FIX] l10n_es_aeat: Pestaña AEAT. Datos sensibles en contactos,"En versiones anteriores de Odoo (hasta la 16), al crear un empleado se generaba automáticamente un contacto privado (`res.partner)` vinculado a él. Ese contacto se utilizaba para guardar información personal y fiscal necesaria para el modelo 190 de la AEAT, como la situación de discapacidad u otros datos sensibles.

A partir de la versión 17 en adelante, esto ha cambiado. Las direcciones privadas desaparecen del modelo res.partner, y toda la información sensible de empleados pasa a gestionarse directamente en `hr.employee`. Esto se detalla en el siguiente cambio oficial de Odoo:

> _- Las direcciones privadas han sido eliminadas del modelo res.partner.
> - La información de direcciones privadas de los empleados se ha trasladado al modelo hr.employee, conservando los registros antiguos pero vaciando los campos de información privada.
> - La información de direcciones privadas de los candidatos se ha trasladado al modelo hr.applicant, siguiendo el mismo enfoque.
> - De manera más general, se han hecho esfuerzos para asegurarse de que solo se cree y utilice el mismo contacto (partner) desde el formulario de solicitud, pasando por la creación del empleado y también la creación del usuario._
> 
> Fuente: https://github.com/odoo/odoo/pull/120586#issue-1696174460

Esto cumple con los requisitos de protección de datos.

El problema es que, en la localización española, los campos del modelo 190 (AEAT) siguen estando en res.partner. Esto incluye, también, los antiguos contactos privados vinculados a empleados, que ahora quedan arachivados, pero que todavía contienen información sensible. 

<img width=""1545"" height=""911"" alt=""Image"" src=""https://github.com/user-attachments/assets/4c74c1ae-28fb-4c3d-bb33-421efa749970"" />

Así, cualquier usuario con acceso a la aplicación de Contactos puede seguir viendo esos datos, aunque no tenga permisos sobre Empleados, además de los nuevos contactos que se creen al dar de alta un nuevo empleado y se tenga que cumplimentar esta información. 

Esto genera dos inconvenientes claros:

- No se respeta la nueva separación de datos personales introducida en Odoo.
- Se expone información fiscal y personal a usuarios que no deberían tener acceso, lo que puede suponer un incumplimiento del RGPD.

Lo ideal sería que toda la información relacionada con la AEAT del modelo 190 se gestione desde la ficha del empleado, o al menos que se limite su visibilidad a los usuarios autorizados.

En cuanto a posibles soluciones:

- Mover los campos AEAT de res.partner a hr.employee.
Esta opción seguiría la lógica del nuevo modelo de datos y mantendría la coherencia con el manejo de información privada en Odoo 18.

- Crear un grupo de seguridad específico para la pestaña AEAT.
Esta alternativa podría ser más viable a corto plazo, ya que el modelo 190 también puede aplicarse a clientes u otros terceros, no solo a empleados. En este caso, bastaría con añadir un grupo de permisos que restrinja el acceso a esa pestaña a los usuarios adecuados, tal como se comentó en el [PR #3692] https://github.com/OCA/l10n-spain/pull/3692

Nos gustaría saber vuestra opinión. ¿Cuál creéis que sería la mejor manera de tratar con esta información sensible?

Ping: @rafaelbn @EmilioPascual 
MT-12201","El tema es tener que depender del módulo `hr`. Creo que el modelo 190 tendría que tener un grupo específico de seguridad, pero no para toda la pestaña, si no para esos datos. [SEP] ¿Valdría el grupo que se usó en https://github.com/OCA/l10n-spain/pull/3692? [SEP] Sí, coincido en que crear un grupo de seguridad específico para los campos sensibles del modelo 190 es una opción más práctica. Evitará depender completamente del módulo hr.employee y también permitirá que esta pestaña sea accesible para los usuarios con este permiso.
¿Cómo lo véis @rafaelbn y @EmilioPascual ? [SEP] Más que la pestaña, esos campos dentro de la pestaña. No se puede limitar la pestaña completa a la AEAT o a este nuevo grupo, porque ahí hay campos que pueden necesitar cambiar otros perfiles (como la identificación o si es simplificado). [SEP] Podéis revisar https://github.com/OCA/l10n-spain/pull/4512 con el fix."
Issue,4468,[16.0]Error multiempresa,"Buenas,
Cuando una empresa es configurada con el verifactu y se crea otra empresa las facturas de la segunda empresa no se envían. Pero si se crean las dos empresas y luego se configura el verifactu salta un error al intentar validar la factura. Este es el error que aparece: 
Traceback (most recent call last):
  File ""/usr/lib/python3/dist-packages/odoo/http.py"", line 1673, in _serve_db
    return service_model.retrying(self._serve_ir_http, self.env)
  File ""/usr/lib/python3/dist-packages/odoo/service/model.py"", line 152, in retrying
    result = func()
  File ""/usr/lib/python3/dist-packages/odoo/http.py"", line 1701, in _serve_ir_http
    response = self.dispatcher.dispatch(rule.endpoint, args)
  File ""/usr/lib/python3/dist-packages/odoo/http.py"", line 1905, in dispatch
    result = self.request.registry['ir.http']._dispatch(endpoint)
  File ""/usr/lib/python3/dist-packages/odoo/addons/base/models/ir_http.py"", line 154, in _dispatch
    result = endpoint(**request.params)
  File ""/usr/lib/python3/dist-packages/odoo/http.py"", line 749, in route_wrapper
    result = endpoint(self, *args, **params_ok)
  File ""/usr/lib/python3/dist-packages/odoo/addons/web/controllers/dataset.py"", line 47, in call_button
    action = self._call_kw(model, method, args, kwargs)
  File ""/usr/lib/python3/dist-packages/odoo/addons/web/controllers/dataset.py"", line 34, in _call_kw
    return call_kw(Model, method, args, kwargs)
  File ""/usr/lib/python3/dist-packages/odoo/api.py"", line 484, in call_kw
    result = _call_kw_multi(method, model, args, kwargs)
  File ""/usr/lib/python3/dist-packages/odoo/api.py"", line 469, in _call_kw_multi
    result = method(recs, *args, **kwargs)
  File ""/usr/lib/python3/dist-packages/odoo/addons/account/models/account_move.py"", line 3874, in action_post
    other_moves._post(soft=False)
  File ""/mnt/extra-addons/l10n_es_verifactu_oca/models/account_move.py"", line 463, in _post
    res = super()._post(soft=soft)
  File ""/usr/lib/python3/dist-packages/odoo/addons/account_edi/models/account_move.py"", line 306, in _post
    posted = super()._post(soft=soft)
  File ""/usr/lib/python3/dist-packages/odoo/addons/account/models/account_move.py"", line 3618, in _post
    to_post.write({
  File ""/mnt/extra-addons/l10n_es_verifactu_oca/models/account_move.py"", line 529, in write
    return super().write(vals)
  File ""/usr/lib/python3/dist-packages/odoo/addons/account/models/account_move.py"", line 2381, in write
    new_number = move.journal_id.secure_sequence_id.next_by_id()
  File ""/usr/lib/python3/dist-packages/odoo/addons/base/models/ir_sequence.py"", line 274, in next_by_id
    return self._next(sequence_date=sequence_date)
  File ""/usr/lib/python3/dist-packages/odoo/addons/base/models/ir_sequence.py"", line 263, in _next
    return self._next_do()
  File ""/usr/lib/python3/dist-packages/odoo/addons/base/models/ir_sequence.py"", line 204, in _next_do
    number_next = _update_nogap(self, self.number_increment)
  File ""/usr/lib/python3/dist-packages/odoo/addons/base/models/ir_sequence.py"", line 57, in _update_nogap
    self._cr.execute(""SELECT number_next FROM %s WHERE id=%%s FOR UPDATE NOWAIT"" % self._table, [self.id])
  File ""/usr/lib/python3/dist-packages/odoo/sql_db.py"", line 321, in execute
    res = self._obj.execute(query, params)
psycopg2.errors.UndefinedFunction: operator does not exist: integer = boolean
LINE 1: SELECT number_next FROM ir_sequence WHERE id=false FOR UPDAT...
                                                    ^
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.


The above server error caused the following client error:
RPC_ERROR: Odoo Server Error
    RPC_ERROR
        at makeErrorFromResponse (http:///web/assets/145-d4bc22f/web.assets_backend.min.js:1002:163)
        at XMLHttpRequest.<anonymous> (http:///web/assets/145-d4bc22f/web.assets_backend.min.js:1010:13)

Un saludo,","No creo que sea de multi-empresa, si no de que tu diario no tiene marcado para utilizar el hash seguro. Revisa eso, y si no, lo más sencillo es desmarcar y volver a marcar lo de habilitar VERI*FACTU. [SEP] Lo probaré, gracias. [SEP] Buenas, es cierto que funciona así. Hemos desactivado y activado en el diario de habilitar VERI*FACTU y si funciona. Como no lo pone en ningún sitio y es poco intuitivo al ver un error hemos pensado en que era un bug.
Un saludo y gracias. [SEP] No, a ver, realmente se puede considerar un bug. La cuestión es dar con los pasos exactos que llevan al mismo, y por el momento, no lo hemos conseguido. Esto fue reportado también en https://github.com/OCA/l10n-spain/pull/4399#issuecomment-3368924524, pero lo dicho, no consigo reproducirlo. [SEP] No se si es por la multicompañía, pero me ha dado la pista para reproducirlo. Pasa cuando configuras verifactu desde otra compañía como admin. Los pasos que he seguido en runboat, Con el usuario admin estando seleccionada la compañía ""San Francisco"", accedo a la configuración de la compañía ES, activo y configuro verifactu. Luego voy a las facturas, cambio la compañía y hago una factura. Al validarla da el error. Si configuro verifactu habiendo cambiado previamente a la compañía ""ES"" no da ese error."
Issue,4467,l10n_es_aeat: Falso positivo en get_certificates,"https://github.com/OCA/l10n-spain/blob/e3ec0c5ba8402f2754cf9dcca56a8de66920ba90/l10n_es_aeat/models/aeat_certificate.py#L73

Según el código si no existe el certificado añadido desde el backend, comprueba que exista el ir.config_parameter , pero no realiza la comprobación de que exista realmente el fichero en la ruta definida en data de https://github.com/OCA/l10n-spain/blob/17.0/l10n_es_aeat/data/ir_config_parameter.xml

Por lo tanto, da un falso positivo si no se crean los ficheros (que es lo normal en una instalación nueva). Veo que está desde versiones atrás...

Veo dos alternativas:

* Añadir check de os.path.isfile
* Eliminar el fichero data

Por otro lado, aunque eliminemos los params que afectan el CRON de VERI*FACTU al lanzarse no captura el error correctamente porque pasa por alto la excepción en https://github.com/OCA/l10n-spain/blob/f0eadce58eccd5125c4e8d80715b9383a67a3c38/l10n_es_verifactu_oca/models/verifactu_invoice_entry.py#L190

Se propone:

```python
try:
            public_crt, private_key = self.env[""l10n.es.aeat.certificate""].get_certificates(
                company=self.company_id
            )
        except UserError:
            raise UserError(
                _(""Please, configure the VERI*FACTU certificates for your company"")
            )
``` 
Con este cambio se detecta un error que queda registrado en el planificador:

<img width=""1832"" height=""341"" alt=""Image"" src=""https://github.com/user-attachments/assets/9fd3f7f7-e8e3-41e2-b24a-59f851826a3c"" />

Pero se pierde la traza del error real...
",
Issue,4463,[17.0] l10n_es_verifactu_oca: Falla factura rectificativa con error unexpected keyword argument 'is_modify',"Perdonad que no soy desarrollador de Odoo y puede que me equivoque. En la descripción del módulo se comenta que la modificación de facturas enviadas no está soportada, pero la creación de rectificativa creo que sí. 

En versión 17 cuando vas a hacer una factura de rectificativa falla

Traceback (most recent call last): File ""/opt/odoo/src/odoo17/odoo/http.py"", line 1971, in _serve_db return service_model.retrying(self._serve_ir_http, self.env) File ""/opt/odoo/src/odoo17/odoo/service/model.py"", line 152, in retrying result = func() File ""/opt/odoo/src/odoo17/odoo/http.py"", line 1999, in _serve_ir_http response = self.dispatcher.dispatch(rule.endpoint, args) File ""/opt/odoo/src/odoo17/odoo/http.py"", line 2203, in dispatch result = self.request.registry['ir.http']._dispatch(endpoint) File ""/opt/odoo/src/odoo17/odoo/addons/base/models/ir_http.py"", line 221, in _dispatch result = endpoint(**request.params) File ""/opt/odoo/src/odoo17/odoo/http.py"", line 786, in route_wrapper result = endpoint(self, *args, **params_ok) File ""/opt/odoo/src/odoo17/addons/web/controllers/dataset.py"", line 29, in call_button action = self._call_kw(model, method, args, kwargs) File ""/opt/odoo/src/odoo17/addons/web/controllers/dataset.py"", line 21, in _call_kw return call_kw(Model, method, args, kwargs) File ""/opt/odoo/src/odoo17/odoo/api.py"", line 484, in call_kw result = _call_kw_multi(method, model, args, kwargs) File ""/opt/odoo/src/odoo17/odoo/api.py"", line 469, in _call_kw_multi result = method(recs, *args, **kwargs) File ""/opt/odoo/src/odoo17/addons/account/wizard/account_move_reversal.py"", line 188, in modify_moves return self.reverse_moves(is_modify=True) TypeError: AccountMoveReversal.reverse_moves() got an unexpected keyword argument 'is_modify' The above server error caused the following client error: RPC_ERROR: Odoo Server Error RPC_ERROR at makeErrorFromResponse (http://------/web/assets/607f1e7/web.assets_web.min.js:2954:163) at XMLHttpRequest.<anonymous> (http://------:8069/web/assets/607f1e7/web.assets_web.min.js:2958:13)

Buscando en el código de los módulos cuales implementan reverse_moves para ver a cual le falta el is_modify parece que es el de verifactu

sudo -iu odoo bash -lc ""
grep -Rns --include='*.py' \
  -E 'class .*AccountMoveReversal|def reverse_moves\\(' \
  /opt/odoo/src/oca /opt/odoo/src/openupgrade17 | sed -n '1,200p'

/opt/odoo/src/oca/l10n-spain/l10n_es_aeat_sii_oca/wizards/account_move_reversal.py:8:class AccountMoveReversal(models.TransientModel):
/opt/odoo/src/oca/l10n-spain/l10n_es_aeat_sii_oca/wizards/account_move_reversal.py:60: def reverse_moves(self, is_modify=False): 
/opt/odoo/src/oca/l10n-spain/l10n_es_facturae/wizard/account_move_reversal.py:7:class AccountMoveReversal(models.TransientModel): 
/opt/odoo/src/oca/l10n-spain/l10n_es_facturae/wizard/account_move_reversal.py:69: def reverse_moves(self, is_modify=False): 
/opt/odoo/src/oca/l10n-spain/l10n_es_verifactu_oca/wizards/account_move_reversal.py:8:class AccountMoveReversal(models.TransientModel): 
**/opt/odoo/src/oca/l10n-spain/l10n_es_verifactu_oca/wizards/account_move_reversal.py:11: def reverse_moves(self):** 
/opt/odoo/src/oca/account-invoicing/account_invoice_refund_link/wizards/account_move_reversal.py:7:class AccountMoveReversal(models.TransientModel): 
/opt/odoo/src/oca/account-invoicing/account_invoice_refund_link/wizards/account_move_reversal.py:10: def reverse_moves(self, is_modify=False):

Lo reporto por si puede ser de ayuda, espero no hacer perder el tiempo a nadie. ","Nos ocurre lo mismo. 
La solución ha sido modificar la definición de la función quedando así: def reverse_moves(self, is_modify=False)

Este módulo al heredar de account_invoice_refund_link que en su rama 16.0 esta definido como:
https://github.com/OCA/account-invoicing/blob/d0f39d06b2a703100feb3b5374652e802f802df4/account_invoice_refund_link/wizards/account_move_reversal.py#L10
Mientras que en la rama 17.0:
https://github.com/OCA/account-invoicing/blob/e34d6cfa741003d4668c4b8325782ea8798612b4/account_invoice_refund_link/wizards/account_move_reversal.py#L10
 [SEP] Sí, disculpad. Esta tarde subo parche. [SEP] También, en cuanto a las facturas rectificativas, hemos detectado que al crear una directamente desde su menú ""Facturas Rectificativas"", sin revertir desde la factura de cargo, esta no se envía. Lo mismo es algo de configuración que no hemos tenido en cuenta y no es el hilo adecuado, pero hago el comentario por si está relacionado.   [SEP] Arreglado en #4470 "
Issue,4462,Migración a la v17 l10n_es_aeat_vat_prorrate_asset,"Hola a todos,

Estoy revisando la generación de activos cuando hay prorrata de IVA. En v14 existía l10n_es_aeat_vat_prorrate_asset y me gustaría migrar/adaptar ese comportamiento para que la prorrata se incorpore correctamente al valor del activo, porque ahora mismo el total del activo se calcula sin la parte no deducible del IVA.

Por lo que he visto, la prorrata ahora genera directamente apuntes contables con la parte no deducible, por lo que la solución previa de l10n_es_aeat_vat_prorrate_asset deja de encajar: no debemos recomputar la prorrata desde el propio activo.

@pedrobaeza, ¿cómo lo ves?
Una opción sería vincular al activo, desde la factura, los apuntes necesarios (base e iniciales) y elevar el valor del activo desde ahí.
O bien, en lugar de migrar este, crear un nuevo módulo.

Como idea inicial, algo así:

```python
invoice = record.account_move_line_ids.filtered(
    lambda line: line.move_id.move_type == ""in_invoice""
)
prorate_line = invoice.line_ids.filtered(lambda l: l.vat_prorate)[0]
if prorate_line:
  # Si tenemos prorrata entonces agregamos otra línea del tipo base amortización con el valor pendiente de la prorrata
  self.env[""account.asset.line""].create({
      'asset_id': record.id,
      'type': 'create',
      'name': invoice.name,
      'amount': prorate_line.amount_currency,
      'init_entry': True,
      'move_id': invoice.id,
      'move_check': True,
      'line_date': invoice.date,
  })
# Acualizamos el valor de compra del activo
  record.write(
      {
          'purchase_value': record.purchase_value+prorate_line.amount_currency,
      }
  )
```

Quedo atento a tus comentarios.

¡Gracias y un saludo!",Cubierto con #4565
Issue,4457,[12.0] Error al actualizar el módulo l10n_es_aeat_mod303 a la última versión,"Buenos días,

Estoy actualizando toda mi bbdd con openupgrade de la versión actual en producción v12 a la última versión disponible que hay de la v12, para así poder ir pasando de versiones con openupgrade.

Para ello, me descargo la rama de openupgrade v12, la de odoo v12 y ejecuto la actualización con openupgrade. Todo se realiza correctamente, hasta que me encuentro este error de la actualización del módulo  l10n_es_aeat_mod303 que no consigo solucionar:
`File ""/opt/openupgrade/odoo/tools/convert.py"", line 850, in convert_csv_import
    raise Exception(_('Module loading %s failed: file %s could not be processed:\n %s') % (module, fname, warning_msg))
Exception: Module loading l10n_es_aeat_mod303 failed: file l10n_es_aeat_mod303/data/2021-07/l10n.es.aeat.map.tax.csv could not be processed:
 Error desconocido durante la importación <class 'odoo.exceptions.ValidationError'>: ('Error mientras se validaban las restricciones\n\nError! Las fechas de los registros se solapan con un registro existente.\n', None)`

He estado buscando en los posts de github y me he encontrado con este mismo problema: https://github.com/OCA/l10n-spain/issues/2548 pero la cosa está, en que si intento actualizar el módulo en bbdd y en código, sigo recibiendo este error, es decir, intento solo lanzar la actualización de este módulo y recibo el mismo error. Tanto el código de openupgrade como el del core de odoo son de la última versión v12 disponible.

Revisando la bbdd tengo lo siguiente (tabla l10n_es_aeat_map_tax):
- Antes de ejecutar la actualización, es decir, sin hacer nada, mi bbdd está así:
` id | date_from | date_to | model | create_uid |        create_date         | write_uid |         write_date         
----+-----------+---------+-------+------------+----------------------------+-----------+----------------------------
  1 |           |         |   347 |          1 | 2020-02-12 13:32:41.167717 |         1 | 2020-02-12 13:32:41.167717
  2 |           |         |   303 |          1 | 2020-02-12 13:33:41.444472 |         1 | 2020-02-12 13:33:41.444472
(2 rows)`

- Despues de ejecutar la actualización mi bbdd está así:
`id | date_from | date_to | model | create_uid | create_date | write_uid | write_date | date_from_search | date_to_search
----+-----------+---------+-------+------------+----------------------------+-----------+----------------------------+------------------+----------------
1 | | | 347 | 1 | 2020-02-12 13:32:41.167717 | 1 | 2025-10-02 09:40:24.076464 | 1900-01-01 | 2999-12-31
2 | | | 303 | 1 | 2020-02-12 13:33:41.444472 | 1 | 2025-10-02 09:40:24.076464 | 1900-01-01 | 2999-12-31
(2 rows)`

He intentado borrar el registro del 303 (no se puede ya que depende de otras tablas), he modificado las fechas del date_from_search y el date_to_search e intentado actualizar y siempre recibo el mismo error que he mostrado más arriba.

Alguien puede echarme una mano con este error para poder seguir actualizando mi odoo por favor.

Gracias de antemano!","Ya he podido solucionarlo, cierro."
Issue,4444,Mejora libro de IVA VAT BOOK,"**Is your feature request related to a problem?**
Vamos a incluir las retenciones en el libro de IVA

**Describe the solution you'd like**
Vamos a incluir las retenciones en el libro de IVA

**Describe alternatives you've considered**
Vamos a incluir las retenciones en el libro de IVA

**Additional context**
basado en el formato oficial aeat https://sede.agenciatributaria.gob.es/Sede/iva/facturacion-registro/ejemplos-libros-registro-iva-irpf-2023/ejemplos-libros-registro-iva-irpf-2022.html

Lo comunico por si alguien tiene algo más a aportar, pero buscaremos un partner para mejorarlo, si puede ser, antes de final de año.","¿incluimos también columna de periodo de deducción para que se incluya la fecha contable? 

<img width=""1461"" height=""562"" alt=""Image"" src=""https://github.com/user-attachments/assets/1bd6a948-e760-4cb6-9d19-c861ffc07cec"" /> [SEP] @AlbertCabedo va a financiar a @Tecnativa para realizar esta mejora. Estará disponible próximamente. [SEP] Implementado en #4709, y backports en camino."
Issue,4435,Posibles errores en el POS,"module: l10n_es_verifactu_pos_oca
version: 16.0

Hola,

Hemos detectado que el modulo genera un archivo con el estatus Aceptado con errores cuando se hace un reembolse desde el punto de venta. Si el reembolso se hace desde el backend el modulo no envía ni genera el QR para verifactu, seguramente porque de esta forma no se le asignan al ticket un secuencia de la factura simplificada tampoco.

",Pon por favor dicho comentario en el PR abierto del módulo: #4378 
Issue,4430,[16.0] l10n_es_verifactu_oca: Fallo en instalación,"https://github.com/OCA/l10n-spain/blob/a9d4066603c3801adacaee6c79ea9c3efe4a4731/l10n_es_verifactu_oca/data/mail_activity_data.xml#L9

Debería ser:        
```
        <field name=""default_user_id"" ref=""base.user_admin"" />

``` 
En una instalación que no existe el ID del usuario que hace referencia a base.group_system falla.",
Issue,4428,[REQUEST] Migrate l10n-es-aeat-sii-oss to Odoo 18.0,"### Description
The module `l10n-es-aeat-sii-oss` is currently available up to Odoo 17.0, but it has not yet been migrated to Odoo 18.0.

### Motivation
This module is essential for companies that need to report invoices to the AEAT through the SII (Immediate Supply of Information) system, 
especially for B2C intra-community sales under the OSS (One-Stop Shop) scheme.

Having it available for Odoo 18.0 would allow Spanish localizations to remain functionally complete and consistent with previous versions.

### Proposal
- Create a branch `18.0-mig-l10n-es-aeat-sii-oss`.
- Adapt dependencies from `l10n-es-aeat-sii-oca` (already migrated to 18.0).
- Update manifest and ensure compatibility with Odoo 18.0.
- Run standard OCA checks (`pre-commit`, `pytest`) and ensure tests pass.
- Publish to PyPI once validated.

### Collaboration
I’m available to help with testing and, if necessary, with the migration process itself.

Thank you very much to the OCA Spain maintainers and community for your continued work.
",Migrated at https://github.com/OCA/l10n-spain/tree/18.0/l10n_es_aeat_sii_oss
Issue,4425,[16.0][IMP] l10n_es_aeat_sii_oca: Fecha inicio SII,"### Contexto

Con motivo de la implementación de la Lay Antifraude y Verifactu, muchas compañías, se adherirán al SII voluntario a partir del 01/01/2026 o antes.

También se sabe que durante la primera quincena de 01/2026, los usuarios contabilizan indistintamente facturas del periodo 12/2025 y 01/2026 (especialmente en la parte de compras).

El problema es que actualmente no se puede establecer una ""fecha de inicio"" para los envíos al SII una vez es activado.

### Objetivo

Habilitar a nivel de res.company la ""Fecha inicio"" en la pestaña ""SII"", de tal forma, que si establecemos la misma a 01/01/2026, sólo las facturas con `[[""date"","">="",""2026-01-01""]]` se envíen al SII.

Gracias,

","En 17 está implementado: https://github.com/OCA/l10n-spain/blob/05f2dd44c1602af0d6d0256bca064693d1afd015/l10n_es_aeat_sii_oca/models/res_company.py#L58 [SEP] https://github.com/OCA/l10n-spain/pull/4436 [SEP] Ya está disponible en 16, 17 y 18."
Issue,4424,[16.0] l10n_es_verifactu_oca: Impuestos OSS,"<!-- Provide a general summary of the issue in the Title above.
Before opening the issue, please check that there isn't another issue addressing the same problem already created -->

Habría que crear un nuevo módulo para mapear los impuestos de OSS","Edit: no sé por qué he leído SII. Efectivamente, habría que hacer el equivalente al del SII para OSS. [SEP] creado pr https://github.com/OCA/l10n-spain/pull/4500"
Issue,4423,[16.0] l10n_es_verifactu_oca: Facturas exentas y causa de exención,"<!-- Provide a general summary of the issue in the Title above.
Before opening the issue, please check that there isn't another issue addressing the same problem already created -->

## Module
l10n_es_verifactu_oca

No se han implementado las causas de exención para las facturas exentas.

<img width=""590"" height=""117"" alt=""Image"" src=""https://github.com/user-attachments/assets/e8fabb8c-498b-444b-84cb-54bd4fceb72f"" />

Documento de validaciones: 
https://www.agenciatributaria.es/static_files/AEAT_Desarrolladores/EEDD/IVA/VERI-FACTU/Validaciones_Errores_Veri-Factu.pdf  páginas 11-12

Tambíen habría que revisar la configuración y mapeo de los impuestos para estos casos.",creado pr https://github.com/OCA/l10n-spain/pull/4499 [SEP] Cierro como ya está el PR en marcha.
Issue,4421,[16.0] l10n_es_verifactu_oca: Anulación de Facturas,"<!-- Provide a general summary of the issue in the Title above.
Before opening the issue, please check that there isn't another issue addressing the same problem already created -->

## Module
l10n_es_verifactu_oca

Actualmente, las facturas enviadas a verifactu no se pueden modificar ni anular, esto en el caso de las rectificativas puede ser un problema, ya que para rectificar una rectificativa habría que crear una nueva factura de venta y no es el procedimiento correcto.

Debería desarrollarse la opción de poder anular facturas en verifactu.

El esquema del envío que debería tener se detalla en [DsRegistroVeriFactu (2).xlsx](/-/project/556/uploads/5ea2deb0870091481bdc68db4ff8bbbd/DsRegistroVeriFactu__2\_.xlsx) en la hoja ""**3)D. Reg. Facturación Anulación**"" ([Fuente original del archivo](https://www.agenciatributaria.es/AEAT.desarrolladores/Desarrolladores/\_menu\_/Documentacion/Sistemas_Informaticos_de_Facturacion_y_Sistemas_VERI_FACTU/Documento_Diseno_de_registro_de_facturacion/Documento_Diseno_de_registro_de_facturacion.html))","desarrollo en progreso https://github.com/OCA/l10n-spain/pull/4548 [SEP] Hola, 
en la configuracion del modulo verifactu en la compañia debo poner  datos de desarrollador, esta informacion donde la puedo buscar [SEP] > Hola, en la configuracion del modulo verifactu en la compañia debo poner datos de desarrollador, esta informacion donde la puedo buscar

https://github.com/OCA/l10n-spain/discussions/4451"
Issue,4420,[16.0] l10n_es_verifactu_oca: Alta por rechazo se envía como alta normal,"<!-- Provide a general summary of the issue in the Title above.
Before opening the issue, please check that there isn't another issue addressing the same problem already created -->

## Module
l10n_es_verifactu_oca

En la documentación oficial de la AEAT ([Documentación](https://www.agenciatributaria.es/AEAT.desarrolladores/Desarrolladores/_menu_/Documentacion/Sistemas_Informaticos_de_Facturacion_y_Sistemas_VERI_FACTU/Documento_Diseno_de_registro_de_facturacion/Documento_Diseno_de_registro_de_facturacion.html)), se detalla que Operativa tiene que llevar las facturas cuya alta es por rechazo (Es decir, facturas que por algún error que se encuentre en los apartados ""Listado de códigos de error que provocan el rechazo de la factura"" o ""Listado de códigos de error que provocan el rechazo del envío completo"" establecido en la [documentación de errores](https://www.agenciatributaria.es/AEAT.desarrolladores/Desarrolladores/_menu_/Documentacion/Sistemas_Informaticos_de_Facturacion_y_Sistemas_VERI_FACTU/Validaciones_y_errores/Validaciones_y_errores.html)) En estos casos la factura se debe marcar con el campo ""<Subsanacion>""=S y ""<RechazoPrevio>""=X. Sin embargo ahora mismo no se están enviando correctamente, se envían como un alta normal.

<img width=""500"" height=""239"" alt=""Image"" src=""https://github.com/user-attachments/assets/5f036c3e-56a9-4d6e-a9df-f78b07a8308e"" />

<img width=""505"" height=""233"" alt=""Image"" src=""https://github.com/user-attachments/assets/db9bf02c-38d9-4e49-a23f-a596b2bd7374"" />




<img width=""1375"" height=""264"" alt=""Image"" src=""https://github.com/user-attachments/assets/5bd4486a-d141-4ff7-ba2b-c240b05e1b14"" />","Me pongo con este issue
https://github.com/OCA/l10n-spain/pull/4429"
Issue,4419,[16.0] l10n_es_verifactu_oca: Tiempo de espera en alta de facturas por rechazo,"<!-- Provide a general summary of the issue in the Title above.
Before opening the issue, please check that there isn't another issue addressing the same problem already created -->

## Module
l10n_es_verifactu_oca

Con el desarrollo actual de verifactu, tanto el alta de las nuevas facturas como el alta por rechazo de facturas se realiza cada minuto, esto hace que en facturas que contengan cualquier error, tengamos una respuesta de la aeat cada minuto, llenándonos el log del mismo error hasta que se subsane. Se puede ver en esta factura de ejemplo

<img width=""1843"" height=""324"" alt=""Image"" src=""https://github.com/user-attachments/assets/4b48c233-6ac6-46eb-8c86-7f6f9779f222"" />

que en el momento de la captura, tiene 867 respuestas de la AEAT con el error

Las facturas que se hayan rechazado, deberían subsanarse manualmente como las que están aceptadas con errores. Y no enviarse cada minuto, como mucho cada hora","cierro issue puesto que las altas por rechazo son facturas que deben subsanarse al igual que las aceptadas con errores, es decir, una vez rechazada, no se enviaría automáticamente hasta que el usuario no la subsana y le da al botón de reenviar desde la factura. El problema es que el alta por rechazo no estaba funcionando correctamente, esto se soluciona en https://github.com/OCA/l10n-spain/pull/4429"
Issue,4416,[18.0][IMP] l10n_es_aeat_mod190: Retenciones IRPF Incapacidad,"El modelo 190 recoge las retenciones e ingresos a cuenta del IRPF realizadas durante el año de cada uno de los perceptores.

Esta retenciones se distribuyen en distintas casillas dependiendo de si son **dinerarias **o** en especie** y si son **derivadas de incapacidad laboral **o** No derivadas de la incapacidad laboral**

<img width=""1160"" height=""473"" alt=""Image"" src=""https://github.com/user-attachments/assets/ccf5951a-15bc-4e12-81c1-52f14280fbbf"" />

Las NO derivadas de la incapacidad laboral recogen las retenciones si no hay ningún tipo de incapacidad (lo habitual) y van en unas determinadas casillas en el 190
Las derivadas de la incapacidad laboral recogen la retenciones cuando hay una incapacidad por parte del empleado de forma permanente o temporal (bajas laborales) y van en otras casillas del 190

Necesitamos distinguir las retenciones que se practica a las percepciones derivadas de la incapacidad laboral de las que son No derivadas de la incapacidad laboral par poder rellenar correctamente el modelo 190

<img width=""800"" height=""528"" alt=""Image"" src=""https://github.com/user-attachments/assets/9e81d97e-d9c7-4ea2-b591-bd3122ed3ada"" />

Ahora mismo existe un impuesto de nominado **_Retenciones IRPF (Trabajadores) dinerarios_** y tenemos que añadir un que se denomine **_Retenciones IRPF (Trabajadores) dinerarios incapacidad laboral_**

Las acciones a realizar:
- [ ] Añadir nuevo impuesto en Odoo https://github.com/odoo/odoo/tree/18.0/addons/l10n_es
- [ ] Modelo 111:  Añadir impuesto
- [ ] Modelo 190: Añadir a las casillas correspondientes

@moduon MT-9457 
@EmilioPascual @OCA/local-spain-maintainers ",
Issue,4402,Migration to version 19.0,"# Todo

https://github.com/OCA/maintainer-tools/wiki/Migration-to-version-19.0

# Modules to migrate

- [ ] account_promissory_note_caixabank
- [ ] delivery_gls_asm - By @RicardCForgeFlow - #4685
- [ ] delivery_seur_atlas
- [ ] l10n_ca_es_cnae
- [ ] l10n_es_account_asset
- [ ] l10n_es_account_banking_sepa_fsdd - By @Vicent-S73 - #4651
- [x] l10n_es_account_statement_import_n43 - By @ferran-S73 - #4644
- [ ] l10n_es_aeat - By @pablo-cort-s73 - #4624
- [ ] l10n_es_aeat_mod111 - By @pablo-cort-s73 - #4675
- [ ] l10n_es_aeat_mod115 - By @pablo-cort-s73 - #4676
- [ ] l10n_es_aeat_mod123
- [ ] l10n_es_aeat_mod130
- [ ] l10n_es_aeat_mod190
- [ ] l10n_es_aeat_mod216
- [ ] l10n_es_aeat_mod296
- [ ] l10n_es_aeat_mod303 - By @sbiosca-s73 - #4680
- [ ] l10n_es_aeat_mod347 - By @pablo-cort-s73 - #4717
- [ ] l10n_es_aeat_mod349
- [ ] l10n_es_aeat_mod390 - By @pablo-cort-s73 - #4727
- [ ] l10n_es_aeat_partner_check - By @arantxa-s73 - #4629
- [ ] l10n_es_aeat_sii_oca
- [ ] l10n_es_atc
- [ ] l10n_es_cnae
- [ ] l10n_es_facturae
- [ ] l10n_es_intrastat_report
- [ ] l10n_es_location_nuts
- [ ] l10n_es_mis_report
- [x] l10n_es_partner - By @pablo-cort-s73 - #4413
- [ ] l10n_es_partner_mercantil
- [ ] l10n_es_payment_order_confirming_aef
- [ ] l10n_es_payment_order_confirming_sabadell
- [ ] l10n_es_toponyms - By @angelmoya - #4415
- [ ] l10n_es_vat_book
- [x] payment_redsys - Incluido en core a partir de V19

Missing module? Check https://github.com/OCA/maintainer-tools/wiki/%5BFAQ%5D-Missing-modules-in-migration-issue-list","Migrando l10n_es_partner #4413  [SEP] Migrando l10n_es_aeat #4624  [SEP] Migrando l10n_es_aeat_mod111 #4675  [SEP] Migrando l10n_es_aeat_mod115 #4676 
 [SEP] Migrando delivery_gls_asm https://github.com/OCA/l10n-spain/pull/4685 [SEP] Migrando l10n_es_aeat_mod347 #4717  [SEP] 
> [ ]  payment_redsys - Incluido en core a partir de V19
> 

Dejo este comentario, ya que creo que payment_redsys no será necesario
"
Issue,4397,[16] l10n_es_verifactu_oca: Error al instalar el módulo de verifactu,"Hola,

he intentado instalar el módulo de verifactu pero me aparece el siguiente error:

RPC_ERROR
Odoo Server Error
Traceback (most recent call last):
  File ""/var/odoo/susanna/src/odoo/tools/convert.py"", line 706, in _tag_root
    f(rec)
  File ""/var/odoo/susanna/src/odoo/tools/convert.py"", line 541, in _tag_record
    raise Exception(""Cannot update missing record %r"" % xid)
Exception: Cannot update missing record 'l10n_es.fp_irpfnrnue24'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File ""/var/odoo/susanna/src/odoo/http.py"", line 1848, in _serve_db
    return service_model.retrying(self._serve_ir_http, self.env)
  File ""/var/odoo/susanna/src/odoo/service/model.py"", line 152, in retrying
    result = func()
  File ""/var/odoo/susanna/src/odoo/http.py"", line 1876, in _serve_ir_http
    response = self.dispatcher.dispatch(rule.endpoint, args)
  File ""/var/odoo/susanna/src/odoo/http.py"", line 2080, in dispatch
    result = self.request.registry['ir.http']._dispatch(endpoint)
  File ""/var/odoo/susanna/src/addons/website/models/ir_http.py"", line 237, in _dispatch
    response = super()._dispatch(endpoint)
  File ""/var/odoo/susanna/src/odoo/addons/base/models/ir_http.py"", line 154, in _dispatch
    result = endpoint(**request.params)
  File ""/var/odoo/susanna/src/odoo/http.py"", line 763, in route_wrapper
    result = endpoint(self, *args, **params_ok)
  File ""/var/odoo/susanna/src/addons/web/controllers/dataset.py"", line 47, in call_button
    action = self._call_kw(model, method, args, kwargs)
  File ""/var/odoo/susanna/src/addons/web/controllers/dataset.py"", line 34, in _call_kw
    return call_kw(Model, method, args, kwargs)
  File ""/var/odoo/susanna/src/odoo/api.py"", line 484, in call_kw
    result = _call_kw_multi(method, model, args, kwargs)
  File ""/var/odoo/susanna/src/odoo/api.py"", line 469, in _call_kw_multi
    result = method(recs, *args, **kwargs)
  File ""<decorator-gen-77>"", line 2, in button_immediate_install
  File ""/var/odoo/susanna/src/odoo/addons/base/models/ir_module.py"", line 74, in check_and_log
    return method(self, *args, **kwargs)
  File ""/var/odoo/susanna/src/odoo/addons/base/models/ir_module.py"", line 478, in button_immediate_install
    return self._button_immediate_function(self.env.registry[self._name].button_install)
  File ""/var/odoo/susanna/src/odoo/addons/base/models/ir_module.py"", line 602, in _button_immediate_function
    registry = modules.registry.Registry.new(self._cr.dbname, update_module=True)
  File ""<decorator-gen-16>"", line 2, in new
  File ""/var/odoo/susanna/src/odoo/tools/func.py"", line 87, in locked
    return func(inst, *args, **kwargs)
  File ""/var/odoo/susanna/src/odoo/modules/registry.py"", line 87, in new
    odoo.modules.load_modules(registry, force_demo, status, update_module)
  File ""/var/odoo/susanna/src/odoo/modules/loading.py"", line 493, in load_modules
    processed_modules += load_marked_modules(cr, graph,
  File ""/var/odoo/susanna/src/odoo/modules/loading.py"", line 374, in load_marked_modules
    loaded, processed = load_module_graph(
  File ""/var/odoo/susanna/src/odoo/modules/loading.py"", line 233, in load_module_graph
    load_data(cr, idref, mode, kind='data', package=package)
  File ""/var/odoo/susanna/src/odoo/modules/loading.py"", line 73, in load_data
    tools.convert_file(cr, package.name, filename, idref, mode, noupdate, kind)
  File ""/var/odoo/susanna/src/odoo/tools/convert.py"", line 771, in convert_file
    convert_xml_import(cr, module, fp, idref, mode, noupdate)
  File ""/var/odoo/susanna/src/odoo/tools/convert.py"", line 837, in convert_xml_import
    obj.parse(doc.getroot())
  File ""/var/odoo/susanna/src/odoo/tools/convert.py"", line 757, in parse
    self._tag_root(de)
  File ""/var/odoo/susanna/src/odoo/tools/convert.py"", line 719, in _tag_root
    raise ParseError('while parsing %s:%s, somewhere inside\n%s' % (
odoo.tools.convert.ParseError: while parsing /var/odoo/susanna/extra-addons/l10n-spain.git-68d11e4d99af7/l10n_es_verifactu_oca/data/account_fiscal_position_template_data.xml:109, somewhere inside
<record id=""l10n_es.fp_irpfnrnue24"" model=""account.fiscal.position.template"">
        <field name=""verifactu_tax_key"">01</field>
        <field name=""verifactu_registration_key"" ref=""verifactu_registration_keys_01""/>
    </record>

The above server error caused the following client error:
RPC_ERROR: Odoo Server Error
    RPC_ERROR
        at makeErrorFromResponse (https://susannafort.cat/web/assets/1072-bb7517d/web.assets_backend.min.js:1003:163)
        at XMLHttpRequest.<anonymous> (https://susannafort.cat/web/assets/1072-bb7517d/web.assets_backend.min.js:1011:13)

Alguna pista de porque ocurre esto?

Comentar que hasta ahora no estaban instalados los módulos ""account_invoice_refund_link"", ""l10n_es_aeat"" ya que sólo se realizaba la facturación y no se llevaba la contabilidad.

Gracias","Buenas @vandekul, esa posición fue añadida hace 11 meses https://github.com/odoo/odoo/commit/a652896cb53717ad0a6a3abafb123bbe99110eb0 es posible que tu versión de odoo esté desactualizada o bien el plan contable como tal. Una vez asegurado que tu versión contiene las posiciones correspondientes puedes utilizar el módulo https://github.com/OCA/account-financial-tools/blob/16.0/account_chart_update para crear las posiciones fiscales faltantes. Espero que te sirva de ayuda"
Issue,4391,warning in l10n_es_aeat_sii_match en su instalacion,"Enla linea 101 del codigo de    hay una etiqueta que es la misma que en la 117
Pueden verificar si es así o por el contrario la etiqueta en la 101 no tendría que llevar contrasted?

Gracias 




 number_records_partially = fields.Integer(
        **string=""Records partially contrasted"",**
        readonly=True,
    )
    number_records_no_test = fields.Integer(
        string=""Records no testables"",
        readonly=True,
    )
    number_records_in_process = fields.Integer(
        string=""Records in process of contrast"",
        readonly=True,
    )
    number_records_not_contrasted = fields.Integer(
        string=""Records not contasted"",
        readonly=True,
    )
    number_records_partially_contrasted = fields.Integer(
        **string=""Records partially contrasted"",**
        readonly=True,
    )",Solucionado en #4404 
Issue,4390,[16.0][BUG] l10n_es_aeat_sii_oca: Retenciones e IRPF no excluidas del total,"
**Módulo**
l10n_es_sii_oca

**Descripción del problema**
Hemos detectado que algunas retenciones, como las de préstamos, no están configuradas en el SII y están dando errores

Como las retenciones no tienen que informarse al SII, estas deben deben estar configuradas para que no resten del total pero algunas no están en la configuración y están dando el _**error _2024 - El valor de ImporteTotal no coincide con el sumatorio de BaseImponible, CuotaSoportada,CuotaRecargoEquivalencia e ImporteCompensacionREAGYP en todas las lineas de detalle_**_

<img width=""1019"" height=""315"" alt=""Image"" src=""https://github.com/user-attachments/assets/d5a5ba60-ddc8-467a-b567-ad021d8519f2"" />


@rafaelbn @pedrobaeza 
Moduon MT-11582","@moduon MT-11582

Vamos a agregar todas las retenciones e irpf que se deban excluir del total y que no están hechas.

Corrigo la imagen de @ArantxaSudon que es una errata.

<img width=""2467"" height=""1096"" alt=""Image"" src=""https://github.com/user-attachments/assets/02d4b672-9897-4373-b117-bfe211698bb7"" />

¿Os parece bien @OCA/local-spain-maintainers ?

Haremos PR semana que viene, para estar de acuerdo antes de hacerlo...

Gracias
Saludos [SEP] OK, adelante."
Issue,4389,[16] l10n_es_verifactu_oca: Error al enviar facturas intracomunitarias,"Al enviar a verifactu cualquier factura con regimen de facturación intracomunitaria nos aparece un error 1103 El valor del campo ID es incorrecto.

Adjunto respuesta enviada por verifactu:

Resposta?
{
    'CSV': None,
    'DatosPresentacion': None,
    'Cabecera': {
        'ObligadoEmision': {
            'NombreRazon': 'Gordó Turch S.L.',
            'NIF': 'B25673807'
        },
        'Representante': None,
        'RemisionVoluntaria': {
            'FechaFinVeriFactu': None,
            'Incidencia': 'S'
        },
        'RemisionRequerimiento': None
    },
    'TiempoEsperaEnvio': '60',
    'EstadoEnvio': 'Incorrecto',
    'RespuestaLinea': [
        {
            'IDFactura': {
                'IDEmisorFactura': 'B25673807',
                'NumSerieFactura': 'FACT/001327',
                'FechaExpedicionFactura': '22-09-2025'
            },
            'Operacion': {
                'TipoOperacion': 'Alta',
                'Subsanacion': None,
                'RechazoPrevio': None,
                'SinRegistroPrevio': None
            },
            'RefExterna': None,
            'EstadoRegistro': 'Incorrecto',
            'CodigoErrorRegistro': 1103,
            'DescripcionErrorRegistro': 'El valor del campo ID es incorrecto.',
            'RegistroDuplicado': None
        }
    ]
}
Capçalera?
{""ObligadoEmision"": {""NombreRazon"": ""Gord\u00f3 Turch S.L."", ""NIF"": ""B25673807""}, ""RemisionVoluntaria"": {""Incidencia"": ""S""}}
Dades de la factura?
[{""RegistroAlta"": {""IDVersion"": 1.0, ""IDFactura"": {""IDEmisorFactura"": ""B25673807"", ""NumSerieFactura"": ""FACT/001327"", ""FechaExpedicionFactura"": ""22-09-2025""}, ""NombreRazonEmisor"": ""Gord\u00f3 Turch S.L."", ""TipoFactura"": ""F1"", ""DescripcionOperacion"": ""."", ""Destinatarios"": {""IDDestinatario"": {""NombreRazon"": ""MULTIPASS SAS - WONDERBOX"", ""IDOtro"": {""CodigoPais"": ""FR"", ""IDType"": ""02"", ""ID"": ""FR""}}}, ""Desglose"": {""DetalleDesglose"": [{""Impuesto"": ""01"", ""ClaveRegimen"": ""01"", ""CalificacionOperacion"": ""S1"", ""TipoImpositivo"": ""0.0"", ""BaseImponibleOimporteNoSujeto"": 353.7, ""CuotaRepercutida"": 0}]}, ""CuotaTotal"": 0.0, ""ImporteTotal"": 353.7, ""Encadenamiento"": {""RegistroAnterior"": {""IDEmisorFactura"": ""B25673807"", ""NumSerieFactura"": ""FACT/001326"", ""FechaExpedicionFactura"": ""22-09-2025"", ""Huella"": ""E43C5ECA49800BB040CC24657819B8BDF9CD937AB044AFC0601BF36BD895F2DF""}}, ""SistemaInformatico"": {""NombreRazon"": ""Odoo Community Association"", ""NIF"": ""B10926533"", ""NombreSistemaInformatico"": ""Odoo"", ""IdSistemaInformatico"": ""01"", ""Version"": ""16.0"", ""NumeroInstalacion"": 1, ""TipoUsoPosibleSoloVerifactu"": ""S"", ""TipoUsoPosibleMultiOT"": ""S"", ""IndicadorMultiplesOT"": ""N"", ""IDOtro"": {""IDType"": """", ""ID"": """"}}, ""FechaHoraHusoGenRegistro"": ""2025-09-22T15:05:28+00:00"", ""TipoHuella"": ""01"", ""Huella"": ""F72B5A15D5D7D6858A50F66CA51598B49C3836D69B05412D3056C388DC99F3BB""}}]","Se esta quejando del CIF del cliente. Por lo que veo no lo tenéis establecido. [SEP] Eso pensava yo, pero realmente está establecido el CIF en la ficha del cliente:

<img width=""1188"" height=""625"" alt=""Image"" src=""https://github.com/user-attachments/assets/52b9f32c-a800-4321-9399-ccf7c2cdfd6c"" />
 [SEP] ES bug, acabo de probarlo en runboat y el campo ID no se rellena con en cif 
""IDOtro"": {
                    ""CodigoPais"": ""FR"",
                    ""IDType"": ""02"",
                    ""ID"": ""FR""}
Aunque este establecido. 

De hecho esta mal aqui https://github.com/OCA/l10n-spain/blob/16.0/l10n_es_verifactu_oca/models/account_move.py#L447 [SEP] Ahora pongo el PR correspondiente. [SEP] > Ahora pongo el PR correspondiente.

Gracias @pedrobaeza  [SEP] Fix en #4398 "
Issue,4387,[16] l10n_es_verifactu_oca: Error when installing l10n_es_verifactu_oca on fresh Odoo 16 CE instance,"I'm trying to install the l10n_es_verifactu_oca module on a clean Odoo 16 CE instance, right after install the system. The installation fails with an error as soon as I try to install the module.

This is a brand-new Odoo environment with no other third-party modules installed. Please find the error message below.

Environment:
Odoo 16 CE
Python 3.9.7

Steps to reproduce:
1.- Install Odoo 16 CE (clean installation).
2.- Try to install the module.
3.- Error occurs during installation.

Please find the error message below.

RPC_ERROR
Odoo Server Error
Traceback (most recent call last):
  File ""/eclipse-workspace/16/odoo/odoo/tools/convert.py"", line 698, in _tag_root
    f(rec)
  File ""/eclipse-workspace/16/odoo/odoo/tools/convert.py"", line 533, in _tag_record
    raise Exception(""Cannot update missing record %r"" % xid)
Exception: Cannot update missing record 'l10n_es.fp_irpfnrnue24'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File ""/eclipse-workspace/16/odoo/odoo/http.py"", line 1638, in _serve_db
    return service_model.retrying(self._serve_ir_http, self.env)
  File ""/eclipse-workspace/16/odoo/odoo/service/model.py"", line 133, in retrying
    result = func()
  File ""/eclipse-workspace/16/odoo/odoo/http.py"", line 1665, in _serve_ir_http
    response = self.dispatcher.dispatch(rule.endpoint, args)
  File ""/eclipse-workspace/16/odoo/odoo/http.py"", line 1869, in dispatch
    result = self.request.registry['ir.http']._dispatch(endpoint)
  File ""/eclipse-workspace/16/odoo/odoo/addons/base/models/ir_http.py"", line 154, in _dispatch
    result = endpoint(**request.params)
  File ""/eclipse-workspace/16/odoo/odoo/http.py"", line 700, in route_wrapper
    result = endpoint(self, *args, **params_ok)
  File ""/eclipse-workspace/16/odoo/addons/web/controllers/dataset.py"", line 46, in call_button
    action = self._call_kw(model, method, args, kwargs)
  File ""/eclipse-workspace/16/odoo/addons/web/controllers/dataset.py"", line 33, in _call_kw
    return call_kw(request.env[model], method, args, kwargs)
  File ""/eclipse-workspace/16/odoo/odoo/api.py"", line 468, in call_kw
    result = _call_kw_multi(method, model, args, kwargs)
  File ""/eclipse-workspace/16/odoo/odoo/api.py"", line 453, in _call_kw_multi
    result = method(recs, *args, **kwargs)
  File ""<decorator-gen-77>"", line 2, in button_immediate_install
  File ""/eclipse-workspace/16/odoo/odoo/addons/base/models/ir_module.py"", line 74, in check_and_log
    return method(self, *args, **kwargs)
  File ""/eclipse-workspace/16/odoo/odoo/addons/base/models/ir_module.py"", line 475, in button_immediate_install
    return self._button_immediate_function(self.env.registry[self._name].button_install)
  File ""/eclipse-workspace/16/odoo/odoo/addons/base/models/ir_module.py"", line 599, in _button_immediate_function
    registry = modules.registry.Registry.new(self._cr.dbname, update_module=True)
  File ""<decorator-gen-16>"", line 2, in new
  File ""/eclipse-workspace/16/odoo/odoo/tools/func.py"", line 87, in locked
    return func(inst, *args, **kwargs)
  File ""/eclipse-workspace/16/odoo/odoo/modules/registry.py"", line 90, in new
    odoo.modules.load_modules(registry, force_demo, status, update_module)
  File ""/eclipse-workspace/16/odoo/odoo/modules/loading.py"", line 488, in load_modules
    processed_modules += load_marked_modules(cr, graph,
  File ""/eclipse-workspace/16/odoo/odoo/modules/loading.py"", line 372, in load_marked_modules
    loaded, processed = load_module_graph(
  File ""/eclipse-workspace/16/odoo/odoo/modules/loading.py"", line 231, in load_module_graph
    load_data(cr, idref, mode, kind='data', package=package)
  File ""/eclipse-workspace/16/odoo/odoo/modules/loading.py"", line 71, in load_data
    tools.convert_file(cr, package.name, filename, idref, mode, noupdate, kind)
  File ""/eclipse-workspace/16/odoo/odoo/tools/convert.py"", line 763, in convert_file
    convert_xml_import(cr, module, fp, idref, mode, noupdate)
  File ""/eclipse-workspace/16/odoo/odoo/tools/convert.py"", line 829, in convert_xml_import
    obj.parse(doc.getroot())
  File ""/eclipse-workspace/16/odoo/odoo/tools/convert.py"", line 749, in parse
    self._tag_root(de)
  File ""/eclipse-workspace/16/odoo/odoo/tools/convert.py"", line 711, in _tag_root
    raise ParseError('while parsing %s:%s, somewhere inside\n%s' % (
odoo.tools.convert.ParseError: while parsing /home/jesus/eclipse-workspace/apps/16/l10n-spain/l10n_es_verifactu_oca/data/account_fiscal_position_template_data.xml:109, somewhere inside
<record id=""l10n_es.fp_irpfnrnue24"" model=""account.fiscal.position.template"">
        <field name=""verifactu_tax_key"">01</field>
        <field name=""verifactu_registration_key"" ref=""verifactu_registration_keys_01""/>
    </record>

The above server error caused the following client error:
RPC_ERROR: Odoo Server Error
    RPCError@http://localhost:8069/web/assets/133-215f357/web.assets_backend.min.js:982:274
    makeErrorFromResponse@http://localhost:8069/web/assets/133-215f357/web.assets_backend.min.js:986:163
    jsonrpc/promise</<@http://localhost:8069/web/assets/133-215f357/web.assets_backend.min.js:994:34","Según parece, tienes un código de Odoo antiguo (que incluye el módulo l10n_es). Debes actualizar dicho código y volver a probar."
Issue,4385,l10n_es_facturae: Agregar factoring,"**Is your feature request related to a problem?**
No de forma directa, pero actualmente el archivo Facturae generado no contempla la posibilidad de incluir información sobre factoring (cesión de facturas), lo que limita su uso en operaciones financieras habituales.

**Describe the solution you'd like**
Propongo extender el facturae para incluir los campos necesarios que permitan registrar los datos de factoring y reflejarlos correctamente en el archivo XML.

Esto facilitará la trazabilidad de la cesión de facturas, permitirá automatizar procesos con entidades financieras y dará mayor flexibilidad a las empresas que operan con factoring.

Campos propuestos

is_factoring: Booleano que determina la visibilidad de los campos de factoring.
assignee_partner: Entidad a la que se cede la factura.
person_type_code: Tipo de persona: Jurídica (J) o Física (F).
residence_type_code: Tipo de residencia: Extranjero (E), Residente (R) o Residente en la Unión Europea (U).
factoring_clauses: Información adicional sobre la cesión.

Datos de pago asociados (podrían reutilizarse los de la propia factura, si aplica):
installment_due_date: Fecha de vencimiento.
installment_amount: Importe.
payment_means: Forma de pago.
account_to_be_credited: Cuenta bancaria de la entidad cesionaria.

```xml
<FactoringAssignmentData>
    <Assignee>
        <TaxIdentification>
            <PersonTypeCode>J</PersonTypeCode>
            <ResidenceTypeCode>R</ResidenceTypeCode>
            <TaxIdentificationNumber>XXXXXXXX</TaxIdentificationNumber>
        </TaxIdentification>
        <LegalEntity>
            <CorporateName>Caixabank, S.A.</CorporateName>
            <AddressInSpain>
                <Address>calle Pintor Sorolla, número 2-4</Address>
                <PostCode>46002</PostCode>
                <Town>Valencia</Town>
                <Province>Valencia</Province>
                <CountryCode>ESP</CountryCode>
            </AddressInSpain>
        </LegalEntity>
    </Assignee>
    <PaymentDetails>
        <Installment>
            <InstallmentDueDate>2025-09-11</InstallmentDueDate>
            <InstallmentAmount>1234.00</InstallmentAmount>
            <PaymentMeans>04</PaymentMeans>
            <AccountToBeCredited>
                <IBAN>XXXXXXXXXXXXXXXXX</IBAN>
            </AccountToBeCredited>
        </Installment>
    </PaymentDetails>
    <FactoringAssignmentClauses>
        Lorem ipsum.
    </FactoringAssignmentClauses>
</FactoringAssignmentData>

```

¿@pedrobaeza que opinas sobre esto? ¿Crees que faltaría alguna cosa a agregar?

Quedo atento a tu respuesta.

Saludos.","Creo que @etobella podría opinar mejor al respecto [SEP] Para esto lo correcto es hacer un modulo que extienda la funcionalidad. Obviamente se puede hacer en la OCA y lo revisaremos cuando se publique [SEP] Perfecto, estoy a la espera de comprobar si la implementación que he hecho funciona correctamente.

Lo que he planteado finalmente se basa en el modelo de unas facturas generadas con el programa de factura electrónica que un cliente utiliza con factoring y que le están funcionando correctamente.

La solución consiste en:

* Agregar los campos Literales Legales, donde se podrá incluir la información relativa al factoring.

* Incorporar los campos de Referencia Emisor y Referencia Receptor, para indicar explícitamente que la factura se emite con factoring.

* Definir la cuenta bancaria asociada al factoring, que se usará siempre que el modo de pago sea de tipo Especial (13), sustituyendo la cuenta del cliente por la de la entidad cesionaria.

Gracias. [SEP] Buenos días @pedrobaeza @etobella,

Que os parece si agrego los literales legales, y las referencias en el l10n_es_facturae, ya que creo que esto es útil para toda persona que use el facturae, y luego haga un módulo de extensión que agregue la opción de la cuenta bancaría de factoring?

¡Quedo atento!

Saludos. [SEP] @BernatObrador los LegalLiterals ya existen, simplemente deberás añadir una referencia en el caso del factoring. Primero haz el módulo y despés comprueba si lo necesitas. En la última versión del facturae se pasa un proceso para limpiar los que están vacios. [SEP] @etobella 
Por lo que vi en el report, y por eso los agregue, asegurándome de que cada uno no haga más de 250 char, es que en el reporte está así:
`<LegalLiterals t-if=""False"" />`
Y en ningún lado se computan estos.

Con el cliente ya hemos hecho la prueba y ha funcionado bien con la manera que os digo, agregando las referencias, literales legales y una cuenta da factoring, que será la de la entidad que cesionaria, para que si el tipo de pago es especial (13), se sustituya la cuenta bancaría en el pago, por esta, en lugar de la del cliente.

Hoy si me da tiempo subo las PR's, si no ya será el lunes! Os voy comentando.

Muchas gracias por vuestro tiempo.

Saludos. [SEP] Implementado en #4417 "
Issue,4381,[16] l10n_es_verifactu_oca account_move_view.xml duplicado en manifest.py,"Tras instalar en el log el nuevo módulo de verifactu, en el log me salía un warning: views/account_move_view.xml is imported twice in module l10n_es_verifactu_oca data

En __manifest__.py se ha declarado dos veces la misma línea: views/account_move_view.xml",Solucionado en #4403
Issue,4376,[16] l10n_es_verifactu_oca : 1177 | El valor de campo IdSistemaInformatico del bloque SistemaInformatico es incorrecto.,"Hola,

Estoy probando el módulo l10n_es_verifactu_oca en Odoo 16 y me encuentro con el siguiente problema al enviar facturas a la AEAT:

Error devuelto por AEAT:

1177 | El valor de campo IdSistemaInformatico del bloque SistemaInformatico es incorrecto

he probado un UUID tipo : 00fbbf73-7472-43fb-a237-cc4e57f4aaf6, un simple ""2"" y no hay forma...

¿Hay algún requisito adicional en el módulo o en la configuración para que AEAT acepte el campo IdSistemaInformatico?
¿El módulo espera que se use UUID, valor numérico o algún registro interno que se declare en otra parte?

Agradecería cualquier orientación, ya que parece que el XML cumple el esquema pero la AEAT sigue devolviendo el 1177.

Gracias de antemano 🙏",Hola! Si tienen que ser dos dígitos.   [SEP] Mil gracias! Funciona!
Issue,4375,[16] l10n_es_verifactu_oca: Punto de Venta,"Quería consultar si está en desarrollo la adaptación del punto de venta de odoo a veri*factu por parte de oca.
Muchas gracias.
Saludos.","Sí, aquí lo tienes: https://github.com/OCA/l10n-spain/pull/4357

y de hecho es una de las razones para tener la versión OCA."
Issue,4374,[16.0] [FIX] l10n_es_verifactu_oca Error 1100 en el envío de facturas,"****Provide a general summary of the issue in the Title above.
Before opening the issue, please check that there isn't another issue addressing the same problem already created **

> Al realizar el envío de las facturas a la AEAT a través de Veri*Factu nos encontramos con los siguentes errores:
1100 | Valor o tipo incorrecto del campo: IdSistemaInformatico
1100 | Valor o tipo incorrecto del campo: NIF


**Module
The name of the module that has a bug.**
l10n_es_verifactu_oca

**Describe the bug**
**A clear and concise description of what the bug is.**
Tras realizar las configuraciones correspondientes para el funcionamiento del módulo, al generar el envío de las facturas a la AEAT nos encontramos con los errores arriba mencionados.


## To Reproduce
****Affected versions**:**
Versión 16.0

**Steps to reproduce the behavior:**
1. Instalación del módulo
2. Cargar Certificado AEAT
3. Creación registro de encadenamiento
4. Creación registro de desarrolladores
5. Configuración pestaña Veri*Factu en Compañía
6. Alta nueva factura de venta
7. Ejecutar manualmente Acción planificada ""Enviar facturas a VERI*FACTU"".
8. Revisión información pestaña Veri*Factu dentro de la factura en cuestión.
9. Reproducción de los errores indicados.

****Expected behavior**
A clear and concise description of what you expected to happen.**
Resultado del ""Estado de envío"" de Veri*Factu ""Enviado"".

****Additional context**
Add any other context about the problem here. (e.g. OS, Python version, ...)**
Se han realizado pruebas basadas en la declaración responsable de Odoo o inclusive, otras, como la que adjunto en la captura 1 y captura 2.

<img width=""755"" height=""394"" alt=""Image"" src=""https://github.com/user-attachments/assets/ef0d71e5-53f9-4c1f-956d-5694e7f39b28"" />

<img width=""1343"" height=""561"" alt=""Image"" src=""https://github.com/user-attachments/assets/4cb157e6-656f-4f06-a361-aa267db1e601"" />","El ID del SIF y el NIF informados deben haber sido dados de alta en Hacienda para poder hacer estas pruebas. [SEP] Hola, el NIF tiene que ser valido, el del desarrollador, AEAT lo comprueba, y el SIF id, se refiere a los dos digitos que indicas en la declaración responsable y se tienen que dar de alta en la referencia del encadenamiento. 

<img width=""751"" height=""259"" alt=""Image"" src=""https://github.com/user-attachments/assets/37f1938f-a130-4a2a-98c5-e74c855196ba"" /> [SEP] Buenos días, Pedro:

Disculpa, pero si el software es Odoo, hay que poner lo que indica la declaración responsable de Odoo, ¿no habiendo sido ellos los que han desarrollador el módulo? Adjunto captura.

<img width=""1236"" height=""398"" alt=""Image"" src=""https://github.com/user-attachments/assets/65439e9c-0cbb-440c-a630-b989eb6616c6"" />

¿Será que cada partner deberá hacer una declaración responsable y darse de alta en la AEAT?

Gracias de antemano por la ayuda.
 [SEP] Bueno, Odoo puede no cubrirte si no es un Odoo online. Cuando llegue la primera denuncia se sabra... Pon ahí lo que estiméis oportuno. [SEP] No hay que darse de alta en la AEAT, pero si que tendrá que firmar alguien la declaración responsable indicando que el software cumple con la legalidad. Puede ser el mismo cliente el que lo firme. Esto esta confirmado con AEAT, ya que al ser de código abierto puede que tu como implantador no puedas asegurar que cumple. Odoo se ha puesto el pero me parece arriesgado ya que esta en la versión community y cualquiera puede modificar ese código en una instalación on-premise [SEP] Muchas gracias, Anmarmo1!"
Issue,4372,[16] l10n_es_verifactu_oca: Cleva de registro no asignado por defecto en Posiciones fiscales,"¡Muchas gracias a todos los contribuidores!

Hoy estoy realizando pruebas.

Después de instalar, configurar y activar VeriFactu, incluso ay tiene asignado la clave de registro mapeado por defecto, debe seleccionar manualmente la «Clave de registro» en Facturación/Contabilidad > Configuración > Posiciones fiscales > Regimen ancional/Recargo de Equivalencia...», Cualquier Regimen que utilice en la factura.

De lo contrario, la validación de la factura mostrará el mensaje «Sin clave de registro».
El problema que he encontrado es que, incluso después de seleccionar la clave correspondiente en los elementos fiscales, la factura sigue dar mismo erro. Es necesario cancelar esta factura y volver a crear otra para que pase la validación y envío por VeriFactu.
 
Por algun motivo, veo que odoo 16 con contablidad esapaña, crea primer factura borrador con numeracion asignado como INV/2025/00001, no como un factura borrador normal sin numero, y eso pasa solo en su primer factura.
Pues ya no puedes tener primer factura con numero 00001, vas a tener con 00002.

Saludos. 

","Lo siento por mis disvistes !!

He visto se puede actualizar todo los posicines fiscales para registrar las nuevas claves de Verifactu por modulo ""account_chart_update"" segun pone en README.rst del ""l10n_es_verifactu_oca"":
- Establecer en las posiciones fiscales la clave de impuestos y la clave de registro VERI*FACTU.
- Para aplicar las claves ejecute el asistente de actualización del módulo accountchart_update.

En concreto:
            Install addons: account_chart_update
                # https://github.com/OCA/account-financial-tools.git

            Settings > Invoicing > Update Chart Template: Update char template
                Next:
                    Check Fiscal positions

                Create/update, then cloes

Creo que esta reuslto mis dudas.

Muchas gracias !!"
Issue,4368,[IMP] Backport OCA Verifactu,"**¿Tu solicitud de funcionalidad está relacionada con algún problema?**
Todas las empresas españolas requieren adaptarse a la normativa contable de la que se deriva Verifactu. Contamos con una versión del módulo OCA para 16.0 aunque lo necesitamos instalar en Odoo 14.0

**Describe la solución que te gustaría**
Contar con el backport a 14.0

**Describe las alternativas que has considerado**
Hacer el backport de la versión 17.0 de Odoo. Considero que el de OCA es más flexible y es mi opción preferida

**Contexto adicional**

**Comenzaremos los trabajos de migración en breve** con el deseo de tenerlo migrado en Octubre del 25 si es que las condiciones son favorables.

Mi compañero @ljimenezsidoo y yo trataremos de iniciar la parte técnica ASAP. Cualquier apoyo será más que bienvenido, quedando muy agradecido del trabajo realizado en la versión 16.0","Hola @flachica me consta que @acysos tenía pensado llevarlo a la V15, también.

Según lo que he hablado con @pedrobaeza , como los cambios de V16 hacia V14 y V15 son bastante similares, sería conveniente que podáis unir esfuerzos y coordinaros.

En caso de que necesitéis revisiones, puedo aportar mi granito de arena.

Gracias. [SEP] @acysos, al enterarse finalmente dice que backportea a 13.0. Aún así, no sé si duplicamos esfuerzos. Bienvenidos tus aportes @HaraldPanten  [SEP] > [@acysos](https://github.com/acysos), al enterarse finalmente dice que backportea a 13.0. Aún así, no sé si duplicamos esfuerzos. Bienvenidos tus aportes [@HaraldPanten](https://github.com/HaraldPanten)

Y si lo lleváis entonces vosotros a V14 y a V15? Nosotros a V13 no lo necesitamos.

Si fuera necesario miramos cómo organizarnos para repartilo.

Ya nos dices @flachica  [SEP] Si. Mi idea es tener una PR en 14.0 antes de que finalice Octubre @HaraldPanten  [SEP] Por favor, portearlo a V13 tambien, no se si los cambios de V13 a V14 son muy profundos... [SEP] @flachica yo puedo ayudar tambien a nivel funcional en revisiones.
 [SEP] > Por favor, portearlo a V13 tambien, no se si los cambios de V13 a V14 son muy profundos...

Si no lo lleva a cabo @acysos de forma voluntaria, también puedes abonar un importe a otros contribuidores para que lo hagan.

Un saludo. [SEP] He renombrado el hilo para ser más amplio, puesto que no solo estamos hablando de la versión 14. [SEP] ¡Hola! A no ser que @acysos indique que ya tiene algo iniciado de la adaptación a Odoo 15, desde Batista10 (@B10Serveis) podríamos encargarnos de ello (probablemente partiendo de la adaptación a la 16). Por supuesto, toda ayuda en revisiones y sugerencias sería muy bienvenida. 🙂  [SEP] Mejor partir de la 14 que de la 16, ya que en 16 se hizo una refactorización previa que habría que volver a extraerla para 15, lo que en la de la 14 ya se ha hecho. [SEP] Gracias @pedrobaeza, tomo nota. 🙂  [SEP] Para facilitar el seguimiento del tíquet: el PR #4377 de @ljimenezsidoo para la migración a 14 ya ha sido mezclado, he creado #4503 para la migración a 15. [SEP] #4503 (Odoo 15) ha sido mezclado también. 🚀  [SEP] Voy a dar esta issue por cerrada, ya que se ha llevado Verifactu a 14.0, 15.0, 16.0 y 17.0.

En 18.0 acabará llegando por necesidad, según procedimiento habitual de contribuciones, mientras que <14.0 debería tener un uso muy residual.

Cualquier cosa podemos reabrir hilo. [SEP] En 18 ya está también... [SEP] sabéis si se va a realizar backport a v13?
se sabe algo de que va a pasar con el tpv de odoo para verifactu?

gracias [SEP] De momento nadie ha expresado su interés en pasarlo a 13. Es demasiado antiguo... Del TPV puedes mirar los diversos pull requests abiertos para ello."
Issue,4366,[16] l10n_es_verifactu_oca,"Hola, he instalado el reciente múdulo publicado de VERIFACTU y al generar la factura el cron, me devulve el siguiente error.


```
2025-09-07 16:45:23,800 28900 ERROR db odoo.addons.base.models.ir_cron: Call from cron Send invoices to VERI*FACTU for server action #655 failed in Job #30

Traceback (most recent call last):
  File ""/ opt/ odoo/ odoo16-venv/lib/ python3.8/ site-packages/ zeep/xsd/valueobjects . py"", line 154, in __getattribute__
    return self.__values__[key]
KeyError: 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):

  File ""/opt/odoo/odoo16/odoo/tools/safe_eval . py"", line 362, in safe_eval
    return unsafe_eval(c, globals_dict, locals_dict)
  File ""ir. actions. server(655,)"", line 1, in <module>
  File ""/opt/odoo/odoo16/verifactu/l10n_es_verifactu_oca/models/verifactu_invoice_entry. py"", line 141, in _cron_send_documents_to_verifactu
    outdated_records.with_context(
  File ""/opt/odoo/odoo16/verifactu/l10n_es_verifactu_oca/models/verifactu_invoice_entry. py"", line 318, in _send_documents_to_verifactu
    create_response_activity = self._create_response_lines(
  File ""/opt/odoo/odoo16/verifactu/l10n_es_verifactu_oca/models/verifactu_invoice_entry. py"", line 335, in _create_response_lines
    respuestaLineas = verifactu_response.get(""RespuestaLinea"", [])
  File ""/opt/odoo/odoo16-venv/lib/python3.8/site-packages/zeep/xsd/valueobjects. py"", line 156, in __getattribute__
    raise AttributeError(
AttributeError: RespuestaRegFactuSistemaFacturacionType instance has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File ""/opt/odoo/odoo16/odoo/addons/base/models/ir_cron. py"", line 368, in _callback
    self.env['ir.actions.server'].browse(server_action_id).run()
  File ""/opt/odoo/odoo16/odoo/addons/base/models/[ir_actions.py](http://ir_actions.py/)"", line 668, in run
    res = runner(run_self, eval_context=eval_context)
  File ""/opt/odoo/odoo16/odoo/addons/base/models/ir_actions. py"", line 538, in _run_action_code_multi
    safe_eval(self.code.strip(), eval_context, mode=""exec"", nocopy=True, filename=str(self))  # nocopy allows to return 'action'
  File ""/opt/odoo/odoo16/odoo/tools/[safe_eval.py](http://safe_eval.py/)"", line 376, in safe_eval
    raise ValueError('%s: ""%s"" while evaluating\n%r' % (ustr(type(e)), ustr(e), expr))
ValueError: <class 'AttributeError'>: ""RespuestaRegFactuSistemaFacturacionType instance has no attribute 'get'"" while evaluating
'model._cron_send_documents_to_verifactu()'
```

A que puede ser debido?","también he probado el addon y tengo también error en el cron, he seguido el desarrollo y la versión tester de hace 1 mes funcionaba, ahora que sube las facturas solo con el cron, también me da error,. [SEP] Probad por favor usando #4367 y decís si ya os sale correcto. [SEP] Buenos días, probado y funcionando. Muchas gracias. [SEP] correcto con los cambios indicados, gracias. seguiremos probando y si sale algo mas lo reportare.
gracias [SEP] Fusionando entonces. [SEP] Hola, he instalado el modulo verifactu en la version 16 y me pide como configuracion en las compañias el codigo del desarrollador, como pudiera obtener ese codigo, Gracias"
Issue,4358,[IMP] Fiscalidad Zona Especial Canaria (ZEC),"Artículo sobre la **Fiscalidad de la Zona Especial Canaria (ZEC):**
[Fiscalidad en la Zona Especial Canaria (ZEC)](https://www.youasesoria.com/fiscalidad-de-la-zona-zec-en-canarias/) 

La ZEC es un régimen fiscal especial en Canarias con una tributación reducida y ciertas particularidades en materia de **IVA/IGIC, IS, retenciones e impuestos locales**.

Algunos puntos interesantes:
1. Tipo impositivo reducido en el **Impuesto sobre Sociedades (IS) al 4%** para entidades inscritas en el Registro Oficial de Entidades de la ZEC que es una gran difrencia si se compara con la de Madrid.

2. Exención sobre los impuesto sobre la Renta de no Residentes (IRNR) siempre y cuando cumpla algunas condiciones como:
     * Si una empresa de la ZEC reparte los dividendos a una empresa extranjera.
     * Si las operacions de la empresa se realizan dentro de Canarias.
     * Los intereses y ganancias patrimoniales se obtengan sin establecimiento permanente.

3. Las empresas de la ZEC están exentas de IGIC (el IVA canario) lo que permite un mejor intercambio de operaciones dentro de la zona especial.

4. También existe exención en ITP y AJD (Transmisiones Patrimoniales y Actos Jurídicos Documentados).

Para estas facilidades que brinda esta zona especial se requieren algunos requisitos fundamentales, por ejemplo:
1.  Ser una [empresa de nueva creación](https://www.youasesoria.com/constituir-una-sociedad-sin-capital-social/), entre los detalles más interesantes esta que  con 1€ puedes abrir tu propia empresa, INCREIBLE. [Ley 18/2022 de 28 de septiembre](https://www.boe.es/diario_boe/txt.php?id=BOE-A-2022-15818)

2. Dirección efectiva y domicilio en Canarias.

3. Alguno de los administradores debe ser residente permanente en Canarias.

4. Realizar inversiones mínimas en activos fijos.

5. Generar empleos un minímo de empleos en zonas capiitalinas y no capitalinas.

6. La actividad que realiza la empresa debe estar dentro de las autorizadas en la ZEC (logística,software, etc.)

7. Presentar una Memoria Descriptiva que justifique la viabilidad y contribución al desarrollo regional.


Funcionalidad deseada:

Crear un **módulo específico para ZEC** que permita:
  * Crear un nuevo régimen/fiscalidad llamado “ZEC” dentro de las opciones de fiscalidad de Odoo.
  * Registrar entidades/empresas bajo este régimen.
  * Aplicar reglas de cálculo de impuestos específicas para ZEC (tipos impositivos, bases, exenciones, deducciones, etc.).
  * Integración con facturación, libros contables y reportes fiscales para ZEC.","Hola, no veo una aplicación muy directa de eso en la gestión del ERP, pero si teneis algo específico, comentadlo. [SEP] Hola @pedrobaeza le agregue más detalles al Isuues, digame que le parece, gracias [SEP] De acuerdo, entonces entiendo que será un nuevo plan contable ""IGIC (ZEC)"" o similar. [SEP] Si correcto @pedrobaeza es la idea "
Issue,4341,[18.0] Migration de Integración de FACe a v18,"El envío de la factura electrónica a FACe ha cambiado mucho con los años:

en v11 y v12 usabamos un model dentro de l10n_es_facturae en el que permitiamos diferentes integraciones (Como FACe  y e.Fact)

A partir de v13 empezamos a usar el framework de EDI de OCA que està basado parcialmente en los modelos comentados.

El problema que nos surge es que el Framework de EDI es bastante complejo y añade una capa de complejidad bastante importante (connector, queue job...).

Personalmente se me ocurren 3 opciones:

1. Usar el account_edi de Odoo, pero tiene 2 limitaciones:
    1. No contempla de forma correcta el envío una segunda vez (complica los reintentos)
    2. No contempla la recepción de información externa
2. Crear de nuevo unos modelos sencillos dentro de FACe. Al no tener e.Fact, la cosa es mucho más sencilla ahora, aunque implicará hacer algo ""parecido"" pero mucho más simplificado a lo hecho por el framework
3. Seguir con el framework de OCA

¿Cual es vuestra opinión?","Hola,
No veo mal que haya un módulo para gestiona las comunicaciones, ya que da mucha más versatilidad a OCA. El problema que veo es que el framework EDI le ha pasado como al contract, ha evolucionado mucho y de tener una orientación sencilla de utilización ha pasado a ser un monstruito jaja.
¿Cabe la posibilidad de separación y adaptación del framework EDI?

Según estuve mirando en su día el punto 1 no lo veo viable. El punto 2, me gustaría no realizarlo ya que realizar módulos bases de comunicaciones es muy útil, a lo mejor ... añadir un apartado a los videos donde se explicase el funcionamiento de framework EDI ¿podría estar bien @etobella ?

Creo que como has comentado enric, el camino natural ha ido a la extracción de ese apartado, no veo del todo bien volver hacía atrás, si no, que se tendría que simplificar. ¿Creación de otro módulo de comunicaciones más sencillito? (pero eso se podría conseguir con el refactor y separación del framework edi ¿correcto?)
 [SEP] ¿No podríamos hacer como con SII, que solo se necesitan unos cuantos campos de control? Realmente el resto de información se ha demostrado no demasiado útil, y más si hay una plataforma como FACe detrás, donde la misma ya registra la actividad. A efectos prácticos, solo necesitamos saber si se ha enviado o no, y error en caso de que no. [SEP] Seria otra opción, si, por eso eran las ideas que se me ocurrían por ahora. De todas formas, si simplificasemos el EDI Framework no lo vería mal yo
 [SEP] El tema es depender de la migración de ese framework en cada versión para tener esto operativo, y más si se da integración por lo de la ley ""Crea y crece"". En ese sentido deberíamos ser más autónomos. Por eso también se quiso quitar de en medio `queue_job` en el SII. [SEP] También depende de otros módulos, aunque el edi-framework acostumbra a ser el más complejo.

Además, la ley crea y crece no irá con facturae, así que si deberá ser con un módulo diferente (y sus respectivos campos y tal) [SEP] Cuantos menos módulos haya en la pila, mejor, y algunas dependencias son lógicas (como `l10n_es_facturae`), pero todo el framework EDI no. [SEP] En eso estoy de acuerdo @pedrobaeza De todas formas, el problema no es el edi-framework, es todo lo que lleva incorporado (queue job, connector....) que tiene una arquitectura demasiado compleja 😢  [SEP] Pues entonces sí que estás de acuerdo, porque el tema es que esa pila es demasiado compleja, y en 18 o cortamos por lo sano, o esa supuesta refactorización del EDI no va a llegar, porque ya hay una parte de la pila fusionada y otros no van a querer cambiarla, y mientras, seguiremos sin tener este módulo disponible. [SEP] A nivel de pilas de módulos obviamente sería mejor integrarlo en el propio y listo, pero veo mejor que exista uno base para que el máximo de módulos se pueda beneficiar de ello, como actualmente está el framework-EDI. Estoy de acuerdo en que la dependencia tecnológica de ese módulo es muy grande y hay puntos de los cuales se quiere ""huir"" (job_queue) como pasó con el SII (también se podría mirar de adaptar el módulo para el queue o triggers de odoo, según configuración o extensiones).
Según lo veo yo si integramos esta conexión directamente en el módulo, estamos ""cerrando"" y duplicando funcionalidades que actualmente están genéricas. Está bien que hayan módulos bases para circuitos de comunicaciones, ya que estamos viendo que cada vez es más común. [SEP] Yo no veo que tenga tanta base compartida, pero si acaso, esa base podría ir en `l10n_es_aeat` como hicimos con SII/VeriFactu. [SEP] Pero entonces si otros módulos se quieren aprovechar de esas funcionalidades si no son del repo l10n-spain, no podrán.
Por otro lado, esta característica podría necesitarse o no ¿es necesario ponerlo en el l10n_es_aeat? Ya que en general no gusta ampliar ese módulo. [SEP] ¿Pero qué funcionalidad se va a reaprovechar? A ver, dejemos de hablar en abstracto. Aquí no hay nada reaprovechable realmente. Lo dicho, al final tenemos unos campos de estado de envío/error, y el código que llama a la API de FACe. Por eso digo que no hay que complicarse. Teniendo librerías Python para esas comunicaciones, y que se inicializan con dos líneas y se envían datos con otras 2, dejemos de montar capas abstractas que si `edi_webservice`, y sustituyendo código por configuraciones raras que continuamente cualquier cambio hacía que ya no saliera un botón o que no se enviara.

Lo dicho, tenemos el antecedente del SII donde no hay complicación. Y lo de `l10n_es_aeat` era siguiendo vuestra línea de razonamiento, pero que efectivamente, aquí no hay código compartido con nada. Lo otro de SII/VeriFactu era porque las estructuras de datos que se envían son iguales en ambos, y sí es más cantidad de código. [SEP] @pedrobaeza Se reaprovechan cosas. Yo en mi caso tengo clientes que envían las facturas de múltiples formas dependendiendo de cliente y el funcionamiento de EDI ayuda un montón.

Personalmente estoy de acuerdo que el stack de edi-framework es demasiado complejo al depender de component y de queue_job y me ofrezco a eliminar esas dependencias para simplificar el stack. PEro de eso a cargarnos el concepto, pues veo muchos problemas. Sobretodo cuando venga la factura electrónica obligatoria en UBL, en el que reinventaremos la rueda según tu idea para generar los ficheros y el envío, ya que el de FACe no nos servirá (desconocemos aún la forma de envío, pero los ficheros seran distintos al 100%). Además que tendremos que notificar los pagos, con lo que tendremos un doble flujo de entrada (envío de facturas de venta, recepción de compras, envío de estado de compras....) Todo esto ya está contemplado en EDI y nos lo simplifica bastante si lo mejoramos un poco.

Sé que personalmente no es fruto de tu devoción el framework de EDI, pero creo que hacerlos completamente separados cada vez no aportan nada. Es mejor buscar una base común más sencilla en mi opinión [SEP] @pedrobaeza con algo así como lo verías? Se quitaria la mayor parte del stack extra dejando solo el edi_oca, que nos permite gestionar la generacioń y envío. Obviamente no pondríamos más dependencias que las explicadas
 [SEP] https://github.com/OCA/edi-framework/pull/192#issuecomment-3166786574 [SEP] El problema es que esto no va a estar en 18. [SEP] Se puede hablar con el equipo EDI y hacer comunicacion en el contributors de la OCA si es necesario y el concepto cuadra para todos [SEP] Bueno, primero habría que conseguir eso, y luego ver cómo se queda finalmente. [SEP] PArece que irá a buen puerto, con lo que podemos plantear el cambio ya en v18. simplificandonos la vida a todos."
Issue,4338,"SII, envío de facturas DUA, o DUA exento","Hola!

Hay un cambio en el método _compute_sii_enabled del módulo del SII en Odoo 17 respecto a la 16 y me gustaría conocer si hay alguna razón legal o de otro tipo para ello. Puesto que hay empresas que quieren enviarlas al SII y en la 17 no se puede.

En Odoo 16 no se excluyen las facturas con DUA Exento: https://github.com/OCA/l10n-spain/blob/16.0/l10n_es_aeat_sii_oca/models/account_move.py#L799

En Odoo 17 se excluyen facturas con DUA exento: https://github.com/OCA/l10n-spain/blob/17.0/l10n_es_aeat_sii_oca/models/account_move.py#L812

El cambio se hace en un commit en el que el objetivo principal era otro, a mi entender: https://github.com/OCA/l10n-spain/commit/b982fcf160546c494b9494425d50c0c66e6cfd37

Como no he encontrado nada en la AEAT al respecto y tengo entendido que no es dañino enviar todas las facturas exentas de impuestos o no, hago la pregunta a los expertos de la localización 😄 

Saludos!","@AaronHForgeFlow no te has saltado esta sobreescritura en el módulo `l10n_es_dua_sii` de la 16?

https://github.com/OCA/l10n-spain/blob/16.0/l10n_es_dua_sii/models/account_move.py#L47

Lo que se hace en la 17 es integrar y adaptar ese otro módulo, porque el DUA ya está en `l10n_es`. [SEP] @pedrobaeza claro, en la 16.0 estaba por separado 🤦  

De todas formas dejo el issue abierto a ver si alguien da una razón funcional/legal de por qué es así. No he encontrado nada. [SEP] La razón es porque la factura original del proveedor extranjero no hay que enviarla. La AEAT dice que no pasa nada por enviarla (claro, ellos quieren cuanta más información de ti, mejor), pero como no es obligatoria, no se envía. [SEP] @pedrobaeza  Vale! muchas gracias! "
Issue,4302,[18.0][FIX] l10n_es_aeat: No se muestra nombre archivo para descargar,"## Module
l10n_es_aeat

## Describe the bug
En versión 18.0 al generar cualquier archivo que genera el wizard de exportación a BOE no se muestra el nombre del archivo si no que aparece lo que ocupa el archivo.
<img width=""1160"" height=""605"" alt=""Image"" src=""https://github.com/user-attachments/assets/904caab7-ae2e-4f30-aa0a-a4c659ba7ff3"" />

## To Reproduce
**Affected versions**: 18.0

Steps to reproduce the behavior:
1. Generar cualquier modelo AEAT.
2. Calcular, Confirmar y exportar a BOE.
3. Exportar en el wizard que aparecerá.
4. En vez de aparecer el nombre del archivo para descargar aparece el tamaño del archivo.

**Expected behavior**
Cuando se genera el archivo de exportación a BOE en el wizard debería aparecer el nombre del archivo en vez del tamaño.

@moduon MT-10948",
Issue,4291,[16] l10n_es_ticketbai_pos: Ticketbai no construida aun.,"Se ha generado la primera factura simplificada sin problema, la comunicación correcta. Pero al ir a realizar la segunda factura ""FS2500002"" aparece un error de que Ticketbai no esta construido aun.

![Image](https://github.com/user-attachments/assets/bbfc13bc-0186-4c18-b243-19ef62d4ae5b)

También hemos comprobado que no hay forma de enviar una factura simplificada sin identificación, cuando no deberia de ser imprescindible el NIF en las facturas simplificadas no?","Esto sucede porque no tiene el codigo postal el cliente definido. Esta definido como un campo obligatorio para el envió del ticketbai cuando no deberia ser asi no? [SEP] Buenas @Joaco1980 
No entiendo muy bien como reproducir el error que comentas.
Yo he realizado dos ventas en el POS sin seleccionar cliente y no me da ningún error. Las ventas ""facturas simplificadas"" se envían correctamente a TBAI. [SEP] > Buenas [@Joaco1980](https://github.com/Joaco1980) No entiendo muy bien como reproducir el error que comentas. Yo he realizado dos ventas en el POS sin seleccionar cliente y no me da ningún error. Las ventas ""facturas simplificadas"" se envían correctamente a TBAI.

Vale para replicarlo, crear un cliente nuevo ""PEPITO FLORES"" y déjale sin CP introducido, mete si quieres provincia, país y todos los datos que consideres pero deja vacío el CP. 

Es ahi donde da el error que comento, ademas si recargas la pagina y vuelves a crear el ticket se crea correctamente pero falla la transmisión y da error cuando haces un ticket después de este error:

ES): El XML del fichero TicketBAI no cumple el esquema.[Linea:2 Columna:1706] Error:cvc-pattern-valid: Value 'aN-aN-NaN' is not facet-valid with respect to pattern '\d{2,2}-\d{2,2}-\d{4,4}' for type 'FechaType'.(EU): TicketBAI fitxategiaren XMLak ez du eskema betetzen.[Linea:2 Columna:1706] Error:cvc-pattern-valid: Value 'aN-aN-NaN' is not facet-valid with respect to pattern '\d{2,2}-\d{2,2}-\d{4,4}' for type 'FechaType'.

Concretamente da un error de validación con la fecha de la factura anterior que la deja asi en el xml:
<FechaExpedicionFacturaAnterior>aN-aN-NaN</FechaExpedicionFacturaAnterior>

Yo estoy subiendo los tickets con error en la subida manualmente en el LROE poniendo esa fecha bien no se si es la manera correcta de hacerlo pero al menos se validan, porque el botón de Cancelar y recrear no sirve en este caso concreto. [SEP] Efectivamente si el cliente no tiene CP salta el error.
`TypeError: Cannot read properties of undefined (reading 'number_prefix')`
 
Seguido de este error, el comportamiento al refrescar etc... pues ya puede ser cualquier cosa. Efectivamente es un BUG a corregir.

ping @rrebollo 
¿Como lo ves para corregir este problema?


NOTA: También recuerdo que quedo pendiente mejorar el módulo para que funcionara con el cambio de  posición fiscal.
 [SEP] @Bilbonet puedo ocuparme del error pero definamos antes la conducta a seguir: ¿Debemos hacer un mejor tratamiento de excepciones y loguear el error concreto: un log indicando que el CP es requerido o el CP no es realmente requerido y podemos continuar con el flujo normal? [SEP] Buenas @rrebollo , muchas gracias por el ofrecimiento.

El tema del TicketBAI funciona en las tres provincias vascas por separado. Lo digo porque aunque la normativa es común podría haber alguna pequeña diferencia. Yo voy a comentar basándome en el TicketBAI de Bizkaia ""BFA"".

Adjunto documento con las especificaciones del envío para el alta de facturas por si necesitas comprobar alguna otra cosa.

Respecto al error que nos ocupa. EL CP del  destinatario NO es un dato obligatorio. Bastaría con evitar que de error cuando se encuentra con este campo vacio.

<img width=""1058"" height=""589"" alt=""Image"" src=""https://github.com/user-attachments/assets/7f5ae03c-0b01-4977-85df-6e828a8bdf3e"" />

▪ Letra roja: Bloque/Campo obligatorio. 
▪ Letra negra: Bloque/Campo opcional. 
▪ Fondo rosa: Bloque/Campo excluyente. 

Quedo a tu disposición para cualquier otra aclaración 😊


[LROE_PJ_240_Alta_V1_0_0.pdf](https://github.com/user-attachments/files/22563391/LROE_PJ_240_Alta_V1_0_0.pdf) [SEP] @Bilbonet perfecto. Lo miro. Sucede que tenemos algunos issues también en una instalación de ticketbai pos en 16.0 y queremos ir descartando causas. Así que puedo aprovechar y corregir este issue también. Al cliente en cuestión le fallan algunos tickets en POS porque la secuencia que genera está repitiendo valores: el valor que sugiere ya está ocupado. Me atrevo a consultarte. ¿Que crees que podríamos revisar? Uno de los temas fundamentales es la imposibilidad de reproducir el bug porque ocurre esporádicamente y no están claras las condiciones que lo desencadenan. [SEP] Genial @rrebollo , para todo lo que necesites no dudes en contactarme.

Respecto a lo que comentas de los duplicados mira esto #3984 
Cualquier cosa me comentas. [SEP] @Bilbonet @Joaco1980 he estado tratando de replicar el error originalmente reportado en este issue en el runboat pero estoy stuck en que el POS no carga el certificado.

<img width=""982"" height=""423"" alt=""Image"" src=""https://github.com/user-attachments/assets/e426a437-16c3-4bea-b38d-cea81e0678ce"" />

Estoy usando los datos de pruebas que se usan en los test automatizados. Alcanzo a ver que los certificados que vienen tanto en l10n_es_ticketbai como l10n_es_ticketbai_api parecen expirados.

<img width=""1679"" height=""336"" alt=""Image"" src=""https://github.com/user-attachments/assets/2c142cbf-be18-42ec-88eb-db6a76b56ee2"" />

¿Me está faltanto alguna configuración? ¿donde puedo obtener un juego de datos apropiado para las pruebas?

Solo de cargar el POS tengo 👇 error en consola del browser

<img width=""560"" height=""189"" alt=""Image"" src=""https://github.com/user-attachments/assets/d15c00b3-7521-4ed2-b69c-7d2420d66252"" /> [SEP] aqui tienes certificados para pruebas

https://www.batuz.eus/fitxategiak/batuz/lroe/batuz_lroe_ziurtagiriak_kit_certificados_v1_0_3.7z





Get Outlook for Android<https://aka.ms/ghei36>
________________________________
From: Rolando Pérez Rebollo ***@***.***>
Sent: Sunday, September 28, 2025 2:13:30 PM
To: OCA/l10n-spain ***@***.***>
Cc: Jesus (Bilbonet) ***@***.***>; Mention ***@***.***>
Subject: Re: [OCA/l10n-spain] [16] l10n_es_ticketbai_pos: Ticketbai no construida aun. (Issue #4291)

[https://avatars.githubusercontent.com/u/38138332?s=20&v=4]rrebollo left a comment (OCA/l10n-spain#4291)<https://github.com/OCA/l10n-spain/issues/4291#issuecomment-3343099649>

@Bilbonet<https://github.com/Bilbonet> @Joaco1980<https://github.com/Joaco1980> he estado tratando de replicar el error originalmente reportado en este issue en el runboar pero estoy stuck en que el pos carga el certificado

image.png (view on web)<https://github.com/user-attachments/assets/e426a437-16c3-4bea-b38d-cea81e0678ce>

Estoy usando los datos de pruebas que se usan en los test automatizados. Alcanzo a ver que los certificados que vienen tanto en l10n_es_ticketbai_pos como l10n_es_ticketbai_api parecen expirados.

image.png (view on web)<https://github.com/user-attachments/assets/2c142cbf-be18-42ec-88eb-db6a76b56ee2>

¿Me está faltanto alguna configuración, donde puedo obtener un juego de datos apropiado para las pruebas?

—
Reply to this email directly, view it on GitHub<https://github.com/OCA/l10n-spain/issues/4291#issuecomment-3343099649>, or unsubscribe<https://github.com/notifications/unsubscribe-auth/AB6MT4GNY2WXFNFMA7LJGJL3U7GGVAVCNFSM6AAAAACBXYIWOOVHI2DSMVQWIX3LMV43OSLTON2WKQ3PNVWWK3TUHMZTGNBTGA4TSNRUHE>.
You are receiving this because you were mentioned.Message ID: ***@***.***>
 [SEP] > El tema del TicketBAI funciona en las tres provincias vascas por separado. Lo digo porque aunque la normativa es común podría haber alguna pequeña diferencia. Yo voy a comentar basándome en el TicketBAI de Bizkaia ""BFA"".

@Bilbonet, si miramos:

https://github.com/OCA/l10n-spain/blob/0ba2de3db3f42dc16af7504e2329b4036582dce9/l10n_es_ticketbai_api/models/ticketbai_invoice.py#L939-L953

☝️ código indica que Gipuzkoa es la excepción. 
(Aclaro que este fragmento **no** es el que se ejecuta en el módulo `l10n_es_ticketbai_pos`, pero lo encontré como un hallazgo interesante durante el análisis del issue).

Pregunto porque tengo listo un fix para el error reportado aquí, pero ahora tengo que refinarlo porque hay diferencias de comportamiento entre las agencias. [SEP] @rrebollo interesante.
Corrijo: Parece que 'Bizkaia/Vizcaya' es la excepción ""que infierno 😥"".

Pues parece que en facturación ya se dio este problema y fue solventado. Imagino que lo mas sencillo sería aplicar el mismo procedimiento en el POS.
Pero lo que tu prefieras. Por mi como si se pone ZIP obligatorio para todas. En este caso tampoco me parece muy importante hilar fino 😊.
 [SEP] > @rrebollo interesante.
> Corrijo: Parece que 'Bizkaia/Vizcaya' es la excepción ""que infierno 😥"".
> 
> Pues parece que en facturación ya se dio este problema y fue solventado. Imagino que lo mas sencillo sería aplicar el mismo procedimiento en el POS.
> Pero lo que tu prefieras. Por mi como si se pone ZIP obligatorio para todas. En este caso tampoco me parece muy importante hilar fino 😊.
> 

Yo creo que solo deberia de ser obligatorio si el destinatario lleva NIF y quiere deducirse por cualquier motivo el IVA, ahí si se obliga a introducir el ""domicilio"" que supongo que incluya el ZIP.

Precisamente las facturas simplificadas es para simplificar la facturación diaria, si exigimos completar todos esos campos que diferencia tenemos con hacer una factura de toda la vida? 

Una tienda que lo utiliza necesita agilidad en la venta, y si quiere asignar un cliente por tema estadístico y de control de ventas no debería tener que pedir tantos datos, es mi opinión.

En cualquier caso toméis la decisión que toméis el tema es que el error no permite arreglarlo introduciendo el ZIP y volver a crear el ticket, o sale sin QR a posteriori y no se crea en el backend, o borras la cache del navegador y vuelves a crearlo y esta vez si se realiza pero da el error de la fecha del ticket anterior en la trasmision, hay que modificarlo manualmente el xml y subirlo al LROE [SEP] > Yo creo que solo deberia de ser obligatorio si el destinatario lleva NIF y quiere deducirse por cualquier motivo el IVA, ahí si se obliga a introducir el ""domicilio"" que supongo que incluya el ZIP.
> 
> Precisamente las facturas simplificadas es para simplificar la facturación diaria, si exigimos completar todos esos campos que diferencia tenemos con hacer una factura de toda la vida?
> 
> Una tienda que lo utiliza necesita agilidad en la venta, y si quiere asignar un cliente por tema estadístico y de control de ventas no debería tener que pedir tantos datos, es mi opinión.

Si claro. El BUG es solo cuando identificas al cliente. Si es una venta anónima no hay error.


 [SEP] @Bilbonet cuando finalmente he podido dilucidar una estrategia para adaptar el código en l10n_es_ticketbai_pos y lograr hacer opcional el CP descubro que bizkaia está definida cómo tbai.tax.agency en el addon l10n_es_ticketbai_batuz. Esto técnicamente implica que para corregir ""bien"" el issue tendríamos que hacer depender el primer addon mencionado del segundo y ya no puedo evaluar que otras repercusiones tendría esto. En este momento me inclino por dejarlo tal y como está. Ya que habría que ocuparse de temas de diseño más serios antes de abordar este. @Joaco1980 lo siento. Si te sirve de algo eso solo está validando que el zip sean 5 dígitos consecutivos so ... [SEP] Ya veo que se ha definido en los módulos de Batuz. Ciertamente esto lo complica 😔.
https://github.com/OCA/l10n-spain/blob/435ca7a53c5ee325f21d50d00306147b29ec55b7/l10n_es_ticketbai_api_batuz/data/tax_agency_data.xml#L5

A estas alturas y viendo que no creo que TBAI de OCA pase de la versión 16.0. Mejor seguir con la mismo estrategia y plantear un nuevo módulo que realice estas correcciones:

-  **l10n_es_ticketbai_pos_batuz**

 [SEP] A mi me parece bien que no toquéis nada pero que al menos ese error no implique no poder avanzar, es decir, si no hay zip en la validación que salte un error de que falta el zip y al menos que te deje volver al cliente, introducir un zip y volver a intentar la transmisión del ticket con el zip.

Ahora el comportamiento es el siguiente: 
- Salta el error de construcción
-  Si luego intentas hacer el ticket le hace pero sin QR de TBAI, puede incluso saltar la secuencia o ni realizarse en el backend. 
- Hay que borrar cache del navegador y volver a realizar la venrta
-  Genera el ticket bien con el QR pero falla el xsig porque el campo de fecha de factura anterior le deja vacío aN-aN-aNNN. 
 
Es como si en todo el proceso perdería la referencia del ticket anterior. Esto implica un error en la transmisión a la hacienda vasca, hay que descargarse el xsig, ponerle la fecha correctamente y subirlo manualmente al LROE.  [SEP] > A estas alturas y viendo que no creo que TBAI de OCA pase de la versión 16.0. Mejor seguir con la mismo estrategia y plantear un nuevo módulo que realice estas correcciones

Vi algo de que ticketbai está disponible en Odoo ¿Enterprise o Community a partir de que versión? Y powered by @ao-landoo y su team creo. [SEP] @Joaco1980 madurando esa última idea

> A mi me parece bien que no toquéis nada pero que al menos ese error no implique no poder avanzar,

Tal vez algo se pueda hacer. Viendolo desde la perspectiva que planteas, el problema fundamental es que ese error ya salta durante la generación del ticket, tal vez si colocamos una validación al momento de escoger el cliente (el detalle es que realmente la validación ignorará el comportamiento para Bizkaia: todos los clientes tienen que tener CP de 5 dígitos) @Bilbonet ¿Que crees?

 [SEP] > > A estas alturas y viendo que no creo que TBAI de OCA pase de la versión 16.0. Mejor seguir con la mismo estrategia y plantear un nuevo módulo que realice estas correcciones
> 
> Vi algo de que ticketbai está disponible en Odoo ¿Enterprise o Community a partir de que versión? Y powered by [@ao-landoo](https://github.com/ao-landoo) y su team creo.

TicketBAI esta diponible en el core de Odoo desde la 16.0. Pero no en el POS.
TicketBAI en el POS se que está en la 18.0 no lo sé seguro si esta en la 17.0    [SEP] > [@Joaco1980](https://github.com/Joaco1980) madurando esa última idea
> 
> > A mi me parece bien que no toquéis nada pero que al menos ese error no implique no poder avanzar,
> 
> Tal vez algo se pueda hacer. Viendolo desde la perspectiva que planteas, el problema fundamental es que ese error ya salta durante la generación del ticket, tal vez si colocamos una validación al momento de escoger el cliente (el detalle es que realmente la validación ignorará el comportamiento para Bizkaia: todos los clientes tienen que tener CP de 5 dígitos) [@Bilbonet](https://github.com/Bilbonet) ¿Que crees?

Pues si, me parece mejor poner una restricción general. 
**Que se obligue a poner CP si identificas al cliente, sea cual sea la hacienda,**
Es peor dejar el error actual. Que según comenta @Joaco1980 hace un estropicio importante cortar la ejecución con el error actual.

 [SEP] @Joaco1980 ¿podremos cerrar este issue entonces?"
Issue,4289,Error al actualizar l10n-spain,"Buenas tardes
Estoy intentando actualizar el modulo de AEAT desde OCA l10n-spain en la version 17.
Puede ser que este realizando alguna cosa mal, y si alguien puede ayudarme se lo agradeceria. 
Lo que hago es sustituir los la carpeta por la nueva para poder instalar los nuevos modulos, pero me da un fallo de Internal Server al intentar cargarlo. 
Cual seria el orden para la actualizacion, ya que me da un error en la base de datos al actualizarlo ""psycopg2.errors.UndefinedColumn: column res_partner.aeat_simplified_invoice does not exist""

Cuando vuelvo a situar los archivos anteriores en la carpeta addons todo vuelve a la normalidad. 

Muchas Gracias",
Issue,4286,Sii Grecia,"Hola, en una 17 al enviar factura de un cliente Griego al sii devuelve con el 1104 valor del campo ID incorrecto hasta que he cambiado el código del país de GR a EL, cosa que luego gereraria otros errores?

alguien mas tiene esto?
saludos","Hola, ¿podéis identificaros adecuadamente en lugar de un nick genérico? Así se sabe con quién se está hablando. [SEP] lo detecte esta mañana y le dije de cambiarlo para que funcionará, se llama Patrick. En ocasiones algunos impuestos usan para grecia GR y otros EL (el nuevo es EL desde hace muchos años)  [SEP] There hasn't been any activity on this issue in the past 6 months, so it has been marked as stale and it will be closed automatically if no further activity occurs in the next 30 days.
If you want this issue to never become stale, please ask a PSC member to apply the ""no stale"" label. [SEP] Hola, estoy teniendo un problema similar.

Actualmente, el VAT del partner está configurado con el prefijo EL, que es el formato correcto según VIES para Grecia. Sin embargo, al notificar la factura al SII, el envío es rechazado indicando un error en la clave codigoPais, ya que el SII espera el código ISO GR y se está enviando EL.

Si se modifica el VAT del partner y se establece el prefijo GR, el envío al SII vuelve a fallar, en este caso indicando que el ID es incorrecto, ya que el VAT deja de ser válido.

El comportamiento esperado por parte del SII es que se envíe:

codigoPais: GR

ID: ELXXXXXXXXX

Por lo que hemos podido analizar, el envío actual utiliza el mismo prefijo tanto para el código de país como para el identificador, lo que dificulta cumplir simultáneamente con los requisitos de VIES y del SII en este caso concreto. [SEP] Analizando el comportamiento con más detalle, creo que el origen del problema puede estar en la siguiente línea de código:
[
        country_code_map = {""EL"": ""GR""}](https://github.com/OCA/l10n-spain/blob/878690ccf0bdf1cd83b008824fe9bd0992630391/l10n_es_aeat/models/res_partner.py#L60)

En concreto, si esta clave no estuviese definida, el flujo posterior parece que podría ajustarse mejor al comportamiento esperado por el SII en este caso, permitiendo enviar codigoPais = GR mientras se mantiene el ID con el prefijo EL, que es el formato válido según VIES. [SEP] Esto se solucionó en #4753 y #4754"
Issue,4272,Verifactu,"¿Sabemos si ya hay algún modulo o está previsto hacer alguno para integrar Verifactu en odoo 17? el 1 de enero ya es obligatorio y deberíamos poder comenzar a realizar pruebas.

Recordad que también para los tickets de tpv/pos

Gracias!","Odoo está incluyendo en el core de 17 un módulo para la gestión de Verifactu, y aquí en OCA, cuando se complete el desarrollo en 16, se migrará a 17. Busca por favor las referencias correspondientes."
Issue,4271,[18.0] ¿Hay planes de migrar l10n_es_aeat_mod190?,"Hola!

¿Está prevista la migración del módulo **l10n_es_aeat_mod190** a Odoo 18.0?

Actualmente estábamos usando este módulo en 16.0 y es fundamental para nuestro proyecto.  

Si puedo ayudar probando o colaborando con la migración, quedo atento.

Gracias por el esfuerzo!","Hola, Nacho, por no abras incidencias para este tipo de cosas que se recopilan y tratan en el [hilo dedicado a la propia migración](https://github.com/OCA/l10n-spain/issues/3754). En cualquier caso, si tan fundamental es para vuestro proyecto, lo que podéis hacer es:

- Realizar la migración vosotros y contribuirla a OCA.
- Financiar a un contribuidor para que la haga por vosotros.

Si no, no está garantizado ningún plazo de realización. Cuando uno de los contribuidores que suelen migrar lo necesite, lo llevará a cabo y probablemente lo contribuya de vuelta en OCA, pero sin garantías expresas ni obligaciones.

Cierro por lo dicho que no debe haber hilos en incidencias sobre cosas que no lo son."
Issue,4262,[16] l10n_es_aeat_mod123 No recoge las factura rectificativas,"El modelo 123 recoge las retenciones e ingresos a cuenta del IRPF, del Impuesto sobre Sociedades o del Impuesto sobre la Renta de No Residentes relacionados con determinadas rentas del capital mobiliario.

**Esto también incluye las facturas rectificativas ya que estas corrigen retenciones ya declaradas**

 Hemos hecho pruebas en runboat y las facturas rectificativas no se están recogiendo y por tanto lo declarado está incompleto

Dejo captura de las facturas:

![Image](https://github.com/user-attachments/assets/5048b7ca-5c00-4b97-8c0d-f21312f548d4)

Y de lo que se recoge en el modelo 123

![Image](https://github.com/user-attachments/assets/46b77f0c-2397-4326-926d-b9bbc2fd334d)

@rafaelbn @EmilioPascual @HaraldPanten @pedrobaeza 

MT-10771","Sería incluir el tipo de operación, pero hay que asegurar que funcionan minorando la misma casilla, o si van de otra forma. [SEP] El modelo 123 no tiene casillas específicas para facturas rectificativas por lo que tiene que ir minorando los importes

![Image](https://github.com/user-attachments/assets/fb452898-e318-455d-9f0d-9ee961779de0) [SEP] Sería entonces si no estoy equivocado, cambiar esta línea y la siguiente a ""both"" en lugar de ""credit"":

https://github.com/OCA/l10n-spain/blob/18.0/l10n_es_aeat_mod123/data/2024/l10n.es.aeat.map.tax.line.csv#L4 [SEP] Pero parece ser que hay que hacer más cosas según https://github.com/OCA/l10n-spain/pull/4220#issuecomment-3024074700 [SEP] He respondido en este PR que hizo @omar7r : https://github.com/OCA/l10n-spain/pull/4220

La cuestión es que la norma solo aplica si debes ingresar más pero no es de menos.


1. Si la factura rectificativa aumenta la retención:

- Debes presentar un modelo 123 complementario del trimestre original.

- Fundamento: artículo 4.3 de la Orden HAP/1608/2014.


2. Si la factura rectificativa reduce la retención:

- No se modifica el modelo 123 ya presentado.

- Si se ingresó de más, debes solicitar una devolución de ingresos indebidos.

- Fundamento: artículo 221.1 de la Ley General Tributaria.

---
Referencias:

Modelo 123 AEAT: https://sede.agenciatributaria.gob.es/Sede/procedimientoini/GC27.shtml

Orden HAP/1608/2014: https://www.boe.es/diario_boe/txt.php?id=BOE-A-2014-8121

Ley General Tributaria: https://www.boe.es/buscar/act.php?id=BOE-A-2003-23186


@moduon @omar7r  [SEP] https://github.com/OCA/l10n-spain/pull/4220#issuecomment-3024303414 [SEP] There hasn't been any activity on this issue in the past 6 months, so it has been marked as stale and it will be closed automatically if no further activity occurs in the next 30 days.
If you want this issue to never become stale, please ask a PSC member to apply the ""no stale"" label."
Issue,4237,"[12.0] AEAT file exports are not valid (mod303, mod390)","<!-- Provide a general summary of the issue in the Title above.
Before opening the issue, please check that there isn't another issue addressing the same problem already created -->

From a few months ago AEAT file ecports cannot be used because the format has changed.

## Module
The name of the module that has a bug.
mod303
mod390

## Describe the bug
A clear and concise description of what the bug is.

File format has changed and they are not valid any more

## To Reproduce
**Affected versions**:

Try to file reports to ARAT

Steps to reproduce the behavior:
1. Generate model 303/390
2. Export file
2. File report to AEAT
3. File format is invalid

**Expected behavior**
A clear and concise description of what you expected to happen.
Backport changes from odoo 16

**Additional context**
Add any other context about the problem here. (e.g. OS, Python version, ...)","La rama 12.0 es una rama obsoleta y ya no se mantiene ""oficialmente"". También se junta que el soporte de las herramientas de CI para esa rama está obsoleto (por el propio GitHub), con lo que aquí debes buscar la forma de traer esos cambios, aunque mi recomendación es que migres de versión. [SEP] Gracias Pedro, intentaré actualizarme con openupgrade."
Issue,4223,[17.0][IMP] Rendimiento búsqueda cliente l10n_es_account_statement_import_n43,"La búsqueda de contactos al importar un fichero con extractos utilizando el módulo l10n_es_account_statement_import_n43 necesita ser mejorada, ya que el tiempo que consume cuando en la base de datos hay muchos contactos es demasiado elevado.

Actualmente existen 4 métodos de búsqueda de contactos, correspodientes a 4 bancos distintos:
- Caixabank
- Santander
- Bankia
- Sabadell

Caixabank y Santander buscan a los contactos por VAT o por number; Bankia los busca por VAT solamente, y Sabadell realiza la búsqueda únicamente por nombre. Propongo lo siguiente para mejorar el rendimiento:
- Seleccionar los bancos cuyas lógicas tienen que considerarse para realizar las búsquedas
- Seleccionar si las búsquedas se quieren realizar por VAT o nombre por cada uno de los bancos seleccionados
- Dar la opción de no realizar la búsqueda de contactos
- Quizás podría eliminarse la búsqueda de Bankia

Asimismo, la búsqueda por VAT para el Santander utiliza un operador ilike. Sin embargo, Caixabank y Bankia utilizan un operador =. ¿Alguien podría indicarme a qué se debe esa diferencia? ¿No sería posible unificar criterios? Cualquier propuesta/opinión es bienvenida.

Muchas gracias","@pedrobaeza Podrías echar un vistazo? Gracias! [SEP] He comentado esto en el foro, hay algunos bancos que ni el VAT te ponen. He tenido que hacer algo para poner el partner_id con una importación de extractos por xlsx. Modificando fichero. [SEP] Esto quedó solucionado eligiendo a nivel de diario lo que se quiere hacer, así que cierro."
Issue,4213,[17.0] l10n_es_sii_oca | No envía algunas facturas,"<!-- Provide a general summary of the issue in the Title above.
Before opening the issue, please check that there isn't another issue addressing the same problem already created -->

## Module
l10n_es_sii_oca

## Describe the bug
Cuando se pulsa en el botón enviar al SII se queda cargando pero no hace nada, no envía todas las facturas al sii, solo algunas y no nos devuelve ningún error.","Me temo que la información proporcionada no es suficiente. Revisa la fecha y hora a la que tiene programado el envío, y si tu instancia puede ejecutar acciones planificadas. Por lo demás, debería funcionar correctamente.

Cierro mientras no tengamos más información que pueda llevarnos a deducir que es un problema del módulo."
Issue,4211,[14.0] l10n_es_ticketbai_pos: Error en recargo de equivalencia,"## Module
l10n_es_ticketbai_pos

## Describe the bug
Al realizar una ticket de venta con la posición fiscal “[Recargo de Equivalencia](https://odoo16.masterlan.es/web?debug=1#id=6&model=account.fiscal.position)” genera mal el fichero .xsig con los detalles de la factura simplificada y hacienda rechaza la factura.

**El XML de la factura, en el detalle del impuesto de recargo, no esta pasando el valor correcto ""S"". **
 

Ejemplo:

```
	<TipoDesglose>
		<DesgloseFactura>
			<Sujeta>
				<NoExenta>
					<DetalleNoExenta>
						<TipoNoExenta>S1</TipoNoExenta>
						<DesgloseIVA>
							<DetalleIVA>
								<BaseImponible>126.00</BaseImponible>
								<TipoImpositivo>21.00</TipoImpositivo>
								<CuotaImpuesto>26.46</CuotaImpuesto>
								<OperacionEnRecargoDeEquivalenciaORegimenSimplificado>N</OperacionEnRecargoDeEquivalenciaORegimenSimplificado>
							</DetalleIVA>
							<DetalleIVA>
								<BaseImponible>126.00</BaseImponible>
								<TipoImpositivo>5.20</TipoImpositivo>
								<CuotaImpuesto>6.55</CuotaImpuesto>
								<OperacionEnRecargoDeEquivalenciaORegimenSimplificado>N</OperacionEnRecargoDeEquivalenciaORegimenSimplificado>
							</DetalleIVA>
						</DesgloseIVA>
					</DetalleNoExenta>
				</NoExenta>
			</Sujeta>
		</DesgloseFactura>
	</TipoDesglose>
```


## To Reproduce
Configurar el terminal para aceptar diferentes posiciones fiscales.
Hacer una venta con la posición fiscal ""Recargo de Equivalencia""

**Affected versions**: ...14.0 / 15.0 / 16.0

","@Bilbonet ¿podrías tal vez indicarme donde encontrar el formato correcto? [SEP] Buenas @rrebollo 
Como se puede ver en el XML que he puesto de ejemplo. Si te fijas en el detalle del IVA.
La parte del recargo de equivalencia la indica mal con el valor ""N"".
Devería ser asi:
`<OperacionEnRecargoDeEquivalenciaORegimenSimplificado>S</OperacionEnRecargoDeEquivalenciaORegimenSimplificado>`

Si realizas una factura Ticketbai con recargo de equivalencia funciona bien. Son las ventas del POS las que sale este valor mal. 
 [SEP] Estimado @Bilbonet
**Problema**: 
- Las implementaciones no gestionan la posición fiscal, ejemplo: v14 https://github.com/OCA/l10n-spain/blob/edfd729da0de8614aad56379c68eb5e8fcd86cac/l10n_es_ticketbai_pos/static/src/js/tbai_models.js#L194-L209

En v16 no mezclado aún:

https://github.com/BinhexTeam/l10n-spain/blob/544ca459119d1d607e8d8ca75fb534f5ff7cac2e/l10n_es_ticketbai_pos/static/src/js/tbai_models.js#L241

- Parece un enfoque técnico simplificado

**Consulta**:
A la luz de estos elementos te parece que sea intencional (por diseño) o es una limitación a corregir? Pregungo por confirmar el enfoque antes de proponer cambios técnicos. [SEP] Buenas @rrebollo

No he analizado a fondo el código que muestras y al mirarlo por encima tengo una duda.
¿Esa parte que muestras del código no se refiere a la posición fiscal de la compañía?
Para el caso que tratamos es la posición fiscal del cliente la que interviene para el desglose de los impuestos. [SEP] > Buenas [@rrebollo](https://github.com/rrebollo)
> 
> No he analizado a fondo el código que muestras y al mirarlo por encima tengo una duda. ¿Esa parte que muestras del código no se refiere a la posición fiscal de la compañía? Para el caso que tratamos es la posición fiscal del cliente la que interviene para el desglose de los impuestos.

Exacto. Solo se tiene en cuenta la company. Creo que desde el punto de vista técnico hay un tratamiento ""ingenuo"" del feature por eso me parece que es una limitación desde el diseño. En el caso del addon ticketbai pos es únicamente desde este código que indico que se le asigna valor al elemento ""OperacionEnRecargoDeEquivalenciaORegimenSimplificado"" del xml. [SEP] Ok entiendo.
Entonces mas que un bug ya estamos hablando de una mejora que habría que implementar.
  [SEP] @Bilbonet entiendo que hay un referente porque desde la app de contabilidad el proceso funciona correctamente así que podría mirarse el código allí (asumo que mayormente python) y trasladar la idea hacia donde corresponda en ticketbai pos (python y js) muy probablemente. Aclarar desde el punto de vista del negocio el panorama para técnicos como yo podría ser la clave: ¿si el cliente tiene una posición fiscal de Recargo de Equivalencia el IVA se comportará igual que en el régimen simplificado? es que no creo que este cambio lo único que afecte sea el valor del tag OperacionEnRecargoDeEquivalenciaORegimenSimplificado al generar el xml. [SEP] No entiendo porque han hecho esta simplificación la verdad.
Puede ser que el desarrollo viene de versiones anteriores del POS donde igual no se podían utilizar diferentes posiciones fiscales de cliente. Y en ese caso pues no correspondía añadir dicha lógica.

Peor por lo que yo conozco desde v14.0 el POS permite diferentes posiciones fiscales así que entiendo que tiene que funcionar igual que en financiero.

De hecho, el POS hace bien el calculo del IVA (parte del core de Odoo). 
Es la parte de TBAI la que no mira el detalle del impuesto si es <OperacionEnRecargoDeEquivalenciaORegimenSimplificado> (desarrollo TBAI).

Respecto a la pregunta que planteas, no se si hay otros caso en los que no este haciendo correctamente el envío TBAI. Pero es muy probable que también ocurra con otras posiciones fiscales como intracavitarias etc...

De momento las facturas simplificadas con recargo de equivalencia la hacienda de Bizkaia las está rechazando:
```
Código:   	B4_2000031
Descripción	(ES): Valor del Tipo impositivo no admitido.
``` [SEP] @Bilbonet gracias por el inside. Creo que como dices probablemente esté relacionado con el hecho de que orgininalmente el POS no permitía usar múltiples posiciones fiscales. Tengo esto en mis issues pendientes. Mirando lo hecho para contabilidad tal vez se pueda trasladar el comportamiento a pos o encontrar alguna solución para incorporar el feature. [SEP] There hasn't been any activity on this issue in the past 6 months, so it has been marked as stale and it will be closed automatically if no further activity occurs in the next 30 days.
If you want this issue to never become stale, please ask a PSC member to apply the ""no stale"" label."
Issue,4207,Estado modelo l10n_es_aeat_mod592,"He estado revisando el estado del desarrollo del modelo 592 de Hacienda y he observado que hace un tiempo se encontraba en pleno desarrollo. Sin embargo, desde entonces no he visto nuevas actualizaciones al respecto.

Me gustaría saber si el proyecto sigue en curso y si está previsto que se publique próximamente para las versiones 14 y 16.

Quedo atento a su respuesta.
Un cordial saludo.","Está fusionado en el repositorio:

https://github.com/OCA/l10n-spain/tree/15.0/l10n_es_aeat_mod592"
Issue,4206,[18.0] delivery_gls_asm: url incorrect,"<!-- Provide a general summary of the issue in the Title above.
Before opening the issue, please check that there isn't another issue addressing the same problem already created -->

## Module
The name of the module that has a bug.
delivery_gls_asm

## Describe the bug
A clear and concise description of what the bug is.
El fallo viene cuando validas un albaran con el metodo de envio de ""GLS"" ya que si intentas hacer el rastreo desde el magin button ""Rastreo"" te envia a una url que empieza por asm en vez de a la gls españa.

![Image](https://github.com/user-attachments/assets/b3bee134-9ed1-4ec4-ad02-c8c7c6d0cb22)

## To Reproduce
**Affected versions**:

Steps to reproduce the behavior:
1.
2.
3.

**Expected behavior**
A clear and concise description of what you expected to happen.

**Additional context**
Add any other context about the problem here. (e.g. OS, Python version, ...)
El `_tipo` siempre me devuelve una ""C"" en vez de una ""N"" y no se si es por alguna configuración o es que no funciona de forma correcta el modulo con el magic button

![Image](https://github.com/user-attachments/assets/a41dc038-0dd1-48da-848b-7da58a1e6865)","@pedrobaeza Si puedes revisar esto y decirme si es por culpa de configuración o si esta obsoleto lo del `_tipo` [SEP] No te puedo decir ahora mismo, porque ahora mismo no tenemos ninguno en activo con este transportista. Hasta hace poco, la antigua URL de ASM funcionaba. Tal vez la han cambiado. [SEP] @pedrobaeza Solo hay que cambiar la url a una mas actual, ya que he tenido que llamar a los de gls y me han dado la url que se tiene que utilizar y voy a hacer los fix de las version 14.0, 16.0 y 17.0, ya que en la version 18 hay un pr de una compañera mia que lo añadira ella.

La nueva url:

![Image](https://github.com/user-attachments/assets/eac7191e-5a32-45b9-ac94-870680a1460a)

El pr de la migración:
https://github.com/OCA/l10n-spain/pull/4090 [SEP] Cierro al estar ya los PRs."
Issue,4198,Odoo 17 Instalo In10n_spain i no veo IVA n nada,"He instalado en las version 17 el modulo In10n_spain  y tengo activada la contabilidad completa en comunity pero no veo ninguna de las funciones , Iva y demas , ma falta algo¿. Mil gracias","Hola, no existe ningún módulo con ese nombre. Dirige por favor tus consultas al foro de AEOdoo, al no tratarse de problemas de los módulos en si, si no de uso."
Issue,4197,Prorrata - No Aparece el campo Porrrata en la compañía,Tengo community 18 ge instalado el modulo y no se ve el click de la prorrateándoos ni el porcentaje. ,"Los módulos de prorrata no están aún migrados a dicha versión, por lo que es normal que los de una versión anterior no funcionen adecuadamente en la siguiente."
Issue,4196,[IMP] l10n_es_cnae: Incorporación de la nueva clasificación CNAE 2025,"**¿Tu solicitud de funcionalidad está relacionada con algún problema?**  
Sí. Actualmente, el módulo `l10n_es_cnae` está basado en la versión de la Clasificación Nacional de Actividades Económicas (CNAE) del año 2009, pero recientemente el Instituto Nacional de Estadística (INE) ha publicado la nueva versión **CNAE 2025**, que entrará en vigor oficialmente en **2026**. Esta actualización afecta a todos los autónomos y empresas españolas, que ya están empezando a recibir notificaciones para revisar o actualizar su actividad en IMPORTASS. La versión actual del módulo quedará desfasada en breve, y puede inducir a error en nuevas implantaciones o desarrollos.

---

**Describe la solución que te gustaría**  
Actualizar el módulo `l10n_es_cnae` incorporando la nueva clasificación CNAE 2025. La solución podría incluir:

- La carga completa de los nuevos códigos CNAE 2025 y sus descripciones.
- Mantener los códigos CNAE 2009 actuales para asegurar compatibilidad con datos históricos.
- Añadir una tabla de correspondencias entre CNAE 2009 y CNAE 2025 para facilitar la migración de registros existentes.
- Posiblemente indicar un campo “válido desde” para marcar la vigencia de cada versión de clasificación.

---

**Describe las alternativas que has considerado**  
- Mantener dos versiones de la clasificación en el módulo, permitiendo seleccionar cuál usar desde la configuración.
- Ofrecer un asistente o script que permita migrar automáticamente los códigos CNAE actuales (2009) al código CNAE 2025 equivalente, en los casos en que exista correspondencia directa.

---

**Contexto adicional**  
- El CNAE es la adaptación española de la clasificación europea NACE.  
- La nueva versión **CNAE 2025** está alineada con la actualización europea **NACE Rev. 2.1**, aprobada por el Reglamento Delegado (UE) 2023/137.  
- La estructura, descripciones y tablas de equivalencia entre CNAE 2009 y CNAE 2025 están publicadas por el INE en:  
  https://www.ine.es/daco/daco42/cnae/cnae2025.htm  
- Más información sobre NACE Rev. 2.1 en:  
  https://ec.europa.eu/eurostat/web/nace/overview  
- Esta actualización no solo tiene implicaciones estadísticas, sino también administrativas y legales, por lo que es recomendable adaptar el módulo con antelación.

Esta mejora permitirá que las instalaciones de Odoo en España mantengan la coherencia con los nuevos requisitos oficiales y eviten errores en la clasificación de actividades económicas a partir de 2026.


##Novedades
---------

**[2025] CNAE 2025**

Esta localización se actualizará próximamente para incluir la nueva clasificación CNAE 2025, publicada por el INE y alineada con la NACE Rev. 2.1 europea.

- Entrada en vigor: 1 de enero de 2026.
- Fuente oficial: https://www.ine.es/daco/daco42/cnae/cnae2025.htm

La actualización incorporará:

- Nuevos códigos CNAE 2025 con sus descripciones.
- Compatibilidad con códigos CNAE 2009 para mantener la trazabilidad de datos históricos.
- Tabla de correspondencia entre CNAE 2009 y 2025.
","Exel oficial de equivalencias

https://www.ine.es/daco/daco42/clasificaciones/cnae25/Correspondencia_CNAE25_CNAE09.xlsx"
Issue,4185,[17.0] l10n_es_aeat_mod303 Error en laz casillaz 74 y 62 del mapeo.,"Buenos días!

Revisando el mapeo del modelo 303, me he dado cuenta de que la casilla 74 ""Importe de las adquisiciones de bienes y servicios a las que sea de aplicación o afecte el régimen especial del criterio de caja conforme a la ley general de devengo contenida en el artículo 75 de LIVA - Base imponible"" tiene un error en el campo ""Tipo de campo"" (field_type). Por la naturaleza de la casilla, debería ser de tipo ""Base"". Sin embargo, es del tipo ""Importe"", igual que la casilla 75 (donde esa configuración si que es correcta), por lo que cuando se usa el criterio de caja, las 2 casillas van a mostrar la misma información:

![Image](https://github.com/user-attachments/assets/6e48bbf5-cd96-4db9-83ba-00cee2d3167f)

Por defecto, ninguna de las 2 casillas tienen impuestos mapeados y hay que añadirlos manualmente en caso de usar el criterio de caja. Aún así, vendría bien que la casilla viniese configurada de manera correcta por defecto, en vez de tener que cambiar la configuración en cada base de datos en la que se use esa casilla (que serán pocas, pero la gente que presenta impuestos a última hora frecuentemente va a descubrir el error recién cuando suba el archivo a Hacienda).

Pasa lo mismo con las casillas 62 y 63, también relacionadas al criterio de caja.

Quedo a la espera de sus comentarios.

Un saludo","Da igual, porque esas casillas no se rellenan con nada, y están ahí solo ""de adorno"". Haría falta migrar el módulo de criterio de caja, que las alimenta, y además creo recordar que se hace manualmente sin seguir esa configuración.

Cierro por no ser un problema real."
Issue,4178,[17.0]l10n_es_aeat_mod303: Error casilla 120 impuesto no sujeto por reglas de localización,"Las ventas y rectificativas de Canarias, Ceuta y Melilla, Aeat indica que se declaran en la casilla 60 y no la 120 que está mapeada en el impuesto.

![Image](https://github.com/user-attachments/assets/ddc9cb5c-53bd-49da-b10a-a8cbfe23a7d5)


![Image](https://github.com/user-attachments/assets/59d21f80-e89a-4852-a935-f68bfe773dbe)

https://sede.agenciatributaria.gob.es/Sede/todas-gestiones/impuestos-tasas/iva/modelo-303-iva-autoliquidacion_/instrucciones.html","Si es así, creo que también se debería modificar la casilla 84 y pasar ese impuestos a la casilla 94. [SEP] Y aunque no se si este comentario vendría aquí o se debería abrir un nuevo issue en caso de aprobar el cambio que propone @pedroortega-punt en el mod. 303, creo que en el mod. 390 se debería cambiar el impuesto de la casilla 110 a la 104. [SEP] @TesseraTech4 He realizado la consulta telefónica al departamento de IVA y me han informado que los bienes a la casilla 60 y la prestación de servicios a la casilla 120, por lo que habría que cambiar el mapeo del impuesto de bienes a la casilla 60. [SEP] There hasn't been any activity on this issue in the past 6 months, so it has been marked as stale and it will be closed automatically if no further activity occurs in the next 30 days.
If you want this issue to never become stale, please ask a PSC member to apply the ""no stale"" label."
Issue,4173,[16.0][IMP] l10n_es_aeat_mod347: Establecer como No válido en multicompañía,"Al calcular el modelo 347, el sistema recoge automáticamente los registros de operaciones anuales con un importe superior a 3.005,06 €. Sin embargo, algunos de estos registros no deben declararse porque ya se incluyen en otros modelos o porque no existe obligación fiscal.

Actualmente, no se puede marcar en los contactos la opción de ""No declarar en el 347"", ya que, en multicompañía, esos mismos contactos pueden necesitar ser declarados en otras compañías, lo que podría generar errores en la presentación.

Existe la opción de mover estos registros a la papelera, pero ciertos usuarios quieren mantener un control sobre cuáles han sido eliminados, especialmente en caso de futuras inspecciones y haciendo este paso de enviar a la papelera, **no queda rastro** de lo que se ha hecho, ni siquiera en el chat

Cuando se marca un registro como **_""establecer como no válido""_**, este cambia de color para identificarse visualmente, pero el número total de registros y el importe declarado no se actualizan, lo que genera confusión en la conciliación de datos.

Se espera que cuando un usuario marque un registro como ""establecer como no válido"", este **_se reste automáticamente del número total de registros y su importe se descuente del importe total declarado_**. Esto garantizaría un mayor control y precisión en la declaración del modelo 347, evitando ajustes manuales y posibles errores en la presentación.

No queremos que se excluyan del 347 si no marcarlos como ""No válidos"" para que quede constancia de ellos pero no sume al número de registro y al importe total del modelo, ni se registren en el .xml

Sugerimos:
  * Implementar una funcionalidad que, al marcar un registro como ""No válido"", actualice en tiempo real el conteo total de registros y el importe total declarado.
  * Mantener la visibilidad del registro en la interfaz con un color diferenciado, pero sin que se contabilice en los totales.
  * Permitir la consulta de los registros marcados como ""No válidos"" para auditorías o inspecciones futuras.

![Image](https://github.com/user-attachments/assets/a97df89a-2cfe-4b21-abe1-2210732af4aa)

@moduon MT-8997
@rafaelbn @EmilioPascual ","Es mucho más sencillo hacer el check de ""No incluir en el 347"" del contacto como dependiente de la compañía. [SEP] There hasn't been any activity on this issue in the past 6 months, so it has been marked as stale and it will be closed automatically if no further activity occurs in the next 30 days.
If you want this issue to never become stale, please ask a PSC member to apply the ""no stale"" label."
Issue,4169,[17.0] l10n_es_aeat_sii_oca: NIF requerido en cliente para facturas extracomunitarias,"Hemos detectado que con clientes extracomunitarios no se pueden enviar las facturas al SII porque pide que el NIF esté rellenado en el contacto. El contacto, aparte del país, tiene Posición Fiscal extracomunitaria.
Si rellenamos con algún caracter para evitar el error se envía:

[...]
""IDOtro"": {
                ""CodigoPais"": ""GB"",
                ""IDType"": ""04"",
                ""ID"": """" --> vacío
            }
[....]
Y SII devuelve en su respuesta el error: 1100 | Valor o tipo incorrecto del campo: ID
[...]
  'RefExterna': None,
            'EstadoRegistro': 'Incorrecto',
            'CodigoErrorRegistro': 1100,
            'DescripcionErrorRegistro': 'Valor o tipo incorrecto del campo: ID',
[...]

En runboat hemos hecho pruebas también, sin certificado (configurado en la imagen adjunta), pero no deja validar la factura por el mismo motivo, sólo cuando rellenamos el campo NIF. No veo el json que se genera por el tema del certificado. 

Adjunto vídeo de una compañera. 
El contacto también tiene Posición fiscal extracomunitaria. 

![Image](https://github.com/user-attachments/assets/ae1e0400-1e70-472d-99e0-6bf84ba381a9)

https://github.com/user-attachments/assets/17609168-fc81-434b-bbc3-6f953fbd8150

Si necesitáis más información decidnos. Yo en cuanto pueda intentaré encontrar en qué punto salta el error debugeando el proceso, pero si con esto se os ocurre algo o si alguien más ha tenido este problema. 
¿El error puede ir por el IDType que lleva y que requiere NIF? No estoy muy puesto en los códigos que informan al SII.
¡Saludos!",¿En la posición fiscal del régimen extracomunitario habéis puesto que el tipo de identificación SII sea de exportación? [SEP] Buenos días @pedrobaeza he probado en el mismo runboat y ahora estamos haciendo pruebas en el cliente. Tiene pinta que es eso. Muchísimas gracias. 
Issue,4165,l10n_es_aeat: Plantillas de impuestos archivados que no se pueden utilizar en los mapeos,"## Module
Módulos que dependen de `l10n_es_aeat` y utilizan mapeos de plantillas de impuestos.

## Describe the bug
En este [commit](https://github.com/odoo/odoo/commit/ef8c7e2b693584f5bba7c1d3b6418bef8e6a256f) de Odoo se archivaron una seríe de impuestos, los del 5% y el recargo de equivalencia 0,62.

Además, hay otras plantillas de impuestos archivadas como pueden ser los irnr.

Al estar archivados estas plantillas impuestos, no se pueden incluir en un mapeo de impuestos para cualquier modelo de AEAT o el SII.

Si tienes activados alguno de estos impuestos porque los necesitas, al actualizar Odoo se archivarán las plantillas de impuestos y aunque los tuvieras previamente incluidos en los mapeos respectivos no se tendrán en cuenta para el cálculo de los modelos o para el SII.

## To Reproduce
**Affected versions**: 

Steps to reproduce the behavior:
1. Activa la plantilla de impuesto ""Retención IRPF No residentes no-UE 24%"".
1. Actualiza el plan general contable para que se active el impuesto ""Retención IRPF No residentes no-UE 24%"" en la compañía.
1. Genera facturas con ese impuesto.
1. Realiza el mapeo en el SII para este impuesto.
1. Actualiza el módulo l10n_es. La plantilla de impuesto ""Retención IRPF No residentes no-UE 24%"" se archivará.
1. Las líneas de factura con el impuesto ""Retención IRPF No residentes no-UE 24%"" no se enviarán al SII.

Este ejemplo es con un impuesto específico y con el SII, pero puede pasar con otros impuestos o con los mapeos de los modelos de Hacienda en vez del mapeo del SII.

**Expected behavior**
Que al coger las plantillas de impuestos de los mapeos tenga en cuenta las plantillas de impuestos archivadas.

**Additional context**
En cuanto a los impuestos que Odoo archivó en este  [commit](https://github.com/odoo/odoo/commit/ef8c7e2b693584f5bba7c1d3b6418bef8e6a256f) según la Ley 37/1992, de 28 de diciembre, del Impuesto sobre el Valor Añadido (https://www.boe.es/buscar/act.php?id=BOE-A-1992-28740) actualizada el 21/01/2025, en el punto tres del Artículo 99. Ejercicio del derecho a la deducción tienes derecho a dedución durante los 4 años siguientes, por lo que aunque Odoo archive el impuesto deberías de estar vigente un mínimo de 4 años.

![Image](https://github.com/user-attachments/assets/174c3972-02a1-4a62-9978-ce146f8d29e9)","Este commit y otros similares en diversos módulos ya tenían en cuenta que estuvieran archivados:

https://github.com/OCA/l10n-spain/commit/e4457af95b1c027a71eb74b1a6e066e6c828b9e8

Tendrás que concretar algo más para saber si falta algo por aplicar. [SEP] Era para versión 14 que no estaba hecho el backport. Acabo de hacerlo en https://github.com/OCA/l10n-spain/pull/4170

@pedrobaeza gracias por el apunte."
Issue,4155,Version 17 del Modulo l10n_es_aeat_sii_oca no envia las facturas a hacienda.,"Hola, nos hemos migrado de una version 15 a la version 17 de odoo. En la versión 15 el moduloi del SII funciona correctamente. Sin embargo, el modulo del SII en la versión 17 no hace nada.  Parece que no se comunica con hacienda.

","Me temo que la información proporcionada no es suficiente para poder ayudar. [SEP] Buenas tardes,
He detectado que el error se produce porque al pulsar en la acción de servidor Enviar al SII en las facturas, en la función de default_get, no actualiza el campo account_move_ids, con las IDS seleccionadas, por lo que al intentar enviar al SII, aparece sin facturas a enviar.
l10n_es_aeat_sii_oca/wizards/account_move_send_sii.py. 
```
        res.update(
            {
                ""sending_number"": len(account_moves),
                ""not_send_without_errors_number"": len(not_send_without_errors),
                ""with_errors_number"": len(with_errors),
                ""modified_number"": len(modified),
            }
        )
        return res
```

Saludos
 [SEP] Fuera de que ahí pueda haber un error, ¿por qué se están usando ese asistente, si con una configuración normal se encola para enviar en cuanto se confirma la factura? [SEP] En mi caso tengo habilitado el que no se envíe las facturas automáticamente, si no que se haga manualmente con el botón de Enviar al SII [SEP] Como tal, considero un error hacerlo de esa forma, porque es muy fácil ""olvidarse"" de alguna factura a enviar y hacerlo en plazo, pero bueno, cada uno que elija la forma que quiera. Entiendo de todas formas que no tienes nada que ver con Eva y la tuya ha sido una averiguación parelela, ¿verdad? [SEP] @Evaguadaltech es posible que alguna de las facturas esté dando error en el envío y por eso parezca que no haga nada. 
Intenta ejecutar la acción planificada manualmente y mira si te sale algún mensaje de error. 

Hola @pedrobaeza iba a abrir un issue, pero me cuelgo de este hilo, en caso de ser necesario lo abro formalmente. 
¿Sabes si es normal que no se puedan enviar al SII facturas de cliente de países extracomunitarios  sin NIF establecido? En versión 15 sí se podía y no veo que en v17 haya que hacer una configuración adicional. ¿Es obligatorio? Gracias 
 [SEP] @mof-landoo en principio sobre eso no ha habido ningún cambio, así que alguna diferencia debería haber entre lo hecho en la 15 y en la 17. Analiza eso, y si no, especifica todos los pasos con datos para reproducir el error en una issue diferente. [SEP] Muy buenas, nosotros estamos teniendo el mismo problema. Tenemos la versión 17 de Odoo y enviamos las facturas de forma manual pulsando el botón (también lo hemos probado de forma automática). Desde el lado de Odoo parece que se ha enviado la factura de forma correcta, cambia a estado Enviado, obtiene el SII CSV, incluso muestra el Retorno SII, pero luego consultamos en la agenciatributaria y la factura no ha llegado.
También he probado a ejecutar la acción planificada de forma manual pero tampoco funciona.
En nuestro log de odoo (odoo-server.log), cuando pulsamos Enviar al SII solo se muestra lo siguiente:
odoo.addons.base.models.ir_cron: Starting job: 'Send Invoices to SII'
odoo.addons.base.models.ir_cron: Job done: 'Send Invoices to SII' (0.794s)

No aparece ningún error.  
¿Se os ocurre por qué puede ser para que lo revise? [SEP] @AlbertoCanto si os devuelve CSV, sí que se está enviando. A ver si tenéis puesto el portal de pruebas en lugar del real... [SEP] El modo pruebas no estaba activado, además, lo curioso, es que el CSV que devuelve no coincide con el real, ya que el que aparece en el campo de Odoo SII CSV es un valor alfanumérico y el que aparece en la factura dentro del portal de la agenciatributaria es numérico solamente. [SEP] Serán números diferentes, porque el CSV siempre ha tenido formato alfanumérico. [SEP] Cierro como ya se fusionó el PR que corregía el asistente de envío."
Issue,4140,Error pre-migration l10n_es_facturae version 16,"<!-- Provide a general summary of the issue in the Title above.
Before opening the issue, please check that there isn't another issue addressing the same problem already created -->

## Module
l10n_es_facturae

## Describe the bug
Error en script premigrations version [16.0.1.10.0] (https://github.com/OCA/l10n-spain/tree/16.0/l10n_es_facturae/migrations/16.0.1.10.0) 

## To Reproduce
**Affected versions**: versión 16

Steps to reproduce the behavior:
1. Actualizar el repositorio en Odoo SH
2.
3.

**Expected behavior**
Al desplegar en Odoo SH salta el siguiente error:
Failed to load registry
Traceback (most recent call last):
  File ""/home/odoo/src/odoo/odoo/modules/registry.py"", line 87, in new
    odoo.modules.load_modules(registry, force_demo, status, update_module)
  File ""/home/odoo/src/odoo/odoo/modules/loading.py"", line 489, in load_modules
    processed_modules += load_marked_modules(cr, graph,
  File ""/home/odoo/src/odoo/odoo/modules/loading.py"", line 374, in load_marked_modules
    loaded, processed = load_module_graph(
  File ""/home/odoo/src/odoo/odoo/modules/loading.py"", line 185, in load_module_graph
    migrations.migrate_module(package, 'pre')
  File ""/home/odoo/src/odoo/odoo/modules/migration.py"", line 170, in migrate_module
    exec_script(self.cr, installed_version, pyfile, pkg.name, stage, stageformat[stage] % version)
  File ""/home/odoo/src/odoo/odoo/modules/migration.py"", line 188, in exec_script
    migrate(cr, installed_version)
  File ""/home/odoo/.local/lib/python3.10/site-packages/openupgradelib/openupgrade.py"", line 2054, in wrapped_function
    func(
  File ""/home/odoo/src/user/OCA/l10n-spain/l10n_es_facturae/migrations/16.0.1.10.0/pre-migration.py"", line 12, in migrate
    openupgrade.add_fields(
  File ""/home/odoo/.local/lib/python3.10/site-packages/openupgradelib/openupgrade.py"", line 2587, in add_fields
    logged_query(
  File ""/home/odoo/.local/lib/python3.10/site-packages/openupgradelib/openupgrade.py"", line 1517, in logged_query
    cr.execute(query, args)
  File ""/home/odoo/src/odoo/odoo/sql_db.py"", line 321, in execute
    res = self._obj.execute(query, params)
psycopg2.errors.InvalidTextRepresentation: invalid input syntax for type json
LINE 7:                         'OU', 'float',
                                ^
DETAIL:  Token ""OU"" is invalid.
CONTEXT:  JSON data, line 1: OU

Si comento el fichero de premigration (por si venía por ahí) despliega correctamente 

**Additional context**
Odoo enviroment in Odoo.sh","There hasn't been any activity on this issue in the past 6 months, so it has been marked as stale and it will be closed automatically if no further activity occurs in the next 30 days.
If you want this issue to never become stale, please ask a PSC member to apply the ""no stale"" label."
Issue,4138,Version 17 modelo 303,"Buenas tardes, se ha exportado el modelo 303 de la OCA de la version 17. Al subir el fichero txt que se genera en el modelo 303 a hacienda. En hacienda le muestra los siguientes errores:

![Image](https://github.com/user-attachments/assets/6124d28e-18eb-453a-a410-4e7a32c0fe6d)

El fichero de exportacion del modelo 303 es el siguiente:

![Image](https://github.com/user-attachments/assets/125b91c1-2836-40ad-b80e-1efa2578956b)

Me podeis indicar como resolverlo.

Gracias.
Un saludo.","Me pasa exactamente lo mismo, si alguien puede dar una solucion me salva, gracias.  [SEP] El módulo debe actualizarse a la última versión (en código y en base de datos), y utilizar la última configuración de exportación disponible. Cierro al estar ya cubierto en el módulo."
Issue,4115,Crear una plantilla de impuesto no un impuesto en version 17.0,"Buenas tardes, necesito saber donde se crean las plantillas de impuesto para mapearla en los distintos modelos que se envian a hacienda. Estoy utilizando la version 17.0 enterprise.

Gracias.
Un saludo.","Hola, Eva, ese tipo de preguntas puedes hacerla en https://www.aeodoo.org/forum, que es un lugar más adecuado para ello."
Issue,4110,From Verifactu to SII or SII to Verifactu,"Revisada la modularidad del módulo de SII_OCA y la idea de realizar el módulo Verifactu, veo de primeras que existirán posibles complicaciones si no se realizan cambios.

Hace 1 año que realizó un buen esfuerzo de extracción del módulo SII_OCA al l10n_es_aeat, para poder realzar más adelante módulos de comunicación con AEAT de una manera más sencilla.

La idea es que si se tiene el SII no se tendrá verifactu, pero... aquí vienen preguntas y según como sí que se tendrán que realizar ""compatibles"". Se entiende que si una empresa está adherida a uno no estará al otro, pero que pasaría en los siguientes casos:

- La empresa actualmente está con el verifactu y pasa a tener que estar adherida al SII. ¿Se desinstala el módulo del verifactu y se usa el del SII? Si se realiza eso se perderá toda la información de envíos, etc. del verifactu ¿es correcto que se tenga que borrar todo eso?

- La empresa actualmente está con el SII y se lo quita. Podéis indicar lo que se quiera indicar, pero el cliente decide. Si el cliente quiere quitarse el SII y ponerse el Verifactu, estaríamos en el mismo caso anterior... se perderían los datos de envío al SII ¿sería correcto esto?

El punto es que la transición entre ambos sistemas no la veo tan clara con el sistema actual y como se plantea hasta este momento.

Creo que con llevar los campos de registro de envío, etc. al l10n_es_aeat se tendría que solucionar todo esto. Se mantiene el histórico y listo.

¿Qué pensáis de esto?","@HaraldPanten @pedrobaeza @etobella @JordiBForgeFlow  [SEP] Bueno, yo lo veo más sencillo en esos casos: tienes instalados los dos módulos, pero activas SII o Verifactu y ya está. Es que otro tipo de compatibilidad no es posible, porque hay campos muy específicos de cada tipo. Por ejemplo, el QR o el encadenamiento de Verifactu, no tienen sentido en la capa superior de abstracción, al igual que el CSV del SII. [SEP] > Bueno, yo lo veo más sencillo en esos casos: tienes instalados los dos módulos, pero activas SII o Verifactu y ya está. Es que otro tipo de compatibilidad no es posible, porque hay campos muy específicos de cada tipo. Por ejemplo, el QR o el encadenamiento de Verifactu, no tienen sentido en la capa superior de abstracción, al igual que el CSV del SII.

Sería la idea, pero hay campos que son compartidos y eso es posible que cree ""inconsistencias"". Por otro lado, podría pasar que una compañía utilice un sistema y otra compañia (sistema multicompañía) utilice el otro.... no se si sería ideal realizar una mayor separación. Abro este punto, ya que como se acercan las jornadas podría ser un punto a realizar (en caso de tener que realizarse algo). [SEP] Hasta donde sé, la activación es por compañía, por lo que no es problema. Si ves incompatibilidad de campos, sería listarlos y empezar a resolverlos (que básicamente sería poner nombres distintos), pero no creo que haya tantos. [SEP] > Hasta donde sé, la activación es por compañía, por lo que no es problema. Si ves incompatibilidad de campos, sería listarlos y empezar a resolverlos (que básicamente sería poner nombres distintos), pero no creo que haya tantos.

Por nuestra parte sin problemas, entonces nos lo apuntaremos para el codesprint 😄 . [SEP] Hola @ValentinVinagre a priori son compatibles, y se configuran por compañía, si pasa de un sistema a otro habría que marcar/desmarcar los checks de la compañía pero no necesariamente desinstalar los módulos con lo que no habría inconsistencias de datos, eso ya se planteo en el anterior codesprint. Digo a priori por que puede que haya algun método que se llame igual y habría que revisarlo.  [SEP] > Hola [@ValentinVinagre](https://github.com/ValentinVinagre) a priori son compatibles, y se configuran por compañía, si pasa de un sistema a otro habría que marcar/desmarcar los checks de la compañía pero no necesariamente desinstalar los módulos con lo que no habría inconsistencias de datos, eso ya se planteo en el anterior codesprint. Digo a priori por que puede que haya algun método que se llame igual y habría que revisarlo.

No estoy del todo de acuerdo, según la migración de 16-17 del SII ya vimos cosas compartidas, etc. [SEP] Igual no me he expresado correctamente, Quería decir que la idea era hacerlo así, puede que haya algo compartido 😄 [SEP] Valentín, ¿tienes un listado de esos campos conflictivos que comentas? [SEP] > Valentín, ¿tienes un listado de esos campos conflictivos que comentas?

Actualmente no tengo una lista, la idea es poner el tema encima de la mesa y plantear la situación. No busco realizar una acción correctiva actualmente, nuestra idea si nos ponemos es en los spanish oca days. [SEP] Vale, pues en los Spanish OCA days alguien puede dedicarse a detectar esos posibles conflictos y atajarlos antes de que fusionemos para que no haya luego que renombrar campos y demás. [SEP] Perdón por mi ignorancia, pero se sabe cuándo y por donde estará listo el módulo de VeriFactu ? [SEP] > Perdón por mi ignorancia, pero se sabe cuándo y por donde estará listo el módulo de VeriFactu ?

Se está realizando desde el siguiente PR, mejor pregúntalo por ahí:
https://github.com/OCA/l10n-spain/pull/3579 [SEP] Respuesta de AEAT:

`Buenos días:

Primero, debe recordarse que un SIF adaptado al RD 1007/2023 (tanto actuando en la modalidad VERI*FACTU como en la NO VERI*FACTU) SOLO puede usarse cumpliendo con todos los requisitos de dicho RD 1007/2023 que le aplican a él (para lo que, entre otras cosas, es necesario tener instalado un certificado electrónico cualificado válido). Cuando un productor o fabricante –mientras se den las circunstancias que permitan esto– ofrece al cliente un sistema de facturación para que pueda ser usado de forma adaptada al RRSIF o sin adaptar a dicha normativa, o bien para que cumpla con diferentes normativas, tales como TicketBAI, RD 1007/2023 y la normativa que regula el Suministro Inmediato de Información “SII”, realmente está ofreciendo “un paquete o familia” de varios productos SIF diferentes (aunque puede que compartan gran parte de su programación), a fin de que el cliente pueda elegir específicamente uno para instalar y usar, bajo la responsabilidad del usuario.
En cualquier caso, este ofrecimiento debe implementarse de tal forma que el usuario no pueda cambiar dinámicamente de un “producto” a otro con cada factura ni con cada sesión o arranque del producto, sino que el usuario deberá elegir previamente qué tipo de SIF quiere utilizar y lo instalará –o actualizará– para que cumpla con esas características, que ya permanecerán así en adelante (a menos que se desinstale).
En todo caso, será el usuario último del SIF, quien será responsable de seleccionar la modalidad de su software que corresponda con la normativa que se le aplica.

Si el caso es que el usuario ha decidido, por ejemplo, darse de alta voluntaria en el SII, a partir de ese momento, a todos los efectos relativos a su facturación propia, no quedan afectados por el R. D. 1007/2023 y el programa que utilicen deberán cumplir genéricamente con las obligaciones que se señalan en el artículo 29.2.j) de la Ley 58/2003, de 17 de diciembre, General Tributaria (LGT).

Respecto a  la conservación de los registros de facturación (RFs) si se trata de un SIF que actúe en la modalidad VERI*FACTU, no es obligatoria la conservación de los registros de facturación (RFs), dado que estos habrán sido remitidos en el momento de la expedición de las facturas, a la sede electrónica. En los demás casos, rigen las normas de conservación documental habituales en materia fiscal, es decir, con carácter general, la prescripción fiscal (cuatro años posteriores a la fecha de devengo), pero, en determinados supuestos, plazos más largos. 

Si fuese a la inversa, igualmente, deben cumplir con la normativa que corresponda. Lo que queremos dejar claro con esto, es que se trata de normativas diferentes con obligaciones diferenciadas. El SII consiste en la llevanza de los libros registro de IVA (facturas emitidas, facturas recibidas, bienes de inversión…) a través de la sede electrónica de la Agencia Tributaria, lo que implica obligaciones de comunicación electrónica a la Agencia Tributaria de una amplia información relacionada con el IVA de las facturas emitidas y recibidas en un determinado plazo de tiempo. Por su parte, el reglamento que establece los requisitos de los sistemas informáticos de facturación obliga a que los SIF registren, con determinadas medidas de seguridad y control, cierta información solo de las facturas expedidas, pudiendo remitirse opcionalmente a la Agencia Tributaria.
El ámbito subjetivo de ambos proyectos es excluyente, es decir, quienes cumplan con el SII no han de cumplir con el reglamento que establece los requisitos de los sistemas informáticos de facturación y viceversa.
Respecto a la consulta del encadenamiento, el SIF utilizado sería una nueva instalación por lo que debería comenzar un nuevo encadenamiento.

Atentamente,
Atención al Usuario
Departamento de Informática Tributaria
Email: verifactu@correo.aeat.es
`

Con saber que ha sido enviado para no volver a enviarlo valdría y ya está en el módulo l10n_es_aeat

Saludos,
Ignacio [SEP] > Con saber que ha sido enviado para no volver a enviarlo valdría y ya está en el módulo l10n_es_aeat

Genial, gracias @acysos . "
Issue,4103,17.0 l10n_es_aeat_mod303: 303_informe_BOE error when import from aeat web,"![Image](https://github.com/user-attachments/assets/ebcb2a25-1aba-4e4a-8dcd-a1ffda699e29)

![Image](https://github.com/user-attachments/assets/558d7abd-203c-4a4f-b7c9-122902a45ab2)

![Image](https://github.com/user-attachments/assets/93fc6d9d-a6ef-4d27-9d36-b322386d9ed0)

I was testing this system and this module for months in year 24 without problems, today I went to generate the model 303 of year 25 t1 and it generated it without errors and without problems but when importing it from the Spanish Treasury website I got these errors, I suppose there is something that has changed and it will have to be updated.
It seems that there are new boxes in the model that are not in the Odoo module.","https://github.com/OCA/l10n-spain/issues/4024
Perdon no vi que ya estaba reportado este bug. [SEP] Revisa que utilizas el formato de exportación último y que tienes todo el código actualizado y tu BD actualizados los módulos. [SEP] ok gracias sin problemas , hare antes una copia de esta maquina en el proxmox."
Issue,4102,[17.0] l10n_es_vat_book: Asientos de ventas por caja sin partner,"<!-- Provide a general summary of the issue in the Title above.
Before opening the issue, please check that there isn't another issue addressing the same problem already created -->

## Module
l10n_es_vat_book

## Describe the bug
No es un bug, pero el modelo devuelve un error por cada asiento que contengan alguna línea de IVA y que no tenga partner establecido. En este caso, son todos los asientos creados desde las sesiones del punto de venta. 

## To Reproduce
**Affected versions**: 17.0

Steps to reproduce the behavior:
1. Calcular un libro de IVA en una base de datos con 'l10n_es_pos_oca' instalado y que almenos se haya generado cerrado una primera sesión con ventas.
2. Aparece el siguiente error por cada asiento de ventas por caja:

![Image](https://github.com/user-attachments/assets/223cfff3-00f2-4a9b-96ab-477da879034c)


**Expected behavior**
Modelo sin errores relacionados con los asientos del punto de venta.

**Additional context**
Nuestro compañero @peluko00, en su día migró el módulo 'l10n_es_pos' ahora 'l10n_es_pos_oca' hacia v17. La particularidad de la migración fue que Odoo ha integrado en el core el módulo 'l10n_es_pos' y su planteamiento es que se genere un registro 'account.move' (una factura) por cada factura simplificada. En la nueva versión del módulo OCA se evitó esto.

Creemos que una solución sería tocar esta método (https://github.com/odoo/odoo/blob/17.0/addons/point_of_sale/models/pos_session.py#L689) para añadir otra agrupación de las líneas que sea por partner. Estableciendo el partner que se crea por defecto desde el módulo del core (l10n_es_pos), Simplified Invoice Partner (ES) si el pedido del punto de venta no tiene partner asignado.

Creamos este issue para ver si nuestro enfoque es correcto y si alguien más tiene el mismo problema o ve otra solución.

@pedrobaeza y @chienandalu os hago ping como autores del 'l10n_es_pos' OCA ahora 'l10n_es_pos_oca' 

Gracias.","Esto se ha discutido anteriormente por issues o en los PRs de `l10n_es_pos`. Haz una búsqueda para echar un vistazo. Básicamente, es utilizar `pos_default_partner` o desarrollar una extensión `l10n_es_vat_book_pos`. [SEP] Gracias Pedro. No tenía constancia. 

De acuerdo, optaremos entonces por la extensión del vatbook para que no requiera el partner en los asientos de caja.  [SEP] Aqui esta:
- [l10n_es_vat_book_pos] https://github.com/OCA/l10n-spain/pull/4104 "
Issue,4100,[18.0] l10n_es_aeat: Gestión de certificados,"Desde 18.0, Odoo incluye un módulo llamado [`certificate`](https://github.com/odoo/odoo/tree/18.0/addons/certificate), que permite almacenar y gestionar certificados criptográficos. Utiliza principios parecidos a los que tenemos en [`l10n.es.aeat.certificate`](https://github.com/OCA/l10n-spain/blob/17.0/l10n_es_aeat/models/aeat_certificate.py), y las mismas librerías para extraer las claves, pero con una diferencia principal: la clave del certificado original se guarda con el propio modelo, en lugar de solicitarse en un wizard que luego termina borrándose.

¿Qué os parece realizar el cambio a la gestión de certificados estándar de Odoo? ¿Veis algún riesgo?","ping @AaronHForgeFlow @JordiBForgeFlow @etobella @ValentinVinagre @acysos @rubencr7 @fuentes73  [SEP] A ver, esto es complicado. La verdad es que lo primero seria pensar si necesitamos seguir usando los certificados como ficheros y que ventaja nos da eso. Si alguien accede al servidor, al final lo tiene todo, con lo que tenerlo en como fichero no nos da más seguridad a no ser que tengamos la BBDD desacoplada del servidor de Odoo. Por lo tanto, yo creo que podemos usar el sistema de Odoo directamente ya que no hay una ventaja directa.

De todas formas, estaría bien ver otras opiniones, por que tal vez se me escapa algo de por que se hizo así en su día. [SEP] Haciendo una revisión en diagonal, veo luces y sombras:
Luces:

- Nos ha pasado que ciertos clientes tienen ""intranquilidad"" en traspasar certificados electrónicos y contraseñas... así que sería una opción para que el propio usuario lo pueda gestionar y no necesite al implantador(hasta cierto punto).
- Si Odoo proporciona un sistema parecido o compatible, lo ideal es utilizarlo, menos que mantener.

Sombras:

- ¿Que dirección tomará Odoo con esto?
- ¿La exportación propia de Odoo puede dar información del certificado? ¿está protegido?
- Elimina la opción de poder tener el certificado externamente ¿sería posible realizar la ampliación? Si se hace... ¿vale la pena?

En conclusión no me parece mal ir por el camino de Odoo, pero haría una ampliación para poder optar también a la utilización del certificado como hasta ahora.
¿Como lo veis? [SEP] Odoo usa los certificados para el mismo propósito que se usa en la localización, por ejemplo en su módulo de facturae lo usa, así que sí creo que es un ""feature"" que está solapado con el módulo del l10n_es_aeat.
Sin embargo el módulo certificate es bastante nuevo y creo que le van a hacer cambios puesto que a mi modo de ver presenta algunas vulnerabilidades:

* La contraseña para desencriptar el fichero .pfx o p12 se guarda directamente en la tabla certificate_certificate:

![Image](https://github.com/user-attachments/assets/39589d2b-330c-440c-882e-367830b4aef6)

* El contenido del fichero .pem extraído se guarda directamente en la tabla del ir_attachment:

![Image](https://github.com/user-attachments/assets/e7a1e311-94f7-42d6-a0db-0e6cdfde14f6)

Creo que aunque son funcionalidades que se solapan esperaría a que Odoo las hiciera más estable. Podríamos hacer el esfuerzo de mejorar la seguridad ahora para que luego Odoo lo arregle en la siguiente versión.

Yo en el PR de migración ya he quitado el commit que hacía la migración al nuevo modelo. [SEP] > Odoo usa los certificados para el mismo propósito que se usa en la localización, por ejemplo en su módulo de facturae lo usa, así que sí creo que es un ""feature"" que está solapado con el módulo del l10n_es_aeat. Sin embargo el módulo certificate es bastante nuevo y creo que le van a hacer cambios puesto que a mi modo de ver presenta algunas vulnerabilidades:
> 
> * La contraseña para desencriptar el fichero .pfx o p12 se guarda directamente en la tabla certificate_certificate:
> 
> ![Image](https://github.com/user-attachments/assets/39589d2b-330c-440c-882e-367830b4aef6)
> 
> * El contenido del fichero .pem extraído se guarda directamente en la tabla del ir_attachment:
> 
> ![Image](https://github.com/user-attachments/assets/e7a1e311-94f7-42d6-a0db-0e6cdfde14f6)
> 
> Creo que aunque son funcionalidades que se solapan esperaría a que Odoo las hiciera más estable. Podríamos hacer el esfuerzo de mejorar la seguridad ahora para que luego Odoo lo arregle en la siguiente versión.
> 
> Yo en el PR de migración ya he quitado el commit que hacía la migración al nuevo modelo.

¿y si se valora para v19 a ver que cambios realizan? yo por el momento mantendría el de OCA como está. [SEP] Para mí lo ideal seria:
1) Guardar el contenido fichero .p12 en una variable de entorno en el servidor
2) Guardar el password asociado en un lugar seguro, que puede ser uno de los siguientes:
    a) Variable de entorno, también en el servidor
    b) En un servicio externo como Google KMS, AWS Secrets Manager, Hashicorp Vault... que limitan quién puede acceder a estas claves (por ejemplo, aplicando restricción por IP)

Por lo que entiendo ahora la arquitectura del modulo l10n_es_aeat guarda la clave privada en la base de datos, de modo que esa clave acaba estando en todos los backups de la base de datos y acaban replicandose en entornos de staging con facilidad.




 [SEP] Creo que estas dos ventajas que señalaba @ValentinVinagre son importantes:

> * Nos ha pasado que ciertos clientes tienen ""intranquilidad"" en traspasar certificados electrónicos y contraseñas... así que sería una opción para que el propio usuario lo pueda gestionar y no necesite al implantador(hasta cierto punto).
> * Si Odoo proporciona un sistema parecido o compatible, lo ideal es utilizarlo, menos que mantener.

Sobre el primer punto, pensad que para que un usuario mande la contraseña del certificado a su implantador, tiene que usar un canal adicional, que perfectamente puede ser un vector de ataque adicional.

Pero sin contar con ese, básicamente existen 3 vectores de ataque. Comparemos:


  | Sistema antiguo de OCA | Sistema nuevo de Odoo
-- | -- | --
**Acceso elevado a Odoo** | Vulnerable. | Vulnerable.
**Acceso elevado a Postgres** | Seguro, ya que no hay datos. | Seguro, salvo que también consigas acceso al filestore.
**Acceso elevado al filestore** | Vulnerable. | Seguro, salvo que también consigas acceso a Posgres.

Así pues, antes estábamos poniendo toda la seguridad en el filestore. Ahora, una parte se almacena en Postgres y otra en el filestore. **A mi modo de ver, estamos incrementando la seguridad** puesto que un atacante necesitará vulnerar 2 accesos diferentes para desbloquear el certificado.

Por supuesto, un acceso elevado a Odoo es vulnerable en todos los sentidos y siempre lo será, por diseño, porque:
- Odoo necesita desbloquear la clave. Por tanto, de un modo u otro, necesita tener la contraseña.
- Un usuario con privilegios puede escribir una acción de servidor y hacer lo que quiera.

Más contexto a considerar:
- El almacenamiento en texto plano de contraseñas en Odoo ya se hace en otros sitios, como los servidores de correo entrante/saliente.
- OCA puede crear módulos que mejoren la seguridad de `certificate` mediante almacenar la contraseña en otro backend, ya sea el filestore, vault, bitwarden, etc. Esa mejora sería transparente a lo que haga `l10n_es` o similares, ya que actuaría a otro nivel.

Por lo tanto, para mí **lo mejor que podemos hacer es adoptar `certificate`**.

@moduon MT-9954 [SEP] Los que trabajaron en la migración de la localización los Spanish OCA Days no estaban convencidos del cambio, así que por el momento se ha dejado como estaba. Se puede evaluar en la siguiente versión, o en medio de ésta con scripts de migración, aunque implicaría un cambio de dependencias."
Issue,4094,[16.0][BUG] l10n_es_facturae: `facturae_code` field misplaced,"## Module  
`l10n_es_facturae`

## Describe the Bug  
The `facturae_code` field is misplaced in the inherited view because the `company_id` field appears twice in the form. The inheritance rule currently places `facturae_code` after the first occurrence of `company_id`, which is outside the form layout and invisible. As a result, `facturae_code` does not appear correctly in the intended position.

## To Reproduce  

**Affected versions**: Odoo 16  

### Steps to reproduce:  
1. Install the `l10n_es_facturae` module.  
2. Open the **Taxes** form view.  
3. Observe that `facturae_code` is not positioned correctly.  

**Expected behavior**  
The `facturae_code` field should appear **after `company_id` inside the ""Advanced Options"" tab**, matching the structure in Odoo 17.  

## Additional Context  
- The `company_id` field appears twice in the form:  
  1. Once outside the `sheet`, where it is invisible.  
  2. Once inside the **""Advanced Options""** tab.  
- The current inheritance places `facturae_code` after the first `company_id`, leading to incorrect positioning.  

![Image](https://github.com/user-attachments/assets/740e40c2-fbf1-434f-9f37-3f2169e18ec6)","No es necesario abrir issue si se va a abrir PR, ya que es duplicar la información. Se continúa en #4095 "
Issue,4092,ERROR	server	'migrate' decorator: failed to inspect the frame above: 'pkg',Updating l10n-spain as submodule version 17.0,"Can you provide more information about the error? like the line/file/module or even the full traceback? [SEP] Esto tiene pinta de un Odoo.sh con algo incorrecto con la librería openupgradelib. En cualquier caso, no es un problema de este repo. [SEP] Tengo este mismo issue en la V17 Odoo.sh, solo veo en el log OpenUpgrade: 'migrate' decorator: failed to inspect the frame above: 'pkg', no tengo más detalles del origen. openupgradelib lo tengo actualizado. Alguna idea de como solventar este issue? [SEP] Creo que Odoo ha hecho algo en su Odoo.sh que provoca ese problema, pero claro, ya queda fuera de nuestro alcance. Pon un ticket de soporte a ellos a ver qué dicen. Sois varios con el mismo problema en cuanto usáis la librería en ese hosting. A ver si saben deciros algo. He revisado los últimos commits de la librería, y no hay ninguna razón para que provoquen este error. [SEP] > Creo que Odoo ha hecho algo en su Odoo.sh que provoca ese problema, pero claro, ya queda fuera de nuestro alcance. Pon un ticket de soporte a ellos a ver qué dicen. Sois varios con el mismo problema en cuanto usáis la librería en ese hosting. A ver si saben deciros algo. He revisado los últimos commits de la librería, y no hay ninguna razón para que provoquen este error.

Hi @pedrobaeza, i've opened the PR https://github.com/OCA/openupgradelib/pull/410  after investigating the probelm; that seem originated by 
 - 16.0 https://github.com/odoo/odoo/pull/202014
 - 17.0 https://github.com/odoo/odoo/pull/202583

both PRs move the migration logic away from its original position in a dedicated method, that has not the pkg in `locals` scope, because the caller pass to that method directly the name of module [SEP] Disculpad que parece que finalmente sí es de la librería. Gracias a @patrickt-oforce 

Viendo la fecha del parche, no me cuadraba porque yo hice una migración sin problemas hace unos días, pero ya sé la razón: OCB no se está sincronizando desde hace una semana. [SEP] @pedrobaeza So, do you recommend reopening the issue? 

@patrickt-oforce you are crack!! [SEP] No, because it's already fixed."
Issue,4085,[17.0] l10n_es_facturae_face problemas al generar factura si la empresa emisora es una persona fisica,"Al generar una factura si la empresa emisora es una persona fisica nos generaba un error en el fichero XML que faltaban los apellidos del emisor.

Instalando el modulo ""partner_firstname"" de OCA, nos divide el nombre del emisor en dos campos ""lastname"" y ""firstname"", en ese caso la factura generada es correcta.

Considero que deberia de estar este modulo en las dependecias de l10n_es_facturae.
","No, esto es así a propósito, porque casi muchos no necesitan esa separación (solo los B2C), así que obligar a ello no es de recibo, y más con un módulo tan intrusivo como `partner_firstname`. Hay que leer los README: https://github.com/OCA/l10n-spain/tree/17.0/l10n_es_facturae#installation"
Issue,4077,Reemplazar dependencia errónea en README.md de l10n_es_vat_book_oss,"https://github.com/OCA/l10n-spain/blob/a8ffe5d47b4513c7bc52ccdc3c900745f0620c70/l10n_es_vat_book_oss/README.rst?plain=1#L45C3-L45C14

Reemplazar:
l10n_eu_oss -> l10n_eu_oss_oca",
Issue,4060,[16.0][BUG] l10n_es_vat_book: “Cuota IVA Soportado” no muestra el importe total cuando hay prorrata,"**Descripción:**
- **Versión de Odoo**: 16.0  
- **Módulos afectados**: l10n_es_vat_book + l10n_es_vat_prorate  

**Pasos para reproducir**  
1. Configurar prorrata de IVA (ej. 80 %).  
2. Crear factura de proveedor con IVA soportado.  
3. Generar Libro de IVA.  

**Comportamiento actual**  
- La columna “Cuota IVA Soportado” refleja sólo la parte deducible (80 %) y se pierde el dato del IVA total soportado (100 %).  

**Comportamiento deseado**  
- La columna “Cuota IVA Soportado” debería mostrar el importe completo del IVA soportado, mientras que la columna “Cuota Deducible” mantendría solo la parte deducible.  

**Comentario**  
¿Alguien más ha detectado este problema? ¿Alguna propuesta de solución estándar para reflejar el 100 % del IVA soportado y, al mismo tiempo, la parte deducible según la prorrata?

---

@etobella @pedrobaeza @HaraldPanten , ¿no os han reportado este error?

Si lees el formato de AEAT que comento en https://github.com/OCA/l10n-spain/issues/3000 veréis que está mal.

https://sede.agenciatributaria.gob.es/Sede/impuestos-tasas/iva/iva-libros-registro-iva-traves-aeat/preguntas-frecuentes/4-libro-registro-facturas-recibidas.html?faqId=1060af1ffc1fb510VgnVCM100000dc381e0aRCRD

Saludos,
Rafa

@moduon MT-5880","Bueno, realmente es correcto que se muestre así, porque Hacienda hasta donde sé es lo que pide en sus inspecciones, ya que es lo que se puede deducir. Mostrar otro dato que haga que las verificaciones cruzadas con el 303 no cuadren es lo que provocaría confusión y preguntas. El enlace proporcionado no veo que esté relacionado, porque no es de prorrata y además habla del SII. [SEP] Entiendo que está mencionado lo del SII, porque SII y Libro de IVA deberían coincidir. De todas formas, a nosotros no nos ha aparecido la casuística. Justamente tenemos los clientes que utilizan prorrata, también están dados de alta en el SII, en nuestro caso; por lo que el libro de IVA, a nivel práctico, no lo utilizan. [SEP] Según el diseño de registro del Libro de IVA que se puede encontrar [aquí](https://sede.agenciatributaria.gob.es/Sede/iva/libros-registro.html) y descargar desde este enlace [Diseños de registro normalizados para los Libros Registro del IVA de personas jurídicas no incluidas en SII en los formatos XLS y CSV (actualizado 18-12-2024)](https://sede.agenciatributaria.gob.es/static_files/AEAT/LSIJ.xlsx):

> - En ""Cuota Deducible"" se consignará el importe de la Cuota del IVA Soportado que sea deducible para cada tipo de IVA. Cuando toda la cuota soportada sea deducible, en la columna ""Cuota Deducible"" se consignará el mismo contenido que figure en la columna ""Cuota IVA Soportado"". 

Es decir, que según el ejemplo de @rafaelbn con una prorrata del 80% configurada en la compañía entonces el valor mostrado en ""Cuota IVA Siportado"" debería ser diferente al valor mostrado en ""Cuota deducible"", concretamente un 80% en este caso. Sólo deberían coincidir cuando toda la cuota soportada sea deducible.

Actualmente con los dos módulos instalados `l10n_es_vat_book` y `l10n_es_vat_prorate` el valor mostrado es idéntico en ""Cuota IVA Soportado"" y ""Cuota deducible"" dando a entender que toda la cuota soportada es deducible independientemente del valor que te hayas deducido. También se está viendo afectado ""Total de factura"" pues el valor reflejado es la Base Imponible + Cuota Deducible, pareciendo que el IVA está mál aplicado.

Ejemplo práctico de una factura de una compañia con la Prorrata del IVA al 80% para este período y con dos líneas de factura, una línea con un importe de 100 € y un impuesto del 21% y otra línea de 200€ con el mismo impuesto.

![Image](https://github.com/user-attachments/assets/097d527b-11ad-48d2-b0a6-792d316bccbc)

- El total de la factura son 363€.
- La cuota de IVA Soportado es 63€, el 21% de 100€ más el 21% de 200€.
- La cuota deducible es 50,40€, el 80% de la cuota de IVA soportado.


Sin enmbargo el libro de IVA está haciendo un cálculo incorrecto, con este ejemplo sale:

![Image](https://github.com/user-attachments/assets/bc39ab8f-904d-4010-a7e2-197267f3dc69)

A todas luces se ve que el cálculo es incorrecto.

¿Cuál creeís que es la solución correcta @pedrobaeza @HaraldPanten @etobella? ¿Crear un módulo glue, por ejemplo, `l10n_es_vat_book_prorate` o solventarlo directamente en `l10n_es_vat_book`?
 [SEP] Gracias por los detalles extra, Emilio. Ahora queda claro que tenemos dos columnas para la cuota y que la prorrata haría diferente cada una. @etobella utilizó un ""truco"" para no necesitar un módulo extra para el SII que completé yo en https://github.com/OCA/l10n-spain/pull/2598

Tal vez se podría aplicar algo similar. Si no, un glue module. [SEP] Con este PR https://github.com/OCA/l10n-spain/pull/4093 debería solventarse. [SEP] Solucionado en https://github.com/OCA/l10n-spain/pull/4093"
Issue,4051,[17.0] l10n_es_facturae_face error zeep.exceptions.ValidationError: Expected at least 1 items (minOccurs check),"Buenos días, estoy intentando configurar y usar el módulo de envío de facturas a FACe, y me he encontrado con varios problemas:

Por un lado, configurando el módulo tal y como insinua el [readme.rst](https://github.com/OCA/l10n-spain/blob/17.0/l10n_es_facturae_face/README.rst), al intentar enviar una factura me daba el siguiente error en el job del envío edi:

> Traceback (most recent call last):
  File ""/opt/odoo/odoo17/oca-addons/edi-framework/edi_oca/models/edi_backend.py"", line 308, in exchange_send
    self._exchange_send(exchange_record)
  File ""/opt/odoo/odoo17/oca-addons/edi-framework/edi_oca/models/edi_backend.py"", line 381, in _exchange_send
    return component.send()
  File ""/opt/odoo/odoo17/oca-addons/l10n-spain/l10n_es_facturae_face/components/edi_send_l10n_es_facturae_face.py"", line 23, in send
    response = self.send_webservice(
  File ""/opt/odoo/odoo17/oca-addons/l10n-spain/l10n_es_facturae_face/components/webservice_face.py"", line 56, in send_webservice
    client = self._get_client(public_crt, private_key)
  File ""/opt/odoo/odoo17/oca-addons/l10n-spain/l10n_es_facturae_face/components/webservice_face.py"", line 39, in _get_client
    return Client(
  File ""/opt/odoo/odoo17/odoo-venv/lib/python3.10/site-packages/zeep/client.py"", line 73, in __init__
    self.wsdl = Document(wsdl, self.transport, settings=self.settings)
  File ""/opt/odoo/odoo17/odoo-venv/lib/python3.10/site-packages/zeep/wsdl/wsdl.py"", line 92, in __init__
    self.load(location)
  File ""/opt/odoo/odoo17/odoo-venv/lib/python3.10/site-packages/zeep/wsdl/wsdl.py"", line 95, in load
    document = self._get_xml_document(location)
  File ""/opt/odoo/odoo17/odoo-venv/lib/python3.10/site-packages/zeep/wsdl/wsdl.py"", line 155, in _get_xml_document
    return load_external(
  File ""/opt/odoo/odoo17/odoo-venv/lib/python3.10/site-packages/zeep/loader.py"", line 87, in load_external
    content = transport.load(url)
  File ""/opt/odoo/odoo17/odoo-venv/lib/python3.10/site-packages/zeep/transports.py"", line 122, in load
    content = self._load_remote_data(url)
  File ""/opt/odoo/odoo17/odoo-venv/lib/python3.10/site-packages/zeep/transports.py"", line 135, in _load_remote_data
    response.raise_for_status()
  File ""/opt/odoo/odoo17/odoo-venv/lib/python3.10/site-packages/requests/models.py"", line 943, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 500 Server Error: Internal Server Error for url: https://se-face-webservice.redsara.es/facturasspp2

Decir, que subí el certificado tanto a https://se-integradores-face.redsara.es/inicio como a Odoo e igualmente seguía sin funcionar. Abrí un ticket al soporte de FACe sobre si el link del servicio era correcto o si me tenía que dar de alta en algún sitio más y me contestaron esto:

![Image](https://github.com/user-attachments/assets/761d8c3a-722c-462f-a13a-48f4817c983a)

Dejo los links por aquí:

Portales:
https://se-proveedores-face.redsara.es/inicio
https://se-organismos-face.redsara.es/inicio
https://se-integradores-face.redsara.es/inicio
Servicios web REST:
https://se-api-face.redsara.es/integrators/doc
https://se-api-face.redsara.es/providers/doc
https://se-api-face.redsara.es/organisms/doc
Servicios web SOAP nuevos:
https://se-ws-face.redsara.es/proveedores/v1/factura?wsdl
https://se-ws-face.redsara.es/organismos/v1/factura?wsdl
https://se-ws-face.redsara.es/organismos/v1/directorio?wsdl
Servicios web SOAP retro compatibles:
https://se-face-webservice.redsara.es/facturasrcf?wsdl
https://se-face-webservice.redsara.es/directoriosrcf?wsdl
https://se-face-webservice.redsara.es/facturasspp?wsdl
https://se-face-webservice.redsara.es/facturasnotificador?wsdl
 
Toda la documentación está publicada en el PAe: https://administracionelectronica.gob.es/ctt/face/descargas

Decidí finalmente probar con el ws https://se-face-webservice.redsara.es/facturasspp?wsdl ya que era el que más se parecía a lo que hay puesto como ws de test en el readme, y ahora me responde este error, que no consigo saber a qué se debe:

> Traceback (most recent call last):
  File ""/opt/odoo/odoo17/odoo17-addons/custom-addons/queue_job/controllers/main.py"", line 104, in runjob
    self._try_perform_job(env, job)
  File ""/opt/odoo/odoo17/odoo17-addons/custom-addons/queue_job/controllers/main.py"", line 36, in _try_perform_job
    job.perform()
  File ""/opt/odoo/odoo17/odoo17-addons/custom-addons/queue_job/job.py"", line 522, in perform
    self.result = self.func(*tuple(self.args), **self.kwargs)
  File ""/opt/odoo/odoo17/oca-addons/edi-framework/edi_oca/models/edi_exchange_record.py"", line 323, in action_exchange_send
    return self.backend_id.exchange_send(self)
  File ""/opt/odoo/odoo17/oca-addons/edi-framework/edi_oca/models/edi_backend.py"", line 308, in exchange_send
    self._exchange_send(exchange_record)
  File ""/opt/odoo/odoo17/oca-addons/edi-framework/edi_oca/models/edi_backend.py"", line 381, in _exchange_send
    return component.send()
  File ""/opt/odoo/odoo17/oca-addons/l10n-spain/l10n_es_facturae_face/components/edi_send_l10n_es_facturae_face.py"", line 23, in send
    response = self.send_webservice(
  File ""/opt/odoo/odoo17/oca-addons/l10n-spain/l10n_es_facturae_face/components/webservice_face.py"", line 69, in send_webservice
    response = client.service.enviarFactura(invoice_call)
  File ""/opt/odoo/odoo17/odoo-venv/lib/python3.10/site-packages/zeep/proxy.py"", line 46, in __call__
    return self._proxy._binding.send(
  File ""/opt/odoo/odoo17/odoo-venv/lib/python3.10/site-packages/zeep/wsdl/bindings/soap.py"", line 123, in send
    envelope, http_headers = self._create(
  File ""/opt/odoo/odoo17/odoo-venv/lib/python3.10/site-packages/zeep/wsdl/bindings/soap.py"", line 73, in _create
    serialized = operation_obj.create(*args, **kwargs)
  File ""/opt/odoo/odoo17/odoo-venv/lib/python3.10/site-packages/zeep/wsdl/definitions.py"", line 222, in create
    return self.input.serialize(*args, **kwargs)
  File ""/opt/odoo/odoo17/odoo-venv/lib/python3.10/site-packages/zeep/wsdl/messages/soap.py"", line 79, in serialize
    self.body.render(body, body_value)
  File ""/opt/odoo/odoo17/odoo-venv/lib/python3.10/site-packages/zeep/xsd/elements/element.py"", line 232, in render
    self._render_value_item(parent, value, render_path)
  File ""/opt/odoo/odoo17/odoo-venv/lib/python3.10/site-packages/zeep/xsd/elements/element.py"", line 256, in _render_value_item
    return self.type.render(node, value, None, render_path)
  File ""/opt/odoo/odoo17/odoo-venv/lib/python3.10/site-packages/zeep/xsd/types/complex.py"", line 295, in render
    element.render(node, element_value, child_path)
  File ""/opt/odoo/odoo17/odoo-venv/lib/python3.10/site-packages/zeep/xsd/elements/indicators.py"", line 251, in render
    element.render(parent, element_value, child_path)
  File ""/opt/odoo/odoo17/odoo-venv/lib/python3.10/site-packages/zeep/xsd/elements/element.py"", line 232, in render
    self._render_value_item(parent, value, render_path)
  File ""/opt/odoo/odoo17/odoo-venv/lib/python3.10/site-packages/zeep/xsd/elements/element.py"", line 256, in _render_value_item
    return self.type.render(node, value, None, render_path)
  File ""/opt/odoo/odoo17/odoo-venv/lib/python3.10/site-packages/zeep/xsd/types/complex.py"", line 295, in render
    element.render(node, element_value, child_path)
  File ""/opt/odoo/odoo17/odoo-venv/lib/python3.10/site-packages/zeep/xsd/elements/indicators.py"", line 251, in render
    element.render(parent, element_value, child_path)
  File ""/opt/odoo/odoo17/odoo-venv/lib/python3.10/site-packages/zeep/xsd/elements/element.py"", line 232, in render
    self._render_value_item(parent, value, render_path)
  File ""/opt/odoo/odoo17/odoo-venv/lib/python3.10/site-packages/zeep/xsd/elements/element.py"", line 256, in _render_value_item
    return self.type.render(node, value, None, render_path)
  File ""/opt/odoo/odoo17/odoo-venv/lib/python3.10/site-packages/zeep/xsd/types/complex.py"", line 295, in render
    element.render(node, element_value, child_path)
  File ""/opt/odoo/odoo17/odoo-venv/lib/python3.10/site-packages/zeep/xsd/elements/indicators.py"", line 251, in render
    element.render(parent, element_value, child_path)
  File ""/opt/odoo/odoo17/odoo-venv/lib/python3.10/site-packages/zeep/xsd/elements/any.py"", line 126, in render
    self.validate(value, render_path)
  File ""/opt/odoo/odoo17/odoo-venv/lib/python3.10/site-packages/zeep/xsd/elements/any.py"", line 172, in validate
    raise exceptions.ValidationError(
zeep.exceptions.ValidationError: Expected at least 1 items (minOccurs check)

En conclusión, me gustaría que me confirmaseis si el link de el ws tanto de test como de producción que hay en el readme es usable, y en caso de que el readme esté equivocado, sería vital un pull request al respecto. En cualquier caso, por qué pueden estar dando estos errores? No he tenido mucho tiempo de revisar el código y de todas formas no veo nada raro...Puede ser que me falte configurar algo? 
","There hasn't been any activity on this issue in the past 6 months, so it has been marked as stale and it will be closed automatically if no further activity occurs in the next 30 days.
If you want this issue to never become stale, please ask a PSC member to apply the ""no stale"" label."
Issue,4042,Importes incorrectos en l10n_es_igic/data/template/account.tax-es_common_canary.csv?,"Calcula mal los impuestos de los documentos de compra con impuestos IGIC.

## Module
l10n_es_igic

## Describe the bug
Creo que los importes de varios impuestos dentro del fichero account.tax-es_common_canary.csv no son los correctos. Adjunto pantallazos

## To Reproduce
Por ejemplo;

IGIC 3% (Retail trade) en el campo ""amount"" tiene establecido 2.1, cuando debería ser 3.

![Image](https://github.com/user-attachments/assets/ae99ec86-408d-492c-a640-d18d51d8d7be)

![Image](https://github.com/user-attachments/assets/b626473e-64a7-4486-a4a4-63118f41be29)

![Image](https://github.com/user-attachments/assets/58e1d1bc-7ff2-4b94-9844-fabb4972c64b)

","Buenas @JMTato, esos impuestos corresponden a los de impuesto minorista, pese a que se llamen Impuesto 3% en realidad no se aplica el 3%. Te adjunto un documento con más información: https://www.google.com/url?sa=t&source=web&rct=j&opi=89978449&url=https://revistas.cef.udima.es/index.php/RCyT/article/download/18473/18201/27775&ved=2ahUKEwijmKzC1MKJAxXEVqQEHXihBlkQFnoECDYQAQ&usg=AOvVaw1b3TMfGz9pYSg7Dfdeo_3U  [SEP] Muchísimas gracias!! Entendido y disculpa."
Issue,4039,[16.0] l10n_es_ticketbai: visualización errónea campo exenciones fiscales para ticketbai en formulario posiciones fiscales,"En Facturación/Contabilidad => Configuración => Posiciones Fiscales. Vista form, tab TicketBAI las exenciones ticketbai se ven 👇 

![Image](https://github.com/user-attachments/assets/d0bb1629-041d-4626-b815-ffbf8fed971e)

## Module
l10n_es_ticketbai

**Additional context**
En la guía de migración a 16 encontramos:
`One2many fields outside of a notebook are now not expanding to the full form width by default. You should put colspan=""2"" for achieving such effect`","Rolando, no es necesario abrir un issue cuando vais a abrir el PR. Simplemente abre el PR directamente con el texto del issue. Cierro y se sigue por #4040 "
Issue,4024,Error en la exportación del fichero 303,"<!-- Al importar el fichero del 303 en la página de Hacienda devuelve que el contenido es incorrecto en alguna de las casillas del apartado ""IVA devengado"" -->

## Module
AEAT modelo 303 
l10n_es_aeat_mod303.

## Describe the bug
Al importar el fichero en la página de Hacienda https://www2.agenciatributaria.gob.es/wlpl/A303-FWME/E2025/OPEN/index.zul se obtienen los siguientes errores:

30515 | Contenido incorrecto en alguna de las casillas bloqueadas en el apartado ""IVA devengado"".
E010811 | La casilla 'Tipo % [166]' sólo admite valor 0
E010321 | La casilla 'Tipo % [154]' sólo admite valor 0
E010841 | La casilla 'Tipo % [169]' sólo admite valor 0,5
E010501 | La casilla 'Tipo % [17]' sólo admite valor 0

Las casillas a las que hace referencia no son utilizadas por el usuario

<img width=""954"" alt=""Image"" src=""https://github.com/user-attachments/assets/044f82ee-94a9-474c-9360-4eb25ea3ed74"" />

<img width=""555"" alt=""Image"" src=""https://github.com/user-attachments/assets/a49b3c25-db90-42f6-92c1-c9b91a4fe6d6"" />


## To Reproduce
**Affected versions**:

Steps to reproduce the behavior:
1. Contabilidad / Declaraciones AEAT / Modelo 303
2. Botón Crear , completar campos requeridos, Calcular, Confirmar, Exportar a BOE
3. Ir a la página de Hacienda seleccionar período subir fichero

**Expected behavior**
Que el fichero sea admitido

**Additional context**
Add any other context about the problem here. (e.g. OS, Python version, ...)","Revisa los pull request en 15.0 y 16.0, que ya está corregido, y en camino la 17.0. Para versiones anteriores, podéis hacer cherry-pick."
Issue,4020,Debate: cambio de nombre del menú Declaraciones AEAT,"Hola,

Nos estamos encontrando que empieza a existir modelos fiscales propios de ciertas zonas geográficas. Hasta ahora teníamos el menú de Declaraciones AEAT donde se engloba todo, mi propuesta es sencilla es cambiarle el nombre a Declaraciones o Declaraciones Impuestos. No poner AEAT, sino estamos creando un menú nuevo para cada zona incrementan los menú.

Por ejemplo, Declaraciones ATC, podrían ir el 415 y 420 englobados dentro de Declaraciones, pasaría lo mismo con el modelo 140 del Batuz del país vasco.

Qué opináis le cambiamos el nombre o uno más genérico y dejamos un solo menú principal, que luego tendrá los que requiera cada zona?

Saludos,
Ignacio","Bueno, con las de ATC creamos un nuevo menú de segundo nivel ""Declaraciones ATC"": https://github.com/OCA/l10n-spain/blob/16.0/l10n_es_atc/views/atc_menuitem.xml#L4, pero podemos reformularlo a tener un único menú superior y poner tres niveles:

- Declaraciones

  -  AEAT

     - Modelo 303

  -  ATC

     - Modelo 415

 [SEP] @pedrobaeza me parece también bien, la idea es no llenar de menús el principal que puede ser al final muy  poco visual.

Pero también hay que tener en cuenta que el por ejemplo el 347 se llama igual en varios sitios, pero hay alguna diferencia por ejemplo en Guipuzcoa se exporta diferente. No sería AEAT, aunque realmente el cálculo es el mismo, especificamente, pero si tiene una diferencia. Tal vez un así, aunque aquí no lo tengo tan claro, porque veo que muchos van a ser generales:

- Declaraciones

  - Generales
     - Modelo 347
  - AEAT
     - Modelo 303
  -  ATC
     - Modelo 415


Saludos,
Ignacio

 [SEP] Uf, eso no me termina de convencer, porque en Canarias creo que no existe 347, por lo que tenerlo en el apartado ""Generales"" se puede entender que también les afecta, siguiendo esa misma lógica. [SEP] Ok, pues lo dejamos como AEAT los comunes, aunque tengan formato diferente de exportación, como es el caso de Guipuzcoa.

- Declaraciones

  -  AEAT

     - Modelo 303
     - Modelo 347

  -  ATC

     - Modelo 415

  -  Bizkaia/Vizcaya

     - Modelo 140

.... [SEP] > Ok, pues lo dejamos como AEAT los comunes, aunque tengan formato diferente de exportación, como es el caso de Guipuzcoa.
> 
> * Declaraciones
>   
>   * AEAT
>     
>     * Modelo 303
>     * Modelo 347
>   * ATC
>     
>     * Modelo 415
>   * Bizkaia/Vizcaya
>     
>     * Modelo 140
> 
> ....

Me parece una buena idea 👍🏻 [SEP] OK, pues podemos hacer el cambio de 17 en adelante, ¿o queréis ir más atrás? [SEP] Yo haría 16.0, 17.0 y 18.0 (cuando se migre).

Saludos,
Ignacio [SEP] OK, pues adelante quien se anime a hacerlo. [SEP] Lo veo bien también, así sobrecargamos menos el menú. Lo único que no estoy seguro si deberíamos sacar el menu item fuera de l10n_es_aeat, en el caso de la ATC no nos afecta porque heredamos directamente de l10n_es_aeat pero el motivo principal es heredar de las plantillas de mapeo y los test helpers. Toda esa funcionalidad podría ir en un módulo común a parte. [SEP] Yo creo que debe quedarse en `l10n_es_aeat` por el momento, ya que es una base adecuada para las declaraciones (sean de la Administración que sean) y no creo que surja el que algún modelo no dependa de este módulo y ""vaya por libre"" sin heredar el modelo base de declaración. [SEP] Asigno yo a un programador y que mande el PR [SEP] There hasn't been any activity on this issue in the past 6 months, so it has been marked as stale and it will be closed automatically if no further activity occurs in the next 30 days.
If you want this issue to never become stale, please ask a PSC member to apply the ""no stale"" label. [SEP] Ya realizado."
Issue,4017,[16.0] l10n_es_aeat_mod347 Movimientos sin impuesto no se reflejan en el mod347,"La compañía es una organización sin ánimo de lucro. 
No tiene obligación de marcar un impuesto, pero si de declarar los movimientos en el mod347.

Solución propuesta: Añadir un impuesto (ej: ""No aplica"") para poder asociarlo al mapeo de la 347. 

Un saludo.","Utiliza el impuesto no sujeto para ello. [SEP] Gracias @pedrobaeza . Había probado esa posibilidad.
Pero si uso ese impuesto que está en el mapeo del Libro de IVA y la casuística para una organización sin ánimo de lucro, como me indican, es que pueda aparecer en el mod347, pero que no aparezca en el libro de IVA.
 [SEP] De momento no está contemplado eso, pero siempre puedes eliminar a mano el impuesto no sujeto del mapeo del libro de IVA. [SEP] Pero entonces los movimientos que literalmente sean no sujetos y que tuvieran que aparecer en el Libro de IVA, no aparecerán. Al quitarlo del mapeo. [SEP] Si como asociación dices que tienes líneas sin impuestos, no creo que tengas IVA no sujeto. [SEP] Me dicen que la organización se comporta como un híbrido. Hay movimientos que si tienen su impuesto, pudiendo incluir no sujeto y a su vez movimientos que declaran por el mod347 que eran los que no entraban en el cálculo por ir el campo impuesto vacío. [SEP] Tendréis que hacer entonces vosotros los modificación para tener todos los casos cubiertos. [SEP] Eso me temo. Había que intentarlo. 
Gracias."
Issue,4016,[17.0],"<!-- Provide a general summary of the issue in the Title above.
Before opening the issue, please check that there isn't another issue addressing the same problem already created -->

Name of taxes too short

## Module
l10n_es_vat_book (I think)

## Describe the bug
I'm not sure if it is a bug or not, in odoo 16 in the taxes the names were quite clear, but I am in a new installation of odoo 17 and the names of the taxes are too short, the description is correct but then when you want to select the type of tax in a product the name that comes out in my opinion makes it difficult to identify, I tried to reload the translations in case it was a problem with the translation.

## To Reproduce
**Affected versions**: 17

Steps to reproduce the behavior:
1. Invoicing >
2. Settings >
3. Taxes

**Expected behavior**
Odoo 16 
![Image](https://github.com/user-attachments/assets/6cf358a4-cfec-4d0c-b3ad-d7178a81cf6a)
Odoo 17

![Image](https://github.com/user-attachments/assets/40b049ce-7ae5-46a9-85a2-8901afe15926)

**Additional context**
Ubuntu 22
Python 3.12","This is not something of this repository, but Odoo itself. Please look in odoo/odoo about that, which we already discussed with them, and it was rejected with a reasoning, not remembering if in a dedicated issue or the pull request introducing the change."
Issue,4008,Problemas con impuestos y tests,"Estoy teniendo problemas a la hora de pasar tests con el repositorio... y veo que el propio repositorio también tiene problemas para pasar los tests.
Por lo que he podido comprobar el problema (o una parte de el mismo) viene de este commit: https://github.com/odoo/odoo/commit/401a961258e991151370899d4b61809879d5a5a8#diff-83dee710d59b2001661ef48dc223df6eff197f827e97b5420f2a669ea873c568

En el cual se borran entre otros, el impuesto llamado ""iva21isp"". El cual se usa en el modulo ""l10n_es_facturae"" (account_tax_template.xml)

** Comentar que este apartado de Odoo es totalmente desconocido para mi, no se si lo que comento puede resultar de ayuda... pero aquí lo dejo por si pudiera servir para corregir el ""atasque"". Disculpad si estoy metiendo ruido.
",Se está analizando en #3996
Issue,3999,Tratamiento de los impuestos [old],"Buenas tardes!

De vez en cuando Odoo actualiza algunos impuestos y los desactiva poniendoles un [old] delante y creando un nuevo impuesto que tiene el mismo nombre, pero sin el [old]. Al hacerlo, el impuesto viejo pierde su plantilla, por lo que si se continúa usando (cosa muy frecuente, ya que no siempre se detecta el cambio al momento) los apuntes contables que lo contienen no van a las declaraciones AEAT (Modelo 303, 347, 349, etc.) teniendo que crearles una nueva plantilla para solucionarlo o reemplazar el impuesto viejo por el nuevo en todos los apuntes contables (a nivel funcional esto ultimo suele ser inviable por el volumen de información).

Por tanto, queríamos preguntar si la comunidad tiene pensando desarrollar algo que evite esto, por ejemplo algún automatismo para crear plantilla para impuestos descatalogados.

Quedo a la espera de su respuesta.

Un saludo y gracias de antemano.","Hola, esto es algo que debe arreglarse a nivel de Odoo, no aquí. Sé que han hecho algunos fixes y creo que no volverá a ocurrir, pero no tengo la certeza, y cuando pasa, hay que arreglarlo manualmente. 

Cierro al no ser algo de este repositorio."
Issue,3995,[16.0] l10n_es_facturae Campo de IVA muestra más de 3 decimales en vez de redondear,"Buenas tardes!

Adjunto la imagen de un archivo de factura electrónica que hice en el Runboat de la V16. Es una factura de una sola línea por valor de 1033,33 euros con un IVA del 21%.

![Image](https://github.com/user-attachments/assets/b2190015-e864-4aae-bf94-9c1928d4d0f0)



En el archivo hay varios campos relativos al IVA. Todos ellos excepto uno redondean el IVA a 2 decimales (es decir, a centimos de euro), mostrando un IVA de 217 euros exactos. El ultimo campo de <TaxAmount><TotalAmount>, sin embargo, tiene 4 decimales, siendo el IVA por valor de 216.99930000. Eso genera problemas de validación de la factura.

Existe la posibilidad de arreglar este problema en actualizaciones futuras del modulo?

Un saludo y gracias de antemano

",La versión de Factuae utilizada especificará eso en su formato. Cambia a otra versión que sea la de 3 decimales (si es que existe). Esto va normalizado. [SEP] Cierro por lo comentado.
Issue,3984,[14.0] l10n_es_ticketbai_pos B4_2000003:(ES): Registro duplicado,"Este comportamiento esta comprobado en la versiones 14.0 y 15.0

## Modulo
l10n_es_ticketbai_pos

## Descripción
En ocasiones, no siempre, hace mal el envío de las facturas Ticketbai informando como numero de factura simplificada el *numero anterior* como si fuera el número de la factura emitida. Esto provoca que hacienda rechace la factura por entender que es un registro duplicado.  

![Image](https://github.com/user-attachments/assets/1f9eebfd-466e-461a-ad84-2e13156b9784)


En el fichero que se envía, los datos de la cabecera, donde indica el número de factura  emitida, **está indicando el de la factura anterior**. En el mismo fichero que se envía, en el apartado la HuellaTBAI donde se debe informar de la factura anterior, esta correcto. Y es el mismo número!!

```
	<Factura>
		<CabeceraFactura>
			<SerieFactura>FTPV/SAN25/</SerieFactura>
			<NumFactura>00087</NumFactura>
			<FechaExpedicionFactura>03-01-2025</FechaExpedicionFactura>
			<HoraExpedicionFactura>16:57:48</HoraExpedicionFactura>
			<FacturaSimplificada>S</FacturaSimplificada>
		</CabeceraFactura>
              ..........
	<HuellaTBAI>
		<EncadenamientoFacturaAnterior>
			<SerieFacturaAnterior>FTPV/SAN25/</SerieFacturaAnterior>
			<NumFacturaAnterior>00087</NumFacturaAnterior>
			<FechaExpedicionFacturaAnterior>03-01-2025</FechaExpedicionFacturaAnterior>
```


Este error es aleatorio y en 1 mes con varios POS, emitiendo 6000 facturas, ha ocurrido en 10 ocasiones.

Las facturas del POS no tienen el mecanismo para cancelar el envío y recrearlo para corregir el problema como si tienen las facturas de los diarios contables.
","Acabo de ver que este bug ya estaba registrado aquí #3448 
Pero parece que no se ha aportado ninguna solución por el momento.

Alguna novedad @xabispacebiker @omar7r  
 [SEP] Buenas 
Encuentro nuevos errores en el POS con la numeración de facturas simplificadas. Estos errores se producen cuando hay desconexión del POS. 
Pongo una imagen de ejemplo donde se observa que el mecanismo para asignar el numero de factura simplificada produce otros errores.
En la imagen el numero de pedido ha producido un desajuste en la correlación de la numeración.
Pero en la asignación del numero de factura simplificada ha producido duplicaciones.

![Image](https://github.com/user-attachments/assets/6de1eaaf-dae0-4c4f-861d-4f385c3175cd)

Esto junto con el módulo Ticketbai provoca facturas rechazadas que no se registran en hacienda.

Otro asunto relacionado #3480  [SEP] There hasn't been any activity on this issue in the past 6 months, so it has been marked as stale and it will be closed automatically if no further activity occurs in the next 30 days.
If you want this issue to never become stale, please ask a PSC member to apply the ""no stale"" label."
Issue,3971,Modelos Hacienda Foral de Bizkaia,"¡Hola! ❤ 

### ¿Tu solicitud de funcionalidad está relacionada con un problema?

Actualmente, no hay ningún módulo de localización española en Odoo (OCA/l10n-spain) que incluya los modelos fiscales específicos que deben presentarse ante la Hacienda Foral de Bizkaia.

Las empresas y usuarios de Odoo en este territorio tienen requisitos diferentes respecto a los modelos estándar de la AEAT, lo que dificulta la gestión centralizada de los impuestos. Esto nos lleva a depender de soluciones personalizadas o externas, lo que no resulta eficiente ni sostenible.

### Describe la solución que te gustaría

Nos gustaría que la comunidad considerara la posibilidad de incluir los modelos fiscales requeridos por la Hacienda Foral de Bizkaia en OCA/l10n-spain. Algunos ejemplos de estos modelos son:

- Modelo 303 (declaración de IVA, adaptado a Bizkaia).
- Modelo 115 (retenciones de alquileres, Bizkaia).
- Modelo 111 (retenciones de IRPF, Bizkaia).
- Modelo 347 (operaciones con terceros, Bizkaia).
- Modelo 349 (operaciones intracomunitarias, Bizkaia).
- Y otros modelos relevantes para la gestión fiscal de este territorio histórico.

La solución podría consistir en la creación de un submódulo específico para Bizkaia dentro de l10n-spain, que permita generar los modelos necesarios en formatos compatibles (XML y PDF) según las especificaciones de la Hacienda Foral. Esto facilitaría enormemente el cumplimiento fiscal de las empresas que operan en Bizkaia.

### Describe las alternativas que has considerado

Queremos plantear esta cuestión a la comunidad para conocer la situación actual y valorar los próximos pasos. Las alternativas que hemos considerado son:

- Explorar si ya existen desarrollos o módulos específicos fuera de OCA: ¿Existen módulos o soluciones que ya incorporen los modelos fiscales de Bizkaia aunque no estén integrados en l10n-spain?
- Valorar el interés de la comunidad para incluir estos modelos en OCA: ¿Es esta una necesidad compartida por otros usuarios? ¿Tiene sentido integrarlo como parte del estándar de localización española?
- Plantearnos desarrollar un módulo desde cero en OCA: En caso de que no existan soluciones previas o de que la comunidad lo considere interesante, ¿sería viable empezar el desarrollo dentro de OCA para aprovechar las ventajas de centralizar estos modelos?

**Nos gustaría saber si alguien ya ha trabajado en esta línea, si hay interés en la comunidad por incluir estos modelos o si hay referencias de desarrollos existentes que puedan aprovecharse.**

### Contexto adicional

La Hacienda Foral de Bizkaia tiene requisitos fiscales y formatos técnicos diferentes a los de la AEAT, incluyendo especificaciones propias para la generación de archivos XML y plazos distintos de presentación. Incluir estos modelos en OCA/l10n-spain sería una mejora importante para las empresas que operan en Bizkaia, permitiendo una gestión fiscal integrada en Odoo.

Documentación oficial sobre los modelos en Bizkaia:
https://www.bizkaia.eus/.

Muchas gracias 😄 

@moduon MT-8829

Ping @acysos @OCA/local-spain-maintainers @rrebollo @antoniodavid @Christian-RB @hugomartineznetkia @jonerikceberio @Bilbonet @oihane @IvanHRN @Berezi @ao-landoo @aritzolea @omar7r @joao-p-marques @Gelojr @fcvalgar ","A tener en cuenta: https://github.com/OCA/l10n-spain/pull/2371#issuecomment-1169837041 [SEP] Issues o PRs relacionados:

- https://github.com/OCA/l10n-spain/pull/2371
- https://github.com/OCA/l10n-spain/pull/3571 [SEP] Haciende Bizkaia “DFB” tiene una aplicación llamada [BILA](https://www.bizkaia.eus/es/bila) como herramienta para cumplir con los modelos fiscales.
Esta aplicación permite importa ciertos modelos desde ficheros tal como se ha comentado en otros issues y PRs aquí comentados.

Yo por mi parte no tengo ningún desarrollo ni conozco ninguno a este respecto.

Puestos a debatir este tema, en mi opinión se podría empezar con los modelos más habituales  de IVA (303 y 390) y su casuística.

En Bizkaia, hacienda pide declarar el IVA deducible separando compras de gastos y bienes de inversión.

![Image](https://github.com/user-attachments/assets/f7967544-c65a-4aeb-b9f0-618ae2e22c96)

Esto actualmente se realiza separando en diarios los diferentes grupos. Aunque luego es un poco costoso obtener de Odoo la información separada en estos grupos y por tipos impositivos. El informe de OCA **""Tabla de impuestos""** no permite filtrar por Diario. Te tienes que ir ha los apuntes contables y allí realizar filtros, agrupaciones y calculadora en mano para sacar lo datos.

Buscar una forma más optima de agilizar este proceso e incluso añadir los modelos 303 y 390 para la BFA podría ser un comienzo.

Muchas gracias 🙂
 [SEP] There hasn't been any activity on this issue in the past 6 months, so it has been marked as stale and it will be closed automatically if no further activity occurs in the next 30 days.
If you want this issue to never become stale, please ask a PSC member to apply the ""no stale"" label."
Issue,3970,l10n_es_aeat_mod303: Casilla 60 de exportaciones se suma por un cliente nacional con IVA exento repercutido y sujeto.,"<!-- Provide a general summary of the issue in the Title above.
Before opening the issue, please check that there isn't another issue addressing the same problem already created -->

## Module
[l10n_es_aeat_mod303](https://github.com/OCA/l10n-spain/tree/14.0/l10n_es_aeat_mod303)

## Describe the bug
Un arrendamiento de vivienda a un cliente nacional con impuesto ""IVA exento repercutido sujeto"" en el 303 NO debería ir en la 60 de exportaciones, dado que no se trata de una exportación y es exento, repercutido, **y sujeto**.

Con ""NO sujeto"" esto no pasaría, pero se da el caso de que es una operación **exenta y sujeta al IVA al mismo tiempo**. Al ser nacional, no debería ir en la casilla 60 porque no es una operación de exportación o asimiladas.

## To Reproduce
**Affected versions**: Versiones soportadas (>14.0)

Steps to reproduce the behavior:
1. Añadir impuesto IVA exento repercutido sujeto en un contacto de régimen nacional real.
2. Siendo de régimen nacional, aparece en la casilla 60 del 303 de ese periodo.

**Expected behavior**
No debería sumarse en la casilla 60 **en este caso, cuando el cliente es nacional**.

**Additional context**
Entiendo que no es por el naming que tenga el impuesto que sea ""No sujeto"" vs ""Sujeto"", los asesores me comentan que es un caso ""sujeto"" y ""exento"" a la vez.","@giarve , es correcto el BUG. Te lo ratifico. El caso es que cada uno esta usando el mismo impuesto para cosas diferentes...

Si quieres lee por curiosidad https://github.com/OCA/l10n-spain/issues/2945

Nadie lo resuelve y mis intentos han sido baldíos 😢  [SEP] Hola @giarve ,

Te comento para que le expliques a los asesores, pues lamentablemente hay un impuesto para gobernar todas las exenciones y claro... no vale. Entonces tiene que cambiar los XML-ID del ""impuesto comodín"" para corregirlo.

Existen varias exenciones del IVA y lamentablemente no tenemos (en Odoo 16 y anteriores) varios impuestos diferentes, sólo hay uno y otros más incorrecto y confuso que otra cosa.

Lo primero que tienes que determinar es ¿cuál es el artículo de La Ley del IVA que necesitan?

Y la respuesta que te van a decir es el Artículo 20 de la ley del IVA.

## Operaciones EXENTAS de IVA (sujetas pero exentas)

| Tipo de Exención                                           | Artículo LIVA      | Casilla Modelo 303                      |
|------------------------------------------------------------|--------------------|------------------------------------------|
| Exenciones interiores (sanidad, educación, etc.)           | Art. 20            | Casilla 83 (*solo en 4T o mes 12*)       |
| Exportaciones de bienes                                    | Art. 21            | Casilla 60 / 94                          |
| Operaciones asimiladas a exportaciones                     | Art. 22            | Casilla 60 / 94                          |
| Servicios relacionados con exportaciones                   | Art. 23            | Casilla 60 / 94                          |
| Zonas francas, depósitos aduaneros, etc.                   | Art. 24            | Casilla 60 / 94                          |
| Entregas intracomunitarias de bienes                       | Art. 25            | Casilla 59 / 93                          |
| Agencias de viajes – operaciones exentas                   | Art. 143           | Casilla 60 / 94                          |

---

## Operaciones NO SUJETAS al IVA (por localización u otros motivos)

| Tipo de No Sujeción                                         | Fundamento Legal   | Casilla Modelo 303 |
|-------------------------------------------------------------|---------------------|---------------------|
| Operaciones No sujetas por reglas de localización           | Arts. 69-70 LIVA    | Casilla 120         |
| Otras operaciones no sujetas por reglas de localización     | Arts. 68-72 LIVA    | Casilla 121         |
 [SEP] Lo ideal aquí no sería tener un impuesto distinto por cada artículo del IVA entonces? Cuál sería el problema? Compatibilidad con versiones anteriores?

El impuesto comodín este va a cubrir muchos casos, pero no siempre y no queda claro cuando **sin mirar las casillas de mapeo de impuestos**. 
Otra alternativa sería tener más impuestos comodines, por ejemplo, agrupar todos los que van a la Casilla 60 / 94. O se le pone un nombre largo.

Lo más fácil para el usuario: que el impuesto sea autodescriptivo, es decir, 1 impuesto por cada artículo del IVA.
Lo más fácil para mantener, entiendo: impuesto comodín para las mismas casillas (problema: quizás en un futuro hay que desglosar si cambia la casilla y daría pie a errores? no se las veces que ha podido pasar esto o si ha pasado)

De todas formas no le veo mucha diferencia pero no soy yo el que ha estado manteniendo los impuestos así que voy a dejar que gente con más experiencia digan algo por este hilo. [SEP] En 17 ya hay un desglose de cada IVA exento según artículo, e hice un remapeo. Revisad https://github.com/OCA/l10n-spain/pull/4084/files#diff-8da58f33dfe1f2b3032205072ca8757fc48b8ca81d21fde4951d35fd5bc176eeR42

Parece que en la casilla 60 siguen faltando otros tipos de exento según la tabla de Rafa, eso sí. [SEP] There hasn't been any activity on this issue in the past 6 months, so it has been marked as stale and it will be closed automatically if no further activity occurs in the next 30 days.
If you want this issue to never become stale, please ask a PSC member to apply the ""no stale"" label."
Issue,3961,TBAI no ha generado codigo QR,"
## Module
l10n_es_edi_tbai para Odoo 17

## Describe the bug
Buenas,

Tengo instalado el modulo  l10n_es_edi_tbai y he subido mi primera factua con el mismo.

Los datos ha subido y validado con Hacienda de Gipuzkoa sin ningun error.

Mi problema es que no me ha generado el codigo QR en la fra y no sé ahora si puedo regenerar ese código QR  de alguna manera.

Tengo que hacer una segunda fra y no me atrevo hasta no solucionar esto.

Tengo Odoo17 CE, se os ocurre por donde tirar? Se puede regenerar el codigo qr de alguna manera?

Gracias de antemano.
Saludos	","Hola, Nosotros llevamos ya unos meses trabajando con el módulo de TicketBAI  contra la hacienda de Bizkaia sin problemas, y el QR se genera en el momento de firmar la factura para enviarla al LROE. SIn embargo desde la actualización a Odoo18 falla y sabemos que está dando muchos problemas. Odoo por ahora no está dando respuestas. [SEP] A mi con la versión Odoo17, tenia problemas para generar el codigo QR, aunque si que subían bien las facturas (esto puedes chequear en la web de Hacienda de Gipuzkoa [https://egoitza.gipuzkoa.eus/WAS/CORP/WATTramiteakWEB/inicio.do])   y gracias a la comunidad de OCA aeodoo. El link de la consulta es el siguiente:
[https://www.aeodoo.org/en/forum/localizacion-espanola-3/tbai-error-al-generar-el-codigo-qr-1960])
Lo solucioné instalando:
pip install reportlab
sudo apt-get install libcairo2 [SEP] There hasn't been any activity on this issue in the past 6 months, so it has been marked as stale and it will be closed automatically if no further activity occurs in the next 30 days.
If you want this issue to never become stale, please ask a PSC member to apply the ""no stale"" label."
Issue,3942,[16.0][WIP] l10n_es_igic_facturae,"Actualmente si intentas generar un fichero facturae con impuestos Canarios se genera un error al faltar el campo `facturae_code` en estos.

![Image](https://github.com/user-attachments/assets/06810257-a427-457a-96b9-712b1a0f8d58)

Se requiere un módulo sencillo que asigne el campo facturae_code a los impuestos del IGIC y que se autoinstale cuando están instalados los módulos l10n_es_facturae y l10n_es_igic.

Trabajando en la solución.
@BinhexTeam",
Issue,3941,[16.0][BUG] l10n_aeat_sii_oca: Facturas de Tipo F6,"El módulo/desarrollo no incluye las facturas de tipo F6.

(https://github.com/user-attachments/assets/f84752c9-ded4-4272-93cf-c8ce0be02631)

Este tipo de factura (F6) se utiliza por ejemplo cuándo un proveedor es extracomunitario, pero con NIF europeo.

La operación está sujeta y no exenta, En el 303 funciona cómo el sujeto pasivo o las adquisiciones intracomunitarias, pero este tipo de factura de servicios no comunitarios, deben constar en las casillas 12-13 (IVA devengado) y 28-29 (IVA deducible)

Normativa AEAT (Página 65): https://sede.agenciatributaria.gob.es/static_files/Sede/Procedimiento_ayuda/G417/FicherosSuministros/V_Final/FAQsAVyREBU31032023V-FINAL.pdf



","Hola, efectivamente no está cubierto. He anotado la falta para que conste en https://github.com/OCA/l10n-spain/commit/5c46443507ba3da27ae3e1158894df1a651312e8, pero a no ser que contribuyáis vosotros con esa mejora, no está previsto incluirlo, así que cierro."
Issue,3900,"[15.0] [16.0] l10n_es_ticketbai: raises ""psycopg2.errors.UndefinedFunction: function to_date(date, unknown) does not exist"" when upgrading from v14","## Module
l10n_es_ticketbai

## Describe the bug
Using openupgrade in a doodba-copier-template project to go from v14.0 to v15.0 raises this error with the following traceback:
```
2025-01-14 17:14:33,492 1 INFO devel OpenUpgrade: l10n_es_ticketbai: post-migration script called with version 14.0.2.9.3
2025-01-14 17:14:33,492 1 ERROR devel odoo.sql_db: bad query:
        UPDATE tbai_invoice_refund_origin
        SET expedition_date = TO_DATE(""openupgrade_legacy_15_0_expedition_date"", 'DD-MM-YYYY')

ERROR: function to_date(date, unknown) does not exist
LINE 3:         SET expedition_date = TO_DATE(""openupgrade_legacy_15...
                                      ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.

2025-01-14 17:14:33,492 1 ERROR devel OpenUpgrade: Error after 0:00:00.000289 running
        UPDATE tbai_invoice_refund_origin
        SET expedition_date = TO_DATE(""openupgrade_legacy_15_0_expedition_date"", 'DD-MM-YYYY')

2025-01-14 17:14:33,492 1 ERROR devel OpenUpgrade: l10n_es_ticketbai: error in migration script /opt/odoo/auto/addons/l10n_es_ticketbai/migrations/15.0.1.4.6/post-migration.py: function to_date(date, unknown) does not exist
LINE 3:         SET expedition_date = TO_DATE(""openupgrade_legacy_15...
                                      ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.

2025-01-14 17:14:33,492 1 ERROR devel OpenUpgrade: function to_date(date, unknown) does not exist
LINE 3:         SET expedition_date = TO_DATE(""openupgrade_legacy_15...
                                      ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.

Traceback (most recent call last):
  File ""/usr/local/lib/python3.8/site-packages/openupgradelib/openupgrade.py"", line 2308, in wrapped_function
    func(
  File ""/opt/odoo/auto/addons/l10n_es_ticketbai/migrations/15.0.1.4.6/post-migration.py"", line 10, in migrate
    openupgrade.logged_query(
  File ""/usr/local/lib/python3.8/site-packages/openupgradelib/openupgrade.py"", line 1718, in logged_query
    cr.execute(query, args)
  File ""<decorator-gen-5>"", line 2, in execute
  File ""/opt/odoo/custom/src/odoo/odoo/sql_db.py"", line 90, in check
    return f(self, *args, **kwargs)
  File ""/opt/odoo/custom/src/odoo/odoo/sql_db.py"", line 311, in execute
    res = self._obj.execute(query, params)
psycopg2.errors.UndefinedFunction: function to_date(date, unknown) does not exist
LINE 3:         SET expedition_date = TO_DATE(""openupgrade_legacy_15...
                                      ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
```

Using openupgrade in a doodba-copier-template project to go from v15.0 to v16.0 raises this error with the following traceback:

```
ERROR devel odoo.sql_db: bad query:
        UPDATE tbai_invoice_refund_origin
        SET expedition_date = TO_DATE(""openupgrade_legacy_16_0_expedition_date"", 'DD-MM-YYYY')

ERROR: function to_date(date, unknown) does not exist
LINE 3:         SET expedition_date = TO_DATE(""openupgrade_legacy_16...
                                      ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.

2025-01-14 20:29:13,432 1 ERROR devel OpenUpgrade: Error after 0:00:00.000390 running
        UPDATE tbai_invoice_refund_origin
        SET expedition_date = TO_DATE(""openupgrade_legacy_16_0_expedition_date"", 'DD-MM-YYYY')

2025-01-14 20:29:13,432 1 ERROR devel OpenUpgrade: l10n_es_ticketbai: error in migration script /opt/odoo/auto/addons/l10n_es_ticketbai/migrations/16.0.1.0.1/post-migration.py: function to_date(date, unknown) does not exist
LINE 3:         SET expedition_date = TO_DATE(""openupgrade_legacy_16...
                                      ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.

2025-01-14 20:29:13,432 1 ERROR devel OpenUpgrade: function to_date(date, unknown) does not exist
LINE 3:         SET expedition_date = TO_DATE(""openupgrade_legacy_16...
                                      ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.

Traceback (most recent call last):
  File ""/usr/local/lib/python3.10/site-packages/openupgradelib/openupgrade.py"", line 2308, in wrapped_function
    func(
  File ""/opt/odoo/auto/addons/l10n_es_ticketbai/migrations/16.0.1.0.1/post-migration.py"", line 10, in migrate
    openupgrade.logged_query(
  File ""/usr/local/lib/python3.10/site-packages/openupgradelib/openupgrade.py"", line 1718, in logged_query
    cr.execute(query, args)
  File ""/opt/odoo/custom/src/odoo/odoo/sql_db.py"", line 321, in execute
    res = self._obj.execute(query, params)
psycopg2.errors.UndefinedFunction: function to_date(date, unknown) does not exist
LINE 3:         SET expedition_date = TO_DATE(""openupgrade_legacy_16...
                                      ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.

2025-01-14 20:29:13,434 1 WARNING devel odoo.modules.loading: Transient module states were reset
2025-01-14 20:29:13,445 1 ERROR devel odoo.modules.registry: Failed to load registry
Traceback (most recent call last):
  File ""/opt/odoo/custom/src/odoo/odoo/modules/registry.py"", line 87, in new
    odoo.modules.load_modules(registry, force_demo, status, update_module)
  File ""/opt/odoo/custom/src/odoo/odoo/modules/loading.py"", line 485, in load_modules
    processed_modules += load_marked_modules(cr, graph,
  File ""/opt/odoo/custom/src/odoo/odoo/modules/loading.py"", line 373, in load_marked_modules
    loaded, processed = load_module_graph(
  File ""/opt/odoo/custom/src/odoo/odoo/modules/loading.py"", line 237, in load_module_graph
    migrations.migrate_module(package, 'post')
  File ""/opt/odoo/auto/addons/openupgrade_framework/odoo_patch/odoo/modules/migration.py"", line 18, in migrate_module
    MigrationManager.migrate_module._original_method(self, pkg, stage)
  File ""/opt/odoo/custom/src/odoo/odoo/modules/migration.py"", line 189, in migrate_module
    migrate(self.cr, installed_version)
  File ""/usr/local/lib/python3.10/site-packages/openupgradelib/openupgrade.py"", line 2308, in wrapped_function
    func(
  File ""/opt/odoo/auto/addons/l10n_es_ticketbai/migrations/16.0.1.0.1/post-migration.py"", line 10, in migrate
    openupgrade.logged_query(
  File ""/usr/local/lib/python3.10/site-packages/openupgradelib/openupgrade.py"", line 1718, in logged_query
    cr.execute(query, args)
  File ""/opt/odoo/custom/src/odoo/odoo/sql_db.py"", line 321, in execute
    res = self._obj.execute(query, params)
psycopg2.errors.UndefinedFunction: function to_date(date, unknown) does not exist
LINE 3:         SET expedition_date = TO_DATE(""openupgrade_legacy_16...
                                      ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.

2025-01-14 20:29:13,445 1 CRITICAL devel odoo.service.server: Failed to initialize database `devel`.
Traceback (most recent call last):
  File ""/opt/odoo/custom/src/odoo/odoo/service/server.py"", line 1311, in preload_registries
    registry = Registry.new(dbname, update_module=update_module)
  File ""<decorator-gen-16>"", line 2, in new
  File ""/opt/odoo/custom/src/odoo/odoo/tools/func.py"", line 87, in locked
    return func(inst, *args, **kwargs)
  File ""/opt/odoo/custom/src/odoo/odoo/modules/registry.py"", line 87, in new
    odoo.modules.load_modules(registry, force_demo, status, update_module)
  File ""/opt/odoo/custom/src/odoo/odoo/modules/loading.py"", line 485, in load_modules
    processed_modules += load_marked_modules(cr, graph,
  File ""/opt/odoo/custom/src/odoo/odoo/modules/loading.py"", line 373, in load_marked_modules
    loaded, processed = load_module_graph(
  File ""/opt/odoo/custom/src/odoo/odoo/modules/loading.py"", line 237, in load_module_graph
    migrations.migrate_module(package, 'post')
  File ""/opt/odoo/auto/addons/openupgrade_framework/odoo_patch/odoo/modules/migration.py"", line 18, in migrate_module
    MigrationManager.migrate_module._original_method(self, pkg, stage)
  File ""/opt/odoo/custom/src/odoo/odoo/modules/migration.py"", line 189, in migrate_module
    migrate(self.cr, installed_version)
  File ""/usr/local/lib/python3.10/site-packages/openupgradelib/openupgrade.py"", line 2308, in wrapped_function
    func(
  File ""/opt/odoo/auto/addons/l10n_es_ticketbai/migrations/16.0.1.0.1/post-migration.py"", line 10, in migrate
    openupgrade.logged_query(
  File ""/usr/local/lib/python3.10/site-packages/openupgradelib/openupgrade.py"", line 1718, in logged_query
    cr.execute(query, args)
  File ""/opt/odoo/custom/src/odoo/odoo/sql_db.py"", line 321, in execute
    res = self._obj.execute(query, params)
psycopg2.errors.UndefinedFunction: function to_date(date, unknown) does not exist
LINE 3:         SET expedition_date = TO_DATE(""openupgrade_legacy_16...
                                      ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.

2025-01-14 20:29:13,446 1 INFO devel odoo.service.server: Stopping gracefully
```

## To Reproduce
Steps to reproduce the behavior:
1. Upgrade from v14 to v15 using OpenUpgrade or from v15 to v16

**Expected behavior**
Addon post-migration scrip pass successfully

## Context
doodba-copier-template
openupgrade
postgres v14",
Issue,3896,Error en MOD 111 ODOO 17 de AEAT al crear archivo de exportación para subirlo a la web de AEAT por lotes,"<!-- Provide a general summary of the issue in the Title above.
Before opening the issue, please check that there isn't another issue addressing the same problem already created -->

## Module
17.0/l10n_es_aeat_mod111

## Describe the bug

Al intentar subir el archivo a AEAT me da el siguiente error  ""111_informe_2025-01-14.txt"" = [""CTROLEOF - No se deben presentar declaraciones con carácter de fin de línea o de carro 082-11  14/01/2025 10:21:42""]

## To Reproduce
17.0/l10n_es_aeat_mod111

Steps to reproduce the behavior:
1. subir el archivo por lotes en la web de la AEAT
2.
3.

**Expected behavior**
Al asubirlo deberia de haber pasado ok firmando el archivo y termiando el proceso. 

**Additional context**
Exportar el archivo por lotes para subir a AEAT","¿Qué opción es ésa de ""por lotes""? Yo lo subo desde el botón ""Importar"" y no he tenido problemas:

![Image](https://github.com/user-attachments/assets/bd9b5510-505a-4e62-9e3b-98357de3c301) [SEP] Sucede lo mismo para versión 16.0.

La presentación de pagos por lotes es un servicio que permite enviar declaraciones correspondientes al mismo modelo, ejercicio y perodo de forma conjunta y automática: https://sede.agenciatributaria.gob.es/Sede/ayuda/manuales-videos-folletos/videos/presentacion-declaraciones-lotes.html

Lo curioso es que si subes los mismos archivos por separado AEAT se lo traga, pero por lotes da el error:

>CTROLEOF - No se deben presentar declaraciones con carácter de fin de línea o de carro

No hay ninguna especificación técnica, ni nada en el diseño de registro del modelo 111 que indique que se tiene que generar de manera diferente el archivo de exportación.

De todas formas por el error que da, tiene pinta que el error está aquí https://github.com/OCA/l10n-spain/blob/16.0/l10n_es_aeat_mod111/data/aeat_export_mod111_data.xml#L720 [SEP] Emilio, prueba a quitar eso a ver si funciona. Se que por ejemplo en Navarra es al revés: que algunos modelos, sin LF+CR, no funcionan. [SEP] > Sucede lo mismo para versión 16.0.
> 
> La presentación de pagos por lotes es un servicio que permite enviar declaraciones correspondientes al mismo modelo, ejercicio y perodo de forma conjunta y automática: https://sede.agenciatributaria.gob.es/Sede/ayuda/manuales-videos-folletos/videos/presentacion-declaraciones-lotes.html
> 
> Lo curioso es que si subes los mismos archivos por separado AEAT se lo traga, pero por lotes da el error:
> 
> > CTROLEOF - No se deben presentar declaraciones con carácter de fin de línea o de carro
> 
> No hay ninguna especificación técnica, ni nada en el diseño de registro del modelo 111 que indique que se tiene que generar de manera diferente el archivo de exportación.
> 
> De todas formas por el error que da, tiene pinta que el error está aquí https://github.com/OCA/l10n-spain/blob/16.0/l10n_es_aeat_mod111/data/aeat_export_mod111_data.xml#L720


------
Hola buenos días. 
Comentaros que cuando vas a validad el 303 al importar el archivo también da error. Os lo pongo por si sirve de ayuda. 
Vosotros sabéis más ahora mismo de las especificaciones. 

![Image](https://github.com/user-attachments/assets/5cfebef9-c107-4d94-a133-982907dc2a61)

y este son los errores del archivo que se ha subido

![Image](https://github.com/user-attachments/assets/68ca0238-28a8-4916-bdc3-caafa309eeb2)

el archivo es la exportacion que realiza Odoo en el modelo 303 vuestro [SEP] There hasn't been any activity on this issue in the past 6 months, so it has been marked as stale and it will be closed automatically if no further activity occurs in the next 30 days.
If you want this issue to never become stale, please ask a PSC member to apply the ""no stale"" label."
Issue,3886,Modelo 349 - número de operadores erróneo,"El modelo me muestra 111 operadores, cuando tengo 38.


## Module

l10n_es_aeat_mod349

## Describe the bug
![imagen](https://github.com/user-attachments/assets/fc13ed78-fafb-4ed2-87dd-ceb69e2e7997)

Esos 111 en este caso parecen corresponden al número de OPERACIONES, no de operadores.

## To Reproduce
Versión 17","Hola, esa captura que enseñas no corresponde al módulo de OCA. Debe ser de los informes enterprise, y por tanto, tendrías que reportarlo a Odoo S. A., no aquí, o empezar a utilizar el 349 de OCA. [SEP] Hola. Simplemente comentar que hemos cambiado de los módulos de enterprise a los de la OCA, gracias a tu respuesta.

Este error y otro comentado sobre la inclusión de operadores intracomunitarios en el modelo, que no lo eran, funcionan perfectamente aquí.

Saludos."
Issue,3881,"[16] l10n_es_sii_oca: Impuesto ganadería y pesca (10,5%)","Tenemos un cliente en el régimen de agricultura. Los impuestos de agricultura están correctamente añadidos al SII. Hemos detectado que el de ganadería y pesca no parece estar añadido de la misma manera. 
¿Alguna opinión al respecto?

**Módulo**
l10n_es_sii_oca

**Descripción del problema**
Me preguntaba si el siguiente impuesto debe estar mapeado con el sistema de Suministro Inmediato de Información (SII) en el módulo l10n_es_sii_oca:

10,5% IVA Soportado régimen ganadero o pesca (l10n_es.3_account_tax_template_p_iva105_gan)

Estos impuestos están configurados en el sistema pero no se están transmitiendo correctamente al SII, lo que genera inconsistencias en las declaraciones fiscales para operaciones realizadas bajo el Régimen Especial de la Agricultura, Ganadería y Pesca (REAGP).


**Pasos para reproducirlo**
Versiones afectadas: Odoo 16

**Pasos para reproducir el problema:**

1.Configurar los impuestos:

10,5% IVA Soportado régimen ganadero o pesca

2. Crear una factura de compra utilizando cualquiera de estos impuestos.
3. Generar el envío al SII desde el módulo l10n_es_sii_oca.
4. Verificar los datos enviados al SII en el XML y comprobar que los impuestos no se mapean correctamente ya que la cuota de IVA deducible se mantiene siempre a 0.0

**Comportamiento esperado**
Que el impuestos este correctamente mapeado y reportarse adecuadamente en el SII de acuerdo con las normativas de la Agencia Tributaria para el REAGP.

Comportamiento observado
El Impuesto no se mapean correctamente en los envíos al SII, generando errores o datos incompletos en las declaraciones.

![image](https://github.com/user-attachments/assets/107dab79-9d87-4812-ac5a-4c51d0e5b1f1)


@moduon MT-8089",
Issue,3876,[17] dependencias de cryptography==3.4.8,"Instalando odoo en una instalación nueva con:
Description:    Ubuntu 24.04.1 LTS
Python 3.12.3

Encuentro problemas con las versiones de cryptography, 
los paquetes l10n_es_facturae_face y l10n_es_facturae tienen en los __manifest__.py dependencias cryptography==3.4.8 que me crean problemas con mi sistema que tiene 44.0.0

el fichero requirements.txt tambien contiene:
cryptography
cryptography==3.4.8

he instalado quitando el requisito de version de todas partes, pero no se si creará problemas.

en #3551 parece decir que este requisito no está en las versiones 15 y 17, pero al menos en estos dos paquetes yo la he encontrado.

No alcanzo a ver si el cambio que he hecho puede romper el funcionamiento.
","Hola, comente sobre este problema directamente en el pr que hizo el cambio: https://github.com/OCA/l10n-spain/pull/3936#issuecomment-2624046335

un saludo. [SEP] Liberada versión en #3936 "
Issue,3872,[17.0] l10n_es_partner: Factura con contacto de nombre comercial pierde dirección,"Cuando se crea una factura y se asigna un contacto que tiene nombre comercial, se quita automáticamente la dirección de la compañía y esta información tampoco se sale en el impreso. En anteriores versiones a la V16 esto no pasa.

Ejemplo V16:

![image](https://github.com/user-attachments/assets/ef8e8bd2-0eda-4b28-9ac3-92f1dcfc9660)
![image](https://github.com/user-attachments/assets/dc4b59aa-3552-48c8-995c-f838df2e871f)
![image](https://github.com/user-attachments/assets/a25cca96-8b65-4bcc-bed8-2757468a5394)

Ejemplo v17:

![image](https://github.com/user-attachments/assets/a4d3f3bd-16d0-41ac-94fc-6267d939595f)
![image](https://github.com/user-attachments/assets/11554c97-61fb-4820-b5e2-a2960957ddf8)
![image](https://github.com/user-attachments/assets/4c3b7596-87c2-45a0-a1b1-0b65eaf87013)


","@pedrobaeza  [SEP] Duplicado de #3636 

Por favor no es necesario que me hagas ping. Recibo igual las notificaciones."
Issue,3868,[v14][l10n_es_ticketbai_pos ] Cannot validate for a simplified invoice without client ,"<!-- Una vez a activado el módulo no es posible validar una venta sin seleccionar cliente para un ticket o factura simplificada, el botón no hace nada-->

## Module
l10n_es_ticketbai_pos

## Describe the bug
Odoo con POS funcionando y creando facturas simplificadas sin problema sin necesidad de seleccionar cliente o con un ""cliente contando"" sin nif. 
Una vez configurado ticketbai y activado el módulo de ticketbai para el POS, no es posible validar (el botón no hace nada) una simple venta sin cliente, y si selecciono un cliente genérico (""cliente contado""), entonces solicita que tenga país y nif. Si creamos factura completa con cliente que tenga todos sus datos, se crea correctamente con el QR de ticketbai correcto. 

## To Reproduce
**Affected versions**: v14, v15

Steps to reproduce the behavior:
1. Instalación básica con pos configurado para generar facturas simplificadas sin cliente 
2. Instalar y configurar módulos de ticketbai 
3. Activar módulo de ticketbai para pos y entonces el botón de validar no hace nada sin seleccionar un cliente o seleccionando un cliente pero para generar factura simplificada (sin marcar el botón de factura) 

**Expected behavior**
Deberia generar un ticket o factura simplificada con ticketbai al clicar sobre el botón de validar sin cliente ocon cliente pero sin marcar el botón de factura completa. 

**Additional context**
Add any other context about the problem here. (e.g. OS, Python version, ...)","Hola de nuevo,
he vuelto a probar en una instalación limpia de v14 y sucede lo mismo, el botón de Validar se pone en verde una vez que añades el pago pero al clicar simplemente no hace nada.
He probado en Odoo18 que soporta nativamente TicketBai y el pos adaptado para ticketbai funciona según lo esperado, al clicar el botóin Validar sin especificar cliente alguno se genera la factura simplificada con el tbai y qrcode.
A ver si alguien nos puede aclarar qué estamos haciendo mal.
Gracias! [SEP] Una vez probado también con v12 se obtiene el mismo comportamiento.

Con las herramientas de desarrollador activadas en el navegador se obtiene un error del tipo
TypeError: Cannot read properties of undefined (reading 'importKey') --> en v12
o del tipo
TypeError: na.subtle --> en v14

Buscando información por diferentes posts parece que las librerias utilizadas (Crypto, requests_pkcs12,.) requieren un entorno de acceso seguro, es decir, hay que acceder por https.

Una vez configurado un reverse proxy con https, los errores una desaparecido y el botón de Validar ya funciona correctamente generando una factura simplificada cuando no se selecciona cliente con el tbai y qrcode.

Quizás a alguien más le pase y este post le sea de utilidad.

Gracias!"
Issue,3864,[17.0] l10n_es_igic Revisión de migración,"Durante la migración del módulo l10n_es_atc_mod415 he detectado que los ids externos de los impuestos no coincidían con los originales y esto hizo saltar mis alarmas.
He revisado el módulo l10n_es_igic y pareceriera que nunca se llegó a revisar los archivos. En la versión 17 este módulo recrea prácticamente toda la contabilidad española. Renombra muchos de los ids externos (con las implicaciones que esto tiene a la hora de migrar, tanto los módulos dependientes, como un odoo en sí). 

Ya estoy trabajando en corregirlo, pero dejo esta issue para intentar advertir a las personas que pretendan utilizar este módulo en la versión 17 que esperen un poco hasta que aplique los cambios necesarios.","Sí, confirmo que no es correcto como está ahora mismo. [SEP] @Christian-RB Necesitas ayuda con la parte de los scripts de migración?

Al final habrá dos currazos:
1- Simplificar el código
2- Aplicar scripts para arreglar los datos de la gente que lo tienen mal por culpa de esto. [SEP] Buenas @etobella Ahora mismo estoy con el punto 1 casi terminando. 
Sería de gran ayuda si alguien crea los scripts para el remapeo de los xml_ids.
Si necesitan alguna referencia estoy reutilizando los mismos que en 16.0. [SEP] cuando esté todo lo reviso y os doy una ayuda con eso [SEP] Cambios necesarios realizados"
Issue,3862,[17] Modelo 349,"Al generar el 349, Odoo incluye todas las operaciones de venta de mercancía que se han realizado con cualquier cliente de otro país europeo, sean operadores intracomunitarios (no pagan IVA) o no (pagan IVA).

He consultado con dos asesores fiscales, y ambos coinciden en que en este modelo solo deben declararse los clientes de otro país europeo que figuran en el registro de operadores intracomunitarios (ROI), los que no pagan IVA.

En las instrucciones de la AEAT figura:

> Quedarán excluidas las siguientes entregas de bienes:
> .....
> b) Las realizadas por sujetos pasivos del Impuesto para destinatarios que no tengan
> atribuido un número de identificación a efectos del citado tributo en cualquier otro
> Estado miembro de la Comunidad.

Me explican que esto quiere decir que los que no tengan NIF europeo, que no figuran en el registro.

La impresión es que al crear el 349 se considera sólo el país de origen y destino de la factura, y no la posición fiscal. A efectos de la AEAT, los operadores intracomunitarios son ""Regimen intracomunitario"" y los que no lo son, serían ""Regimen nacional"", y sólo deberían ir al 349 los de ""Régimen intracomunitario"".

El 303 sale correcto.

## Module
l10n_es_aeat_mod349


## To Reproduce
**Affected versions**: 17.0

Steps to reproduce the behavior:

Crear dos clientes de Portugal, por ejemplo, uno con posición fiscal en R. Intracomunitario, y el otro con R. nacional. 

Hacer factura para ambos. En el caso del intracomunitario el IVA tiene que ser 0 (en mi instalación es 0% G Exent), y el de R. nacional IVA que corresponda al producto, por ejemplo 21% G.

Hacer el 349. Contempla ambas facturas y los dos clientes. 

**Expected behavior**
Sólo debería salir el/los operador(es)  intracomunitario(s) y su(s) factura(s).

Desde mi desconocimiento de la Ley y guiándome por los asesores.","Hola, la clave del 349 se calcula en base a los impuestos, no a la posición fiscal:

https://github.com/OCA/l10n-spain/blob/0e62d8ab8ceb93c4acf441b2b83fdf60a90cebfb/l10n_es_aeat_mod349/models/account_move.py#L47-L59

por lo que el comportamiento que describes no es lo que ocurre. Revisa que cada factura tiene los impuestos adecuados.

Cierro al no ser correcta la aseveración y no existir ese error. [SEP] Hola. Entonces, al incluir o no según el impuesto, ¿tiene alguna lógica que incluya el ""21% G"" en el 349?  En el caso de otros clientes que no son particulares en estados miembros, pero no figuran en el registro de operadores intracomunitarios, se debe incluir el IVA en la factura y ellos tienen que deducirlo/reclamarlo porque están exentos. Sin embargo, no pueden figurar en el 349 porque no están en el registro de operadores. 

No veo ningún IVA 21% específico para Ventas intracomunitarias que pudiera ser excluido del 349, junto con el cliente. 

¿Qué estoy haciendo mal? [SEP] Es que cualquier impuesto que no sean los intracomunitarios se excluyen por defecto del 349, sin hacer nada. Aquí están los únicos impuestos que se incluyen (los códigos son los XML-IDs):

https://github.com/OCA/l10n-spain/blob/0e62d8ab8ceb93c4acf441b2b83fdf60a90cebfb/l10n_es_aeat_mod349/data/aeat.349.map.line.csv"
Issue,3861,[16.0][FIX] l10n_es_aeat_mod303: Error generación asiento contable cuando sale a pagar pero se compensa parcialmente con ejercicios anteriores,"Cuando en un informe 303 sale una cantidad determinada a pagar pero puedes compensar una parte (470xxx) e ingresar otra (475xxx), no lo contabiliza correctamente en sus cuentas contables sino que lo lleva todo a la 475xxx

El informe si lo hace bien, lo que no crea bien es el asiento contable

## Module
l10n_es_aeat_mod303

## Describe the bug
En el siguiente video lo explica perfectamente mi compañera @ArantxaSudon
https://www.loom.com/share/ff5fe31c7da347768d992cef1436a15a?sid=7d2365a0-f139-4605-b11e-98b019ebd3ef

## To Reproduce
**Affected versions**: 16.0

Steps to reproduce the behavior:
Ver el [video](https://www.loom.com/share/ff5fe31c7da347768d992cef1436a15a?sid=7d2365a0-f139-4605-b11e-98b019ebd3ef) para saber los pasos a reproducir.

**Expected behavior**
Ver el final del vídeo [video](https://www.loom.com/share/ff5fe31c7da347768d992cef1436a15a?highlightComment=65850042&t=248) para ver el comportamiento experado.

@loida-vm @rafaelbn @pedrobaeza 
","Hasta donde sé, el asiento de regularización no tiene que ver con lo que compensas o no. Es el resultado de tu ejercicio. Luego, se tendrá que hacer un asiento extra que mueva parte de los saldos entre la 470 y la 4751 según esa operación. Hacerlo todo en un mismo asiento, no sé si sería lo correcto. La información podría estar según las casillas, desde luego.

@AlbertCabedo es correcto hacerlo todo de un golpe? [SEP] Hola @pedrobaeza 

No sé a que te refieres con lo del asiento de regularización exactamente

El problema que presenta aquí @EmilioPascual es que cuando te sale un trimestre a pagar IVA pero tenemos una cantidad a compensar que utilizamos para pagar menos a Hacienda, esa cantidad, contablemente, tiene que quitarla de la cuenta 470xxx porque si no es así, esa cuenta quedará descuadrada

El modelo 303 lo hace bien trasladando esa cantidad a la casilla 110 pero no genera bien el asiento porque no la descuenta de la cuenta 470xxx

Si veis en el video, cuando solo compensamos lo resta de esa cuenta pero cuando compensamos una parte y pagamos otra, lleva el total a la cuenta 475xxx, cuando debe llevar cada parte a su cuenta correspondiente

Resumen contable del vídeo

![Captura desde 2024-12-19 12-38-27](https://github.com/user-attachments/assets/044bd1a1-5ce7-46e3-b0b6-3efd37561efb)

@rafaelbn @loida-vm @pedrobaeza @AlbertCabedo 

 [SEP] El asiento de regularización es el asiento que genera la declaración, y como digo, ese asiento es el movimiento de la 472/477 a la cuenta que toque (4751 o 4700). El que además se compense es lo que digo que no tengo claro que tenga que ir en el mismo asiento o deba ser uno separado. [SEP] @pedrobaeza mi duda sobre el asiento de regularización del IVA era porque no se van a poder utilizar las cuentas **4750** y **4700** en el mismo asiento, de hecho, eso es lo que contablemente refleja la situación real de lo que estamos declarando en el 303

Si nosotros en la declaración del 303 ponemos en la casilla 78 alguna cantidad porque decidimos compensar y esta no queda reflejada en el asiento, entonces el asiento es incorrecto porque me está poniendo lo mismo que si no declarase nada en esa casilla

Lo que está ocurriendo ahora mismo es que hace el mismo asiento, rellenes o no la casilla 78 y no debería ser así

Dejo un vídeo en el que se ve que hace lo mismo en los dos casos:

https://www.loom.com/share/2ec2f8d5962042269c8d183ed1903b73?sid=2c19b53c-14ec-4217-a85b-0aba9133bb5d

@rafaelbn @EmilioPascual @loida-vm 

@AlbertCabedo  [SEP] A ver si @AlbertCabedo o @acysos confirman al respecto. [SEP] He realizado el siguiente PR https://github.com/OCA/l10n-spain/pull/3874 para resolver esta casuistica [SEP] Cierro estando #3874 ya fusionado."
Issue,3858,Fecha de Operación en el SII,"En la información al SII no se está informando de la **_Fecha de Operación_** asumiendo que sólo es necesaria si es diferente que la **_Fecha de expedición_**.

**Nueva característica propuesta**
Que ese campo aparezca en la factura y que se informe al SII. 
**¿Por qué proponemos esto?**
Trabajamos con productos de alimentación, los impuestos están variando mucho y ocurre que en el momento del pedido, de la entrega y de la factura se pueden dar conflictos con el impuesto aplicado.
","Hola @EnekoAira 

Nos ha pasado lo mismo con esto de los impuestos de alimentos y los errores del SII...
El problema de habilitar la ""Fecha de operación"", es que la misma determina la deducibilidad de las cuotas de IVA. Y si esa fecha difiere respecto a la ""Fecha contable"" de la factura, habrá una incongruencia respecto a los periodos en los que se liquidan esas facturas dentro de los modelos legales de Odoo:

- 303
- 349
- LIVA
- otros...

Es decir, también implica hacer un desarrollo extra en todos modelos legales para que priorice incluir en las declaraciones las facturas conforme a ""fecha operación"" (siempre que esté establecida), por encima de ""fecha contable"".

Saludos,
 [SEP] Tratándose de operaciones entre empresas la mayoría de veces, en los que les da igual el IVA, ya que son meros intermediarios, la solución más eficaz es cambiar los impuestos a los que toque en la fecha de factura, sin más complicación. [SEP] @SoniaViciana Gracias por la respuesta.

No he tenido en cuenta todos esos modelos, supongo que deberíamos consultar la forma de afrontarlo a la propia AEAT. 
Tengo mi opinión pero no está respaldada. 

No obstante, si así fuere, habría que cambiarlos también. Que la pereza no nos lleve a no hacer bien las cosas :-)
 [SEP] @EnekoAira no es pereza, si no practicidad. Además, ¿tienes pensado tú hacer esas mejoras? [SEP] > Tratándose de operaciones entre empresas la mayoría de veces, en los que les da igual el IVA, ya que son meros intermediarios, la solución más eficaz es cambiar los impuestos a los que toque en la fecha de factura, sin más complicación.

No soy quién para contestar a esto. Yo no lo haría, otros ERPs no lo hacen [SEP] Eso de siempre aludir a que ""otros ERPs"" tal, bueno, pues vete con el otro ERP...

Una cosa está clara: un sistema en el que la fecha contable del asiento de la 472 o 477 no coincide con la fecha efectiva de impuestos es un NO muy grande por muchas razones que ahora mismo no voy a desglosar, ya que de todas formas es algo que no se va a hacer en Odoo nunca, primero porque el propio Odoo no lo permite ni lo va a permitir (ya quitó hace muchos años, a partir de la v9, eso de forzar periodo y fecha del asiento, que permitía hacer más o menos estas cosas), y segundo porque la localización se complicaría de forma inimaginable para un caso tan marginal.

Cierro esta issue como algo que no se realizará. [SEP] @SoniaViciana, en realidad creo que la fecha por la que se deben generar los modelos es la fecha de devengo, no la fecha de operación.

Es imposible que sea la fecha de operación la marque el período de devengo, dado que si así fuese sería imposible cumplir lo que indican en las preguntas frecuentes de la AEAT sobre como se debe de cubrir el tipo de operación en el caso de rectificativas, por ejemplo. (https://sede.agenciatributaria.gob.es/Sede/impuestos-tasas/iva/iva-libros-registro-iva-traves-aeat/preguntas-frecuentes/2-registro-cuestiones-comunes.html?faqId=910f6c3d02bc9510VgnVCM100000dc381e0aRCRD)

En las últimas versiones del SII están validando precisamente que el impuesto reportado esté vigente a ""fecha de operación"" de la factura informada; con lo cual queda claro que para la AEAT la fecha que debe tomarse a la hora de decidir el tributo a aplicar es la fecha de operación (no la fecha de factura, ni la fecha contable, ni la fecha de devengo, ni cualquiera otra fecha que queramos aplicar).

Vuelvo sobre el ejemplo de las rectificativas. Si en un período P (IVA al 4%) tengo que rectificar una factura del período P-1 (con un IVA 2%), no puedo simplemente cambiar el IVA de la nueva factura rectificativa al 4%, porque entonces mis bases y cuotas no son correctas, ya que he pagado por 2 y rectifico por 4, causando un perjuicio a la hacienda pública; lo cual no les gusta nada y nos pone en el foco de una posible inspección.


PS: Es mi primer aporte a la comunidad de Odoo y me he quedado muy ingratamente sorprendido por la reacción tajante , desmesurada y agresiva. @SoniaViciana si quieres que continuemos esta reflexión conjuntamente puedes escribirme directamente. [SEP] Una tirita se arranca mejor de un golpe que poco a poco.

Lo que comentas de las rectificativas es otra cuestión aparte. A mí hasta ahora no me han rechazado en el SII una rectificativa hecha con fecha de estos meses (desde octubre) con impuesto del 4%, porque precisamente tienen en cuenta estas cuestiones, y poner fecha de operación de antes de octubre lo considero incorrecto, porque el devengo de la rectificación es ahora, no cuando se hizo la operación rectificada. [SEP] Estaré yo confundido, pero insisto en que ""fecha de operación"" y ""período de devengo"" no están relacionados.

Sobre la rectificativa, la AEAT es clara (por raro que parezca :D): https://sede.agenciatributaria.gob.es/Sede/impuestos-tasas/iva/iva-libros-registro-iva-traves-aeat/preguntas-frecuentes/2-registro-cuestiones-comunes.html?faqId=d6ce6c3d02bc9510VgnVCM100000dc381e0aRCRD

PS: Con un poco de agua tibia también salen muy bien las tiritas. [SEP] Gracias por el enlace, Raúl. En el módulo SII, no estamos indicando fecha de operación en ningún caso, sea rectificativa o normal, y Hacienda no lo está rechazando, aunque no conocía que la AEAT indique que deba ser la fecha de operación de la rectificada.

De todas formas:

- El SII no rechaza rectificativas con el 4% en las fechas actuales.
- El SII no obliga a poner fecha de operación. Rellenando ""Fecha expedición"" y ""Periodo de liquidación"" es suficiente.
- No tengo constancia de notificaciones o inspecciones que indiquen lo contrario.

Por el momento, no veo que haya que hacer nada al respecto para las rectificativas, y empezar a enviar esa fecha generaría muchos flecos, como por ejemplo cuando se hace una rectificativa (como un rappel), sin una factura de origen exacta. Se podría barajar enviar la fecha de operación de la rectificativa cuando el origen está claro. Eso a ver qué les parece a otra gente. Reabro para dar lugar a ese debate, aunque esto sea un tema lateral.

De cara a la fecha de operación en general, el objetivo aquí es automatizar lo máximo posible el envío y evitar errores, por lo que tener un campo ""Fecha de operación"" manipulable no está entre las características deseables por el momento, salvo que se encuentre alguna causa insalvable, pero si alguien quiere hacerlo, gracias a la capacidad modular de Odoo, se puede hacer como un módulo de extensión. [SEP] Ah, y otra cosa que veo según la nueva información: la fecha de operación no debe marcar el periodo de liquidación de los impuestos, ya que si no, las rectificativas irían en declaraciones anteriores y no en la que toca. Parece que ese dato es totalmente caprichoso. [SEP] En nuestro caso, en alguna empresa del grupo, que no es la que usa Odoo si hemos tenido problemas de envío al SII por enviar una factura rectificativa con fecha de noviembre, que rectificaba a una de septiembre, y llevaba entre los IVAs una parte de IVA al 5%.

Dado que ese IVA no es válido en octubre, el SII la rechazó, y tuvimos que modificarla indicando que la fecha de operación era septiembre para que la aceptase.

En resumen, la fecha de operación es la que marca los tributos a aplicar, y la fecha de devengo es la que marca el período en el que se debe incluir en los modelos (al menos de IVA, si metemos el IRPF por el medio ya nos salen más lios...).

PD: Soy Rubén ;D [SEP] La propuesta de añadir un nuevo campo de ""fecha de operación"", sin valor por defecto, pero que si está cubierto se informe al SII va precisamente en la línea de que luego, cada empresa según sus necesidades decida como dar valor a este campo:
- Manualmente por los usuarios
- En base a la fecha de los albaranes
- En base a la fecha de pedidos
- ...

Todo eso sería una cuestión a personalizar en los módulos de cada empresa, según sus necesidades y decisiones.
Así mismo, quien no necesite/quiera hacer nada al respecto simplemente con no alimentar ese campo el comportamiento de su sistema seguirá igual que ahora.

Es por ello que, dado que el concepto de ""fecha de operación"" es un concepto que define el SII debe de estar contemplado en este módulo el que se envíe. Y como es, cuando menos, controvertido; de ahí que la propuesta sea crear un campo que cada empresa decida como alimentar (o no) según su caso de uso. [SEP] Perdona, Rubén, como el login aparece rmosquera, se me ha ido el nombre. Es raro, acabo de comprobar ahora mismo justo ese caso, y tengo facturas aceptadas por el SII en octubre con IVA 4 %.

Si la fecha de operación se considera solo a esos efectos, creo que puede añadirse que se envíe - sin intervención del usuario - en las rectificativas cuando se tiene claro el origen.

Lo de poner ese campo de forma general, no, porque eso repercutiría en la gente tocando sin saber, y teniendo tickets de asistencia por esos temas. Lo dicho, eso es fácil ponerlo en un módulo extra, e incluso se podría plantear tener ese módulo extra aquí, pero desde luego de base, es muy peligroso. [SEP] Al 4% claro que lo van a aceptar, porque es un tipo válido en cualquier mes.

El caso es con los IVA que la AEAT si puede validar porque solo han estado activos durante un tiempo, como el 5% o el 2%.

Entiendo, aunque no comparto, el temor de un mal uso de ese campo... Si está oculto, solo lo activará quien necesite usarlo y debemos confiar en que sepa como usarlo.

No podemos limitar el caso a las rectificativas, lo uso como ejemplo porque es el más claro y el más explícito; pero cualquier caso en el que facturemos operaciones de un mes en otro, y en ese salto de mes haya un cambio de IVA pueden provocar este problema.

La solución que planteas para estos casos en https://github.com/OCA/l10n-spain/issues/3858#issuecomment-2551519653, de decirle al departamento de administración, que haga mal las facturas, a sabiendas; no me parece apropiado.
Y además, no resuelve el caso de las compras, en las que el proveedor simplemente podría negarse a hacer esto.
Y seguramente también nos daría problemas con los casos de autónomos en Régimen Especial Agrario, que no liquidan IVA y por tanto, los estaríamos perjudicando si les facturamos con un tipo de IVA más alto. [SEP] Y otra cosa para @SoniaViciana entonces: con eso no habría que tocar nada de los otros módulos. Simplemente, habría IVA 4% en por ejemplo octubre, pero ya está.

Yo de todas formas, estoy dudando bastante que Hacienda permita hacer facturas de cliente del 4% por ejemplo a finales de octubre, por mucho que le digas que la fecha de operación es de septiembre porque la mercancía se envió entonces... [SEP] > No podemos limitar el caso a las rectificativas, lo uso como ejemplo porque es el más claro y el más explícito; pero cualquier caso en el que facturemos operaciones de un mes en otro, y en ese salto de mes haya un cambio de IVA pueden provocar este problema

No lo limito, solo digo que en este caso es automatizable y sin efectos laterales: se envía si se sabe la factura origen. Se sigue como hasta ahora si no se sabe (como el de una factura de rappel).

> La solución que planteas para estos casos en https://github.com/OCA/l10n-spain/issues/3858#issuecomment-2551519653, de decirle al departamento de administración, que haga mal las facturas, a sabiendas; no me parece apropiado.

No es hacerlo mal. Al contrario, es hacerlo bien, porque la tributación siempre se aplica a las facturas. Los albaranes no llevan fiscalidad. Lo otro se admite por dar ""cuartelillo"". Pero fíjate que tendrías el mismo problema (por lo menos en Odoo, pero también en otros ERPs), si hiciste un presupuesto hace un año, con los impuestos anteriores, y lo confirmas, envías y facturas ahora. Tendrás que cambiar igualmente los impuestos a los que tocan ahora. No vale poner fecha de operación de hace un año porque era cuando emitiste el presupuesto.

> Y además, no resuelve el caso de las compras, en las que el proveedor simplemente podría negarse a hacer esto.
> Y seguramente también nos daría problemas con los casos de autónomos en Régimen Especial Agrario, que no liquidan IVA y por tanto, los estaríamos perjudicando si les facturamos con un tipo de IVA más alto.

Como digo, hasta ahora no tengo constancia de ningún rechazo de este tipo. y el régimen agrario no está contemplado en el desarrollo actual. Pero bueno, volvemos a lo mismo: que la fecha de operación se puede implementar en un módulo aparte. Si es lo bueno que tiene la modularidad. [SEP] Efectivamente no deberías facturarlo a finales de octubre; pero no porque no lo admita el SII, que creo que si lo aceptará (sería cuestión de testarlo en el entorno de pruebas).

El problema ahí sería que incumplirías los plazos de la ley: https://sede.agenciatributaria.gob.es/Sede/ayuda/manuales-videos-folletos/manuales-practicos/manual-iva-2021/capitulo-10-obligac-formales-suj-registro/obligaciones-materia-facturacion/plazos-expedicion-envio-facturas.html

Pero hasta el 16 si podrías:
`Antes del día 16 del mes siguiente a aquél en que se haya producido el devengo del impuesto correspondiente a la citada operación` [SEP] El caso del presupuesto y del albarán no son comparables. Hacienda es clara con que la fecha que marca la fiscalidad es la de ""la entrega de la mercancía o de la prestación del servicio""; ni presupuesto, ni pedido, ni factura.

De hecho, es esa fecha ""de entrega de la mercancía o prestación del servicio"", la que te marca el plazo para poder emitir la factura, como indico en el comentario anterior.

Por nuestra parte veo necesario este desarrollo, y no sé si lo plantearemos como un módulo específico, o como un fork (con su PR) a la rama 12.0 de este repo (que es la versión en la que aún trabajamos).
Seguramente optemos por lo que técnicamente nos resulte más sencillo. Si creamos un módulo nuevo no creo que podamos asumir el adaptarlo a las normas de OCA, que es algo en lo que no tenemos experiencia, y somos una empresa usuaria final de Odoo, no una implantadora. [SEP] Nos tocó trabajar con esto hace poco para un caso muy puntual relacionado con las cuotas de alimentos:

![image](https://github.com/user-attachments/assets/a1d411f3-173f-4ed9-a431-79ba37992c76)

Y podemos asegurar que en el PRE-303 esa factura se deduce a 10/2024 y no en 11/2024. No he encontrado mucha info en la AEAT, pero sí en los blocs de otros ERP:

https://soporte.sage.es/plus/2017/09/gestion-de-fechas-de-facturas-expedidas-para-el-sii-en-contaplus-flex/

https://a3responde.wolterskluwer.es/documentos/erp/fecha-contable-y-fecha-de-operacion-en-facturas-de-venta.html [SEP] Pues entonces volvemos al supuesto inicial que teníamos tanto Sonia como yo, que es que sí que marca la fecha de operación lo que es la fecha a efectos fiscales, y eso supone esa triple fecha que es una línea roja.

Pero entonces es inconsistente con ese otro enlace que dice que en las rectificativas la fecha de operación debe ser la de la factura origen.

¿Tal vez la fecha de operación la utiliza Hacienda de forma diferente según el tipo de factura? [SEP] En mi opinión, y aquí entro en el terreno de lo que intuyo pero no puedo asegurar; lo que marca en que modelo debe ir no es ninguna de las fechas, si no el ""período"" que se indique. Y apoyo mis suposiciones en que:
- Los modelos siempre hacen referencia a un período, que puede ser mensual, trimestral o anual. En el caso de las empresas en SII, mensual y anual. Y esos son los campos que efectivamente tiene el registro de ""Periodo"" en el SII.
- En otra empresa del grupo que no usa Odoo estamos reportando las facturas de compra del mes pasado, que registramos antes del 16 del mes en curso, con período de devengo del mes de la factura, para devengarlas lo antes posible. Llevamos haciendo esto sin problema durante años. Las contabilizadas después del 16 van el el modelo correspondiente al periodo en el que se contabilizan.
- Existe también en el SII una opción de indicar que el IVA de una factura se devengará en un período posterior a aquel en el que se reporta (que se debe usar en casos de proveedores en ""criterio de caja"".

El caso que expone @SoniaViciana no concuerda con lo que yo entiendo, ya que si en esa factura indican:
![image](https://github.com/user-attachments/assets/fb32a033-fd84-480b-8ba5-8bdceb4415c0)

Debería ir en el modelo del 11-2024.

Entiendo que puede parecer un argumento peregrino pero... ¿es posible que ese premodelo no sea correcto? En nuestro grupo de empresas no usamos esos premodelos generados por la AEAT, por lo que no puedo juzgarlo.

Sobre la documentación de otros ERPs... pues es la información de los casos más generales, y tiene la validez que le demos en base a la credibilidad de la empresa (y de su celo por mantener actualizada la documentación pública). Y dicho esto, la veo correcta; pero para el caso general y más común, y en el que la información se registra en plazo en el ERP.
 [SEP] Ya, pero sin esa confirmación de qué supone la fecha de operación en ese caso, la verdad es que es arriesgado aventurarse a poner un dato. [SEP] No sé si desde la OCA tenéis algún canal de comunicación con la AEAT para poder plantear esa consulta a nivel técnico, de la correlación entre los datos enviados al SII y los modelos.

En el ERP de la empresa que no usa Odoo los tributos tienen el concepto de ""fecha de devengo"" y ese es el campo que se usa para los modelos y con el que calcula el ""PeriodoLiquidacion"" para el SII. Lo hacemos así desde hace tiempo sin problemas.

Entiendo que sin una respuesta que se pueda considerar de una autoridad no se incorporen cambios en esa línea al módulo de la OCA.

Nosotros trataremos de hacer nuestro aporte con lo que a nosotros nos sirva. [SEP] @acysos puedes lanzar consulta vinculante sobre este tema?

En cuanto a lo de la fecha de devengo separada de la fecha contable, es la línea roja que siempre os he comentado. No puede ser que se saque un sumas y saldos de una 472/477 y dé un resultado, y en cambio en el 303 se declare otro distinto porque las fechas de devengo son algo diferente. [SEP] Legalmente si puede ocurrir esa diferencia, y que los datos sean correctos. Pero en cualquier caso concuerdo que es algo que si se puede evitar es mucho más práctico, y solo lo ponía como ejemplo y argumento de como creo que funciona el sistema por parte de la AEAT. No propongo que se incorpore un cambio de este tipo, que bastante tenemos con el debate sobre la ""fecha de operación"" :D [SEP] ¡Gracias @EnekoAira ! ¡Bonito caso!

Esta es mi propuesta: https://github.com/OCA/account-invoicing/issues/1962

Me hice una chuletilla de un ejemplo de factura de proveedor, que hay hasta 4 años para contabilizar y para la misma factura son 5 fechas diferentes.

![Image](https://github.com/user-attachments/assets/a2c508ce-5437-4fb5-8b12-ea37ffed6c44)

❤ ❤ 

@moduon [SEP] Desde mi punto de visto sería muy conveniente que apareciera un nuevo campo de ""fecha de operación"", sin valor por defecto, pero que si está cubierto se informe al SII puesto que la fecha en la que quiero imputar mi gasto puede ser distinta a la fecha contable, ya que hay hasta el día 16 de cada mes para poder devengarme en el periodo anterior 

El SII recoge esta casuistica y diferencia entre la fecha de registro contable (fecha en la que se registra la factura) y la Fecha de operación (fecha en la que imputo mi gasto), como vemos en la tabla de @rafaelbn 

Tenemos que tener mucho cuidado con la nomenclatura ya que lo que: 

- en la AEAT llaman **Fecha de operación**, en Odoo es la **fecha contable**
- en la AEAT llaman **Fecha de registro contable**, es la fecha en la que registro la factura en el programa y la valido y esa fecha la tiene en cuenta la AEAT para los plazos del SII

Esto solo se da en la facturas de proveedor ya que en las de cliente esas dos fechas tienen que ser iguales

Estoy de acuerdo con todo lo que ha ido exponiendo @rmosquera-aira

A ver si @acysos hace la consulta vinculante para ver si se puede desarrollar porque nosotros lo vemos necesario

https://github.com/moduon [SEP] > en la AEAT llaman Fecha de operación, en Odoo es la fecha contable

Esto no es del todo correcto, porque está el periodo de liquidación también en la información que se pasa a la AEAT, y el problema es que tengamos una desincronización entre la contabilidad de la 472/477 y la fiscalidad. Mientras eso no se aclare (y tengamos claro que la fecha de operación es solo para ""ver los impuestos válidos""), no se debe incorporar ese campo a nivel de usuario. [SEP] There hasn't been any activity on this issue in the past 6 months, so it has been marked as stale and it will be closed automatically if no further activity occurs in the next 30 days.
If you want this issue to never become stale, please ask a PSC member to apply the ""no stale"" label."
Issue,3856,[BUG][14][15][16] IVA al 2% no incluido correctamente en el Modelo 303 en facturas rectificativas,"Hola @OCA/local-spain-maintainers !

¿Qué opináis de hacer un PR resolviendo esto teniendo en cuenta que el impuesto ya no sigue vigente?


**Descripción del problema:**
Hemos detectado que el IVA del 2% no se está reflejando adecuadamente en el modelo 303 para las facturas rectificativas (abonos).

**Comportamiento esperado:**
El IVA al 2% en las facturas rectificativas debería incluirse correctamente en el modelo 303 según las instrucciones de la Agencia Tributaria. Esto implica actualizar las casillas relacionadas con la modificación de bases y cuotas, así como su reflejo en las casillas correspondientes a la base y a la cuota para la autoliquidación.

**Solución manual provisional aplicada:**
- Añadir la base y la cuota al 2% a las casillas 14 (modificación base compras y ventas) y 15 (modificación cuota compras y ventas).
- Añadir también la base a la casilla 165 y la cuota a la casilla 167.

Documentación oficial del modelo 303 (4T-2024):
https://sede.agenciatributaria.gob.es/Sede/todas-gestiones/impuestos-tasas/iva/modelo-303-iva-autoliquidacion_/instrucciones/instrucciones-4t-2024.html

Gracias por los comentarios
Saludos,
Rafa

@moduon MT-8422","Todo esto está ya hecho en 15.0 en adelante. Revisad PRs ya fusionados. Para 14.0, alguien debe hacer los backports."
Issue,3851,Informe de Balance de Sumas y Saldos de la Contabilidad en la version 11,"Buenas tardes,
Esta incidencia la llevo arrastrando durante 2024. Las cuentas 705000007, 631000005 y 631000006 no han tenido movimientos durante 2024 y al generar el informe de sumas y saldos, acotando fecha desde 01/01/2024 a 31/10/2024,

Las cuentas que indico siguen saliendo con saldo en el informe. Deberían estar a cero, puesto que no hay movimiento en 2024.

Gracias.
Un saludo.

 ","Hola.

Esta cuestión no tiene que ver con los módulos publicados en este repositorio. Publica por favor tu consulta en los foros de AEOdoo para que alguien te pueda orientar, que tiene pinta de configuración. 

Cierro por lo expuesto."
Issue,3842, Error Transacción Pasarela Redsys,"<!-- Provide a general summary of the issue in the Title above.
Before opening the issue, please check that there isn't another issue addressing the same problem already created -->

## Module
Redsys Payment Acquirer

## Describe the bug
Se produce un problema al sincronizar el pedido con la transacción generada en el siguiente caso:

## To Reproduce
**Affected versions**: Odoo 16.0

Pasos para reproducir el problema:
1. Inicias Pasarela de Pago.
2. Vuelves al carrito.
3. Vuelves a iniciar la Pasarela de Pago. El pago este llega al banco, pero el pedido en Odoo no queda confirmado ni pagado.

**Expected behavior**
Al crear iniciar la pasarela de pago dos veces se crean dos transacciones por separado ""transacción"" y ""transacción-1"". Está segunda ""transacción-1"" no está recibiendo un Ok por algún motivo y en ese caso el pedido no queda pagado ni confirmado.

**Additional context**
Al iniciar la pasarela una sola vez todo funciona correctamente.","There hasn't been any activity on this issue in the past 6 months, so it has been marked as stale and it will be closed automatically if no further activity occurs in the next 30 days.
If you want this issue to never become stale, please ask a PSC member to apply the ""no stale"" label."
Issue,3831,Error instalando fix mod303 en docker (odoo 16),"## Module
l10n_es_aeat_mod303

## Describe the bug
Debido a los cambios de este año en el modelo 303 he tratado de actualizar el repo y actualizar la base de datos de odoo. Pero obtengo el siguiente error:

Exception: Fallo en la carga del módulo l10n_es_aeat_mod303: no se pudo procesar el archivo l10n_es_aeat_mod303/data/2024-10/l10n.es.aeat.map.tax.line.csv:
No se han encontrado registros coincidentes para id. externo 'l10n_es.account_tax_template_p_iva2_ic_bc' en el campo 'Taxes templates'
No se han encontrado registros coincidentes para id. externo 'l10n_es.account_tax_template_p_iva2_ic_bc' en el campo 'Taxes templates'
No se han encontrado registros coincidentes para id. externo 'l10n_es.account_tax_template_p_iva2_isc' en el campo 'Taxes templates'
No se han encontrado registros coincidentes para id. externo 'l10n_es.account_tax_template_p_iva2_isc' en el campo 'Taxes templates'
No se han encontrado registros coincidentes para id. externo 'l10n_es.account_tax_template_p_iva2_ic_bc' en el campo 'Taxes templates'
No se han encontrado registros coincidentes para id. externo 'l10n_es.account_tax_template_p_iva2_ic_bc' en el campo 'Taxes templates'
No se han encontrado registros coincidentes para id. externo 'l10n_es.account_tax_template_s_req1' en el campo 'Taxes templates'
No se han encontrado registros coincidentes para id. externo 'l10n_es.account_tax_template_s_req1' en el campo 'Taxes templates'
No se han encontrado registros coincidentes para id. externo 'l10n_es.account_tax_template_p_req026' en el campo 'Taxes templates'
No se han encontrado registros coincidentes para id. externo 'l10n_es.account_tax_template_p_req026' en el campo 'Taxes templates'
No se han encontrado registros coincidentes para id. externo 'l10n_es.account_tax_template_p_iva2_ibc' en el campo 'Taxes templates'
No se han encontrado registros coincidentes para id. externo 'l10n_es.account_tax_template_p_iva2_ibc' en el campo 'Taxes templates'
No se han encontrado registros coincidentes para id. externo 'l10n_es.account_tax_template_p_iva2_ic_bc' en el campo 'Taxes templates'
No se han encontrado registros coincidentes para id. externo 'l10n_es.account_tax_template_p_iva2_ic_bc' en el campo 'Taxes templates'
No se han encontrado registros coincidentes para id. externo 'l10n_es.account_tax_template_p_req026' en el campo 'Taxes templates'
No se han encontrado registros coincidentes para id. externo 'l10n_es.account_tax_template_p_req026' en el campo 'Taxes templates'
No se han encontrado registros coincidentes para id. externo 'l10n_es.account_tax_template_s_iva7-5b' en el campo 'Taxes templates'
No se han encontrado registros coincidentes para id. externo 'l10n_es.account_tax_template_s_iva7-5b' en el campo 'Taxes templates'
No se han encontrado registros coincidentes para id. externo 'l10n_es.account_tax_template_s_iva2b' en el campo 'Taxes templates'
No se han encontrado registros coincidentes para id. externo 'l10n_es.account_tax_template_s_iva2b' en el campo 'Taxes templates'
No se han encontrado registros coincidentes para id. externo 'l10n_es.account_tax_template_s_req026' en el campo 'Taxes templates'
No se han encontrado registros coincidentes para id. externo 'l10n_es.account_tax_template_s_req026' en el campo 'Taxes templates'


Steps to reproduce the behavior:
1. Git pull de la rama 16.0 en el repo l10n-spain
2. Elimino la imagen de docker para asegurarme de que cojo la última imagen de odoo:16
3. Arranco el contenedor de docker
4. Trato de actualizar el módulo l10n_es_aeat_mod303, o bien el módulo l10n_es_aeat o bien el módulo l10n_es, en cualquiera de los tres aparece el error.

**Expected behavior**
Actualización sin errores
","Hola,

Esto no es cosa del módulo, si no de tu despliegue: o bien no tienes el código de Odoo actualizado, que incluye esos cambios, o bien en tu BD no está actualizado dicho módulo.

En cualquier caso, cierro esta issue, al no tratarse de un error en el código fuente en si. Puedes acudir al foro o a listas para solicitar más ayuda."
Issue,3829,[BUG] l10n_es_ticketbai_batuz method not called,"Hi,

in the next Link u can check the call to the method batuz_get_supplier_num_factura inside _get_lroe_140_2_1_dict function is not getting called never missing parenthesis

https://github.com/OCA/l10n-spain/blob/e1107ce2adfb333daa948cc441970284800555f3/l10n_es_ticketbai_batuz/models/account_move.py#L596","Puedes proponer un PR arreglándolo. [SEP] Seria lo suyo, pero antes habría que comentar el por que esta oculto el boton de cancelar asiento ""button_cancel"" en facturas de proveedor cuando tenemos confirmada la factura, aprovechamos y tratamos ambos asuntos en un mismo PR.


https://github.com/OCA/l10n-spain/blob/e1107ce2adfb333daa948cc441970284800555f3/l10n_es_ticketbai/views/account_move_views.xml#L248-L252
 [SEP] De acuerdo. Eso lo tendrás que ver con los creadores/mantenedores del módulo, ya que al ser algo específico de vuestra parte, los mantenedores habituales de la localización no hemos intervenido. [SEP] Buenas @enriquemartin entiendo que la parte de l10n_es_ticketbai la hizo Aritz Olea en su día y ahora mismo no habría maintainer de ese modulo? [SEP] Buenas @AsierAcedo no hay maintainer oficial activo no, pero nosotros solemos ser bastante activos en cuanto a PRs en los módulos de tbai/batuz [SEP] There hasn't been any activity on this issue in the past 6 months, so it has been marked as stale and it will be closed automatically if no further activity occurs in the next 30 days.
If you want this issue to never become stale, please ask a PSC member to apply the ""no stale"" label. [SEP] Hola @AsierAcedo 
Al final no hay PR de esto?  [SEP] There hasn't been any activity on this issue in the past 6 months, so it has been marked as stale and it will be closed automatically if no further activity occurs in the next 30 days.
If you want this issue to never become stale, please ask a PSC member to apply the ""no stale"" label."
Issue,3826,[16.0] l10n_es_aeat_sii_oca: bloqueo gestión de errores,La siguiente línea provoca un bloqueo cuando ocurre un error con el envío al SII: https://github.com/OCA/l10n-spain/blob/c7d3d0b65ce4c57788fa0097e2907dc69ac8fe0d/l10n_es_aeat_sii_oca/models/sii_mixin.py#L826,"El `with` justamente lo que hace es un `close` cuando termina su alcance, así que a priori es lo mismo. [SEP] @pedrobaeza Correcto, disculpa. Haciendo pruebas pensaba que no se bloqueaba por alguna razón, pero también se bloquea (he editado el mensaje de la issue para quitar la alternativa). Estoy probando en el runbot y ocurre lo mismo: si hay un error durante el envío, hay un bloqueo. [SEP] Pero yo no he experimentado nunca ese bloqueo que comentas. Mira si es por algo específico de esa instancia. [SEP] @pedrobaeza El problema reside en lo de siempre. El método de envío sin el queue, que ya sabemos que da muchos problemas/fallos.

Nosotros siempre lo configuramos con el conector en producción, pero hemos detectado este mal funcionamiento en una instancia de pruebas, por ejemplo cuando el SII da errores cuando no hay certificado, etc. Este tipo de errores (no errores en facturas).

Merece la pena invertir recursos en mejorar ese sistema? Más que nada es para dejarlo reportado.

Por otra parte, y ya que estamos... no sé si merecería la pena hacer desaparecer el sistema ""instantáneo"" en el refactoring de V17.

Ya nos dices. [SEP] Sí, en v17 yo quitaría el sistema instantáneo, puesto que la principal razón era porque `queue_job` no es compatible con Odoo.sh, pero ya al no utilizarlo, ya da igual. Además, se puede hacer instantáneo poniéndolo un retardo de 0. [SEP] > Sí, en v17 yo quitaría el sistema instantáneo, puesto que la principal razón era porque `queue_job` no es compatible con Odoo.sh, pero ya al no utilizarlo, ya da igual. Además, se puede hacer instantáneo poniéndolo un retardo de 0.

OK

@manuelregidor Teniendo en cuenta estos cambios y para no irnos muy ""offtopic"", puedes añadir este punto a la lista de faltantes para el refactoring de V17? Me refiero a lo de eliminar el método instantáneo sin queue, que antes ya hemos barajado esa opción. [SEP] @HaraldPanten De acuerdo, lo añado. Es necesario mantener esta issue abierta? Gracias. [SEP] > @HaraldPanten De acuerdo, lo añado. Es necesario mantener esta issue abierta? Gracias.

Creo que no. Por mí podemos cerrarla"
Issue,3823,[16.0] l10n_es_aeat_sii_oss: Impuesto de bienes de Inversion,"Modulo.
l10n_es_aeat_sii_oss

Descripción del problema
Al mandar una factura con bienes de inversión y servicios al SII se agrupan todos los impuestos y se marcan como bien de inversión.

Pasos para reproducir el problema:
Generar una factura con varias lineas unas con el impuesto 21% Bienes y otra con 21% servicios.

Ejemplo:
```json
        ""DesgloseFactura"": {
            ""DesgloseIVA"": {
                ""DetalleIVA"": [
                    {
                        ""TipoImpositivo"": ""21.0"",
                        ""BaseImponible"": 8475.0,
                        ""CuotaSoportada"": 1779.75,
                        ""BienInversion"": ""S""
                    }
                ]
            }
        },
```
Es posible enviar varias lineas DetalleIVA al SII con el mismo TipoImpositivo? He estado revisando la documentación de [SII_Descripcion_ServicioWeb](https://sede.agenciatributaria.gob.es/static_files/Sede/Procedimiento_ayuda/G417/FicherosSuministros/V_1_1/SII_Descripcion_ServicioWeb_v1.1_es_es.pdf ) y no veo nada al respecto.
Gracias.

","There hasn't been any activity on this issue in the past 6 months, so it has been marked as stale and it will be closed automatically if no further activity occurs in the next 30 days.
If you want this issue to never become stale, please ask a PSC member to apply the ""no stale"" label."
Issue,3812,[16] vat_book: Impuestos temporales no incluidos en mapeo,"Módulo
l10n_es_vat_book

Descripción del problema
El módulo del Libro de IVA (vat_book) no está registrando correctamente algunos tipos de IVA introducidos en la normativa de 2024. En particular, los tipos temporales del 2% y del 7,5% no están correctamente mapeados, por lo que no se reflejan de forma adecuada en el informe generado por el módulo.

Según la normativa vigente, los tipos de IVA que deben recogerse en el Libro de IVA son:

21% (General).
10% (Reducido).
4% (Superreducido).
0% (Temporal para alimentos básicos y aceite de oliva del 1 de julio al 30 de septiembre de 2024).
2% (Temporal para alimentos básicos y aceite de oliva del 1 de octubre al 31 de diciembre de 2024).
5% (Temporal para aceites de semillas y pastas alimenticias del 1 de julio al 30 de septiembre de 2024).
7,5% (Temporal para aceites de semillas y pastas alimenticias del 1 de octubre al 31 de diciembre de 2024).

Puedes consultar los detalles de la normativa aquí:
[Agencia Tributaria - Novedades IVA 2024](https://sede.agenciatributaria.gob.es/Sede/iva/novedades-iva/novedades-normativa-2024).

Pasos para reproducirlo
Versiones afectadas: Odoo 16

Pasos para reproducir el problema:

Configurar en plan contable. 
Registrar facturas de compras o ventas con los tipos temporales del 2% y 7,5%.
Generar el informe del Libro de IVA utilizando el módulo l10n_es_vat_book.
Revisar los valores en el informe generado.

Comportamiento esperado
El Libro de IVA debería incluir todos los tipos de IVA indicados en la normativa de 2024, incluyendo los temporales del 2% y 7,5%, y reflejar los valores correctamente en el informe.

Comportamiento observado
Los tipos temporales del 2% y 7,5% no se están mapeando correctamente, por lo que no se reflejan de forma adecuada en el informe del Libro de IVA.

Contexto adicional
Este problema afecta la correcta declaración de impuestos a la Agencia Tributaria, especialmente durante los períodos en los que se aplican los tipos temporales.

![image](https://github.com/user-attachments/assets/7cf74e78-f358-4e8f-9993-4f22f8d4933b)

![image](https://github.com/user-attachments/assets/ff33a872-cf17-4e65-8434-f894b3c9837a)

![image](https://github.com/user-attachments/assets/947893bd-15a8-4f70-ae62-8c0af0d32f7c)

![image](https://github.com/user-attachments/assets/4ff90eeb-a4b1-4bf3-861f-30897a5dcfc9)

MT-8100 @moduon

","@fcvalgar es correcto. El libro de IVA no se ha actualizado conforme a los nuevos impuestos. [SEP] @HaraldPanten a ver si mi compañero @edlopen nos puede lanzar un PR para añadir esos mapeos.  [SEP] @HaraldPanten @fcvalgar os dejo el PR para que lo probéis. ¡Gracias!

https://github.com/OCA/l10n-spain/pull/3813 [SEP] Esta issue se puede cerrar porque se resolvió en https://github.com/OCA/l10n-spain/pull/3813 [SEP] Falta hacer backport/fw-port. [SEP] Ya está llevado a 15.0 y rehecho en 17.0. Los nuevos IVAs no deducibles estaban mapeados incorrectamente en 16.0 y ya está también arreglado."
Issue,3806,"Error al importar el módulo ""payment_redsys"" en Odoo v17","<!-- Provide a general summary of the issue in the Title above.
Before opening the issue, please check that there isn't another issue addressing the same problem already created -->

## Module
Payment Redsys

## Describe the bug
No puedo importar el módulo descargado del market place en la versión 17 de Odoo. Aparece el siguiente mensaje de error:

Error al importar el módulo ""payment_redsys"".

 while parsing /tmp/tmpr7e9asah/payment_redsys/views/payment_provider.xml:5
Ocurrió un error al validar vista cercana

                <field name=""company_id"" invisible=""1""/>
                <field name=""is_published"" invisible=""1""/>
                <field name=""main_currency_id"" invisible=""1""/>
                <field name=""support_manual_capture"" invisible=""1""/>
                <field name=""support_tokenization"" invisible=""1""/>

El campo ""redsys_merchant_name"" no existe en el modelo ""payment.provider""

View error context:
{'file': '/tmp/tmpr7e9asah/payment_redsys/views/payment_provider.xml',
 'line': 4,
 'name': 'payment.provider.form.redsys',
 'view': ir.ui.view(3336,),
 'view.model': 'payment.provider',
 'view.parent': ir.ui.view(640,),
 'xmlid': 'provider_form_redsys'}


**Additional context**
Instalación limpia Odoo Enterprise On Premise en servidor dedicado.","Hola, la opción de importar módulos solo sirve para módulos que no contengan código (módulos de datos, como los de industria), por lo que no es válida para casi ningún módulo. Debes incluir el módulo en tu addons path de Odoo, y reiniciar la instancia una vez colocado.

Cierro, ya que no es un ningún fallo del módulo, si no de cómo se ha intentado desplegar. [SEP] Gracias por la respuesta Pedro. No tenía ni idea."
Issue,3799,[15.0] l10n_es_facturae pre-migration.py,"<!-- Provide a general summary of the issue in the Title above.
Before opening the issue, please check that there isn't another issue addressing the same problem already created -->

## Module
l10n_es_facturae

## Describe the bug
After updating to the latest commit from l10n-spain and latest commit from Odoo, when trying to update the module l10n_es_facturae we get the following error:
![image](https://github.com/user-attachments/assets/d7784d80-2186-43f0-bc39-d293f31c2e46)


## To Reproduce
**Affected versions**:
15.0
16.0 (using OpenUpgrade tool, probably also doing a regular update in version)

Steps to reproduce the behavior:
1. Use the latest commit from l10n-spain
2. Try to update 


**Expected behavior**
The query from pre-migration.py should execute and you should be able to update the addon

**Additional context**
Python 3.8, Ubuntu 20.04 (also on WSL enviroment) PSQL 15.0 for Odoo 15
Python 3.10, Ubuntu 22.04, PSQL 15.0 for Odoo 16",Efectivamente es incorrecto. Arreglado en https://github.com/OCA/l10n-spain/commit/2ec7e5299e66a6d17e385017e14df36edbd19edb
Issue,3790,[16.0] Comprobación de exportación AEAT modelo 303 2023-actualidad,"<!-- Provide a general summary of the issue in the Title above.
Before opening the issue, please check that there isn't another issue addressing the same problem already created -->

## Module
l10n_es_aeat, l10n_es_mis_report, l10n_es_aeat_mod303

## Describe the bug
Cuando voy a hacer la comprobación de la exportación del modelo 303 2023-actualidad obtengo el siguiente error.
Traceback (most recent call last):
  File ""/opt/odoo/odoo/tools/safe_eval.py"", line 391, in safe_eval
    return unsafe_eval(c, globals_dict, locals_dict)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File """", line 1, in <module>
NameError: name 'object' is not defined
...
  File ""/opt/odoo/odoo/tools/safe_eval.py"", line 405, in safe_eval
    raise ValueError('%s: ""%s"" while evaluating\n%r' % (ustr(type(e)), ustr(e), expr))
ValueError: <class 'NameError'>: ""name 'object' is not defined"" while evaluating
""object.period_type in ('4T', '12') and object.exonerated_390 == '1'""

Me falla en otras instalaciones de Odoo 16, y lo he probado con el archivo generado por mi Odoo, como con el que me genera mi gestor y ya esta validado correctamente en la web de AEAT. 

NOTA: Otros modelos como el modelo 111 y el 115 funcionan si problemas.

## To Reproduce
**Affected versions**:  Odoo 16

Steps to reproduce the behavior:
1. Contabilidad > Declaraciones AEAT > Modelo 303 > 2.024 | 3T - Tercer trimestre (la exportación esta configurada para Mod.303 2023-actualidad) > Exportar a BOE
2. Contabilidad > Configuración > AEAT > Configuración de Exportación a BOE > Mod.303 2023-actualidad
3. Comparar Archivo

**Expected behavior**
Que me devuelva los campos comparados, como por ejemplo en la captura que adjunto del modelo 111
![image](https://github.com/user-attachments/assets/220248e3-317f-49a7-88fd-8a9ef9e6d1e5)


**Additional context**
Leyendo en [OCA AEAT Base ](https://odoo-community.org/shop/aeat-base-1342#attr=22705) se indica lo siguiente ""Para poder utilizar el motor genérico de cálculo de casillas por impuestos (como el 303), hay que heredar del modelo ""l10n.es.aeat.report.tax.mapping"" en lugar de ""l10n.es.aeat.report"". Para la vista, hay que añadir el campo a mano, ya que la herencia de vistas no permite una doble herencia de AbstractModel, pero lo que es la vista tree ya está definida."" Pero la verdad es que no entiendo muy bien como hacerlo y supongo que es la solución a mi problema. ","El comprobador es una herramienta de depuración con sus limitaciones, y en el 303 tal como está no sirve. Se aceptan mejoras en el mismo, pero no es un error como tal, si no una limitación. [SEP] Entiendo, muchas gracias por la respuesta. Saludos!"
Issue,3787,Cuotas en casillas 11 y 37  de compras intracomunitarias  en modelo 303,"<!-- Provide a general summary of the issue in the Title above.
Before opening the issue, please check that there isn't another issue addressing the same problem already created -->
version 17
![11-37](https://github.com/user-attachments/assets/29908244-0808-4ec3-a3b5-81a3ea0cbd23)

No se rellenan las casillas de 11 y 37 con las cuotas de compras  intracomunitarias

## Module
modelo 303

## Describe the bug
No se rellenan las casillas de 11 y 37 con las cuotas de compras  intracomunitarias

## To Reproduce
**Affected versions**:

Steps to reproduce the behavior:
1.Agregar una compra intracomunitaria con 0% de iva
2.Generar el modelo 303
3. Se aprecia que las casillas 11  y 37 donde deberia ir la cuota 21% para que se contraresten viene vacia.

**Expected behavior**
A clear and concise description of what you expected to happen.

**Additional context**
Add any other context about the problem here. (e.g. OS, Python version, ...)","Diría que has cambiado las cuentas estándar 472/477. [SEP] Gracias por tu  rapida respuesta amigo Pedro. No he cambiado nada simplemente he instalado todo y estoy haciendo pruebas antes de utilizar este sistema el proximo año. Podrias decirme como habria podido cambiar estas cuentas y como restaurar esto para que funcione correctamente ? muchisimas gracias Pedro
![impuesto](https://github.com/user-attachments/assets/090ad9ee-30bd-4ab1-9671-e5026fe44580)

Este es el tipo de impuesto que  he usado.
 [SEP] tengo diferentes backups en mi proxmox y he cargado la primera imgen que cree cuando estaba el sistema con las addons sin ningun tipo de cambio y he hecho una simulacion y obtengo el mismo resultado , no hay nada en casillas 11 y 37
![addons](https://github.com/user-attachments/assets/d6e8bda1-3c5d-47c4-9901-1409ad321331)
Crees que es algun tipo de bug ? has intentado replicar esto? o crees que en mi maquina hay alguna configurancion cambiada? gracias Pedro [SEP] El impuesto que debes utilizar es ""IVA 21% Adquisición de servicios intracomunitarios"", no ""IVA 0% Adquisición de servicios intracomunitarios"", o mejor aún, establece el ""IVA 21% (servicios)"" en el producto, y la posición fiscal ""Régimen Intracomunitario"" en el proveedor, y te lo hará solo el sistema. [SEP] Muchisimas gracias Pedro por tu ayuda asi como dices si ha funcionado correctamente pido disculpas por abrir este hilo con el tag de bug puesto que no lo es . Gracias de nuevo por tu ayuda amigo.
![ok](https://github.com/user-attachments/assets/2a7a422a-f9ca-4fa9-b057-3bba3e7995f9)
"
Issue,3786,[17.0] Error en facturas con DUA,"Buenos días, después de hacer un post en el foro: https://www.aeodoo.org/en/forum/general-1/error-despues-de-instalar-libro-de-iva-en-odoo-17-1679

Me han recomendado abrir un issue aquí. Ante nada perdón, ya que no soy técnico, por lo que si necesitáis más información decidme.

Al instalar el libro de IVA en 17.0, he identificado que, si en el periodo que intento generar un libro de IVA hay una factura que tenga el impuesto DUA aplicado, me produce el siguiente error:

`RPC_ERROR
Odoo Server Error
Traceback (most recent call last):
  File ""/home/odoo/src/odoo/odoo/http.py"", line 1783, in _serve_db
    return service_model.retrying(self._serve_ir_http, self.env)
  File ""/home/odoo/src/odoo/odoo/service/model.py"", line 133, in retrying
    result = func()
  File ""/home/odoo/src/odoo/odoo/http.py"", line 1810, in _serve_ir_http
    response = self.dispatcher.dispatch(rule.endpoint, args)
  File ""/home/odoo/src/odoo/odoo/http.py"", line 2014, in dispatch
    result = self.request.registry['ir.http']._dispatch(endpoint)
  File ""/home/odoo/src/odoo/addons/website/models/ir_http.py"", line 235, in _dispatch
    response = super()._dispatch(endpoint)
  File ""/home/odoo/src/odoo/odoo/addons/base/models/ir_http.py"", line 222, in _dispatch
    result = endpoint(**request.params)
  File ""/home/odoo/src/odoo/odoo/http.py"", line 759, in route_wrapper
    result = endpoint(self, *args, **params_ok)
  File ""/home/odoo/src/odoo/addons/web/controllers/dataset.py"", line 28, in call_button
    action = self._call_kw(model, method, args, kwargs)
  File ""/home/odoo/src/odoo/addons/web/controllers/dataset.py"", line 20, in _call_kw
    return call_kw(request.env[model], method, args, kwargs)
  File ""/home/odoo/src/odoo/odoo/api.py"", line 468, in call_kw
    result = _call_kw_multi(method, model, args, kwargs)
  File ""/home/odoo/src/odoo/odoo/api.py"", line 453, in _call_kw_multi
    result = method(recs, *args, **kwargs)
  File ""/home/odoo/src/user/l10n_es_aeat/models/l10n_es_aeat_report.py"", line 346, in button_calculate
    res = self.calculate()
  File ""/home/odoo/src/user/l10n_es_vat_book/models/l10n_es_vat_book.py"", line 207, in calculate
    self._calculate_vat_book()
  File ""/home/odoo/src/user/l10n_es_vat_book/models/l10n_es_vat_book.py"", line 470, in _calculate_vat_book
    rec.create_vat_book_lines(lines, map_lines[:1].book_type, taxes)
  File ""/home/odoo/src/user/l10n_es_vat_book/models/l10n_es_vat_book.py"", line 404, in create_vat_book_lines
    tax_line.pop(""other_tax_ids"")
KeyError: 'other_tax_ids'

The above server error caused the following client error:
RPC_ERROR: Odoo Server Error
    RPC_ERROR
        at makeErrorFromResponse (/web/assets/96d4c34/web.assets_web.min.js:2893:163)
        at XMLHttpRequest.<anonymous> (/web/assets/96d4c34/web.assets_web.min.js:2897:13)`

Sin embargo, si el periodo no incluye ninguna factura con DUA, genera el libro sin ningún problema.

Espero que sea suficiente para identificar el fallo.

Gracias,","Alguien le puede intentar echar un ojo a esto? Lo necesitamos para fin de año... no nos importa pagar por el tiempo. Gracias. [SEP] > Alguien le puede intentar echar un ojo a esto? Lo necesitamos para fin de año... no nos importa pagar por el tiempo. Gracias.

@buildamoc lo hemos corregido en este [PR](https://github.com/OCA/l10n-spain/pull/4121) 😄 "
Issue,3754,Migration to version 18.0,"# Todo

https://github.com/OCA/maintainer-tools/wiki/Migration-to-version-18.0

# Modules to migrate

- [x] account_promissory_note_caixabank - By @CarlosRoca13 - #4023
- [x] delivery_dhl_parcel - By @Alexgars73 - #4332
- [x] delivery_gls_asm - By @arantxa-s73 - #4090
- [x] delivery_seur_atlas - By @javierjcf - #4238
- [x] l10n_ca_es_cnae - By @Anxo82 - #4246
- [x] l10n_es_account_asset - By @SiscoIngeos - #4217
- [x] l10n_es_account_banking_sepa_fsdd - By @SiscoIngeos - #4219
- [x] l10n_es_account_statement_import_n43 - By @LauraCForgeFlow - #4146
- [x] l10n_es_aeat - By @AaronHForgeFlow - #4033
- [x] l10n_es_aeat_mod111 - By @LauraCForgeFlow - #4152
- [x] l10n_es_aeat_mod115 - By @EmilioPascual - #4241
- [x] l10n_es_aeat_mod123 - By @LauraCForgeFlow - #4153
- [x] l10n_es_aeat_mod130 - By @zurbaran - #4306
- [x] l10n_es_aeat_mod190 - By @etobella - #4351
- [x] l10n_es_aeat_mod216 - By @EmilioPascual - #4242
- [x] l10n_es_aeat_mod296 - By @EmilioPascual - #4250
- [x] l10n_es_aeat_mod303 - By @AaronHForgeFlow / @pedrobaeza - #4230
- [x] l10n_es_aeat_mod303_oss - By @LauraCForgeFlow - #4148
- [x] l10n_es_aeat_mod303_vat_prorate - By @BetoRaja - #4263
- [x] l10n_es_aeat_mod347 - By @AaronHForgeFlow / @pedrobaeza - #4256
- [ ] l10n_es_aeat_mod347_igic - By @luisDIXMIT - #4530
- [x] l10n_es_aeat_mod349 - By @pablo-cort-s73 / @pedrobaeza - #4257
- [x] l10n_es_aeat_mod369 - By @sergioM-S73 - #4234
- [x] l10n_es_aeat_mod390 - By @sergioM-S73 - #4045
- [x] l10n_es_aeat_mod390_oss - By @LauraCForgeFlow - #4182
- [x] l10n_es_aeat_partner_check - By @pablo-cort-s73 - #4283
- [x] l10n_es_aeat_sii_invoice_summary - By @victoralmau - #4508
- [ ] l10n_es_aeat_sii_match - By @FernandoRomera - #4688
- [x] l10n_es_aeat_sii_oca - By @AaronHForgeFlow - #4046
- [x] l10n_es_aeat_sii_oss - By @carlos-lopez-tecnativa - #4488
- [x] l10n_es_atc - By @JasminSForgeFlow - #4297
- [ ] l10n_es_atc_mod415 - By @luisDIXMIT - #4386
- [x] l10n_es_atc_mod420 - By @luisDIXMIT - #4388
- [x] l10n_es_cnae - By @javierjcf - #4236
- [x] l10n_es_facturae - By @etobella - #4340
- [x] l10n_es_facturae_face - By @etobella - #4352
- [x] l10n_es_facturae_sale_stock - By @deeniiz - #4670
- [ ] l10n_es_igic - By @Christian-RB - #3993
- [x] l10n_es_intrastat_report - By @LauraCForgeFlow - #4151
- [x] l10n_es_location_nuts - By @Andrii9090 - #4348
- [x] l10n_es_mis_report - By @JasminSForgeFlow - #3969
- [x] l10n_es_partner - By @mpascuall - #3998
- [x] l10n_es_partner_mercantil - By @CarlosRoca13 - #4106
- [x] l10n_es_payment_order_confirming_aef - By @Vicent-S73 - #4189
- [x] l10n_es_payment_order_confirming_sabadell - By @Vicent-S73 - #4190
- [x] l10n_es_pos_oca - By @cesarportas - #4549
- [x] l10n_es_pos_sii - By @christian-ramos-tecnativa - #4656
- [ ] l10n_es_reav
- [x] l10n_es_toponyms - By @juancarlosonate-tecnativa - #4027
- [x] l10n_es_vat_book - By @IsabelAForgeFlow - #4098
- [x] l10n_es_vat_book_invoice_summary - By @victoralmau - #4509
- [x] l10n_es_vat_book_oss - By @carlos-lopez-tecnativa - #4487
- [x] l10n_es_vat_prorate - By @Andrii9090 - #4442
- [x] l10n_es_verifactu_oca - By @pedrobaeza - #4446
- [x] payment_redsys - By @carlos-lopez-tecnativa - #4486

Missing module? Check https://github.com/OCA/maintainer-tools/wiki/%5BFAQ%5D-Missing-modules-in-migration-issue-list","Nota para cuando comencemos con la migración de AEAT, SII, etc: revisar el módulo core `certificate` para ver si provee ya de base las herramientas para la gestión de certificados. [SEP] I'm migrating l10n_es_partner [SEP] Trabajando en l10n_es_igic [SEP] working on `l10n_es_toponyms` [SEP] Working on payment_redsys [SEP] Are there plans to migrate the modules not yet migrated in version 17? Specifically, I'm referring to:
-  l10n_es_ticketbai
- l10n_es_ticketbai_api
- l10n_es_ticketbai_api_batuz
- l10n_es_ticketbai_batuz [SEP] @Gasteizko a partir de la v17.0 esta incluido en el core de Odoo

https://github.com/OCA/OCB/tree/17.0/addons/l10n_es_edi_tbai
 [SEP] > [@Gasteizko](https://github.com/Gasteizko) a partir de la v17.0 esta incluido en el core de Odoo
> 
> https://github.com/OCA/OCB/tree/17.0/addons/l10n_es_edi_tbai

Si, pero paso lo mismo con el SII, que esta en el core, pero le faltan cosas y no funciona bien con los IRPF. Ahí ya es decisión más de los que están en el país vasco que quieren hacer. [SEP] Working on l10n_es_account_asset #4217  [SEP] Working on l10n_es_account_banking_sepa_fsdd #4219  [SEP] Working on l10n_es_cnae  #4236  [SEP] Hay planes de migrar el modelo 190? [SEP] Hay plan sobre el modulo de verifactu?
 [SEP] Working on l10n_es_aeat_patner_check #4283  [SEP] Buenas tardes,

Se migrará el módulo l10n_es_vat_book_pos a la v18???"
Issue,3751,"[160] payment_redsys - Porque necesita una dependencia en ""website_sale""?","Hola a todos:

Nos gustaría usar el payment_redsys para hacer pagos de facturas y demás, pero no instalar website y por tanto tener acceso público a odoo,  hemos simplemente cambiado el manifest borrando la dependencia en ""website_sale""e instala correctamente con lo que la dependencia debe ser ""blanda"", la revisión del código las únicas ocurrencia de website están relacionadas con la obtención de la url pública  desde el website, ¿ estamos en lo cierto? 

Hay ademas un parametro website en la definición de una url en el controller pero entendemos que no es importante..

Y esta bastante bien protegido (creemos)  es decir que  con una configuración correcta, se podría hacer funcionar sin problemas... sin necesidad de instalar website..

Saludos, Ignacio J Ortega","@sergio-teruel tienes información sobre este punto? [SEP] Hola @ValentinVinagre No recuerdo bien, seguramente será por herencia del pasado.
Tendría que analizar en profundidad [SEP] Gracias por contestar, efectivamente se puede quitar esa dependencia sin problemas, es dinamica y esta relativamente bien protegida aqui https://github.com/OCA/l10n-spain/blob/2ffc60e53c05330b3fada7c4f927b37abe3eab42/payment_redsys/models/payment_provider.py#L103

Nosotros  ya estamos usando el modulo sin la dependencia, y teniendo correctamente configurado web.base.url funciona muy bien [SEP] Perfecto, pues si alguien podéis hacer el pull request, así queda bien establecido. Indicad por favor en el README la cuestión de `web.base.url` o del dominio cuanto se tiene website. [SEP] ¡Qué bien visto!

¿@IJOL os encargáis del PR? Podemos hacerlo nosotros desde Sygel sin problema sino. Avisadnos y nos organizamos.

¡Gracias!

Un saludo, [SEP] @IJOL ¿Puedes hacerme ping en el PR?"
Issue,3730,[16.0] l10n_es_vat_prorate Slipt de lineas de impuesto por línea de factura ,"Hola 

Creo que sería necesario hacer un desglose por líneas del impuesto que no se puede deducir con la prorrata

Cuando creamos una factura de proveedor y una empresa tiene prorrata del IVA, en los apuntes contables vemos que lleva una parte correctamente a la cuenta 472 y la parte que no se tiene derecho a deducción la lleva a una cuenta de gasto. Todo esto es correcto

La mejora que sugiero es que cuando en una factura hay más de un producto y esos productos son activos, se debería crear una línea distinta de la cuenta de gasto, ya que fiscalmente ese gasto es un mayor valor del activo y si no están separados los gastos que pertenecen a cada activo, después no podré activarlos en cada inmovilizado

He hecho un vídeo explicativo de ejemplo:
https://www.loom.com/share/6ee7e9b1479f441585b684cbb499a558?sid=293c8942-e21e-486f-962a-a3c2d8cd8428

@rafaelbn @EmilioPascual 
MT-1809 @moduon","Hello ✋🏼 !

Please @etobella @pedrobaeza @HaraldPanten could review this proposal please?

Thank you very much! 😄 ❤️ 

For me is 👍🏼 , really nice video @ArantxaSudon 💘 🤗  [SEP] https://github.com/OCA/l10n-spain/pull/3715 [SEP] Cierro al estar el PR propuesto. [SEP] @etobella gracias por remitirme a este PR pero he vuelto a probarlo y  no hace lo que comento en el vídeo

@pedrobaeza podrías, por favor, volver a abrir este Issue

![Captura desde 2024-09-26 13-14-59](https://github.com/user-attachments/assets/fcae54c2-e87e-4e96-a7ec-36ea2e08aa6e)


Como veréis en esta captura, yo hago las pruebas y grabo el vídeo con el PR https://github.com/OCA/l10n-spain/pull/3715 ya aprobado y lo que comento aquí sigue reproduciéndose

He vuelto a repetirlo, comprobando que el módulo estaba instalado y, es cierto que:

-  si se utiliza **distinto impuesto**, las líneas de la prorrata si se desdoblan
-  pero si utilizo el **mismo impuesto** (que es lo que suele ocurrir), entonces la líneas no se desdoblan y va todo a la misma línea de gasto.

 
 Creo que, si os fijais en el vídeo que os dejé, se ve perfectamente como me lo deja en una solo línea

Muchas gracias

@rafaelbn @EmilioPascual 
MT-1809 @moduon
 [SEP] Esto no es un PR, si no un issue. Los comentarios correspondientes deberían hacerse en el PR de Enric. [SEP] @pedrobaeza Entonces vuelvo a poner todo esto en https://github.com/OCA/l10n-spain/pull/3715 ?

Yo no soy técnico, soy funcional y aporto todo lo que puedo para mejorar y si tú me dices que lo cambie, que eres el que sabe como funciona, no hay ningún problema, lo cambio en un segundo [SEP] A ver, el PR está cerrado y mergeado y yo no podré dedicarle tiempo a resolverlo, si queréis, podéis abrir un PR y, si puedo, ya lo revisaré, es lo máximo que os puedo ofrecer. [SEP] Gracias @etobella  [SEP] OK, si #3715 no es lo que se comenta en esta issue, entonces reabro para seguir reflejándolo hasta que haya un PR que lo haga. Disculpad la confusión. [SEP] Muchas gracias @pedrobaeza  [SEP] There hasn't been any activity on this issue in the past 6 months, so it has been marked as stale and it will be closed automatically if no further activity occurs in the next 30 days.
If you want this issue to never become stale, please ask a PSC member to apply the ""no stale"" label."
Issue,3721,[15.0] l10n_es_facturae_face SSL handshake timeout desde 13/09/2024 10:26,"l10n_es_facturae_face

Timeout para conectarse a FACE, empezando desde 13/09/2024 10:26 (justo antes, se enviaron correctamente)

Traceback (most recent call last):
  File ""/home/odoo/.pyenv/versions/3.8.10/lib/python3.8/site-packages/urllib3/connectionpool.py"", line 382, in _make_request
    self._validate_conn(conn)
  File ""/home/odoo/.pyenv/versions/3.8.10/lib/python3.8/site-packages/urllib3/connectionpool.py"", line 1010, in _validate_conn
    conn.connect()
  File ""/home/odoo/.pyenv/versions/3.8.10/lib/python3.8/site-packages/urllib3/connection.py"", line 411, in connect
    self.sock = ssl_wrap_socket(
  File ""/home/odoo/.pyenv/versions/3.8.10/lib/python3.8/site-packages/urllib3/util/ssl_.py"", line 449, in ssl_wrap_socket
    ssl_sock = _ssl_wrap_socket_impl(
  File ""/home/odoo/.pyenv/versions/3.8.10/lib/python3.8/site-packages/urllib3/util/ssl_.py"", line 493, in _ssl_wrap_socket_impl
    return ssl_context.wrap_socket(sock, server_hostname=server_hostname)
  File ""/home/odoo/.pyenv/versions/3.8.10/lib/python3.8/ssl.py"", line 500, in wrap_socket
    return self.sslsocket_class._create(
  File ""/home/odoo/.pyenv/versions/3.8.10/lib/python3.8/ssl.py"", line 1040, in _create
    self.do_handshake()
  File ""/home/odoo/.pyenv/versions/3.8.10/lib/python3.8/ssl.py"", line 1309, in do_handshake
    self._sslobj.do_handshake()
socket.timeout: _ssl.c:1114: The handshake operation timed out

Python 3.8.10
cryptography 38.0.2


No se hizo ningun cambio del lado de Odoo, asi que supongo que han tocado algo en el endpoint del FACe","Se soluciono solo
Parece que era cosa de ellos"
Issue,3720,"[16.0] l10n_es_ticketbai: Error en facturas con iva bienes, iva servicios y recargo de equivalencia","En referencia al issue #3045 pero en la versión 16, continúa pasando lo mismo. Según el equipo técnico de Batuz <programak@bizkaia.eus> este comportamiento es incorrecto.
![EmailBatuz](https://github.com/user-attachments/assets/1ecd99fb-eb68-49a3-ad33-d4c230a36657)

## Module
l10n_es_ticketbai

## Describe the bug
Al usar al menos 2 impuestos en una línea de factura, siendo uno de ellos Recargo de equivalencia + IVA 21% **Bienes** y la otra combinada con IVA 21% **Servicios**, se genera en el xml una duplicidad por el total del impuesto de Recargo de equivalencia en cada línea, en lugar de obtener el importe por separado de la base imponible de cada línea.

## To Reproduce
**Affected versions**: 14.0, 15.0, 16.0

Steps to reproduce the behavior:
1. Crear una factura con al menos 2 líneas.
![LineasFactura](https://github.com/user-attachments/assets/474fbcc6-e0db-40e8-b0d1-08f44c6314e4)

2. Establecer en cada línea al menos 2 impuestos, para este ejemplo los impuestos son: IVA 21% Bienes con 5.2% recargo de equivalencia y la otra línea IVA 21% Servicios con 5.2% recargo de equivalencia.
3. Confirmar la factura y revisar el XML generado hacia ticketbai.
![DuplicadoRE](https://github.com/user-attachments/assets/a2a4800b-f4b2-4c56-b219-449fe31aa0ac)

4. Se evidencia cómo se crea de forma incorrecta el recargo de equivalencia (agrupado), debería separarlo por línea según la base imponible pero no ocurre así. Este es el ejemplo real de un cliente que nos ha pasado su captura de pantalla.
![DesgloseFacturaIncorrecto](https://github.com/user-attachments/assets/a922177a-ebcc-443e-bfc1-9e48e6ed2c08)


**Expected behavior**
Se espera que por cada línea se calcule el recargo de equivalencia por separado según su base imponible.
![DesgloseFacturaCorrecto](https://github.com/user-attachments/assets/feb9e840-0717-46e1-96e3-8d5ab467f568)


**Additional context**
Las últimas 2 capturas de pantalla son enviadas por terceros en conversaciones por correo electrónico.","¿A alguien más le pasa? [SEP] @keiverobles efectivamente así es.
La solución pasa por refactorizar la forma en la que se recogen los datos para conformar el XML. Se tiene que hacer agrupando por tipo impositivo.
En su momento se trató el tema pero de momento nadie a tomado la iniciativa de plantear una solución.

Gracias por el issue porque aquí queda perfectamente explicado el problema 👍 [SEP] There hasn't been any activity on this issue in the past 6 months, so it has been marked as stale and it will be closed automatically if no further activity occurs in the next 30 days.
If you want this issue to never become stale, please ask a PSC member to apply the ""no stale"" label."
Issue,3718,Permitir hacer facturas electrónicas a clientes que no sean centros administrativos y firmar las facturas en Odoo 16.,"Antes de nada, muchas gracias, hacéis una gran labor con vuestro esfuerzo y dedicación a este proyecto.

Entrando en materia, he buscado el modo, pero **no he sido capaz de generar facturas a clientes que no sean centros administrativos**.
Si se dejan los campos de  vacíos de centro, oficina..., al menos en la prueba que he hecho a un cliente con nombre y apellidos (con el paquete partner_firstname instalado), la factura generada no es validada por face (https://face.gob.es/es/facturas/validar-visualizar-facturas) - Element 'AdministrativeCentres': Missing child element(s). Expected is ( AdministrativeCentre )-.

¿Esto es algo intencional? ¿Se prevé incluir clientes no institucionales dentro de las facturas electrónicas en la versión 16 en algún momento para poder cumplir con normativa estatal a partir del próximo año? 

Por otra parte, ¿se va a incluir la posibilidad de firmar las facturas? Con los paquetes de instalados, **no me aparece en el formulario de las compañías dónde subir el certificado**. Es posible que esté obviando algo, pero no sé qué puede ser.","Por si alguien tiene las mismas dudas que yo, he resuelto los problemas de la siguiente forma:
- En el fichero /l10n-spain/l10n_es_facturae/views/report_facturae.xml sustituir el código existente por el siguiente ( he dejado la primera y última línea afectada del xml para mayor claridad) :

```
        ................
        <PartyIdentification t-if=""False"" />

        <t t-set=""has_admin_centres"" t-value=""
            administrative_partner.oficina_contable or 
            partner.oficina_contable or 
            administrative_partner.organo_gestor or 
            partner.organo_gestor or 
            administrative_partner.unidad_tramitadora or 
            partner.unidad_tramitadora or 
            administrative_partner.organo_proponente or 
            partner.organo_proponente
        "" />

        <t t-if=""partner.facturae and has_admin_centres"">
            <AdministrativeCentres>
                <t t-call=""l10n_es_facturae.administrative_center"">
                    <t t-set=""centre_code"" t-value=""administrative_partner.oficina_contable or partner.oficina_contable"" />
                    <t t-set=""role_type_code"" t-value=""'01'"" />
                </t>
                <t t-call=""l10n_es_facturae.administrative_center"">
                    <t t-set=""centre_code"" t-value=""administrative_partner.organo_gestor or partner.organo_gestor"" />
                    <t t-set=""role_type_code"" t-value=""'02'"" />
                </t>
                <t t-call=""l10n_es_facturae.administrative_center"">
                    <t t-set=""centre_code"" t-value=""administrative_partner.unidad_tramitadora or partner.unidad_tramitadora"" />
                    <t t-set=""role_type_code"" t-value=""'03'"" />
                </t>
                <t t-call=""l10n_es_facturae.administrative_center"" t-if=""administrative_partner.organo_proponente or partner.organo_proponente"">
                    <t t-set=""centre_code"" t-value=""administrative_partner.organo_proponente or partner.organo_proponente"" />
                    <t t-set=""role_type_code"" t-value=""'04'"" />
                </t>
            </AdministrativeCentres>
        </t>

        <LegalEntity t-if=""buyer_type == 'J'"">
        ....................
```

Además, en el fichero /l10-nspain/l10n_es_facturae/models/account_move.py no obligar a comprobar la unidad tramitadora y oficina contable, comentando estas líneas:

```
	#if not self.partner_id.unidad_tramitadora:
        #    raise ValidationError(_(""Unidad Tramitadora not provided""))
        #if not self.partner_id.oficina_contable:
        #    raise ValidationError(_(""Oficina Contable not provided""))
```

Por último, si se quiere poder firmar con el certificado digital, hay que ir a Facturación/Contabilidad->Configuración->AEAT|Certificados AEAT:
   	- Poner un nombre al certificado
   	- Incluir el archivo .pfx
   	- Poner un nombre a la _carpeta_ donde se ubicarán las claves públicas y privadas que será en la ruta de  Odoo16/sessions/_carpeta_
   	- Incluir la fecha de inicio de uso del certificado y la fecha de finalización
   	- Darle a OBTENER CLAVES. 
   	- Una vez obtenidas, darle a PARA ACTIVAR y verificar que esté activado.
   Ahora si se quiere firmar la factura electrónicia, al generarla, dejar marcado el botón de firmar.


"
Issue,3703,Actualizar el Modelo 303 casillas 108 y 111 (Orden HAC/819/2024 de España),"Esta issue Tiene un impacto específico en empresas que se benefician de la aplicación de tipos impositivos reducidos en la entrega de alimentos. 

### Descripción:
El gobierno español ha introducido nuevos requisitos regulatorios a través de la Orden HAC/819/2024, que entrará en vigor el 6 de agosto de 2024. Estos cambios afectan al modelo de autoliquidación del IVA, modelo 303, y requieren modificaciones en Odoo para garantizar el cumplimiento.

#### Cambios Clave Requeridos:
1. **Adición de Nuevas Casillas en el Modelo 303 de IVA**:
   - **Casilla 108**: Para ajustes que no tienen una casilla específica en el modelo, particularmente para discrepancias de criterio administrativo.
   - **Casilla 111**: Para diferenciar entre solicitudes de devolución basadas en la normativa del IVA y aquellas por ingresos indebidos.

2. **Adaptación a Nuevos Tipos Impositivos Reducidos y Recargos de Equivalencia**:
   - La normativa prorroga la aplicación de ciertos tipos impositivos reducidos y sus recargos de equivalencia hasta el 31 de diciembre de 2024. Esto requiere actualizar las tablas de impuestos en Odoo para asegurar que estos tipos y recargos se apliquen correctamente a los productos afectados.

3. **Implementación de Autoliquidaciones Rectificativas**:
   - Se establece un nuevo proceso para las autoliquidaciones rectificativas bajo el artículo 74 bis del Reglamento del IVA. Esto incluye:
     - Añadir un campo para identificar las autoliquidaciones rectificativas y especificar las razones dentro del Modelo 303.
     - Implementar la lógica para manejar excepciones para cuotas repercutidas indebidamente a otros obligados tributarios.

4. **Fechas de Implementación**:
   - Para los sujetos pasivos con **periodo de liquidación mensual**, estos cambios se aplicarán a partir de la autoliquidación de **septiembre de 2024**.
   - Para los sujetos pasivos con **periodo de liquidación trimestral**, estos cambios se aplicarán a partir de la autoliquidación del **tercer trimestre de 2024**.

#### Acciones Propuestas:
- **Actualizar el formulario del modelo 303 de IVA en Odoo** para incluir las nuevas casillas y ajustes.
- **Configurar y probar los nuevos tipos impositivos y recargos** para asegurar el cumplimiento con los tipos reducidos y recargos de equivalencia prorrogados.
- **Desarrollar la lógica para manejar las autoliquidaciones rectificativas**, incluyendo la adición de nuevos campos y la gestión de excepciones.
- Asegurar que estas actualizaciones estén **listas antes de las fechas aplicables** para evitar problemas de cumplimiento para los usuarios de Odoo.

### Impacto:
Estos cambios son obligatorios para todas las empresas que operan en España y que deben presentar el Modelo 303 de IVA. El incumplimiento podría llevar a reportes incorrectos del IVA y posibles sanciones.

@moduon MT-7092 OPW-4139325

@OCA/local-spain-maintainers @AlbertCabedo 

--------------------------------------------------
Orden HAC/819/2024, de 30 de julio, por la que se modifica la Orden EHA/3786/2008, de 29 de diciembre, por la que se aprueban el modelo 303 del IVA. Autoliquidación. BOE 05-08-2024

La presente orden entrará en vigor 06/08/2024 y se aplicará por primera vez a las autoliquidaciones del IVA, modelo 303, correspondientes a los siguientes periodos de liquidación:

a) En el caso de sujetos pasivos con periodo de liquidación mensual, se aplicará por primera vez a la autoliquidación de septiembre de 2024.

b) En el caso de sujetos pasivos con periodo de liquidación trimestral, se aplicará por primera vez a la autoliquidación del tercer trimestre de 2024.

Esta orden tiene por objeto adaptar el modelo 303 a las medidas introducidas por el Real Decreto-ley 4/2024, que ha prorrogado hasta el 31 de diciembre de 2024 la aplicación de tipos impositivos reducidos, y sus correspondientes recargos de equivalencia, a determinadas entregas de alimentos. Introduce en el mismo las casillas necesarias para los nuevos tipos impositivos y los nuevos tipos de recargo de equivalencia. (enviado 27/06/2024)

Esta orden tiene por objeto introducir en el modelo 303 los cambios necesarios para la implementación de la autoliquidación rectificativa regulada en el artículo 74 bis del Reglamento sobre el Valor Añadido (Real Decreto 1624/1992), introducido por la disposición final tercera del Real Decreto 117/2024 (resumen enviado el 12 de febrero). 

El artículo 74 bis del RIVA establece la autoliquidación rectificativa como la vía general para rectificar, completar o modificar la autoliquidación presentada con anterioridad.

Este nuevo sistema de rectificación se configura como el procedimiento general con dos excepciones.

En primer lugar, cuando el motivo de la rectificación alegado sea la eventual vulneración por la norma aplicada en la autoliquidación previa de los preceptos de otra norma de rango superior, la rectificación se podrá efectuar mediante la presentación de una autoliquidación rectificativa o bien mediante el tradicional procedimiento de solicitud de rectificación de autoliquidaciones.

En segundo lugar, quedan excluidos de la autoliquidación rectificativa los casos de rectificaciones de cuotas indebidamente repercutidas a otros obligados tributarios a las que se refiere el artículo 129 del REGAT (RD 1065/2007), cuya rectificación se efectuará en todo caso a través del procedimiento de solicitud de rectificación de autoliquidaciones.

La efectiva implantación de la autoliquidación rectificativa en el ámbito del IVA requiere la adaptación del modelo 303.

Para ello, introduce en el modelo 303, además de las necesarias casillas para identificar la autoliquidación rectificativa, y en su caso, las causas que la motivan, dos nuevas casillas. 

La nueva casilla 108, tiene por objeto permitir aquellas rectificaciones para las que no exista una casilla específica en el modelo. Esta casilla exclusivamente se podrá cumplimentar en aquellos casos en los que la autoliquidación rectificativa se deba a una discrepancia de criterio administrativo cuyo ajuste no pueda realizarse a través del resto de casillas del modelo. El importe de este ajuste se tendrá en cuenta en el cálculo del resultado de la autoliquidación (casilla 69).

La nueva casilla 111 se crea para permitir que, en los casos de solicitudes de devolución, el contribuyente pueda diferenciar las que derivan de la aplicación de la normativa del Impuesto de aquellas que puedan corresponderse con una solicitud de ingresos indebidos teniendo en cuenta el diferente régimen de unas y otras devoluciones.","Odoo SA ya lo tiene desarrollado para Odoo Enterprise hace 3 semanas: https://github.com/odoo/enterprise/pull/69736 [SEP] Empezamos a trabajar en el PR para hacerlo en OCA. @moduon MT-7092 [SEP] Hola a todos, Emilio lo empezó a hacer en el OCA Sprint pero no lo terminó. Ahora lo está retomando @Shide . Si alguno tiene más experiencia y quiere ayudar nos decís. Estamos con esto ahora mismo. [SEP] Estoy yo haciéndolo ahora. En unas horas lo tendré. [SEP] Gracias @pedrobaeza  [SEP] - [x] Hecho PR para Odoo 15 en https://github.com/OCA/l10n-spain/pull/3755
- [x] https://github.com/OCA/l10n-spain/pull/3757 [SEP] REABRO porque tenemos errores. Creo que no están implementsdos todos los cambios. Estoy viendo que se puso en Known issues 

@Shide  [SEP] Las casillas no implementados son casos muy específicos de las nuevas auto-declaraciones rectificativas. Si tenéis un caso y tenéis claro cómo funcionan, adelante con los cambios. [SEP] El error actual es:

![image001](https://github.com/user-attachments/assets/5765bd5c-87aa-4b45-96a9-259dd6216d14)
 [SEP] @rafaelbn ese error es porque no se está utilizando el nuevo formato BOE. Si generaron la declaración antes del parche, tendrán puesta esa configuración antigua. Cambiad la configuración y volved a exportar. [SEP] - [x] PR en https://github.com/OCA/l10n-spain/pull/3770 [SEP] Correcto @pedrobaeza . Adicionalmente se necesita en ciertos casos rellenar estas casillas.

https://github.com/OCA/l10n-spain/pull/3770"
Issue,3700,"Error Codigo[4102].El XML no cumple el esquema. Falta informar campo obligatorio.: DesgloseTipoOperacion en el modulo ""l10n_es_aeat_sii_oss""","Hola, cuando voy a enviar la facturas con el IVA OSS de cualquier pais me da el error ""Codigo[4102].El XML no cumple el esquema. Falta informar campo obligatorio.: DesgloseTipoOperacion"". Me podeis indicar si es un error del codigo o no esta bien configurado.

Gracias.
Un saludo.","Es probable que no estés utilizando los impuestos correspondientes del OSS, o que tengas mal gestionado el mapeo en el módulo del SII. No es una incidencia del módulo como tal. [SEP] Hola entonces tengo que mepear los impuestos del OSS en Contabilidad>Configuracion>SII - Mapeo de impuestos. Como se hace con los nuevos impuestos que se crean.¿es correcto lo que indico?


Gracias.
Un saludo."
Issue,3699,Error de validación al actualizar plan contable - La opción IVA requerido debe estar activada [l10n_es_IGIC],"Hola,

Tras instalar correctamente el módulo l10n_es_igic, a la hora de actualizar el plan contable se obtiene el siguiente error:

""La posición fiscal 'EU privado' tiene intrastat establecido en B2B, por lo que la opción 'IVA Requerido' debe estar activada.

La cuestión es que la opción de ""Requiere IVA"" está activada en ""EU privado"".

Para reproducir, tratar de actualizar el plan contable tras instalar el módulo.

Odoo 16.0-20240422 (Versión Community)
Python 3.11.2

Muchas gracias!","Hola, esto no tiene que ver con `l10n_es_igic`, si no con el actualizar (`account_chart_update`). En cualquier caso, simplemente quita la actualización de esa posición fiscal en el listado en el que aparece, en lugar de darle a ""Siguiente"", ""Siguiente"". [SEP] Hola Pedro,

Gracias por la información. No obstante, hemos actualizado el módulo account_chart_update a la última versión pero sigue apareciendo el mismo error al actualizar el plan contable:

""La posición fiscal 'EU privado' tiene intrastat establecido en B2B, por lo que la opción 'IVA Requerido' debe estar activada.

(La opción de ""Requiere IVA"" está activada en ""EU privado"")

¿Sabes cuál podría ser el motivo?

No puedo quitar la actualización de esa posición porque entonces no se actualizaría.

Muchas gracias. [SEP] Desactiva esa casilla manualmente, o en el `account_chart_update` (que hay que ejecutarlo), pongas de no actualizar ese dato."
Issue,3698,Fallo carga certificado AEAT,"**1.- Contexto:**
Odoo 16 corriendo en Docker.
**2.- Prueba**
Al subir un certificado pfx en Certificados AEAT, se visualiza así:
![image](https://github.com/user-attachments/assets/bb0d2a0a-adb6-46c9-a0a9-83882f68e4d8)
Indicó posteriormente nombre al certificado y nombre a la carpeta, y al grabar, muesta esto:
![image](https://github.com/user-attachments/assets/20edba94-2f89-4eb7-a833-e1842ac86d78)
Notar que el nombre del fichero se convierte al tamaño del fichero supuestamente subido....
Posteriormente si intentó obtener claves, e indico la contraseña del certificado sale este error:
![image](https://github.com/user-attachments/assets/f4b7b45e-ea02-4c8d-a4d1-0aebc7fe6486)
Parece ser que el archivo pfx no sube al servidor, y esto es lo que veo en el sistema de archivos:
![image](https://github.com/user-attachments/assets/5a12b16b-e534-4a76-b916-1b5446cdaede)
Como ven, intenta generar los archivos de clave pública y privada, pero no lo consigue por que no dispone del archivo pfx.
No sé si es un bug.

Gracias.

","Prueba a subirlo en formato p12. [SEP] Gracias, Pedro.
No se como obtener un P15.
He conseguido transformarlo a pem, pero tampoco sirve (Could not deserialize PKCS12 data). [SEP] Perdón, era p12. Prueba a utilizar un navegador como Firefox para importar el certificado, y ver si funciona correctamente. Entonces, desde ahí podrás exportar a formato .p12. Básicamente es similar al .pfx, pero para aumentar las posibilidades de compatibilidad. [SEP] Mismo error.
Al cargar, sigo viendo como nombre de archivo, lo que ""ocupa"":
![image](https://github.com/user-attachments/assets/63cc42c9-94fa-42f3-98eb-f1613e67f66b)
Y si intento obtener claves:
![image](https://github.com/user-attachments/assets/80c5e5f2-f8e8-4888-9ba4-02e564ee3204)
Probado con p12 y Firefox.
 [SEP] Bueno, lo de que se vea el tamaño es normal, porque así funciona el widget. Si la importación en Firefox funciona, entonces el problema podría ser de las librerías crypto instaladas. Lista qué versiones tienes de cada librería y fíjate lo que hay en el requirements.txt del repositorio https://github.com/OCA/l10n-spain/blob/16.0/requirements.txt.

En cualquier caso, me temo que esto no es un fallo del módulo, por lo que no se debe continuar aquí en el issue tracker. Si con estas indicaciones no lo consigues, acude por favor al foro https://www.aeodoo.org/forum para solicitar más ayuda."
Issue,3690,Retorno transaccion Ok,"<!-- Provide a general summary of the issue in the Title above.
Before opening the issue, please check that there isn't another issue addressing the same problem already created -->

## Module
payment_redsys

## Describe the bug
En la descripción de la aplicación en Odoo comenta que si hay mas de una base cuando la pasarela de pago envía el formulario a “/payment/redsys/return” odoo no sabe con que base de datos procesar esta información, por lo que hay que establecer los parametros dbfilter y dbname en el archivo de configuración.
Pero como se puede aplicar esto en Odoo.sh
Hoy todas las transaciones que se pasan por Redsys no se confirman en Odoo porque no recibe el ok de transacción
![image](https://github.com/user-attachments/assets/c072561e-718e-4264-8ae4-9e284d738431)
","Hola Matias, nos encontramos con el mismo problema. Pudiste encontrar solución? [SEP] Hola, en mi caso el problema estaba con otro modulo de pagos (Klarna) que capturaba todos los token de pago y no devolvia el estado de la transaccion al modulo de Redsys, corrgiendo esto se solucionó el problema."
Issue,3689,[16] [l10n_es_aeat] Pestaña AEAT visible en dirección privada,"## Module
l10n_es_aeat

## Describe the bug
Cuando accedo a la dirección privada de un contacto mediante un usuario sin permiso Manager AEAT puedo ver la pestaña AEAT.


## To Reproduce
[OCA | [16.0]] [FIX] Pestaña AEAT visible 👤MT-6959 - Watch Video](https://www.loom.com/share/07390fd520fa4f80a77744220ec75d90)

**Expected behavior**
Que la pestaña AEAT este oculta para los usuarios no autorizados.

[Moduon Task - #6959](https://www.moduon.team/web#id=6959&menu_id=256&cids=1&action=387&model=project.task&view_type=form) @moduon ","Hola @fcvalgar , yo creo que es un BUG del módulo, dado que esa pestaña se debería comportar de manera análoga a la pestaña de Contabilidad. Es decir:

Igual que si tengo acceso a la pestaña de Contabilidad veo la pestaña Contabilidad y si no no

Pues

Si tengo acceso como responsable de AEAT veo la pestaña y si no No

Para todos, es un problema de seguridad importante en la parte de protección de datos puesto que si os fijáis si usas el 190 y rellenas datos, como hacemos, ahí salen datos privados de salud como si tienes discapacidad y cosas así... y lo puede ver cualquiera.

¡Gracias! ¡Saludos!

Creo que es un cambio fácil @OCA/local-spain-maintainers que nosotros haremos un PR para que esa pestaña no se muestre si no tienes en el usuario el permiso de AEAT. ¿Os parece OK? Gracias. 😄 ❤️  [SEP] Fix en https://github.com/OCA/l10n-spain/pull/3692.

Si hay campos cuya privacidad es más crítica, decidme cuáles por favor porque hay que añadir una capa extra de seguridad a nivel ORM. [SEP] Se cierra y la discusción continúa en #3692 "
Issue,3688,[16.0] l10n_es_vat_book no refleja correctamente las operaciones de facturas simplificada del pos,"Hola a todos:

Como todos sabeis, he visto las discusiones al respecto en 15.0, y no me queda claro si había una solucion prevista o algún tipo de workaround,  ya he visto que una posible ""solucion"" sería no necesitar el libro de IVA usando l10n_es_pos_sii, pero en el caso de mi cliente, usar el SII es algo que por ahora no quieren hacer, así que esto me deja con la cuestión, es un bug solucionable, o no en el estado actual del asunto en 16?

En caso de que sea solucionable, puedo poner el trabajo de pruebas y programación, pero me fallan conocimientos de base sobre el asunto, en una aproximación naive, seria poco mas que poner el numero de factura simplificado en el libro de IVA, os es algo mucho mas complicado? no busco tanto reportar un bug ( no hay muchas opciones la verdad)  como iniciar una discusión sobre como se podria solucionar el asunto, y no tengo problemas en hacerlo yo mismo, pero necesito claridad..","La forma adecuada de resolverlo sería crear un módulo `l10n_es_vat_book_pos`, que detecta qué apuntes provienen del PoS, y que no los marque como incorrectos por no tener NIF, y además tenga en cuenta las posibles casuísticas de constar como simplificadas, o también resumirlos como agrupados. [SEP] > además tenga en cuenta las posibles casuísticas de constar como simplificadas,

Que casuísticas se pueden producir?

>  o también resumirlos como agrupados.

esto a simple vista parece mucho mas complicado, no iria por esta ruta si no es obligatorio

 [SEP] En cuanto a lo de no dar errores por no tener nif, según deduzco de anteriores conversaciones una manera de solucionar este asunto sería por la ruta de pos_default_partner, y marcar este partner como no Aeat, esto sigue siendo  válido como solución? [SEP] https://github.com/OCA/l10n-spain/blob/d1aaa8aa24889b16df2de25298385e366b5decba/l10n_es_vat_book/models/l10n_es_vat_book_line.py#L39-L41

He visto esto en la revision del asunto, no es dañino, pero tampoco bonito [SEP] > Que casuísticas se pueden producir?

Creo que básicamente que venga indicado que es simplificada, pero no he entrado en detalles.


> esto a simple vista parece mucho mas complicado, no iria por esta ruta si no es obligatorio

Sí, pero sería lo más útil en cuanto a volumen.

> He visto esto en la revision del asunto, no es dañino, pero tampoco bonito

Sí, estaría bien limpiarlo.

> En cuanto a lo de no dar errores por no tener nif, según deduzco de anteriores conversaciones una manera de solucionar este asunto sería por la ruta de pos_default_partner, y marcar este partner como no Aeat, esto sigue siendo válido como solución?

Esto es un workaround, pero lo suyo es tratarlo adecuadamente. [SEP] There hasn't been any activity on this issue in the past 6 months, so it has been marked as stale and it will be closed automatically if no further activity occurs in the next 30 days.
If you want this issue to never become stale, please ask a PSC member to apply the ""no stale"" label."
Issue,3682,[16] [BUG] 10n_es_aeat_sii_oss: Error al enviar al SII ,"Buenos días, tenemos problemas para enviar facturas OSS al SII
1. Hemos instalado los módulos para el SII, SII con importaciones con DUA y SII con OSS
2. En la posición fiscal se informa la clave 17, ""Consumidor final B2C"" y el país.
![posición fiscal](https://github.com/user-attachments/assets/3629424a-7c77-4a41-81f1-435eb7244e15)

3. Hemos creado un contacto genérico por país intracomunitario, informamos que es factura simplificada, anónimo (desconocemos sus datos fiscales) y cliente B2C.
![contacto](https://github.com/user-attachments/assets/e65dd0dc-5db7-4f5e-b781-88535a329d00)
4. Creamos una factura al cliente, donde los impuestos están informados correctamente
![factura](https://github.com/user-attachments/assets/b21d0623-5983-439e-9e89-78421d62ed4a)

5. Al enviar al SII nos aparece el siguiente error de validación  ""Codigo[4102].El XML no cumple el esquema. Falta informar campo obligatorio.: DesgloseTipoOperacion""
![errorSII](https://github.com/user-attachments/assets/4a1b69e9-3551-412c-a3f4-a277384bf721)
![Error SII](https://github.com/user-attachments/assets/bd0d97a1-c41e-4a76-a2ff-88d1887ff0e1)
¿Alguien ha visto esta incidencia o sabe como solucionarlo? Gracias de antemano
","Duplicado con el foro: https://www.aeodoo.org/forum/localizacion-espanola-3/sii-con-oss-1462

Cuando esté claro que es un error real del módulo, se puede reabrir esto.

Ana, no hagas cross-posting. Punto 16 de la FAQ de los foros, que aplica aquí también: https://www.aeodoo.org/forum/localizacion-espanola-3/faq [SEP] Buenos días, nuestro problema se solucionó con la desinstalación de uno de los módulos del estándar para OSS. Después de hacerlo, en ajustes teníamos disponible el wizard que nos permite crear los impuestos necesarios.
![OCA](https://github.com/user-attachments/assets/5ced878c-5035-4856-bc91-9e0541d3da67)
La pista surgió con el comentario de Harald Panten en el foro de Aeodoo, al cuestionar el formato de los impuestos disponibles.
Muchas gracias a todos

"
Issue,3680,Problemas con el modulo payment_redsys en Odoo16,"Hola,
ante todo muchas gracias por el proyecto.
He instalado un sitio web de comercio electrónico con Odoo16 y al efectuar el pago online
la pasarela Redsys muestra un error 400 al enviar la notificación
![chrome_3yaPiDgnC8](https://github.com/user-attachments/assets/eef38eab-88d8-4337-abfd-57a193401c98)
Luego, el pago no se consuma y el carrito no se vacía
![chrome_nzPwytpzDq](https://github.com/user-attachments/assets/fa04e11e-e829-4c3a-993d-1733cf438cad)
Gracias","He encontrado el problema, se debia a una cuenta obsoleta que se intentaba usar y Odoo en consecuencia devolvía un error 400.
Al cambiar la configuración de la cuenta el pago se procesa con éxito y el carrito se vacía."
Issue,3676,[12.0][l10n_es_aeat_sii] Error '2024 : El valor de ImporteTotal no coincide con el sumatorio de BaseImponible,"En una factura de proveedor con impuestos exentos salta el error ""Error '2024 : El valor de ImporteTotal no coincide con el sumatorio de BaseImponible, CuotaSoportada, CuotaRecargoEquivalencia e ImporteCompensacionREAGYP""

<img width=""1480"" alt=""Captura de pantalla 2024-07-22 a las 18 48 44"" src=""https://github.com/user-attachments/assets/1b69fff3-2afa-4515-8660-638360aedda1"">

El JSON enviado:

{
    ""IDFactura"": {
        ""IDEmisorFactura"": {
            ""NIF"": ""xxxxxxxx""
        },
        ""NumSerieFacturaEmisor"": ""12xxxx49-A"",
        ""FechaExpedicionFacturaEmisor"": ""25-04-2024""
    },
    ""PeriodoLiquidacion"": {
        ""Ejercicio"": 2024,
        ""Periodo"": ""06""
    },
    ""FacturaRecibida"": {
        ""TipoFactura"": ""F1"",
        ""ClaveRegimenEspecialOTrascendencia"": ""01"",
        ""DescripcionOperacion"": ""factura de proveedor | [Notario] Notario - [Otros Servicios] Otros Servicios"",
        ""DesgloseFactura"": {
            ""DesgloseIVA"": {
                ""DetalleIVA"": [
                    {
                        ""TipoImpositivo"": ""21.0"",
                        ""BaseImponible"": 75.6,
                        ""CuotaSoportada"": 15.88
                    },
                    {
                        ""TipoImpositivo"": ""0.0"",
                        ""BaseImponible"": -73.1,
                        ""CuotaSoportada"": 0.0
                    }
                ]
            }
        },
        ""Contraparte"": {
            ""NombreRazon"": ""xxxxxx"",
            ""NIF"": ""xxxxxxxM""
        },
        ""FechaRegContable"": ""04-07-2024"",
        ""ImporteTotal"": 93.98,
        ""CuotaDeducible"": 15.88
    }
}

Parece que resta los 2.5€ de la base imponible. 
He revisado el mapeo y está correcto.
Se han enviado otras facturas similares con IVA e IRPF sin problema pero esta con el IVA exento da error.

Gracias por la ayuda","Alguna ayuda o pista por donde tirar sobre esto?  [SEP] Nadie se ha encontrado con el problema?
 [SEP] Revisa la tabla de mapeo de impuestos del SII, se está enviando un impuesto con una base de -73.1. Es probable que alguno de los impuestos no los tengas mapeados correctamente. [SEP] Te faltará mapear el impuesto ""IVA Soportado exento (operaciones corrientes)"" en el apartado SFRS del SII. [SEP] There hasn't been any activity on this issue in the past 6 months, so it has been marked as stale and it will be closed automatically if no further activity occurs in the next 30 days.
If you want this issue to never become stale, please ask a PSC member to apply the ""no stale"" label."
Issue,3670,import facturae,"veo que account_invoice_import_facturae ya se quedo en la versión 12 hay alguna cosa parecida para importar facturae ?

en caso de l10n_es_facturae dice que es para creación no dice nada de importar ",Utiliza por favor los foros (https://www.aeodoo.org/forum) para este tipo de preguntas.
Issue,3669,[16.0]verificar con aeat error si hay codigo pais en el IVA,"<!-- Provide a general summary of the issue in the Title above.
Before opening the issue, please check that there isn't another issue addressing the same problem already created -->

## Module
l10n_es_aeat_partner_check

## Describe the bug
no se puede verificar con AEAT si el numero de IVA tiene ES

## To Reproduce
**Affected versions**:
16
http://oca-l10n-spain-16-0-77e0950a9c23.runboat.odoo-community.org/web#action=321&model=res.partner&view_type=kanban&cids=1&menu_id=171

Steps to reproduce the behavior:
1.marcar esto
![image](https://github.com/user-attachments/assets/4536eb88-143a-435e-8702-16f515166110)

2. crear un vendor con Tax ID ESQ0867012G
3. intentar guardar
![image](https://github.com/user-attachments/assets/9d262206-6819-4dfd-96ea-f7f5fbc58337)


**Expected behavior**
deberia ignorar el ES y mirar el resto 

**Additional context**
```

Traceback (most recent call last):
  File ""/opt/odoo/odoo/http.py"", line 1632, in _serve_db
    return service_model.retrying(self._serve_ir_http, self.env)
  File ""/opt/odoo/odoo/service/model.py"", line 133, in retrying
    result = func()
  File ""/opt/odoo/odoo/http.py"", line 1659, in _serve_ir_http
    response = self.dispatcher.dispatch(rule.endpoint, args)
  File ""/opt/odoo/odoo/http.py"", line 1863, in dispatch
    result = self.request.registry['ir.http']._dispatch(endpoint)
  File ""/opt/odoo/addons/website/models/ir_http.py"", line 237, in _dispatch
    response = super()._dispatch(endpoint)
  File ""/opt/odoo/odoo/addons/base/models/ir_http.py"", line 154, in _dispatch
    result = endpoint(**request.params)
  File ""/opt/odoo/odoo/http.py"", line 716, in route_wrapper
    result = endpoint(self, *args, **params_ok)
  File ""/opt/odoo/addons/web/controllers/dataset.py"", line 42, in call_kw
    return self._call_kw(model, method, args, kwargs)
  File ""/opt/odoo/addons/web/controllers/dataset.py"", line 33, in _call_kw
    return call_kw(request.env[model], method, args, kwargs)
  File ""/opt/odoo/odoo/api.py"", line 468, in call_kw
    result = _call_kw_multi(method, model, args, kwargs)
  File ""/opt/odoo/odoo/api.py"", line 453, in _call_kw_multi
    result = method(recs, *args, **kwargs)
  File ""/mnt/data/odoo-addons-dir/l10n_es_aeat_partner_check/models/res_partner.py"", line 101, in write
    partner.aeat_check_partner()
  File ""/mnt/data/odoo-addons-dir/l10n_es_aeat_partner_check/models/res_partner.py"", line 67, in aeat_check_partner
    res = soap_obj.sudo().send_soap(
  File ""/mnt/data/odoo-addons-dir/l10n_es_aeat/models/aeat_soap.py"", line 52, in send_soap
    serv = self.connect_wsdl(service, wsdl, port_name, model)
  File ""/mnt/data/odoo-addons-dir/l10n_es_aeat/models/aeat_soap.py"", line 46, in connect_wsdl
    client = self.connect_soap(wsdl, model)
  File ""/mnt/data/odoo-addons-dir/l10n_es_aeat/models/aeat_soap.py"", line 38, in connect_soap
    client = Client(wsdl=wsdl, transport=transport, plugins=[history])
  File ""/opt/odoo-venv/lib/python3.10/site-packages/zeep/client.py"", line 73, in __init__
    self.wsdl = Document(wsdl, self.transport, settings=self.settings)
  File ""/opt/odoo-venv/lib/python3.10/site-packages/zeep/wsdl/wsdl.py"", line 92, in __init__
    self.load(location)
  File ""/opt/odoo-venv/lib/python3.10/site-packages/zeep/wsdl/wsdl.py"", line 95, in load
    document = self._get_xml_document(location)
  File ""/opt/odoo-venv/lib/python3.10/site-packages/zeep/wsdl/wsdl.py"", line 155, in _get_xml_document
    return load_external(
  File ""/opt/odoo-venv/lib/python3.10/site-packages/zeep/loader.py"", line 79, in load_external
    content = transport.load(url)
  File ""/opt/odoo-venv/lib/python3.10/site-packages/zeep/transports.py"", line 122, in load
    content = self._load_remote_data(url)
  File ""/opt/odoo-venv/lib/python3.10/site-packages/zeep/transports.py"", line 134, in _load_remote_data
    response = self.session.get(url, timeout=self.load_timeout)
  File ""/opt/odoo-venv/lib/python3.10/site-packages/requests/sessions.py"", line 602, in get
    return self.request(""GET"", url, **kwargs)
  File ""/opt/odoo-venv/lib/python3.10/site-packages/requests/sessions.py"", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File ""/opt/odoo-venv/lib/python3.10/site-packages/requests/sessions.py"", line 703, in send
    r = adapter.send(request, **kwargs)
  File ""/opt/odoo-venv/lib/python3.10/site-packages/requests/adapters.py"", line 639, in send
    self.cert_verify(conn, request.url, verify, cert)
  File ""/opt/odoo-venv/lib/python3.10/site-packages/requests/adapters.py"", line 350, in cert_verify
    raise OSError(
OSError: Could not find the TLS certificate file, invalid path: /opt/certificates/publicCert.crt

The above server error caused the following client error:
null
```
",La traza que aparece en tu reporte no tiene nada que ver con que tenga el `ES` o no lo tenga. El problema es que no tienes configurado el certificado.
Issue,3668,[16.0] l10n_es_atc_dua,"Las importaciones en Canarias  son equivalentes a las de territorio peninsular, con la diferencia que las extracomunitarias y comunitarias tienen similar tratamiento, por tal motivo la posición fiscal Régimen Extracomunitario Islas Canarias  creo que complica gestión de las importaciones.

La solución pasaría por dar el mismo tratamiento que se da a las importaciones con DUA en territorio peninsular

Podríamos  implementar un l10n_es_atc_dua con la misma estructura del  l10n_es_dua

tal como se encuentra aquí:
 [ InfinityLoop-Sistemas-S-L:16.0-l10n_es_atc_dua
](https://github.com/InfinityLoop-Sistemas-S-L/l10n-spain/tree/16.0-l10n_es_atc_dua)

Ya lo valoran  @pedrobaeza @HaraldPanten","Puesto que está el PR #3667, no es necesario tener también una issue, así que cierro."
Issue,3660,Cambios en Redsys,"Hola,

En principio por lo que intepreto yo, no nos afecta: https://sis-d.redsys.es/sis/CAs/comunicadoCertificado.html

Pero por si acaso lo pongo porque a veces varios ojos ven más que uno.

Saludos","Efectivamente, no está afectado, porque nosotros redirigimos a la página de la propia Redsys, así que cierro. Gracias por comentarlo en cualquier caso."
Issue,3650,l10n_es_vat_prorate: cambio de licencia a LGPL,"Hola @etobella @pedrobaeza ,

¿Pensáis que podemos cambiar la licencia de AGPL a LGPL?

Tenemos un caso que usa Odoo Assets de Odoo SA y no de OCA, pero la aplica la prorrata del IVA

Entonces tenemos 2 opcinoes:

1) Que este módulo https://github.com/OCA/l10n-spain/tree/16.0/l10n_es_vat_prorate pase a ser LGPL
2) Que nosotros u Odoo desarrolle la prorrata de IVA en el CORE l10n_es

Me decís por favor

Gracias
Saludos,
Rafa

@moduon MT-6620 ping @yajo @edlopen ","Y por que necesitais que sea LGPL?

No deberiais necesitar un glue module [SEP] A ver, por mi parte, no veo la necesidad de cambiar la licencia. Si no se necesita un glue module, se pueden usar ambos módulos. En caso contrario, está el account_asset_management de OCA :wink: 

Sobre portar la funcionalidad a Odoo, pues lo que vosotros queráis (teniendo en cuenta que estamos hablando de contabilidad, supongo que Odoo dirá que a EE... además, no tengo claro como ligará con su sistema de presentación de impuestos o con el propio SII...), pero recordad que los mismos mecanismos no deberian usarse, ya que seria incumplimiento de licencia. [SEP] Hola @etobella ,

Por que es el módulo base de la prorrata de IVA y si no usas los activos de OCA y usas los de Odoo no puedes adaptar los activos de Odoo a la prorrata para que te cree el activo por el valor adecuado si la factura de proveedor tiene prorrata.

Como te digo tenemos estas 2 opciones para darle salida porque para nosotros no es una opción usar los activos de OCA 😄 , que están genial, pero siempre que podemos usamos lo que tiene Odoo y ampliamos lo que no tiene.

Ya me decís para si esta vía no sirve hablar con Odoo para solucionarlo en CORE.

¡Mil gracias!

Abrazos,
Rafa [SEP] Hablalo con core, a mi la licencia me parece correcta tal y como está, además siempre podéis optar por los assets de OCA."
Issue,3647,AVISO: Rama 17.0 empujada forzada,"Debido a que el bot empujó un archivo DEB de 30 MB:

https://github.com/OCA/l10n-spain/commit/6ab2763cbef17f2a81528e7564ddf36ce870ad79#diff-de4e69c46f94e742c70468b9e0f08ebc21bf93aa8a5b98463faf63effa1e7c8a

que provoca esa sobrecarga cada vez que se hace un `fetch` de la rama, o peor, un `pull` en cualquier rama, se ha eliminado dicho archivo en el commit origen, y se ha hecho un push forzado para no tener que desperdiciar esos recursos cada vez que alguien descargue el repositorio.

Si se hubiera eliminado de forma normal, significaría el doble de tamaño (~60 MB), ya que serían 30 MB de diff para añadirlo, y otros 30 MB de diff para quitarlo.

Si se mantiene una copia del repo en local, la forma de actualizarlo es:

- `git fetch origin 17.0`
- `git reset --hard origin/17.0`

Gracias por la comprensión y perdonad las molestias.",Cierro ya después de un tiempo publicado.
Issue,3641,[16.0] instalando l10n_es_aeat_mod123 da un error no encuentra  account_tax_template_p_irpf19cs ,"```
2024-06-21 09:34:58,678 124 INFO xxxx odoo.modules.loading: loading l10n_es_aeat_mod123/data/2024/tax_code_map_mod123.xml 
2024-06-21 09:34:58,682 124 ERROR xxxx odoo.tools.convert.init: Could not eval([(4, ref('l10n_es.account_tax_template_p_irpf19cs'))]) for tax_ids in {} 
20

```

He comprobado contra una ultima version de todo, he buscado ese id y solo estan las 2 referencias del modulo que falla, no donde se crea..","Debes actualizar todo el código, no solo el de OCA/l10n-spain. En este caso, tienes código obsoleto de odoo/odoo. Y claro, actualizar los módulos en la BD correspondiente. [SEP] Glups, gracias, tienes toda la razon era el odoo,  disculpas por el ruido"
Issue,3636,"[17.0] l10n_es_partner , address doesnt show in reports if partner has commercial name ","L10n_es_partner

If commercial name is defined, adress is not showed in reports.

To reproduce, just configure a partner qith commercial name and print a report.
",Same issue here [SEP] Resuelto en #3872 
Issue,3627,[16.0] l10n_es_facturae Problema de Signos con Facturas Rectificativas,"Tengo un error con las Facturas Rectificativas.

En la sección de errores conocidos pone que:

""No está soportada la exportación de facturas rectificativas. Fallan las series.""

No he notado algo con las series, pero he notado una discrepancia extraña en los importes en el XML; no sé si es normal, aquí un Ejemplo:

```
> <InvoiceTotals>
> <TotalGrossAmount>720.00</TotalGrossAmount>
> <TotalGrossAmountBeforeTaxes>720.00</TotalGrossAmountBeforeTaxes>
> <TotalTaxOutputs>-151.20</TotalTaxOutputs>
> <TotalTaxesWithheld>-0.00</TotalTaxesWithheld>
> <InvoiceTotal>871.20</InvoiceTotal>
> <TotalOutstandingAmount>871.20</TotalOutstandingAmount>
> <TotalExecutableAmount>871.20</TotalExecutableAmount>
> </InvoiceTotals>
```

Al intentar subir a FACE, justamente dice :

El importe total 871.2 debe ser igual al importe bruto antes de impuestos (720) más impuestos repercutidos (-151.2) menos impuestos retenidos (0) HAP/1650/2015 [msg6008]

¿Me da la impresión que hay un error con los signos en las facturas rectificativas?

Me parece curioso que aparece la base imponible y el total en positivo, pero los impuestos en negativo. (De nuevo es una Factura Rectificativa (de abono), no tengo claro si debería ir todo negativo, o todo positivo y el sistema ya indica que es rectificativa.

¿Alguien sabe algo al respecto?

Saludos,","@ramiadavid es esto lo que tú te encontraste en la migración a 17.0? [SEP] @pedrobaeza si, creo que si [SEP] @emedina-mts echa un vistazo a estos cambios:

https://github.com/OCA/l10n-spain/pull/3529/commits/62b30b88c233e1f783c4d8cb7e90e9f74be57dbe#diff-dddf5901fd999ae3d0c986925b1d6d86981f36753f3f607c6ec6c6299d44e312R197

y si los llevas a 16 y funciona, estaría bien que hicieras un PR para resolverlo en esta versión. [SEP] There hasn't been any activity on this issue in the past 6 months, so it has been marked as stale and it will be closed automatically if no further activity occurs in the next 30 days.
If you want this issue to never become stale, please ask a PSC member to apply the ""no stale"" label. [SEP] @emedina-mts hola, cuando hice la migración a la v17 (creo que era esa) ya lo comenté y lo modifiqué para esa versión, porque habia un problema en los tests y no se estaban ejecutando y por tanto no se detecta a el fallo, yo sugerí que había que revisarlo en versiones anteriores. Porque no tenia claro si los signo tenian que ser todos en negativo o todos en positivo, simplemente modifique el xml para que los tests no dieran error, porque asumí que los tests estaban correctos y en la pagina de hacienda aparentemente de las dos formas las validaba correctamente

Aunque ahora no recuerdo donde lo comenté porque no encuentro los comentarios, pero si buscas el pr de la migración y miras los cambios hechos en el xml, verás que se han hecho cambios justamente para eso [SEP] #4012 incluye el parche para los signos."
Issue,3624,[BUG][15.0] l10n_es_ticketbai_pos cerrar sesión con factura cancelada ,"No es un problema exactamente del POS pero se da una situación bloqueante cuando utilizas POS y Ticketbai

En una sesión de POS emites una factura a un cliente.
ANTES de cerrar la sesión de POS cancelas dicha factura por alguna razón X.
Posteriormente al cerrar la sesión del POS, hay una comprobación que impide cerrar la sesión si hay facturas que no están en estado  ""Posted"".

https://github.com/OCA/OCB/blob/dd2da708bc4a42bba9670b874282a2206d8f5ffe/addons/point_of_sale/models/pos_session.py#L203

Al tener instalado TicketBAI, dicha factura no puede ser devuelta a la situación de ""Posted"" de ninguna manera. 
Por restricciones en la operativa se han quitado las opciones de devolver a borrador una factura.

Lo planteo aquí porque no se cual sería la manera más adecuada se subsanar este problema.

Lo primero que se me ocurre es reescribir en el módulo [l10n_es_ticketbai_pos] para que también permita cerrar la sesión con facturas en estado cancelada.

Saludos 😅","There hasn't been any activity on this issue in the past 6 months, so it has been marked as stale and it will be closed automatically if no further activity occurs in the next 30 days.
If you want this issue to never become stale, please ask a PSC member to apply the ""no stale"" label."
Issue,3622,[14.0] Errores en l10n_es_payment_order_confirming_aef,"Hola!

Desde la actualización más reciente hecha al modulo de Confirming, la manera de la que salen los ficheros ha cambiado, con 2 errores principales:

1. La cuenta de la compañía ahora sale sin el IBAN.
2. Si algún proveedor en la remesa es de un país diferente a España, pero tiene una cuenta bancaria en un banco español, en el archivo sale como que la cuenta tiene el mismo país que el contacto y no debería ser así.

Adjunto un archivo de prueba que hice en Runbot para un proveedor irlandés con cuenta en Ibercaja.

Es posible que nos falte algo por configurar correctamente, o que se trate de un bug, alguno lo tenía detectado? @pedrobaeza 
[PAY0001.txt](https://github.com/user-attachments/files/15532603/PAY0001.txt)


Un saludo","Esto no ha cambiado, ya que nunca ha exportado el IBAN completo. Se está revisando si incluirlo si es compatible con todos aquí: https://github.com/OCA/l10n-spain/pull/3332"
Issue,3610,[16.0] l10n_es_aeat_sii_oca: create reversal from model other than account.move,"<!-- Provide a general summary of the issue in the Title above.
Before opening the issue, please check that there isn't another issue addressing the same problem already created -->

## Module
l10n_es_aeat_sii_oca

## Describe the bug
When I try to create a reversal from an other model, this module try to open an invoice with the active_id which is the id of the current model and not an account.move id

## To Reproduce
**Affected versions**: 16.0

Steps to reproduce the behavior:
_Bug is identified with an OE module: helpdesk_account_
1.From a helpdesk.ticket, a button 'Refund' is added, which calls the wizard account.move.reversal

**Result**: Access Error: Due to security restrictions, you are not allowed to access 'Journal Entry' (account.move) records....
Trying to open an account.move with the id of the current helpdesk.ticket

**Expected behavior**
Only call the specific process when coming from account.move model
","Fixed with PR #3609  [SEP] Closing the issue as there's a PR. Next time, you only need to put the PR explaining the issue there."
Issue,3607,[14.0] l10n_es_aeat_sii_invoice_summary: invalid path,"Git da error con el fichero:
error: invalid path 'setup/l10n_es_aeat_sii_invoice_summary/odoo/addons/l10n_es_aeat_sii_invoice_summary~98ccc3435 ([MIG] l10n_es_aeat_sii_invoice_summary: Migration to 14.0)'

Es decir, [éste](https://github.com/OCA/l10n-spain/blob/ac6637c7e361d0cee2aa99ce578a0e0644c90ea9/setup/l10n_es_aeat_sii_invoice_summary/odoo/addons/l10n_es_aeat_sii_invoice_summary~98ccc3435%20(%5BMIG%5D%20l10n_es_aeat_sii_invoice_summary%3A%20Migration%20to%2014.0)#L1)

Entiendo que se ha colado en #3588 ","No uso todo el tema del pip y los artificios del setup que hace el pre-commit, pero borrando la carpeta del setup y lanzado pre-commit de nuevo, ha salido esto que debe solucionarlo:

https://github.com/OCA/l10n-spain/commit/8f6f52b14c12c98700cd25d4c0b007303991d036"
Issue,3605,Prorrata de IVA según la actividad de una misma compañía (Prorrata Especial de IVA),"**Contexto:**

- Trabajamos con nuestra Compañía 1
- La Compañía 1 está sujeta a prorrata de IVA.
- La Compañía 1 realiza varias actividades (pongamos actividad 1 y actividad 2).
- Cuando hacemos adquisiciones relacionados con la actividad 1, SÍ se debe aplicar prorrata.
- Cuando hacemos adquisiciones relacionados con la actividad 2, NO se debe aplicar prorrata.

**Casos posibles:**

1- Se da el caso en que se lleva a cabo una adquisición, en la que toda la factura pertenece a la actividad 1, por lo que **SÍ debería aplicar prorrata a toda la factura.**
2- Se da el caso en que se lleva a cabo una adquisición, en la que toda la factura pertenece a la actividad 2, por lo que **NO se debería aplicar la prorrata en ningún esta factura.**
3- En una misma factura, se pueden mezclar adquisiciones para actividad 1 y para actividad 2. Por este motivo, **habrá apuntes que sí se verán afectados por la prorrata y otros que no** (dentro de la misma factura).

**Menciones especiales:**

- _Trabajamos en un entorno multicompañía._
- Utilizamos SII en alguna compañía.

**Propuestas posibles** (y menciono las descartadas):

- **Flag en factura** para la misma pueda estar sujeta/no sujeta a prorrata --> Descartada ya que se puede dar el caso 3 en el apartado ""Casos posibles"".
- **Flag en posición fiscal** para que la factura pueda estar sujeta/no sujeta a prorrata --> Descartada ya que se puede dar el caso 3 en el apartado ""Casos posibles"".
- **Nuevos impuestos soportados** prorrateado para diferenciarlos de los IVA soportados habituales --> Descartado completamente.
- **Flag en apunte contable** --> El impuesto aplicado en un apunte (y que sea susceptible de prorratearse, `with_vat_prorate=True`) se prorrateará o no. Sería una posibilidad.

**Info adicional:**

- Esta necesidad ya surgió aquí (aunque se planteó de otro modo) --> https://github.com/OCA/l10n-spain/pull/3360
- Este comentario es el que puede aportar algo de luz, con las propuestas posibles --> https://github.com/OCA/l10n-spain/pull/3360#issuecomment-1884796555

@pedrobaeza Hace unos meses participaste en el hilo. Qué opinas? Nuestra idea es hacer algo genérico y sostenible en la localización, para no tenerlo en un custom.

Gracias.","Creo que el flag a nivel de account.move.line es la opción más factible. Pero el actual `with_vat_prorate` se utiliza para otro fin, que es para marcar el apunte generado por el sistema que es la parte de la cuota del impuesto que no se deduce.

Ese flag podría ser un computed writable y llamarse `apply_vat_prorate`, y que se cambie solo según los impuestos puestos o el producto. Desplazaríamos la lógica que se mira ahora mismo de qué impuestos y cuentas aplican la prorrata o no a este nuevo campo, y simplificaríamos el `_compute_all_tax` a solo mirar si tiene dicho campo marcado o no.

@etobella también debe opinar aquí, que él tocó bastante este módulo en 14.0 [SEP] Gracias Pedro,

Perfecto, a ver si Enric puede corroborar la idoneidad del cambio. [SEP] A ver, mi conocimiento de la prorrata es el siguiente:

Existen 3 tipos de empresas

- Empresas normales
- Empresas con prorata general (se aplica la prorrata en todas las facturas de compra)
- Empresas con prorata especial (es el caso que explicas)

Todo lo que comentas afecta a la prorata especial. En la especial, al recibir una factura pueden darse 3 casos (de hecho debería hacerse línea a línea):

1- La factura no aplica prorrata - Actividad 2
2- Aplico la prorrata (o sea, que un porcentaje va a gastos directamente) - no queda claro que actividad es
3- Toda la factura va a gastos - Actividad 1

Por lo tanto, lo que debería hacerse a nivel de apunte es poner un campo de selección (en blanco seria aplica prorata general) Este campo solo deberia aparecer si la compañía tiene el flag de ""Prorata especial"" (así no cambia nada para la general)

WDYT? [SEP] Bueno, realmente puede ser prorrata general, pero hablar de líneas de negocio. @AlbertCabedo es el caso de AEOdoo, ¿no? ¿O eso se considera prorrata especial? [SEP] > A ver, mi conocimiento de la prorrata es el siguiente:
> 
> Existen 3 tipos de empresas
> 
> * Empresas normales
> * Empresas con prorata general (se aplica la prorrata en todas las facturas de compra)
> * Empresas con prorata especial (es el caso que explicas)
> 
> Todo lo que comentas afecta a la prorata especial. En la especial, al recibir una factura pueden darse 3 casos (de hecho debería hacerse línea a línea):
> 
> 1- La factura no aplica prorrata - Actividad 2 2- Aplico la prorrata (o sea, que un porcentaje va a gastos directamente) - no queda claro que actividad es 3- Toda la factura va a gastos - Actividad 1
> 
> Por lo tanto, lo que debería hacerse a nivel de apunte es poner un campo de selección (en blanco seria aplica prorata general) Este campo solo deberia aparecer si la compañía tiene el flag de ""Prorata especial"" (así no cambia nada para la general)
> 
> WDYT?

Correcto, Enric. Entonces la propuesta (sin entrar en detalles técnicos ya que no es este mi foco) podría ser:

1- Check en compañía para establecer si se rige por prorrata especial (solo si tiene prorrata marcado).

2- En caso de que la compañía tenga prorrata especial, en los apuntes contables habrá el check para decidir si se aplica prorrata especial. Si el check de los apuntes no está marcado y la compañía se rige por prorrata especial, los IVA soportados funcionarán SIN prorrata (es decir, un impuesto soportado ""normal"") .

- Ese es nuestro caso, en una misma factura hay impuestos soportados que se comportan SIN prorrata, pero hay apuntes con IVA soportado a los que SÍ se debe aplicar prorrata.

2.1- Si la compañía no tiene marcado prorrata especial (pero sí prorrata) se comportará como hasta ahora con prorrata general.

2.2- Obviamente, si la compañía no tiene prorrata, se comportará normalmente. No se verá sujeta a esta casuística.

3- He aquí otra pregunta... lo haríais en el mismo módulo? O en una extensión del tipo `l10n_es_vat_prorate_special` o similar? Personalmente creo que un nuevo módulo sería lo más adecuado, para simplificar el código del `l10n_es_vat_prorate` estándar.

WDYT?
 [SEP] No puede ser un check en la línea, pk hay 3 casos distintos:

- Aplica prorata
- Todo va a gastos
- todo normal

Te lo pongo con un ejemplo:

Supongamos que tenemos una compañía 2 actividades: Consultoria y Formación y que tiene una prorata del 30%. Y tengo un único centro de trabajo.

Supongamos que recibo la factura de luz. Como no se a que actividad va, tengo que aplicar mi prorata. O sea, del IVA podremos desgravar el 30% y el otro 70% irá directamente a gastos

Ahora recibo una factura de mesas. Si las mesas son para la parte de consultoria, no aplica la prorata y todo lo podremos desgravar.

Si la factura de mesas fuera para usar en las aulas, al ir a la actividad de educación, no puedo desgravarme los gastos. [SEP] > No puede ser un check en la línea, pk hay 3 casos distintos:
> 
> * Aplica prorata
> * Todo va a gastos
> * todo normal
> 
> Te lo pongo con un ejemplo:
> 
> Supongamos que tenemos una compañía 2 actividades: Consultoria y Formación y que tiene una prorata del 30%. Y tengo un único centro de trabajo.
> 
> Supongamos que recibo la factura de luz. Como no se a que actividad va, tengo que aplicar mi prorata. O sea, del IVA podremos desgravar el 30% y el otro 70% irá directamente a gastos
> 
> Ahora recibo una factura de mesas. Si las mesas son para la parte de consultoria, no aplica la prorata y todo lo podremos desgravar.
> 
> Si la factura de mesas fuera para usar en las aulas, al ir a la actividad de educación, no puedo desgravarme los gastos.

Hola Enric, lo que comentas sobre la opción de ""Todo va a gastos"".

Según lo que tengo entendido y nuestro caso:

- Aplica prorrata --> Ese apunte (esa línea de factura) si es para actividad que prorratee, se le desglosará el impuesto en 2 apuntes. Uno como IVA soportado ""normal"", y otro como más valor de la base, para entendernos (un apunte en la cuenta de gastos).
- Todo normal --> Se comporta como un IVA soportado sin prorrateo.
- Todo va a gastos --> Este punto no lo entiendo. ¿Qué quieres decir que va todo a gastos?

En una misma factura, yo tengo los casos 1 y 2. ""Aplica Prorrata"" y ""Todo normal"" respectivamente.

Me falta por entender el caso de una línea de factura en la que ""Todo vaya a gastos"". ¿A qué te refieres?

Gracias. [SEP] Me refiero a que ese IVA no serà desgravable y debe ir todo a gasto (como si tuvieras una prorata del 0%) [SEP] > Me refiero a que ese IVA no serà desgravable y debe ir todo a gasto (como si tuvieras una prorata del 0%)

Pero para eso ya tendríamos el IVA no deducible. Por lo que no veo necesario que haya 3 opciones:

- IVA Soportado habitual.
- IVA Soportado que sí se deba prorratear.
- Todo gasto --> Se puede resolver con los IVA soportados no deducibles, que ya existen.

¿Me equivoco? ¿O estamos mezclando conceptos? [SEP] y que haremos con los casos raros como el IVA de Bienes de inversión? [SEP] Pongamos un ejemplo.

**Contexto:**

- Soy la Compañía 1.
- Llevo a cabo varias actividades. Unas afectadas por prorrata y otras no, por lo que me veo sujeto a la prorrata especial.
- Actividad 1 = Afectada por prorrata.
- Actividad 2 = NO afectada por prorrata.

Caso de uso:

- Me llega la factura mensual de mi proveedor 1, quien me agrupa muchos conceptos en una misma factura.
- En su factura tengo productos con IVA soportado.
- Pongamos que hay 2 conceptos/productos en esa factura.
- El IVA de estos productos, debo interpretarlos según mi actividad, resumidamente:

1. Este producto es para mi sector de actividad NO afectado por la prorrata.
2. Este producto es para mi sector de actividad SÍ afectado por la prorrata.

Resolución. Cómo entraría la factura en el sistema:

- En la línea del producto 1, no marcaría el check de prorrata especial, por lo que no se vería afectado por la prorrata. Sería un IVA soportado habitual.
- En la línea del producto 2, marcaría el check de aplicar prorrata especial, ya que en esta línea sí querría aplicar la prorrata del IVA. Esto me haría 2 apuntes contables: uno que se llevaría la prorrata a la cuenta de impuesto y otro que cogería la misma cuenta que la base (lo que te hage la funcionalidad de la prorrata, para entendernos).

Este sería un caso de factura con IVAs con prorrateo y sin prorrateo en la misma factura. El caso que me comentas tú, entiendo que se diferenciaría de los productos 1 y 2, ¿correcto? [SEP] correcto @pedrobaeza . 
Según mi punto de vista, hablais todos de lo mismo y estáis todos alineados. Respecto a un posible desarrollo entiendo lo siguiente:
1) si el gasto no es deducible, ya tenemos el Impuesto creado para ello, no hay que hacer nada
2) Si el gasto es deducible 100%, ya tenemos el impuesto creado para ello, no hay que hacer nada.
3) Aqui está el tema, si el gasto es ""común"" en ambas actividades, por ejemplo, el asesor, el abogado, o la luz, entonces se aplica prorrata en estos gastos. Se puede crear un impuesto para ellos o bien desarrollar alguna casilla u opción que permita aplicar prorrata a dichos gastos.

Como digo, todos decís lo mismo y estáis en lo cierto, cualquier cosa o aclaración un meet de 5 minutos y lo resolvemos seguro. gracias y buen finde! [SEP] Gracias @AlbertCabedo creo que ya tenemos un punto en común y pueden empezar a desarrollarlo.

@eantones puede que esto te interese  [SEP] > correcto @pedrobaeza . Según mi punto de vista, hablais todos de lo mismo y estáis todos alineados. Respecto a un posible desarrollo entiendo lo siguiente:
> 
> 1. si el gasto no es deducible, ya tenemos el Impuesto creado para ello, no hay que hacer nada
> 2. Si el gasto es deducible 100%, ya tenemos el impuesto creado para ello, no hay que hacer nada.
> 3. Aqui está el tema, si el gasto es ""común"" en ambas actividades, por ejemplo, el asesor, el abogado, o la luz, entonces se aplica prorrata en estos gastos. Se puede crear un impuesto para ellos o bien desarrollar alguna casilla u opción que permita aplicar prorrata a dichos gastos.
> 
> Como digo, todos decís lo mismo y estáis en lo cierto, cualquier cosa o aclaración un meet de 5 minutos y lo resolvemos seguro. gracias y buen finde!

Gracias Albert. Nos has despejado las dudas.

@pedrobaeza @etobella Entonces propongo lo que ya he comentado antes (sin entrar en detalles, sino a nivel conceptual):

1- Check en compañía para establecer si se rige por prorrata especial (solo visible/seleccionable si la compañía tiene prorrata marcado).

2- En caso de que la compañía tenga prorrata especial, en las líneas de factura (y en los apuntes) habrá la posibilidad de marcar un check (`ya pensaremos si default=True o si default=False`). Yo optaría porque pueda ser seleccionable `default=True/False` según la compañía, pero eso ya es más un detalle de UI.

- Este check solo será visible/seleccionable si la compañía tiene marcada la opción de prorrata especial.
- Este check servirá para decidir si el IVA aplicado a esta línea de factura (y en los apuntes) se prorratea o no se prorratea.
- En caso de estar marcado, el IVA se prorratea (SÍ se aplica prorrata).
- En caso de estar desmarcado, el IVA soportado se aplicará normalmente (NO se aplica prorrata).

3- Para terminar... ¿Hacemos módulo aparte? ¿O en el mismo módulo? Yo creo que lo más limpio seria hace un `l10n_es_vat_prorate_special` o similar, puesto que es un caso muy poco común.

WDYT?

 [SEP] Creo que no merece la pena separar en 2 módulos. No se gana tanto en este caso. [SEP] OK. Empezamos a planificar la apertura de nuevo PR. A priori, a falta de estudio en detalle:

- Añadir el check en compañía, para determinar si se está afectado por prorrata especial.
- Añadir los cambios necesarios en facturas y apuntes.
- Añadir los cambios necesarios a nivel de UI.
- Ampliar README.
- Añadir tests.

Todo como IMP del módulo ya existente `l10n_es_vat_prorate` [SEP] Ahora que tenemos hecho esto, vamos a hacer comprobaciones en el módulo l10n_es_aeat_mod303_vat_prorate, para validar que todo dé como tiene que dar. [SEP] Implementado."
Issue,3589,Fallo de los tests al conectar a la Hacienda de Gipúzcoa,"En todas las ramas está dando este error:

```
requests.exceptions.ConnectTimeout: HTTPSConnectionPool(host='egoitza.gipuzkoa.eus', port=443): Max retries exceeded with url: /ogasuna/sii/ficheros/v1.1/SuministroFactEmitidas.wsdl (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x7fbeed2ca980>, 'Connection to egoitza.gipuzkoa.eus timed out. (connect timeout=300)'))
```

Parece ser que no está disponible.

Los que tenéis allí SII, ¿sabéis qué puede ocurrir? Tal vez @JuaniFreedoo ?","Por si le arroga luz a alguien: un par de clientes nos lo han reportado pero no pasa desde todas las máquinas. Este comando es equivalente a la llamada que recibe timeout en los tests que mencionas:
```
wget https://egoitza.gipuzkoa.eus/ogasuna/sii/ficheros/v1.1/SuministroFactRecibidas.wsdl -O-
```
En mi PC (por poner un ejemplo) funciona correctamente pero un par de clientes no. No sé si hacienda está baneando determinadas IPs o es un problema de enrutado más general. [SEP] Gracias por la información. Desde mi PC también funciona. A lo mejor como dices han puesto una lista de denegados. Estoy reintentando en estos momentos un CI, y si sigue fallando, voy a excluir la agencia de los tests porque nos está bloqueando todos los PRs, a falta de saber los motivos. [SEP] Nos acaba de llegar esto desde hacienda:

> Buenos días,
>
> Desde la mañana del pasado viernes día 17 estamos teniendo algunos problemas de conectividad. Estamos trabajando para solventarlos en la mayor brevedad posible.
>
> Esta incidencia se tendrá en cuenta, en su caso,  a todos los efectos del cumplimiento de las obligaciones tributarias.
>
> Disculpen las molestias ocasionadas. [SEP] Hacienda Gipuzkoa notifica que los problemas de conectividad ya están resueltos. @pedrobaeza, si lo puedes confirma se podría cerrar este ticket sin problemas. [SEP] Veamos a ver si ya vuelven a funcionar los tests correctamente: https://github.com/OCA/l10n-spain/pull/3602 [SEP] Pues sí, efectivamente ya funciona de nuevo. Lo he dejado restablecido en 16.0, pero para las versiones anteriores creo que lo voy a dejar desactivado como ya tenemos el chivato en caso de que vuelva a fallar, y así no paralizamos tantas ramas en caso de que vuelva a pasar."
Issue,3565,[BUG][15.0] PR 3447 rompe instalaciones existentes,"Modulo: l10n_es_facturae

El PR https://github.com/OCA/l10n-spain/pull/3447 rompe las instalaciones existentes, con este error:

psycopg2.errors.UndefinedColumn: column res_partner.facturae_hide_discount does not exist

Es posible que añadiendo el modulo 'base' a las dependencias se solucione

Reproducir:
Usar l10n_es_facturae version 15.0.8 y actualizar a 15.0.9

","Hola, eso ocurre si actualizas código y reinicias servicio, pero no actualizas módulo dentro de la instancia para que se reflejen los cambios de estructura de la base de datos. Es algo estándar de todo Odoo.

Cierro, al no tratarse de un error del módulo."
Issue,3560,Garante de TicketBAI,"Buenas tardes;

Tengo entendido que para configurar el módulo 10n_es_ticketbai necesitas introducir la licencia de la compañía garante de ticketBAI. Esto hace que me aborden una serie de dudas:

.- ¿La OCA dispone de esa licencia garante ya que ha desarrollado el módulo? ¿Los integradores podemos utilizar esa licencia?

.- ¿Qué solución recomiendan que adoptemos los integradores que queremos utilizar el módulo para nuestros clientes?

Muchísimas gracias.","Hola, OCA no se hace garante de nada.

Tendrá que ser el propio integrador, o en su defecto, el usuario (el cliente) el que se hace garante del software."
Issue,3552,Como reflejar bienes amortizados en el modelo 130?,"Buenas, aclarar primero que soy bastante principiante con Odoo.

¿De qué manera en el modelo 130 (estoy usando la versión para odoo 15 en odoo 16, que aparentemente funciona) se pueden reflejar en los gastos deducibles la parte amortizada en el periodo en vez del gasto total?

He tratado de categorizarlo en IVA 21% Bienes de inversión para probar y sin embargo aparece la cantidad total en el cómputo del modelo 130.

Gracias!","Hola, realiza por favor la pregunta en el foro de AEOdoo (https://www.aeodoo.org/forum), ya que este espacio es para bugs/problemas con el código."
Issue,3551,[16.0] Dependencias en cryptography==3.4.8,"Hola,

La versión 16.0 de los módulos l10n_es_aeat, l10n_es_facturae y l10n_es_facturae_face tienen una dependencia estricta en sus manifests de ""cryptography==3.4.8"" (de 2021), mientras que las versiones 15 y 17 dependen solamente de ""cryptography"".

Estoy probando una migración de v15 a v16; mi sistema de pruebas es una instalación limpia de Debian 12, que a fecha de hoy cuenta con la versión 38.0.4 (de 2022) en sus repos y me encuentro con lo siguiente:

- Instalando Odoo desde el paquete .deb instala a su vez cryptography 38. Odoo funciona bien y puedo importar la BD del sistema antiguo.
- Al tratar de actualizar la BD con openupgrade el proceso falla porque los módulos necesitan la versión específica 3.4.8. Tengo que instalar esa versión con pip3 --user y la actualización se ejecuta correctamente.
- A continuación, todavía con 3.4.8 instalada para el usuario de odoo, el programa falla al arrancar con un error en openssl/crypto por obsolescencia de la versión 3.4.8
- Desinstalando 3.4.8 Odoo vuelve a arrancar con la BD actualizada y en principio funciona, pero imagino que en cuanto haya una actualización a cualquiera de esos módulos la situación volverá a repetirse.

Mi pregunta es: ¿hay algún motivo por el que v16.0 necesita estrictamente 3.4.8, en lugar de p.e. "">=3.4.8""? ¿Se podría corregir los manifests en ese sentido?

También, entiendo que si hay un motivo para exigir 3.4.8 (o mayor) en v16, ese requisito debería seguir ahí para v17 y también convendría corregir esos manifests.


Un saludo.","There hasn't been any activity on this issue in the past 6 months, so it has been marked as stale and it will be closed automatically if no further activity occurs in the next 30 days.
If you want this issue to never become stale, please ask a PSC member to apply the ""no stale"" label."
Issue,3539,[16]  l10n_es_aeat_mod349 -Error de permisos al entrar en facturas tras instalar 349 l10n_es_aeat_mod349 ,"<!-- Provide a general summary of the issue in the Title above.-->
Un usuario con los siguientes permisos:
- Mostrar sólo documentos propios

No puede acceder a sus facturas tras la instalación del módulo l10n_es_aeat_mod349
## Module
l10n_es_aeat_mod349

## Describe the bug
https://www.loom.com/share/c146fdd3d07a4c119d0d7acb00f99123?sid=07c50580-077a-4406-90f6-bf2872c4d40e

## To Reproduce
**Affected versions**: 16

Steps to reproduce the behavior:
1.Explicado en vídeo
2.
3.

**Expected behavior**
Poder acceder a las facturas tras instalar el módulo l10n_es_aeat_mod349 tal y como permite Odoo de forma estándar antes de instalarlo
@moduon MT-5826","Hola Gelo, gracias por el reporte.

¿Solo falla en V16? ¿O te has encontrado lo mismo en V15, por ejemplo?

Saludos. [SEP] Fusionado el FIX --> https://github.com/OCA/l10n-spain/pull/3540"
Issue,3538,[IMP] l10n_es_aeat_mod303: Permitir trasladar la compensación al año siguiente,"En estos momentos cuando se declara el modelo 303 en el 4º trimestre del año, si hay un importe pendiente de compensar la opción que se propone es 'Devolución'. Pero legalmente es posible seguir compensando hasta 4 años.

El campo 'result_type' es ahora mismo calculado. Quizás debería existir un booleano 'Trasladar compensación al siguiente año', que sólo aparezca en el último trimestre?

@OCA/local-spain-maintainers ","Lo tienes en #3534  [SEP] Perdón, #3359, que tengo follón por lo de la separación de PRs."
Issue,3533,[IMP] l10n_es_aeat_mod_216: versión 2024,"Hola,

Según la nueva normativa, el modelo 216 incorpora nuevos cambios

-  https://sede.agenciatributaria.gob.es/Sede/todas-gestiones/impuestos-tasas/impuesto-sobre-renta-no-residentes/modelo-216-irnr______sos-cuenta-declaracion-ingreso_/instrucciones-modelo-216-presentacion-ejercicio-siguientes.html
- https://sede.agenciatributaria.gob.es/static_files/Sede/Disenyo_registro/DR_200_299/archivos_24/216e2024.xlsx

@ArantxaSudon @moduon
MT-5789
","There hasn't been any activity on this issue in the past 6 months, so it has been marked as stale and it will be closed automatically if no further activity occurs in the next 30 days.
If you want this issue to never become stale, please ask a PSC member to apply the ""no stale"" label."
Issue,3527,Gestión de IRPFs y sus posiciones fiscales,"He notado que las posiciones fiscales de IRPF (los correspondientes a autónomos, o sea, 15% y 7%) e IRNR (en este caso entiendo que todos) incluyen impuestos de venta y no tengo claro si tiene sentido.

En principio, los impuestos de IRPF para ventas y compras deberían usarse en los siguientes supuestos:

1- Si soy una empresa: solo debería usar estos impuestos para compras a proveedores de este tipo. Si a uno de estos proveedores les hiciera una factura de venta por algún motivo, no debería haber ningún IRPF. Además, se declarará en el modelo 111 y 190
2- Si soy un autónomo: Debería usar estos impuestos para ventas en caso de que mi cliente sea una empresa. En este caso, si el proveedor me hiciera una factura de compra, no debería llevar IRPF. (No tengo claro donde se presentará en este caso, puede que en el 130?)

En mi opinión, no deberían existir los mapeos en Odoo tal y como están. Probablemente lo más límpio seria dividir y crear una plantilla completamente nueva para autónomos (al estilo asociaciones) con los impuestos de ventas de IRPF y sus posiciones fiscales aunque en su defecto se puede meter directamente en el completo.

¿Cómo lo veis?

@OCA/local-spain-maintainers ","De hecho, mirando el listado de todas las retenciones que existen para la localización española, existen un montón que a dia de hoy no deberían existir. Este es el listado de las retenciones existentes en 2024 segun l'AEAT:

https://sede.agenciatributaria.gob.es/static_files/Sede/Programas_ayuda/Retenciones/2024/Cuadro_tipos_retenciones_IRPF2024.pdf [SEP] There hasn't been any activity on this issue in the past 6 months, so it has been marked as stale and it will be closed automatically if no further activity occurs in the next 30 days.
If you want this issue to never become stale, please ask a PSC member to apply the ""no stale"" label. [SEP] Relacionado con IRPFs, me he encontrado con un caso donde el régimen del contacto es de canarias pero también hay que aplicarle IRPF X% y por lo tanto no lleva IVA. La solución que me viene inmediatamente a la cabeza es una posición fiscal que mapee a impuestos de canarias (**sin IVA**) y además aplique el IRPF. [SEP] There hasn't been any activity on this issue in the past 6 months, so it has been marked as stale and it will be closed automatically if no further activity occurs in the next 30 days.
If you want this issue to never become stale, please ask a PSC member to apply the ""no stale"" label."
Issue,3522,l10n_es_aeat_mod303: tests con demo data en v17,"Se ha detectado que los tests del modulo l10n_es_aeat_mod303 en v17 se están lanzando con datos de demo, lo que provoca que el test test_model_303_negative_special_case falle, al obtenerse resultados no esperados en las casillas 28 y 29.

Concretamente, la factura que provoca el problema es la identificada como demo_invoice_equipment_purchase, generada desde el fichero account_demo.py del módulo account de Odoo.","@HaraldPanten @pedrobaeza  [SEP] > account_demo

https://github.com/odoo/odoo/blob/17.0/addons/account/demo/account_demo.py [SEP] @manuelregidor respecto a esa factura ¿que es diferente o porque realiza que fallen los test? Es algo raro que antes no fallara y ahora si ¿podría haber otra causa? [SEP] @ValentinVinagre Porque aplica en las líneas impuestos que se tienen en cuenta en el 303, por lo que no solamente se genera el informe con los datos creados en los tests del módulo del 303 sino también con los de la info de demo. [SEP] Una solución directa es cambiar la fecha de los datos de los tests para que sea del año pasado, y así no hay solape. [SEP] > Una solución directa es cambiar la fecha de los datos de los tests para que sea del año pasado, y así no hay solape.

Si realizamos eso ¿No podría pasar que no podamos testear correctamente nuevos mapeos de impuestos? 
Es decir: si por ej. tenemos mapeos de esta manera:
mapeo1: 1/1/2010 - 31/12/2020
mapeo2: 1/2/2021 - actual

Aquí se podría poner las facturas de test en fecha 1/1/2021 sin problema. Pero, si entrase un mapeo nuevo por ej:
mapeo1: 1/1/2010 - 31/12/2020
mapeo2: 1/2/2021 - 31/12/2023
mapeo3: 1/1/2024 - actual

Si ponemos las fechas de facturas en años pasados... no podremos testear correctamente esos mapeos actuales. Si no es que para los tests hacemos la jugada de ... dejar siempre el último mapeo y forzar unas fechas específicas correspondiente a los tests.

¿como lo ves?
 [SEP] Ya, claro, ese problema estaba presente en anteriores versiones y de hecho por eso puse la fecha actual y tuve que cambiar el resultado de los tests cuando migré, porque había definiciones de mapeos de impuestos más modernos, pero lo decía como solución inmediata.

Otra opción sería por SQL hacer un borrado de impuestos en las facturas existentes para sin mucha complicación, que no interfieran. [SEP] Veo mejor pensar una solución un poco más a largo plazo, total ahora estamos a tiempo, ya que se está realizando toda la migración y no tenemos clientes con una alta urgencia de estas necesidades.
Por lo que hemos comentado veo las siguientes opciones:

1.- En los test's de los modelos siempre testear el último mapeo, borrar los anteriores y indicar siempre una fecha específica para que no interfiera lo de Odoo. (esta es la que veo que menos problemas nos podría dar y que es la ""las estable"").
2.- Realizar un borrado por sql (o similar) de todos los impuestos aplicados en las facturas creadas por Odoo. Esto ... no me acaba de gustar del todo, ya que se podría interferir en los posibles testeos futuros de otros módulos o si Odoo en un futuro cambia esto... ¿podría ser problemático?
3.- Cambiar fechas en las facturas de los tests actuales.
4.- Cambiar los test's para que de alguna manera se identifiquen las facturas que no tendrían que entrar para los test's de los modelos de OCA. Por ej. ¿en el aeat se podría indicar una función de filtrado de todo esto?

Por el momento veo esto ...  No se si veis alguna opción más. 
 [SEP] 2 no es problemático, porque se deshace todo en cuanto termina el test específico. [SEP] > 2 no es problemático, porque se deshace todo en cuanto termina el test específico.

La idea sería ponerlo en el l10n_es_aeat para que lo recojan el resto de módulos de la l10n-spain de oca o en cada módulo que tenga problemas? [SEP] Se puede poner en el test aeat base. Igualmente lo deshará en cada test hijo que lo herede."
Issue,3521,Recopilación de problemas encontrados con l10n_es_pos_sii,"### Contexto:

* https://github.com/OCA/l10n-spain/tree/16.0/l10n_es_pos_sii
* https://github.com/OCA/l10n-spain/issues/3058

Los envíos al SII desde el `pos.order` se implementaron pensando en que Verifactu requeriría el envío individual de las facturas simplificadas, sin embargo, el Reglamento  ya se aprobó y no aplica a las empresas adheridas al SII:

https://sede.agenciatributaria.gob.es/Sede/normativa-criterios-interpretativos/analisis/2023/diciembre/11/reglamento-verifactu.html
![image](https://github.com/OCA/l10n-spain/assets/46522913/661e4034-17af-4e16-a2f3-6c16a9bbf239)

### Objetivo:

Aparte, llevamos un tiempo usando este módulo en entornos de producción, y en esta tarea quiero plantear todos los prolemas que hemos encontrado (algunos ya se sabían de antes):

**1. Diferencias entre los envíos al SII y la contabilidad**

Si un restaurante abre sesión a las 10:00 horas y cierra a las 01:00 horas, los pedidos registrados desde las 10:00 hasta las 00:00 horas se enviarán al SII con fecha X. Sin embargo, el asiento contable estará con fecha X+1 dado que responde a la fecha de cierre de sesión.

**2. Imposibilidad de corregir errores del SII**

Cuando se nos presenta un error en el SII, por ejemplo, por un impuesto mal indicado en la ficha de producto, y en consecuencia, mal asignado a la `pos.order.line` no existe ninguna opción de corregirlo. Los `pos.order` no se pueden manipular una vez han sido publicados, ni siquiera con el método de importación / exportación. Este punto hace que el usuario sea muy dependiente del implantador / equipo técnico.

**3. Complejidad en la revisión de los envios al SII**
Cuando se acaba un periodo fiscal, lo ideal es que el usuario de contabilidad revise todos los envíos al SII antes de generar el 303 (por ejemplo). Actualmente, hay que revisar:

* Facturas de venta
* Rectificativas de venta
* Facturas de compra
* Rectificativas de compra
* Pedidos de TPV

Para los 4 primeros puntos, solemos hacer uso de https://github.com/OCA/account-invoicing/tree/16.0/account_menu_invoice_refund y así son 2 los menús a revisar y no 4. Sin embargo, imperativamente hay que revisar el menú de pedidos del TPV, con el agravante descrito en el punto 2.

**4. Problemas de conexión y sesiones de rescate**

* Entro en el TPV en un dispositivo A
* Registro pedidos, pero pierde la conexión y no se envían
* Entro en el mismo TPV desde otro dispositivo B y cierro la sesión
* Cuando A recupera la conexión **al día siguiente**, se crea sesión de rescate con pedidos del día anterior.

Mismo problema de fechas que lo comentado en el punto 1.

**5. Diferencias pre-303 y 303 de Odoo**

El pre-303 se completa conforme a los envíos al SII, y el modelo 303 de Odoo conforme a la contabilidad. Existe diferencias en estas casillas:

![image](https://github.com/OCA/l10n-spain/assets/46522913/242c577e-233a-49e6-a863-67cb370aa060)

El pre-303 completara todas esas casillas, mientras que el modelo 303 sólo completa desde la 1 hasta la 9, ya que el asiento agrupado de simplificadas, no diferencia si hay rectificativas (devoluciones).


### Propuesta de solución:

Implementar la opción 2 definida en: https://github.com/OCA/l10n-spain/issues/3058

-------

*** Abro esta tarea para dara conocer y recopilar todos los inconvenientes que hemos encontrado con el uso del módulo, seguramente aportemos la solución en un futuro.

Saludos,

@albertcabedo @pedrobaeza @zamberjo @omar7r



","*** Editado punto 4 y añadido punto 5. [SEP] Hola @SoniaViciana 

Entiendo los problemas que indicas, sobre todo los que tienen que ver con las sesiones que cierran al dia siguiente. Donde los apuntes se van a quedar en una fecha distinta a la del envio del SII de algunas facturas simplificadas.
Lo que no tengo muy claro es la propuesta de solución usando el **l10n_es_aeat_sii_invoice_summary** por que hacer un apunte con el resumen de lo que hay que enviar al SII, ¿supone duplicar la información contable? 
Como dices verifactu ha excluido a las empresas adscritas al SII pero no se hasta cuando van a permitir seguir enviando un asiento resumen a los del SII cuando a los demás les van a exigir enviar todas las facturas...

En cualquier caso, es cierto que hay algunos problemas con esta implementación que habría que revisar, tal vez podríamos esperar a ver la implementación del verifactu en el pos por que habrá que tocar también cosas para enviar cada una de las facturas simplificadas por separado.

Un saludo
 [SEP] Hola @anmarmo1 

En la propuesta de solución, la idea sería no duplicar, si no dotar al asiento agrupado de facturas simplificadas que ya genera el TPV, de la información / lógica faltante para que sea una factura de venta a todos los efectos. Completando a su vez los campos de `l10n_es_aeat_sii_invoice_summary` (primer y último número de factura simplificada).
Sin embargo... esto se tiene que sopesar, porque haría el SII del TPV incompatible con `l10n_es_pos_by_device` (múltiples dispositivos por sesión en el punto de venta). 

Entonces, lo cierto es que hay que pensarse bien qué conviene más, sabiendo los pros y los contras de cada opción (esto es lo que pretendo en este issue). En todo caso, iremos informando. La opción 2 no es algo que tengamos pensado abordar a corto plazo.

Saludos, [SEP] Lo suyo sería que se discutiera esto en los Spanish OCA Days. Sonia, convence a tu jefe para que vayáis para allá... [SEP] There hasn't been any activity on this issue in the past 6 months, so it has been marked as stale and it will be closed automatically if no further activity occurs in the next 30 days.
If you want this issue to never become stale, please ask a PSC member to apply the ""no stale"" label."
Issue,3520,[16.0][IMP] l10n_es_aeat_mod123: Add 2024 version,"Hola 

Según la nueva normativa el modelo 123 incorpora unas nuevas casillas que desglosan el importe total de retenciones e ingresos a cuenta
 [(https://www.boe.es/buscar/doc.php?id=BOE-A-2024-1772)]
![Captura desde 2024-04-11 13-21-43](https://github.com/OCA/l10n-spain/assets/104626993/06f05743-0611-4511-89d4-b01f581c02e6)

Por lo tanto, hay que añadir lo siguiente: 
Se incluye un desglose dentro del importe total de retenciones e ingresos a cuenta, correspondiente a los dividendos y otras rentas de participación en fondos propios de entidades.

El 123 anterior era más resumido, solo con 3 casillas:
![Captura desde 2024-04-11 13-26-59](https://github.com/OCA/l10n-spain/assets/104626993/53c8ddb8-26c5-4b82-9fd3-8b6bdc3434b7)

Con el desglose añadido, se añaden las siguientes casillas: 
![Captura desde 2024-04-11 13-27-10](https://github.com/OCA/l10n-spain/assets/104626993/029effc0-3c7c-4c23-8846-cedcd9fd3c78)

**NUEVAS CASILLAS A AÑADIR EN EL MODELO 123**
**Casilla 01**

Número de rentas. Dividendos y otras rentas

Totales de número de perceptores (se contará por números de NIF)
**Casilla 02**

Número de rentas. Resto de rentas

Totales de número de perceptores (se contará por números de NIF)

Es decir, si se reciben varias facturas de un solo NIF, el número total será 1
**Casilla 03 SUMATORIO** (01+02)

Número de rentas. Totales
**Casilla 04**

Base de retenciones e ingresos a cuenta. Dividendos y otras rentas
**Casilla 05**

Base de retenciones e ingresos a cuenta. Resto de rentas
**Casilla 06 SUMATORIO** (04+05)

Base de retenciones e ingresos a cuenta. Totales
**Casilla 07**

Retenciones e ingresos a cuenta. Dividendos y otras rentas
**Casilla 08**

Retenciones e ingresos a cuenta. Resto de rentas
**Casilla 09 SUMATORIO** (07+08)

Retenciones e ingresos a cuenta. Totales

De las casillas 1,2 y3 se ha hecho consulta en AEAT y nos confirman que se rellenan con el número de perceptores


Moduon - MT-5726
@EmilioPascual ","Detalla de los cambios comentados sobre el 123 en https://github.com/OCA/l10n-spain/issues/3227 [SEP] Gracias @ArantxaSudon @rafaelbn . Abrís PR? [SEP] @HaraldPanten , podemos empezar a trabajar en esto el lunes a primera hora. Esta semana no podemos empezar. [SEP] > @HaraldPanten , podemos empezar a trabajar en esto el lunes a primera hora. Esta semana no podemos empezar.

Sin problema, cuando os vaya bien. Nosotros estamos con la migración a V17. Si os encargáis del nuevo formato en V16, por ejemplo, ya lo añadimos en el PR de migración para la nueva.

Gracias! [SEP] @HaraldPanten PR en https://github.com/OCA/l10n-spain/pull/3528 [SEP] @rafaelbn @HaraldPanten  dejo captura del excell utilizado en V16 para incorporar los cambios por si sirve de ayuda

![Captura desde 2024-04-15 12-20-06](https://github.com/OCA/l10n-spain/assets/104626993/81c42c25-6876-494e-b015-bdf8a8528e73)
 [SEP] Realizado en #3528"
Issue,3518,[16.0] l10n_es_igic: Código de cuenta duplicado,"Hola.

Al seleccionar el paquete ""PGCE entidades sin ánimo de lucro 2008 - Islas Canarias"" en Ajustes/Opciones generales/Contabilidad/Localización fiscal, da el siguiente error: ""No se puede completar la operación: ¡El código de la cuenta tiene que ser único para cada empresa!"".

He revisado el módulo y he visto que la cuenta **""Hacienda Pública, deudora por colaboración en la entrega y distribución de subvenciones (art.12 Ley de Subvenciones""** en el archivo **""account.account.template-common.csv""** tiene el código 4707, al igual que la cuenta **""Hacienda Pública, deudora por IGIC""** en el archivo **""account.account.template-common.csv""**, lo cual está causando el error por la duplicidad de los códigos. Lo mismo ocurre con las cuentas **""Hacienda Pública, acreedora por subvenciones recibidas en concepto de entidad colaboradora (art.12 Ley de Subvencioens)""** y **""Hacienda Pública, acreedora por IGIC""**, ya que ambas tienen el código 4757.

Entiendo que los códigos de las cuentas **""Hacienda Pública, deudora por colaboración en la entrega y distribución de subvenciones (art.12 Ley de Subvenciones""** y **""Hacienda Pública, acreedora por subvenciones recibidas en concepto de entidad colaboradora (art.12 Ley de Subvencioens)""** son erróneos y habría que modificarlos, ¿es así? ¿Por cuáles habría que sustituirlos?

Muchas gracias.","Buenas tardes @greciosd, por lo que he podido comprobar es correcto que ambas cuentas tengan el mismo código, pero claramente no es correcto que ambas se carguen en el paquete ""sin ánimo de lucro"". En el plan general la cuenta 4707 corresponde a ""Hacienda Pública, deudora por IGIC"" y en el plan ""sin ánimo de lucro"" la cuenta 4707 corresponde a ""Hacienda Pública, deudora por colaboración en la entrega y distribución de subvenciones (art.12 Ley de Subvenciones)"". Voy a proponer un PR para sacar las cuentas 4707 y la cuenta 4757 del common, para poder asignarlas a nivel del hijo. [SEP] El PR en concreto: https://github.com/OCA/l10n-spain/pull/3523"
Issue,3514,l10n_es_aeat_mod303: la cuenta bancaria no siempre se notifica en el fichero .txt,"Mejora para 16.0

El modelo 303 presenta un comportamiento inconsistente en el campo de la cuenta bancaria. Según la especificación, este campo debería comportarse de manera específica dependiendo del tipo de resultado, sin embargo, la implementación actual no cumple adecuadamente con esta especificación.

### Comportamiento Actual
- El campo de cuenta bancaria es visible en el formulario cuando el tipo de resultado es D, V, X, I, G o U.
- El campo de cuenta bancaria es obligatorio cuando el tipo de resultado es D, V o X.
![imagen](https://github.com/OCA/l10n-spain/assets/104626797/2777ca10-c164-4a04-a54d-5675afca0e6b)
- Ejemplo: En el caso de que el tipo de resultado sea I, aunque no sea obligatorio, es visible este campo en el formulario, pero no en el fichero.
![imagen](https://github.com/OCA/l10n-spain/assets/104626797/27133298-7fa2-4fbd-abcb-c6b57ea686e1)


### Comportamiento Esperado
- Siempre que se indique la cuenta bancaria, cuando son todos estos tipos de resultados, debería aparecer en el fichero también. 
- Ejemplo: Solo con  el tipo de resultado es D, sí es visible el campo de cuenta bancaria en el fichero. Por lo que debería aparecer también con los otros resultados (V, X, I, G o U)
![imagen](https://github.com/OCA/l10n-spain/assets/104626797/238117bc-91f1-434b-8f8d-74cc6be4d74c) (_imagen de un runbot_)

Loida
Moduon - MT-5662
","Hola, Loia, creo recordar que se quitó porque la AEAT no quería tener el campo rellenado en ese caso. Entonces el parche sería que no fuera visible para el tipo `I`. Probadlo si es correcta mi hipótesis y nos decís. [SEP] Por ahora el tipo ""I"" no es visible. Pero sí debería serlo. Según la AEAT, esta es la nueva normativa: 
![imagen](https://github.com/OCA/l10n-spain/assets/104626797/3d886030-fa3c-44d2-b78b-5455cfbdadf7)
https://sede.agenciatributaria.gob.es/Sede/todas-gestiones/impuestos-tasas/iva/modelo-303-iva-autoliquidacion_/instrucciones.html

Si la opción es a domiciliar, debe estar indicada la cuenta bancaria. 
Ahora el código está así: https://github.com/OCA/l10n-spain/blob/fc2a79ffe96832030fffed3c3d41b251ba63d12c/l10n_es_aeat_mod303/data/2023/aeat.model.export.config.line.csv#L123 (_línea 123; columna: expression_) 
Solo es visible con el `result_type` X y D

Gracias [SEP] OK, pues adelante con el PR si lo tenéis claro."
Issue,3507,[16.0] cryptography wrong version in modules manifest,"<!-- Provide a general summary of the issue in the Title above.
Before opening the issue, please check that there isn't another issue addressing the same problem already created -->

## Module
l10n_es_aeat
l10n_es_facturae

## Describe the bug
There is a wrong version in the manifest from the modules, being in branch 15.0 version not requiered an specific version but in branch 16.0 is required version 3.4.8.
Even if this cryptography version is installed, the modules can't be installed given you an error message that requires the version already installed

## To Reproduce
**Affected versions**: 16.0

Steps to reproduce the behavior:
1. Install Odoo 16
2. Install requirements and l10n_spain
3. Try to install the modules

**Expected behavior**
The modules should be installed

**Additional context**
In 15.0 the manifest from l10n_es_aeat is the following:
    ""external_dependencies"": {""python"": [""unidecode"", ""cryptography""]},
    
While in 16.0 is the following:
    ""external_dependencies"": {""python"": [""unidecode"", ""cryptography==3.4.8""]},
","@etobella si no recuerdo mal, lo incluiste tú para evitar una incompatibilidad. [SEP] No entiendo el problema :thinking: que tiene que ver el manifest de la 15 si estas instalando 16. 

De hecho, usamos la misma versión que define Odoo en sus requirements. https://github.com/odoo/odoo/blob/16.0/requirements.txt#L5

Así que para mi no hay ningún bug.

Debemos recordar que por eso hay cambio de versiones... Las dependencias pueden cambiar entre versiones mayores (lo intentamos evitar en menores...) [SEP] @etobella la indicación a la rama 15 es por indicar las diferencias entre una rama que no da ningún problema (la cual en su manifest no solicita ninguna version de cryptography en concreto) realizando la instalación con una que si las esta dando.

La única diferencia apreciable entre versiones es la obligación de versión de la dependencia que aunque estando la misma versión que requiere odoo y en el sistema la misma, esa indicación de version es la que genera el fallo que salta el error de que no esta instalada (aunque si lo esta)

Como se ha indicado, los pasos han sido los siguientes:

Instalación de odoo 16 CE con sus requirements, su funcionamiento es correcto
Descarga del repositorio l10n_spain e instalación de sus requirements, cuando se va a los modulos mencionados salta el mensaje de que esa versión no esta instalada.

Si eliminamos del manifest la versión, dejando solo indicado la dependencia cryptography funciona correctamente la instalación

Queremos dejar claro que este problema no es a nivel del fichero requirements.txt sino en los archivos __manifest__.py [SEP] El problema esta en tu instalacion. Odoo requiere esa version, por eso esta congelado. [SEP] @iTecan efectivamente si se instala con las versiones indicadas tanto en el requirements.txt de Odoo como en el manifest, todo funciona correctamente, así que cierro. Revisa por favor tu procedimiento de despliegue para ver si estás instalando por otro lado una versión sin congelar de `cryptography`, y tendrás que indicar dicha versión. Me suena que utilizas Doodba, así que sería en el archivo pip.txt indicar `cryptography==3.4.8` en lugar de solo `cryptography`.

Cierro entonces la issue."
Issue,3500,l10n_es_ticketbai: 010 196-AVISO: Error validación de negocio [Factura con Clave de régimen especial de IVA = 51 o 52 sin desglose sujeto/no exento con Operación en recargo de equivalencia o régimen simplificado],"## Module
l10n_es_ticketbai, l10n_es_ticketbai_api

## Describe the bug
En instalaciones en régimen de equivalencia, se configura ticketbai para recargo de equivalencia e incluso se especifica en la configuración del TPV como posición fiscal ""Recargo de equivalencia"". He comprobado que los impuestos están bien mapeados para recargo de equivalencia, y todo parece correcto.

## To Reproduce
**Affected versions**:
14.0
Steps to reproduce the behavior:
1. Configurar ticketbai con recargo de equivalencia.
2. Configurar posición fiscal del TPV como recargo de equivalencia.
3. Hacer una venta y esperar a que se envíe la factura a ticketBai (o forzarlo manualmente)

**Expected behavior**
Se deberían añadir los impuestos de recargo de equivalencia, y la factura de TicketBAI enviada a las diputaciones no debería devolver el error ""010 196-AVISO: Error validación de negocio [Factura con Clave de régimen especial de IVA = 51 o 52 sin desglose sujeto/no exento con Operación en recargo de equivalencia o régimen simplificado]"" 
",
Issue,3483,Memoria justificativa alta software garante Batuz,"Buenos días:

Tenemos una instalación de Odoo en producción para uso popio y hemos procedido a instalar el modulo de integración con Batuz - Diputación de Bizkaia. 
Tras la instalación, hemos realizado las pruebas con el entorno de pruebas que facilita la propia diputación de Bizkaia y ha ido todo bien. A la hora de proceder a pasar a producción la Diputación nos requiere el darse de alta como proveedor homologado y, para ello, presentar una memoria con el siguiente contenido:


_1)	Proceso de encadenamiento de los ficheros de alta de operación con software garante._
El sistema TicketBAI implica que cada factura debe identificar la factura anterior. El cumplimiento del requisito de encadenamiento depende de la forma de funcionamiento del sistema de facturación, que es lo que hay que indicar en este punto de la memoria descriptiva:
- Si un mismo dispositivo emite facturas de diferentes series, el requisito de encadenamiento debe identificar la factura anterior expedida, con independencia de la serie (por ejemplo, a una factura de una serie ordinaria le puede preceder una factura rectificativa de otra serie).
- Si existen diferentes dispositivos de facturación, los cuales sólo expiden facturas dentro de una serie específica para cada dispositivo, el encadenamiento se produce dentro de cada serie. 
- Si el sistema de facturación es un sistema centralizado que genera las series y los números de facturación, el encadenamiento se refiere a la última factura expedida por el sistema.
 
_2)	Proceso de firma de los ficheros de alta y de anulación de operación con software garante, indicando en particular, los tipos de certificados electrónicos que pueden ser utilizados por el software garante para el proceso de firma._
 Además de los certificados se debe indicar el proceso de firma, describiendo su flujo/arquitectura (cliente, servidor) y los algoritmos, librerías criptográficas o servicios externos utilizados.

_3)	Tipos de facturas o justificantes que genera el software garante, indicando, en particular, si el software genera:_
a) Facturas simplificadas y/o completas.
b) Facturas en soporte papel y/o electrónicas.

_4)	Ubicación del código identificativo y del código QR de acuerdo con lo dispuesto en el artículo 6 de la Orden Foral 1482/2020._
 
_5)	Identificación de la opción del software que permita la verificación presencial en una única pantalla de la información a que se refiere el artículo 9 de la Orden Foral 1482/2020 (funcionalidad de verificación presencial de los softwares garantes)._
 
_6)	Sistema de almacenamiento de los ficheros de alta y de anulación de operación con software garante._
En este apartado se le requiere que describa dónde se almacenan los ficheros TicketBAI generados por la aplicación, ya que el contribuyente usuario del software debe conservarlos durante el plazo indicado (en general el plazo de prescripción y o caducidad).
La finalidad de solicitar esta información es poder identificar el espacio en el cual, según la instalación de la aplicación, se almacenan estos ficheros. 

Esto es independiente de que queramos realizar un desarrollo interno (que es nuestro caso) o comercializar la solución (que **no es nuestro caso**).

¿Podría alguien proporcionar la memoria a rellenar? Muchas gracias de antemano.

Gracias.
","Hola, esto no es ninguna issue del módulo, por lo que éste no es el lugar adecuado para hacer este tipo de solicitudes. Prueba a ponerlo en los foros de AEOdoo: https://www.aeodoo.org/forum. De todas formas, creo que este tipo de cosas son las que debe aportar cada uno como empresa implantadora de Odoo, y no tengo claro que alguien os conteste al respecto. Estamos muchos que ni trabajamos en esa zona, y los demás ya han aportado el software como gesto solidario."
Issue,3482,Homogeneizar términos: envase - paquete,"Buenos días.

Desde Moduon hemos estado trabajando para homogeneizar unos términos de traducción y queríamos compartir con AEOdoo el trabajo realizado y las conclusiones para poder unificar esfuerzos en una misma dirección.

Paso a explicar.

# Situación actual
Recientemente nuestros clientes han sufrido problemas de usabilidad en Odoo debido a la traducción heterogénea que se estaba realizando de 3 términos parecidos pero diferentes. Se trata de los modelos [product.packaging](https://github.com/odoo/odoo/blob/49d4f20242c48964b4f367a0d9ce1cdc964b6460/addons/product/models/product_packaging.py), [stock.quant.package](https://github.com/odoo/odoo/blob/49d4f20242c48964b4f367a0d9ce1cdc964b6460/addons/stock/models/stock_quant.py#L1386) y [stock.package.type](https://stock.package.type/).

Como se puede observar por el nombre de los modelos, es fácil confundirlos. Las traducciones variaban entre ""envase"", ""embalaje"", ""paquete"" o ""empaquetado"". Todas correctísimas, pero llevando a confusión. La cosa se complica más todavía porque hay vistas de Odoo en las que podemos necesitar simultáneamente trabajar con todos esos modelos. Y en realidad, no tienen nada que ver entre sí.

Como no existe un estándar y tanto Transifex como Weblate aceptan todo tipo de contribuciones, la traducción de estos campos va variando con el tiempo. Esto produce más confusión todavía.

Voy a explicar qué es cada uno para dar contexto.

## product.packaging
Este modelo lo define el módulo product, así que su funcionalidad es transversal a todos los otros módulos que usan productos (ventas, compras, inventario...). Se puede observar porque la opción se puede activar en varias secciones desde ajustes:

![image](https://github.com/OCA/l10n-spain/assets/973709/a72848c5-a559-45da-9310-c6d6bbfde0d6)


Aquí se configuran en el producto:

![image](https://github.com/OCA/l10n-spain/assets/973709/9744f84c-1056-4134-b6d3-4bc96177c2fa)


Como podéis ver en el ejemplo, aunque las manzanas se venden por kg y se pueden vender a granel, también las tenemos en bolsas y en cajas, de 3 y 12 kg respectivamente.

Más ejemplos:

- Leche. Vendemos en unidades de 1L, pero podemos vender una caja con 6 tetrabriks.
- Jamón. Lo vendemos por kg, pero:
  - Tenemos un envase que es un blíster de 200g
  - Una pata de jamón podría llegar a considerarse un envase de 7kg.


Básicamente, es un multiplicador de unidades, en la misma UdM que el producto al que pertenecen. Por ejemplo, al comprar 100 cajas estamos comprando 1200 kg. Aquí el pedido de compra:

![image](https://github.com/OCA/l10n-spain/assets/973709/5057d5c6-9677-4e01-805c-74a598519b4d)


## stock.quant.package y stock.package.type
Estos modelos los define el módulo stock, así que únicamente afectan a las operaciones de inventario.

Los stock.quant.package son contenedores identificados que contienen otros stock.quant.package u otros stock.quant. Los stock.package.type categorizan a los stock.quant.package.

Por ejemplo, al recepcionar la compra anterior, los podemos ver al pulsar en el botón detalles de la línea del albarán:

![image](https://github.com/OCA/l10n-spain/assets/973709/c72cae4e-d6f3-44d1-b5cb-c9ba22a75b3f)

![image](https://github.com/OCA/l10n-spain/assets/973709/980167f4-53c4-4829-8b1b-9c52f2718272)

![image](https://github.com/OCA/l10n-spain/assets/973709/63816aa2-e0ec-4e1c-829b-79dc6d50e895)





Como se puede observar en la vista de albarán, comparten contexto con product.packaging.

# Situación deseada
Que exista una traducción homogénea al español al referirnos a cada uno de estos modelos. Los usuarios españoles ya no se confundirán. Tampoco malgastaremos esfuerzos en ir adelante y atrás con las traducciones, como comunidad.

# Solución propuesta
Nuestra propuesta es definir unos términos canónicos para referirnos a cada uno de esos modelos, y esforzarnos por tener una traducción homogénea.

Proponemos el siguiente canon:

- product.packaging: traducir por ""envase"", ""envasar""
- stock.quant.package: traducir por ""paquete"", ""empaquetar""
- stock.package.type: traducir por ""tipo de paquete""

Frases de ejemplo:

- Nos han llegado al almacén 100 envases de 200g de jamón, empaquetados en 4 cajas.
- Tenemos 100 kg de manzanas. Vamos a envasarlos en bolsas de 10 kg para la venta.


Obviamente no encajará siempre con cada caso de uso, pero más o menos se puede llegar a entender.

Creemos que lo más importante es tener un estándar, que la traducción sea homogénea, y que se distinga fácilmente entre modelos y usos, sin confundir.

# Progreso
Hemos empezado con la estandarización en las traducciones de Odoo 16. Observaréis estos cambios probablemente.

He añadido algunas entradas a los glosarios de Transifex y Weblate para referencia de todos los traductores. Ejemplos:

- https://app.transifex.com/odoo/odoo-main-glossary/translate/#es/odoo-main-glossary/432407116
- https://translation.odoo-community.org/translate/0-oca-project-template/glossary/es/?checksum=c718e8f084ff2c35


He traducido muchos términos de Odoo y de algunos módulos de OCA relacionados.

Quería exponer aquí el trabajo realizado y pedir colaboración, si os parece bien, para que podamos trabajar juntos en esta vía.

¡Gracias!

@moduon MT-5363","Envase no debe ser la traducción para `product.packaging`: https://dle.rae.es/envase. Empaquetado era correcto IMO. [SEP] Precisamente consultamos la RAE a la hora de hacer esa elección. [La traducción para empaquetado](https://dle.rae.es/empaquetado) indica únicamente:

> Acción y efecto de empaquetar.

Normalmente, en los contextos mencionados, el que conlleva una ""acción y efecto"" es más bien el contexto de inventario. Pongamos el caso de un supermercado:
- Los operarios de almacén harán la ""acción y efecto de [des]empaquetar"" al abrir los pallets, que quizás vengan envueltos en plástico, y colocar las cajas en estanterías, o ""acciones"" similares.
- En cambio, las fresas ya las compran ""envasadas"" en cajitas de 500g, no es una ""acción"" que ellos hagan.

En cualquier caso, obviamente son términos casi equivalentes, y el problema de escoger ""empaquetado"" es que deja la incógnita de qué escoger para la otra parte: la de stock. [SEP] En stock (`stock.quant.package`), está puesto ""paquete"". Para `product.packaging`, se habla de ""empaquetado"", por lo que están diferenciados. Creo que ""envase"", aunque su tercedra acepción lo puede permitir, queda poco natural. Ejemplo: tenemos un cliente que vende guantes de protección, y los vende empaquetados de 5 en 5. Hablar de envase de 5 pares de guantes quedaría muy raro. También envase se relaciona muchas veces con líquidos. [SEP] > Envase no debe ser la traducción para `product.packaging`: https://dle.rae.es/envase. Empaquetado era correcto IMO.

Yo aquí discrepo 😅. Me explico:

- En función de la definición que das de la RAE creo que encaja en la segunda acepción. Por ejemplo, caja de 6 unidades en la venta de manzanas que es un producto que se vende por Kg.
![image](https://github.com/OCA/l10n-spain/assets/147538094/8e333f74-d23b-4e1c-ad80-91a96465fad7)

- Respesto a ""Empaquetado"" la RAE dice:
![image](https://github.com/OCA/l10n-spain/assets/147538094/4cf19bdd-7a8f-4743-9660-4447e23acf3b)

- Si miramos empaquetar, creo que también la segunda acepción encaja con lo que @yajo dice en el ejemplo: Nos han llegado al almacén 100 envases de 200g de jamón, empaquetados en 4 cajas.
![image](https://github.com/OCA/l10n-spain/assets/147538094/fbb7158a-a917-478e-abda-b50e8ac7cbe3)

Saludos,
 [SEP] Lo dicho, Gelo, tú nunca hablarías de envase de 5 pares de guantes, ¿a que no? [SEP] > En stock (`stock.quant.package`), está puesto ""paquete"". Para `product.packaging`, se habla de ""empaquetado"", por lo que están diferenciados.

Sobre el papel, son términos diferentes; pero en realidad, paquete y empaquetado no están bien diferenciados. Si lo estuvieran, nunca hubiéramos necesitado preocuparnos de este asunto...

""Paquete"" es el sustantivo y ""empaquetar"" es el verbo, pero ambas se refieren a la misma cosa. De hecho, [la primera definición de empaquetar](https://dle.rae.es/empaquetar) es ""hacer paquetes"".

> Creo que ""envase"", aunque su tercedra acepción lo puede permitir, queda poco natural.

Del mismo modo, cuando hablamos de ""empaquetados"", hay contextos en que no queda natural. Ejemplo: Vendo aceite empaquetado en botellas de 1, 5 y 10 L. Obviamente, en este contexto queda mejor ""envasado"".

También hay contextos en que queda exactamente igual de bien tanto el uno como el otro:
- Vendo jamón empaquetado en blísters de 200g.
- Vendo jamón envasado en blísters de 200g.

Y hay otros en los que queda igual de mal uno que el otro:
- Vendo jamón empaquetado en pata de 7kg.
- Vendo jamón envasado en pata de 7kg.

Por eso decía al principio:

> Obviamente no encajará siempre con cada caso de uso, pero más o menos se puede llegar a entender.
> 
> Creemos que lo más importante es tener un estándar, que la traducción sea homogénea, y que se distinga fácilmente entre modelos y usos, sin confundir.

Creo que el español es un idioma suficientemente rico como para poder usar 2 terminologías totalmente diferentes y así ayudar a nuestros usuarios a entender la diferencia.

En fin, todo esto que estamos comentando no es en contra de lo que dices, @pedrobaeza, sino simplemente estamos expresando públicamente el mismo análisis que ya hicimos internamente y que luego nos llevó a la conclusión de que la usabilidad de Odoo mejoraría llamando ""envase"" a `product.packaging` que llamándolo ""empaquetado"". [SEP] Pero curiosamente los casos en los que queda peor envase afectan a mis clientes, y supongo que envasado quedará mejor en los vuestros. A ver qué opina más gente al respecto. [SEP] Bueno, tampoco es tan así. Quiero decir que no a todos nuestros clientes les encaja perfecto ""envase"". Incluso, para ciertos clientes les encaja bien en unos productos y mal en otros.

La cuestión aquí no es si le va mejor o peor a nuestros clientes. La cuestión es mejorar la usabilidad general de Odoo permitiendo al usuario diferenciar apropiadamente entre 2 funcionalidades independientes, que tienen nombres demasiado parecidos. [SEP] Ya, yo es lo que intento también, con unos términos lo más adecuados posibles, teniendo en cuenta que no siempre va a casar al 100%. En muchos sitios te estás refieriendo como ""envasado"" en lugar de ""envase"", que es el cambio que planteáis, con lo que ahí ya también se desfigura la idoneidad de esa palabra, porque así queda mejor en las frase formuladas. La cuestión es que en Odoo solo tenemos una palabra en la columna, y entre ver ""Envase"" o ver ""Empaquetado"" en dicha columna, yo sigo decantándome por la última, pero lo dicho, a ver qué opina otra gente. [SEP] > Lo dicho, Gelo, tú nunca hablarías de envase de 5 pares de guantes, ¿a que no?

Hola Pedro, no te discuto que en alguna ocasión puede ser confuso, pero también puede ser porque no usamos la palabra adecuada. 

Según chat GPT:
Los términos ""paquete"" y ""envase"" son comúnmente utilizados en el contexto del embalaje de productos, pero tienen significados ligeramente diferentes:

**- Envase:**
  - Un envase se refiere específicamente al contenedor físico utilizado para contener y proteger un producto. Puede ser cualquier tipo de recipiente, como una botella, una lata, una caja, una bolsa, etc.

  - El envase cumple funciones importantes, como proteger el producto de daños físicos, contaminación, pérdida de frescura y deterioro durante el transporte y el almacenamiento.
  - Además de proteger el producto, el envase puede tener un papel en la promoción y la comercialización del producto, ya que a menudo lleva información sobre el producto, instrucciones de uso, etiquetas de advertencia, diseños gráficos para atraer a los consumidores, etc.

**-Paquete:**
  - El término ""paquete"" se utiliza más ampliamente para referirse al conjunto completo de materiales de embalaje que rodean y contienen un producto. Esto incluye no solo el envase primario que contiene directamente el producto, sino también cualquier envoltura secundaria o material de relleno utilizado para proteger y presentar el producto.
  - Un paquete puede incluir varios niveles de embalaje, como el envase primario (la botella, la lata, etc.), el envase secundario (la caja que contiene varias unidades del producto), y el embalaje de transporte (cartones, relleno protector, etc.).
  - El paquete se diseña teniendo en cuenta tanto la protección del producto como la eficiencia en términos de almacenamiento, transporte y manipulación.

En resumen, **mientras que el ""envase"" se refiere específicamente al contenedor físico que contiene el producto, el ""paquete"" se refiere al conjunto completo de materiales de embalaje que rodean y contienen el producto, incluyendo el envase primario, cualquier envoltura secundaria y el embalaje de transporte.**

Así que yo creo que la RAE y Chat GPT van más a favor de la propuesta de @yajo  [SEP] > En muchos sitios te estás refieriendo como ""envasado"" en lugar de ""envase""

Gracias, he actualizado algunas traducciones para que digan ""envase"". Creo que puse ""envasado"" por inercia al ver ""empaquetado"". 😅 

En cualquier caso, no era un gran problema. Precisamente, al usar 2 familias completamente diferentes de palabras, ya no se vuelve tan relevante diferenciar si uno usa el sustantivo o el verbo. [SEP] Ante la falta de opiniones de más empresas, y puesto que Jairo volvió a cambiar todos los términos en Transifex a la siguiente semana, lo dejaremos así por el momento. [SEP] OK Gracias ❤️ 😊 "
Issue,3480,[14.0] l10n_es_ticketbai_pos: interacción incorrecta en caso de error,"El módulo l10n_es_ticketbai_pos hace un método hermano del build_tbai_invoice ([build_tbai_simplified_invoice](https://github.com/OCA/l10n-spain/blob/22861cd91d8e4bbcc718e5a1eb514f2c6d9bcf07/l10n_es_ticketbai_pos/models/ticketbai_invoice.py#L29)) para usar los datos de última factura enviada del config de la TPV en vez de los datos de la compañía.

Pero si el proceso de envío (común), da error, se llama al [mark_chain_as_error](https://github.com/OCA/l10n-spain/blob/22861cd91d8e4bbcc718e5a1eb514f2c6d9bcf07/l10n_es_ticketbai_api/models/ticketbai_invoice.py#L637) para deshacer todo el proceso. Y éste no está heredado en l10n_es_ticketbai_pos, por lo que va a escribir como última factura enviada en la compañía la última factura de la TPV. Sin comprobarlo, entiendo que esto destroza el encadenamiento porque hemos metido las simplificadas en las ordinarias.

Tal y como lo veo yo: heredar mark_chain_as_error en el l10n_es_ticketbai_pos, comprobar si es simplificada (tiene pos_order_id), y si es así hacer lo mismo que el método original pero escribiendo en el config de TPV. Si no, llamar a super","Este caso parece complejo. 
Entiendo lo que comentas, y siendo así, seria conveniente hacer la mejora en el POS.
Si haces alguna propuesta de mejora y necesitas ayuda para hacer pruebas y review estoy disponible 🙂
 [SEP] There hasn't been any activity on this issue in the past 6 months, so it has been marked as stale and it will be closed automatically if no further activity occurs in the next 30 days.
If you want this issue to never become stale, please ask a PSC member to apply the ""no stale"" label."
Issue,3475,[14.0 / 16.0] - Módulo Prorrata de IVA incompatible con Criterio de Caja,"<!-- Provide a general summary of the issue in the Title above.
Before opening the issue, please check that there isn't another issue addressing the same problem already created -->
Hola, parece que el módulo de Prorrata de IVA (creo que tanto en V16 como en versiones anteriores) no es compatible con la extensión de Odoo de Criterio de Caja. Sería interesante indicarlo en el readme del módulo, a no ser que se considere un bug, yo en principio lo doy de alta como bug. También trataré de investigar más a fondo el problema, pero lo dejo por aquí.

## Module
[l10n-spain](https://github.com/OCA/l10n-spain/tree/16.0)
/l10n_es_vat_prorate/

## Describe the bug
Si se activa para una compañía un % de prorrata y también está activada la opción de ""Cash Basis"" de Odoo (criterio de caja), cuando se registra el pago de una factura se produce un error:

""ValueError: Expected singleton: account.account(account_id.id, account_id.id)""
(En el error real saldrán los Ids de las cuentas contables afectadas)

## To Reproduce
**Affected versions**: comprobado en V14 y en V16 (vía runboat).

Steps to reproduce the behavior: se pueden reproducir estos pasos en una V16 con localización española, desde runboat, con el usuario Michael Admin (admin) pero antes de indicar los pasos, debemos activar y configurar tanto el criterio de caja como la prorrata de IVA, que detallo a continuación en requisitos previos.

**Requisitos previos para poder reproducir el bug desde runboat en V16** Debemos activar y configurar el criterio de caja y por otra parte debemos activar y configurar la prorrata de IVA. Para ello:

-Arrancamos un runboat en V16 con localización española instalada.
-Debemos configurar el usuario admin dentro del grupo ""Mostrar características de contabilidad completas"" para que pueda ver y activar la opción de criterio de caja en los ajustes de facturación.
-Conmutamos a compañía ""ES Company"" de la instancia de runboat.

**Configuración básica de criterio de caja necesaria para reproducir el bug en la compañía ""ES Company"":**
-Debemos activar en los ajustes de facturación la opción ""Cash Basis"" (Criterio de Caja). Esto nos creará un nuevo diario contable llamado ""Cash Basis Taxes"". La cuenta puente se puede dejar en blanco o no (no afecta al error).
-Debemos crear una cuenta puente para impuestos recibidos en el plan contable. Por ejemplo copiamos la cuenta ""472000 - Hacienda Pública. IVA soportado"" a la cuenta ""472100 - Hacienda Pública. IVA soportado Criterio Caja"".
-Escogemos un impuesto cualquiera, por ejemplo ""21% IVA soportado (bienes corrientes)"". Lo editamos y en la pestaña ""Ajustes avanzados"" indicamos que se basa en el Pago, poniendo a continuación la cuenta puente 4721. Guardamos.

**Configuración básica de Prorrata necesaria para reproducir el bug en la compañía ""ES Company"":**
-Debemos ir a Ajustes - Compañías y activamos prorrata para ""ES Company"". Esto nos habilitará la pestaña de líneas de prorrata de IVA, y damos de alta una nueva línea, por ejemplo desde ""01/01/2024"" y un porcentaje del 10%.

Con esto ya tendríamos lo necesario para reproducir el bug. Ahora sí los pasos:

1. Nos vamos a facturas de proveedor y registramos nueva factura. Para evitar configuraciones de partners, directamente en la factura nos vamos primero a la pestaña ""Other info"" y ponemos posición fiscal en ""Régimen nacional"".
2. Creamos una línea de factura por ejemplo 1 unidad del producto ""Whiteboard Pen"" a un precio de 100€. Revisamos que el IVA aplicado al producto sea el que hemos modificado (21% IVA soportado (bienes corrientes)), si no, lo ponemos a mano. Tendremos un asiento contable en el que se lleva una parte del IVA a la 4721 y otra parte a gasto, todo ello por efecto del módulo de prorrata. Guardamos y confirmamos la factura (poner referencia que es obligatorio).
3. Hacemos clic en registrar el pago. Ponemos fecha, y llegaremos al error:

`RPC_ERROR
Odoo Server Error

Traceback (most recent call last):
  File ""/opt/odoo/odoo/http.py"", line 1633, in _serve_db
    return service_model.retrying(self._serve_ir_http, self.env)
  File ""/opt/odoo/odoo/service/model.py"", line 133, in retrying
    result = func()
  File ""/opt/odoo/odoo/http.py"", line 1660, in _serve_ir_http
    response = self.dispatcher.dispatch(rule.endpoint, args)
  File ""/opt/odoo/odoo/http.py"", line 1864, in dispatch
    result = self.request.registry['ir.http']._dispatch(endpoint)
  File ""/opt/odoo/addons/website/models/ir_http.py"", line 237, in _dispatch
    response = super()._dispatch(endpoint)
  File ""/opt/odoo/odoo/addons/base/models/ir_http.py"", line 154, in _dispatch
    result = endpoint(**request.params)
  File ""/opt/odoo/odoo/http.py"", line 697, in route_wrapper
    result = endpoint(self, *args, **params_ok)
  File ""/opt/odoo/addons/web/controllers/dataset.py"", line 46, in call_button
    action = self._call_kw(model, method, args, kwargs)
  File ""/opt/odoo/addons/web/controllers/dataset.py"", line 33, in _call_kw
    return call_kw(request.env[model], method, args, kwargs)
  File ""/opt/odoo/odoo/api.py"", line 468, in call_kw
    result = _call_kw_multi(method, model, args, kwargs)
  File ""/opt/odoo/odoo/api.py"", line 453, in _call_kw_multi
    result = method(recs, *args, **kwargs)
  File ""/opt/odoo/addons/account/wizard/account_payment_register.py"", line 883, in action_create_payments
    payments = self._create_payments()
  File ""/opt/odoo/addons/account/wizard/account_payment_register.py"", line 879, in _create_payments
    self._reconcile_payments(to_process, edit_mode=edit_mode)
  File ""/opt/odoo/addons/account/wizard/account_payment_register.py"", line 838, in _reconcile_payments
    .reconcile()
  File ""/opt/odoo/addons/account_edi/models/account_move.py"", line 489, in reconcile
    res = super().reconcile()
  File ""/opt/odoo/addons/account/models/account_move_line.py"", line 2428, in reconcile
    tax_cash_basis_moves = partials._create_tax_cash_basis_moves()
  File ""/opt/odoo/addons/account/models/account_partial_reconcile.py"", line 505, in _create_tax_cash_basis_moves
    counterpart_line_vals = self._prepare_cash_basis_counterpart_tax_line_vals(tax_line, line_vals)
  File ""/opt/odoo/addons/account/models/account_partial_reconcile.py"", line 327, in _prepare_cash_basis_counterpart_tax_line_vals
    'account_id': tax_line.account_id.id,
  File ""/opt/odoo/odoo/fields.py"", line 5092, in __get__
    raise ValueError(""Expected singleton: %s"" % record)
ValueError: Expected singleton: account.account(1315, 993)

The above server error caused the following client error:
RPC_ERROR: Odoo Server Error
    at makeErrorFromResponse (http://oca-l10n-spain-16-0-4b822699d2b3.runboat.odoo-community.org/web/assets/718-3e76ea7/web.assets_backend.min.js:993:163)
    at XMLHttpRequest.<anonymous> (http://oca-l10n-spain-16-0-4b822699d2b3.runboat.odoo-community.org/web/assets/718-3e76ea7/web.assets_backend.min.js:1001:13)`

**Expected behavior**
Se debería registrar el pago correctamente.

**Additional context**
Si no se activa la prorrata de IVA y solo se deja el criterio de caja, no se produce error, realizándose el asiento de impuestos correctamente (quitando el saldo de la cuenta puente 472100 y arrastrándolo a la cuenta real de impuestos, la 472000).

","Indicada la incompatibilidad en el ROADMAP: https://github.com/OCA/l10n-spain/commit/fc2f5838f308ce36cd9f597d464e23bda5e8be9d

Cierro y el que quiera solucionar dicho caso, puede poner un PR al respecto."
Issue,3474,Estado módulos AEAT para Odoo 17,"Buenos días,
Estaba viendo que en Odoo 17 aún no existe ningún módulo de los modelos de la AEAT. ¿Existe una fecha prevista o esperada para su salida? Muchas gracias.  ","Por favor no abras issues nuevos teniendo una issue (y además fijada) para controlar dicho progreso. Se seguirá progresando en el tema, pero no hay fechas cerradas."
Issue,3459,[15.0] imposible instalar el módulo en una base de datos nueva,"[15.0] al intentar instalar el módulo en una base de datos nueva se produce el siguiente error:

Traceback (most recent call last):
  File ""/opt/odoo15dev/odoo/odoo/tools/convert.py"", line 683, in _tag_root
    f(rec)
  File ""/opt/odoo15dev/odoo/odoo/tools/convert.py"", line 533, in _tag_record
    raise Exception(""Cannot update missing record %r"" % xid)
Exception: Cannot update missing record 'l10n_es.account_tax_template_p_iva0_s_bc'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File ""/opt/odoo15dev/odoo/odoo/addons/base/models/ir_http.py"", line 237, in _dispatch
    result = request.dispatch()
  File ""/opt/odoo15dev/odoo/odoo/http.py"", line 687, in dispatch
    result = self._call_function(**self.params)
  File ""/opt/odoo15dev/odoo/odoo/http.py"", line 359, in _call_function
    return checked_call(self.db, *args, **kwargs)
  File ""/opt/odoo15dev/odoo/odoo/service/model.py"", line 94, in wrapper
    return f(dbname, *args, **kwargs)
  File ""/opt/odoo15dev/odoo/odoo/http.py"", line 348, in checked_call
    result = self.endpoint(*a, **kw)
  File ""/opt/odoo15dev/odoo/odoo/http.py"", line 916, in __call__
    return self.method(*args, **kw)
  File ""/opt/odoo15dev/odoo/odoo/http.py"", line 535, in response_wrap
    response = f(*args, **kw)
  File ""/opt/odoo15dev/odoo/addons/web/controllers/main.py"", line 1346, in call_button
    action = self._call_kw(model, method, args, kwargs)
  File ""/opt/odoo15dev/odoo/addons/web/controllers/main.py"", line 1334, in _call_kw
    return call_kw(request.env[model], method, args, kwargs)
  File ""/opt/odoo15dev/odoo/odoo/api.py"", line 464, in call_kw
    result = _call_kw_multi(method, model, args, kwargs)
  File ""/opt/odoo15dev/odoo/odoo/api.py"", line 451, in _call_kw_multi
    result = method(recs, *args, **kwargs)
  File ""<decorator-gen-74>"", line 2, in button_immediate_install
  File ""/opt/odoo15dev/odoo/odoo/addons/base/models/ir_module.py"", line 74, in check_and_log
    return method(self, *args, **kwargs)
  File ""/opt/odoo15dev/odoo/odoo/addons/base/models/ir_module.py"", line 486, in button_immediate_install
    return self._button_immediate_function(type(self).button_install)
  File ""/opt/odoo15dev/odoo/odoo/addons/base/models/ir_module.py"", line 603, in _button_immediate_function
    registry = modules.registry.Registry.new(self._cr.dbname, update_module=True)
  File ""/opt/odoo15dev/smile-github/odoo_addons/smile_upgrade/models/registry.py"", line 27, in new
    return native_new(db_name, force_demo, status, update_module)
  File ""/opt/odoo15dev/odoo/odoo/modules/registry.py"", line 87, in new
    odoo.modules.load_modules(registry, force_demo, status, update_module)
  File ""/opt/odoo15dev/odoo/odoo/modules/loading.py"", line 474, in load_modules
    processed_modules += load_marked_modules(cr, graph,
  File ""/opt/odoo15dev/odoo/odoo/modules/loading.py"", line 363, in load_marked_modules
    loaded, processed = load_module_graph(
  File ""/opt/odoo15dev/odoo/odoo/modules/loading.py"", line 222, in load_module_graph
    load_data(cr, idref, mode, kind='data', package=package)
  File ""/opt/odoo15dev/odoo/odoo/modules/loading.py"", line 69, in load_data
    tools.convert_file(cr, package.name, filename, idref, mode, noupdate, kind)
  File ""/opt/odoo15dev/odoo/odoo/tools/convert.py"", line 748, in convert_file
    convert_xml_import(cr, module, fp, idref, mode, noupdate)
  File ""/opt/odoo15dev/odoo/odoo/tools/convert.py"", line 814, in convert_xml_import
    obj.parse(doc.getroot())
  File ""/opt/odoo15dev/odoo/odoo/tools/convert.py"", line 734, in parse
    self._tag_root(de)
  File ""/opt/odoo15dev/odoo/odoo/tools/convert.py"", line 696, in _tag_root
    raise ParseError('while parsing %s:%s, somewhere inside\n%s' % (
Exception

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File ""/opt/odoo15dev/odoo/odoo/http.py"", line 643, in _handle_exception
    return super(JsonRequest, self)._handle_exception(exception)
  File ""/opt/odoo15dev/odoo/odoo/http.py"", line 301, in _handle_exception
    raise exception.with_traceback(None) from new_cause
odoo.tools.convert.ParseError: while parsing /opt/odoo15dev/oca-github/l10n-spain/l10n_es_facturae/data/account_tax_template.xml:166, somewhere inside
<record id=""l10n_es.account_tax_template_p_iva0_s_bc"" model=""account.tax.template"">
        <field name=""facturae_code"">01</field>
    </record>

","Aunque no estás indicando el módulo, por el trozo de error, estás creando la base de datos con código de Odoo core obsoleto. Actualiza dicho código. [SEP] Me refería a l10n_es_facturae. Correcto, al actualizar l10n_es sí es posible instalar l10n_es_facturae. Gracias!"
Issue,3456,[14.0] l10n_es_dua_ticketbai_batuz: impuestos de servicios extracomunitarios incluídos en mapeo de DUA,"En el l10n_es_dua_ticketbai_batuz se crea un mapeo específico para el DUA, y se incluyen los impuestos lógicos: importaciones de bienes (corrientes y de inversión, es decir 6 impuestos). Pero además se añaden los 3 impuestos de adquisiciones de servicios extracomunitarios, que no deberían verse afectados por el módulo. El [xml](https://github.com/OCA/l10n-spain/blob/c248db0b81015f113050d981086bb0fe1a8a84c8/l10n_es_dua_ticketbai_batuz/data/tax_code_map_dua_ticketbai_data.xml#L17)

Esto hace que cualquier compra de servicios extracomunitarios se considere DUA, y acaba mandando una factura como F5 y con Inversión del Sujeto Pasivo, que es rechazada (código de error B4_2000311:(ES): Inversión sujeto pasivo no puede ser S si Tipo de factura es F5 o LC).

Compararando con el l10n_es_dua_sii, vemos el mismo mapeo, pero sin los extracomunitarios. [Xml](https://github.com/OCA/l10n-spain/blob/c248db0b81015f113050d981086bb0fe1a8a84c8/l10n_es_dua_sii/data/tax_code_map_dua_sii_data.xml#L11)

Propuesta: quitar los impuestos de adquisiciones de servicios del mapeo del DUA
Versiones afectadas: 9.0 a 15.0",#3472 - corrección v14.0 [SEP] Cerrado por mergeo
Issue,3455,Modelo 347 importes en negatico,"Hola, cuando generamos el modelo 347 y un cliente tiene importes en negativo (porque solo hay facturas rectificativas) en el documento sale correcto:
![image](https://github.com/OCA/l10n-spain/assets/84158523/1fa316da-787c-4dc0-87ee-1a677a984acf)

Pero cuando exportas a BOE sale en positivo. 
![image](https://github.com/OCA/l10n-spain/assets/84158523/5c3044b6-43ca-4be4-a9be-5ffc5307d036)

Estamos haciendo algo mal o es un problema del módulo?","Según veo en la definición de la exportación, tiene para aplicar el signo:

https://github.com/OCA/l10n-spain/blob/16.0/l10n_es_aeat_mod347/data/aeat_export_mod347_partner_data.xml#L178-L180

![image](https://github.com/OCA/l10n-spain/assets/7165771/39400832-dc2d-41f8-817b-72175d0a4f20)

¿Lo tienes así definido en la BD en la que estás exportando? [SEP] @pedrobaeza  si lo tengo así
![image](https://github.com/OCA/l10n-spain/assets/84158523/b732e7fa-f2ba-4eee-9189-eaf59ad923f0)
 [SEP] Pues entonces debería exportar con la N delante... ¿Lo que muestras arriba es ese campo de importe de las operaciones o es algún otro? [SEP] Solo me han pasado esa captura. Tranquilo ya lo reviso yo, era solo confirmar que tiene que salir en negativo en el documento. [SEP] Pero si por la posición (después de la ""B"") tiene que ser ese campo [SEP] @pedrobaeza He estado revisando el tema y creo que el problema está aqui:
https://github.com/OCA/l10n-spain/blob/035a1f9d5525f2e043d5991e8d89a36f8754261f/l10n_es_aeat_mod347/data/aeat_export_mod347_partner_data.xml#L176

La función abs hace que el valor siempre sea positivo, ¿sabes si hay algún motivo para esto o se puede modificar? [SEP] Veo que ese cambio lo hice aquí:

https://github.com/OCA/l10n-spain/commit/2102ab1207fb8ed546c4ac9b468c25b02c14f733

y es que antes había `abs` en el código, pero no veo la razón que me llevo a poner el `abs` en la exportación del BOE. No tiene demasiado sentido visto ahora, y puede que fuera un ""por si acaso"". Creo que no ha impactado hasta ahora porque no es lo habitual que salgan registros con negativo. Arreglado en #3467 (y posteriores fw-port)."
Issue,3452,[15.0][l10n_es_facturae] El servicio de validación de facturas electrónicas no valida la factura firmada,"Buenos días.

Cuando subo una factura firmada al [servicio de validación de  facturas electrónicas](https://sedeaplicaciones2.minetur.gob.es/FacturaE/) manualmente, la plataforma muestra:
![image](https://github.com/OCA/l10n-spain/assets/160132841/a36333dd-18a0-4b8c-ab51-8115d2bc1877)

Estoy utilizando Odoo 15 con el modulo de facturae en la versión 15.0.1.9.0 y xmlsig en la 1.0.1.

Como comente antes lo subo a mano, no utilizo el modulo l10n_es_facturae_face, tampoco esta instalado.

He visto problemas similares como el #1559 o el #1034 , pero xmlsig esta actualizado y el certificado esta emitido por la FNMT

Por ultimo, si genero la factura sin firmarla, la firmo con autofirma y el mismo certificado que esta subido y la compruebo, muestra que el certificado esta correcto.

Muchas gracias. 
","Creo que la solución es actualizar la libreria **xmlsig**, nos encontremos un problema similar y actualmente tenemos la version 1.0.1 y dejo de dar ese error. [SEP] La librería xmlsig esta actualizada, como comente antes [SEP] El mismo problema en Odoo 16.  Comparando el fichero firmado con autofirma y el fichero firmado con Odoo veo que autofirma usa el sha-256 mientras que el que me sale de odoo usa sha1. No sé donde se cambia eso en Odoo. [SEP] Tras varias confirmaciones, el módulo no tiene problemas en si. La problemática puede venir de las versiones criptográficas, o del certificado subido (como le ha ocurrido a https://www.aeodoo.org/forum/localizacion-espanola-3/error-gestion-certificado-en-odoo-16-docker-1501).

Entonces cierro esta issue, al no tratarse de algo de código de este repositorio."
Issue,3451,l10n_es_aeat_mod347: subvenciones,"<!-- Provide a general summary of the issue in the Title above.
Before opening the issue, please check that there isn't another issue addressing the same problem already created -->

## Module
l10n_es_aeat_mod347

## Describe the bug
En el modelo 347 hay que incluir las subvenciones no reembolsables: [consulta vinculante de la DGT](https://www.supercontable.com/informacion/IVA_Impuesto_valor_a%C3%B1adido/Cobro_de_subvenciones.Imputacion_en_la_declaracion_.html).

Desconozco si hay otra manera de hacerlo mejor, para solucionarlo he hecho lo siguiente:

1. He creado una plantilla de impuestos en base de datos account.tax.template (crear por front no deja ya que el campo chart_template_id es obligatorio y no aparece en el form y duplicar una plantilla existente salta un error de el nombre de los impuestos deben ser únicos). La plantilla la he llamado S_SUB.
2. He creado también un impuesto llamado Subvenciones (S_SUB)
3. He creado un diario de facturas llamado Subvenciones con una numeración específica.
4. He creado una factura para cada subvención recibida, por el importe total concedido (aunque sea a varios años ya que en el 347 hay que declarar el total recibido en el momento de la concesión)
5. La factura le pongo como diario ""Subvenciones""
6. En la línea de la factura le pongo el impuesto Subvenciones.
7. He adaptado el modelo del 347 para que incluya ese tipo de impuesto en la categoría B.

No utilizo S_IVA0 ni S_IVA_NS porque estos aparecerían en el 303 y eso no sería correcto.

Hacer los asientos contables directamente (572/4708) no lo veo tan funcional ya que el 347 solamente podría leer el importe si se le añadiera el impuesto en el apunte de la 4708, que de hecho esto es lo que hace la factura. Tengo la impresión que hacer el asiento a mano es poco intuitivo excepto en empresas que reciben muchas subvenciones y ya están al caso. Haciendo una factura además tiene la ventaja que se puede conciliar fácilmente con el apunte de banco y en caso de devolver la subvención, se podría hacer una rectificativa ([otra consulta vinculante](https://www.supercontable.com/informacion/IVA_Impuesto_valor_a%C3%B1adido/Consulta_vinculante_V1453-12.A%C3%B1o_natural_en_el_que_se_.html)).

Antes de hacer cambios en código quería confirmar si esta situación ya está resuelta y cómo debería hacerse y sino, validar si hacerlo así tendría alguna repercusión en otros impuestos.

## To Reproduce
**Affected versions**: Todas

**Expected behavior**
Las subvenciones deberían aparecer en el 347.
","Caso bastante especial sin duda... Creo que no habría que hacer una factura, si no un asiento, pero efectivamente haría falta un impuesto nuevo con cuota 0 y mapearlo en el 347 si no hay ninguno de los existentes que pueda valer. [SEP] Sí, un caso especial, y con el Kit Digital creo que será un problema para mucha gente, pues hay que informarlo en el 347 cuando supere los 3.000€...

Con meter el impuesto en el apunte de la 4708 también he probado y no funciona bien, no sé si hice algo mal, al poner el impuesto directamente en el apunte contable, a parte que hay que poner igualmente la empresa que otorga la subvención y por tanto y crear el cliente igualmente, con su CIF y su dirección correcta (en el caso del Kit Digital sería ENTIDAD PÚBLICA EMPRESARIAL RED.ES), en el 347 el importe global lo pone correcto, pero en el desglose trimestral lo pone en negativo y considera el apunte como el de una rectificativa. 

Por otro lado en mi caso la factura ayuda mucho para saber cuánto falta por cobrar de la subvención y poner claridad en el asunto, es una factura que hay que cobrar, tienes un sitio donde sabes todas las subvenciones que has recibido, tienes el control en cuentas de clientes, etc...

---

El asiento del Kit precisamente es un poco complejo, lo pongo aquí por si da alguna pista (disclaimer!! esto es según lo que me ha recomendado a mi la gestoría, como dice gpt, mejor consultar con un experto en contabilidad antes de tocar nada :)

Asiento de la factura del proveedor:

|Cuenta | Empresa | Etiqueta | Impuesto (cuota) | Impuestos | Cuenta analítica | Monto moneda | Moneda | Debe | Haber | Fecha vencimiento
|-- | -- | -- | -- | -- | -- | -- | -- | -- | -- | --
|  |   |   |   |   |   |   |   | 2.416,37 | 2.416,37 |  
|4100156 Agente Digitalizador SL | Agente Digitalizador SL | / |   |   |   | 0,00 |   | 0,00 € | 2.416,37 € | 01/07/2023
|472000 Hacienda Pública. IVA soportado | Agente Digitalizador SL | 21% IVA soportado (servicios corrientes) | 21% IVA soportado (servicios corrientes) |   |   | 0,00 |   | 419,37 € | 0,00 € | 01/07/2023
|206000 Aplicaciones informáticas | Agente Digitalizador SL | Kit digital |   | 21% IVA soportado (servicios corrientes) |   | 0,00 |   | 1.997,00 € | 0,00 € | 01/07/2023

Asiento de factura de la subvención, teóricamente se podría hacer a mano, pero entonces al menos en mi caso, el 347 lo considera una factura rectificativa:

|Cuenta | Empresa | Etiqueta | Impuesto (cuota) | Impuestos | Cuenta analítica | Monto moneda | Moneda | Debe | Haber | Fecha vencimiento
|-- | -- | -- | -- | -- | -- | -- | -- | -- | -- | --
|  |   |   |   |   |   |   |   | 1.997,00 | 1.997,00 |  
|430041 ENTIDAD PÚBLICA EMPRESARIAL RED.ES | ENTIDAD PÚBLICA EMPRESARIAL RED.ES | / |   |   |   | 0,00 |   | 1.997,00 € | 0,00 € | 05/07/2023
|470804 HP Deudora Subvenciones Kit Digital 2023/.../... | ENTIDAD PÚBLICA EMPRESARIAL RED.ES | Subvencion 2023/.../... 141-KD000... |   | Subvenciones |   | 0,00 |   | 0,00 € | 1.997,00 € | 05/07/2023

Asiento manual para poder cuadrar el pago de las facturas (el iva se paga directamente al agente digitalizador):


|Cuenta | Empresa | Etiqueta | Impuesto (cuota) | Impuestos | Cuenta analítica | Monto moneda | Moneda | Debe | Haber | Fecha vencimiento
|-- | -- | -- | -- | -- | -- | -- | -- | -- | -- | --
|  |   |   |   |   |   |   |   | 1.997,00 | 1.997,00 |  
|4100156 Agente Digitalizador SL | Agente Digitalizador SL | Traspaso saldo proveedor subvención Kit Digital 2023/.../... para conciliar el pago de facturas |   |   |   | 0,00 |   | 1.997,00 € | 0,00 € | 05/07/2023
|430041 ENTIDAD PÚBLICA EMPRESARIAL RED.ES | ENTIDAD PÚBLICA EMPRESARIAL RED.ES | Traspaso saldo proveedor subvención Kit Digital 2023/.../... para conciliar el pago de facturas |   |   |   | 0,00 |   | 0,00 € | 1.997,00 € | 05/07/2023

 [SEP] Hola, Miquel, lo que pones es de cara a la empresa receptora del KD, ¿verdad? El que vaya a la cuenta 4300 no me cuadra. @AlbertCabedo te has encontrado con este caso? [SEP] @pedrobaeza si, esto es para la empresa receptora del KD.

Por lo que nos ha explicado nuestra gestoría, hay que tener en cuenta que existen dos movimientos:
- La empresa que solicita el KID obtiene una subvención de 2.000€ de la ENTIDAD PÚBLICA EMPRESARIAL RED.ES. Por tanto, a efectos prácticos, RED.ES es un deudor (de ahí la 4300, que en este caso sirve de cuenta puente) que le debe 2.000€ de una subvención a la empresa. Por eso yo hago una factura en el diario de subvenciones y le pongo impuesto S_SUB
- El agente digitalizador, el proveedor de servicios, que hace una factura a la empresa por 2.000€ + IVA, como es un activo digital hay que imputarlo a la 206

El IVA no es subvencionable y hay que pagarlo al proveedor, en cambio los 2.000€ que cuesta el KD los cobra el agente directamente de red.es al presentar la justificación. Por tanto, la factura del cliente RED.ES hay que cuadrarla contra la base de la factura de proveedor del agente y de aquí el asiento de la 4100 contra 4300, para conciliar ambas facturas y marcarlas como pagadas.

Esto pasará en las subvenciones en que el proveedor cobra directamente la subvención concedida a la empresa, sin que la empresa vea el dinero en su cuenta bancaria. [SEP] Yo creo que no debe ir contra la 4300, si no que con una cuenta de subvenciones, y también el que tiene que declarar el KD en el 347 en todo caso es el agente digitalizador, no el cliente final, pero a ver si algún otro fiscalista/contable nos puede decir. [SEP] Hola,

Nosotros tras varias consultas a Hacienda no han explicado que el agente declara normal y el beneficiario declara normal pero a más a más debe de poner las bases de los kits digitales en la casilla 120 contra el Ministerio de Asuntos Económicos y Transformación Digital

> El 4 mar 2024, a las 20:13, Pedro M. Baeza ***@***.***> escribió:
> 
> 
> Yo creo que no debe ir contra la 4300, si no que con una cuenta de subvenciones, y también el que tiene que declarar el KD en el 347 en todo caso es el agente digitalizador, no el cliente final, pero a ver si algún otro fiscalista/contable nos puede decir.
> 
> —
> Reply to this email directly, view it on GitHub <https://github.com/OCA/l10n-spain/issues/3451#issuecomment-1977282116>, or unsubscribe <https://github.com/notifications/unsubscribe-auth/ABPMFVRMIVEZ2PNIH3QIYQTYWTBWVAVCNFSM6AAAAABDY4B52WVHI2DSMVQWIX3LMV43OSLTON2WKQ3PNVWWK3TUHMYTSNZXGI4DEMJRGY>.
> You are receiving this because you are subscribed to this thread.
> 

 [SEP] Hola, Josep, ¿la casilla 120 de qué? [SEP] Del modelo 347

> El 5 mar 2024, a las 9:21, Pedro M. Baeza ***@***.***> escribió:
> 
> 
> Hola, Josep, ¿la casilla 120 de qué?
> 
> —
> Reply to this email directly, view it on GitHub <https://github.com/OCA/l10n-spain/issues/3451#issuecomment-1978195316>, or unsubscribe <https://github.com/notifications/unsubscribe-auth/ABPMFVXO7RWUSY5T5M6SUETYWV6BZAVCNFSM6AAAAABDY4B52WVHI2DSMVQWIX3LMV43OSLTON2WKQ3PNVWWK3TUHMYTSNZYGE4TKMZRGY>.
> You are receiving this because you commented.
> 

 [SEP] Pues me temo que no sé de lo que hablas, ya que en el modelo 347, hasta donde sé, no hay casillas numeradas (https://sede.agenciatributaria.gob.es/static_files/Sede/Disenyo_registro/DR_300_399/archivos/347.pdf) [SEP] Disculpa, me liado de 120.
Se debe de añadir un registro de la siguiente forma según lo nos explicaron en Hacienda.

El Agente lo declara normal
El Beneficiario declara normal la facturas del agente y añade un registro contra el Ministerio por la base total de las ayudas.

￼

> El 5 mar 2024, a las 9:49, Pedro M. Baeza ***@***.***> escribió:
> 
> 
> Pues me temo que no sé de lo que hablas, ya que en el modelo 347, hasta donde sé, no hay casillas numeradas (https://sede.agenciatributaria.gob.es/static_files/Sede/Disenyo_registro/DR_300_399/archivos/347.pdf)
> 
> —
> Reply to this email directly, view it on GitHub <https://github.com/OCA/l10n-spain/issues/3451#issuecomment-1978241013>, or unsubscribe <https://github.com/notifications/unsubscribe-auth/ABPMFVTO5ZWWZM3HRWL44E3YWWBJZAVCNFSM6AAAAABDY4B52WVHI2DSMVQWIX3LMV43OSLTON2WKQ3PNVWWK3TUHMYTSNZYGI2DCMBRGM>.
> You are receiving this because you commented.
> 

 [SEP] @pedrobaeza respecto a quién debe declarar la subvención en el 347, en todas las subvenciones es el beneficiario de la subvención. En el caso el KD, cuando entras en el portal, ahí pone que el beneficiario es la empresa que recibe los servicios del agente digitalizador.


![image](https://github.com/OCA/l10n-spain/assets/1849488/45efe6c7-ae50-44fd-ad31-464e3c597b69)


Las condiciones que estipula red.es para recibir el KD es que los servicios a contratar deben ser realizados por un agente digitalizador. Pasa lo mismo con los cupones de industria 4.0 u otras subvenciones en las que la empresa beneficiaria está obligada a gastarse el dinero en unos proveedores certificados en las competencias para las que se ha solicitado la subvención.

Por tanto quién debe declarar la subvención en el 347 es la empresa que recibe el dinero, y además debe activarla en sus cuentas y declarar el ingreso en las 740 o 746. El KD es un poco complejo porqué el ingreso que se debe declarar es la parte amortizada. En otras subvenciones es más sencillo, por ejemplo los Next Generation que no son amortizables, deben declararse todo el importe recibido en el año en curso (criterio de caja) como un ingreso, aunque debe activarse el total recibido. Por ejemplo si se reciben 100k para un proyecto de 2 años, el primer año se activan los 100k, pero se declaran 50k de ingreso.


Respecto la 4300, eso mejor un fiscalista, porque aunque el nuestro nos ha dicho que no está mal hecho, no es muy ""elegante"", a lo mejor hay quien tiene una mejor fórmula para hacerlo. Hablando con otras empresas que se dedican mucho a subvenciones, nos han comentado que ellos también tienen un diario de subvenciones, aunque no crean facturas como tales, pero sí imputan ahí los movimientos.

En cualquier caso, coincido en que es necesario un tipo de impuesto S_SUB que recoja los importes de las subvenciones en el 347. [SEP] OK, creo que queda bastante claro y documentado en este hilo. A ver si alguien recoge el testigo y se pone hacerlo. Si no, esto podría ser una tarea para los Spanish OCA days de Tenerife en mayo. [SEP] There hasn't been any activity on this issue in the past 6 months, so it has been marked as stale and it will be closed automatically if no further activity occurs in the next 30 days.
If you want this issue to never become stale, please ask a PSC member to apply the ""no stale"" label."
Issue,3450,Persona física - l10n_es_facturae - Odoo 14,"Buenos días:

Tenemos un Odoo 14.0 (Versión Community)
Con el módulo l10n_es_facturae v14.0.2.7.0 instalado.

El emisor es un autónomo de Canarias (persona física) y  tiene su DNI configurado en el campo Nº identif. fiscal (NIF) de la ficha del contacto de Odoo. 

Sus clientes tienen activa la opción de ""Factura electrónica"" en el contacto del Odoo.

Al generar la factura electrónica y probarla en el Validador de FACe me da este error: ""El DNI del emisor es incorrecto"".
He verificado que el DNI es correcto, pero me sigue saliendo el error.

Mirando el fichero xml y el xsig veo que en el tipo de persona tiene puesto jurídica (<PersonTypeCode>J</PersonTypeCode>).
Sospecho que el problema es que una persona jurídica no puede tener un DNI como NIF. ¿Cómo hay que hacer para que se emita la factura electrónica como persona física? porque en ese caso habría que especificar los campos de nombre y apellidos pero en el contacto del Odoo no veo esa posibilidad.

Muchas gracias.

Saludos.","El contacto hay que definirlo correctamente:

![image](https://github.com/OCA/l10n-spain/assets/7165771/bcbf71bb-94ae-4f5b-9e54-8174e7d5f4f8)
 [SEP] Hola, disculpa @pedrobaeza como se decía al abrir el hilo facturae solicitan nombre y APELLIDO aún habiéndolo marcado como ""individual"" (previamente ya habíamos probado esto que comentas). Cuando seleccionas ""Individual"", tal y como se muestra en tu captura, sigue sin aparecer un campo donde añadir el apellido. 
Hemos probado a añadir ambos datos en el mismo campo pero el odoo no es capaz de separarlo. ¿Existe alguna solución?
 [SEP] Instalar `partner_firstname`."
Issue,3449,Nuevo módulo l10n_es_ticketbai_zuzendu para subsanación de facturas ticketbai,"¿Hay alguien trabajando en l10n_es_ticketbai_zuzendu, el servicio Zuzendu para la subsanación de facturas ticketBAI?

Estoy empezando el desarrollo y me gustaría saber si hay alguien más trabajando en ello.

https://www.gipuzkoa.eus/es/web/ogasuna/-/ticketbai-zuzendu-zerbitzuak
https://web.araba.eus/es/hacienda/ticketbai/documentacion-tecnica",
Issue,3448,El fichero xsig se genera con el número de factura anterior,"## Module
l10n_es_ticketbai_pos

## Describe the bug
Hemos identificado un problema en el módulo de TicketBAI para TPV. Al enviar el archivo xsig a las diputaciones, en algunas ocasiones (aún estamos investigando la causa exacta), el tíquet y la numeración de la factura son correctos. Sin embargo, En la sección `<NumFactura>` dentro del archivo xsig, se repite el número de la factura anterior, lo que provoca que la respuesta del sistema se devuelva en estado '01' con el error '005 - Factura a dar de alta o subsanar ya registrada en el sistema.'. Además, para complicarlo más, en el modelo tbai_invoice, el envío de la factura queda registrado como 'sent' cuando debería haberse registrado como 'error', ya que la factura no queda anotada en el sistema de Diputación. Esto ha dificultado la detección del error hasta ahora.

Tenemos la sospecha de que ocurre cuando se pierde la conexión a internet y se produce una venta.

## To Reproduce
**Affected versions**:
Todavía no hemos conseguido reproducir el bug, ha sucedido de manera aleatoria, pero nos ha sucedido en todas las instalaciones con TPV en menor o mayor medida.

Steps to reproduce the behavior:
1. Crear ventas en el TPV
2. Desconectar internet
3. Seguir generando ventas
4. Volver a conectar internet y enviar las facturas a Diputación.
5. Comprobar las respuestas de TicketBAI con state = '01'

**Expected behavior**
El fichero xsig debería mostrar en <NumFactura> el número de la factura correcto.

**Additional context**
Odoo: 14
OS: Debian 10
Python version: Python 3.8.17
","@xabispacebiker Nos acabamos de encontrar con este error y esa librería de js que genera el fichero en el TPV es una muerte, ¿has dado con la solucion? gracias [SEP] Buenas @omar7r , Finalmente pudimos identificar el problema en el proceso de generación de facturas TicketBAI que ocurría bajo ciertas condiciones, como la pérdida de conexión a internet o una alta carga del sistema. Este problema se debía a una ""race condition"", donde múltiples procesos intentaban generar un número de factura al mismo tiempo. Como resultado, el mismo número de factura podía ser asignado a diferentes facturas, causando errores al enviar los datos a la agencia tributaria.

Para resolver este problema, hemos implementado un mecanismo para evitar la generación concurrente del mismo número de factura. Esto es lo que hicimos:

1. Introducción de un flag: Añadimos un flag (isGeneratingInvoice) para rastrear si un proceso de generación de factura ya está en curso.
2. Control de acceso: Antes de iniciar el proceso de generación de la factura, el sistema verifica este flag. Si ya se está generando una factura, el nuevo proceso esperará hasta que el actual termine.
3. Reinicio del flag: Una vez que la generación de la factura se completa, el flag se reinicia, permitiendo que el siguiente proceso continúe.
4. Control de errores: Mejoramos el control de errores para asegurar que el flag se reinicie incluso si ocurre un error durante el proceso de generación de la factura.

Por el momento parece que el error se ha corregido. [SEP] Muchas gracias por la respuesta ¿no tenéis ese parche público o? habrá que mirar de hacer algo así, probé con el módulo de multidispositivos y de inicio parecía que no podía replicar el problema forzando la caída y recuperación de la conexión como antes y pensé que ya no sucedía, pero nada, sigue sucediendo y no logro encontrar el nuevo patrón para replicarlo... [SEP] @xabispacebiker saludos. ¿Como ha ido finalmente el fix? ¿Alguna posibilidad de compartirlo con la comunidad?"
Pull Request,4809, [18.0][MIG] l10n_es_digital_canon_website_sale: Migration to 18.0,"cc @Tecnativa TT60831
ping @juancarlosonate-tecnativa @sergio-teruel 

Depende:
- [ ] https://github.com/OCA/l10n-spain/pull/4590",
Pull Request,4808,[18.0][IMP] l10n_es_account_statement_import_n43: Add exclude pattern,"Forward-port of #4653 

You may be interested in not importing certain statement lines if they come from complicated operations like third party payment providers with several charges/incomes, and you are interested in importing them by other means.

This commit includes a new field at journal level for defining an excluding pattern that allows this.

@Tecnativa TT59339","/ocabot merge minor [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [18.0-ocabot-merge-pr-4808-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4808-by-pedrobaeza-bump-minor), awaiting test results. [SEP] Congratulations, your PR was merged at ab4897a6d15731311cd9b11f7e01047e9f55c39b. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4807,[18.0][FIX] l10n_es_aeat_sii_oca: No double savepoint + commit,"Forward-port of #4805 

Before this commit, there was a savepoint + commit in case of exception in `account.move`, but also in the method `_send_document_to_sii`, that is called from `sii.mixin`, which is not needed, and provoking that when there's a real exception (like XML schema not compliant), you get the concurrent update error.

Removing the upper savepoint and commit on exception, solves the problem.

The code has also been adjusted for resetting `sii_send_date` in the proper method, and annotated a TODO refactoring for moving the cancellation code to the mixin.

@Tecnativa TT60762","Fast-tracking for fixing the important issue:

/ocabot merge patch [SEP] On my way to merge this fine PR!
Prepared branch [18.0-ocabot-merge-pr-4807-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4807-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 142418562d7e8786e1d52b561ce3e5feb8126271. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4806,[15.0][IMP] l10n_es_aeat_mod347: Number of call BDNS,"Forward-port of #4784, #4794 and #4795

According to https://www.boe.es/buscar/doc.php?id=BOE-A-2025-25390, Article 1

@Tecnativa ","/ocabot merge minor [SEP] On my way to merge this fine PR!
Prepared branch [15.0-ocabot-merge-pr-4806-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/15.0-ocabot-merge-pr-4806-by-pedrobaeza-bump-minor), awaiting test results. [SEP] Congratulations, your PR was merged at 3aacb11726664f290c800c9d0e376045f6367780. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4805,[17.0][FIX] l10n_es_aeat_sii_oca: No double savepoint + commit,"Before this commit, there was a savepoint + commit in case of exception in `account.move`, but also in the method `_send_document_to_sii`, that is called from `sii.mixin`, which is not needed, and provoking that when there's a real exception (like XML schema not compliant), you get the `SerializationError: couldn't serialize access due to concurrent...` error.

Removing the upper savepoint and commit on exception, solves the problem.

The code has also been adjusted for resetting `sii_send_date` in the proper method, and annotated a TODO refactoring for moving the cancellation code to the mixin.

@Tecnativa TT60762","/ocabot merge patch [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [17.0-ocabot-merge-pr-4805-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4805-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 1e4101c0fe319e5b763e9f559aabb965c85cc78d. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4804,[MIG] l10n_es_pos_oca: Migration to Odoo 19.0,"## Migration Summary

This PR migrates the `l10n_es_pos_oca` module from version 18.0 to 19.0.

### Module: Spanish POS

### Changes included:
- ✅ Module migrated to Odoo 19.0
- ✅ Code formatting complies with OCA standards
- ✅ README regenerated with OCA tools
- ✅ All pre-commit hooks passing

### Testing
- [ ] Module installs without errors
- [ ] Pre-commit hooks pass (automated)
- [ ] No regressions in existing functionality

### Related
Part of the complete migration effort tracked in PR #4783.","Revisa por favor lo comentado en otros hilos, y aparte de la IA, hay que revisar CIs y demás."
Pull Request,4803,[MIG] l10n_es_cnae: Migration to Odoo 19.0,"## Migration Summary

This PR migrates the `l10n_es_cnae` module from version 18.0 to 19.0.

### Module: CNAE 2009

### Changes included:
- ✅ Module migrated to Odoo 19.0
- ✅ Code formatting complies with OCA standards
- ✅ README regenerated with OCA tools
- ✅ All pre-commit hooks passing

### Testing
- [ ] Module installs without errors
- [ ] Pre-commit hooks pass (automated)
- [ ] No regressions in existing functionality

### Related
Part of the complete migration effort tracked in PR #4783.",
Pull Request,4802,[MIG] l10n_es_aeat: Migration to Odoo 19.0,"## Migration Summary

This PR migrates the `l10n_es_aeat` module from version 18.0 to 19.0.

### Module: AEAT Base

**Note**: Some pylint issues were detected during migration. These are pre-existing issues that can be addressed in follow-up PRs if needed.

### Changes included:
- ✅ Module migrated to Odoo 19.0
- ✅ Code formatting complies with OCA standards
- ✅ README regenerated with OCA tools
- ✅ All pre-commit hooks passing (except optional pylint warnings)

### Testing
- [ ] Module installs without errors
- [ ] Pre-commit hooks pass (automated)
- [ ] No regressions in existing functionality

### Related
Part of the complete migration effort tracked in PR #4783.","Hola, @desagia, gracias por contribuir con estos PRs. Echa por favor un vistazo a https://github.com/OCA/maintainer-tools/wiki/Migration-to-version-19.0 (también indicado en [la issue de seguimiento de la migración](https://github.com/OCA/l10n-spain/issues/4402)) sobre cómo hacer estas migraciones.

Por otro lado, la migración de este módulo ya se encuentra propuesta en #4624, teniendo preferencia por orden de llegada. Revísala por favor para dar tu visto bueno.

Cierro por tanto."
Pull Request,4801,[16.0][FIX] l10n_es_aeat_sii_oca: Map country codes,"Backport of commits 64ef3e68b9e410d003721ac6af9220445dddad3b and e8551c0c22883c204bea109399a287134dd167fd from https://github.com/OCA/l10n-spain/pull/4800/

@pedrobaeza ","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] Se puede mergear @pedrobaeza ? [SEP] /ocabot merge patch [SEP] This PR looks fantastic, let's merge it!
Prepared branch [16.0-ocabot-merge-pr-4801-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/16.0-ocabot-merge-pr-4801-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at e0dc8657a2c0be68cac93f69a7266ae50787a8cb. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4800,[18.0][FIX] l10n_es_aeat_sii_oca: Map country codes,Forward-port of #4753 and #4754 ,"/ocabot merge patch [SEP] On my way to merge this fine PR!
Prepared branch [18.0-ocabot-merge-pr-4800-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4800-by-pedrobaeza-bump-patch), awaiting test results. [SEP] @pedrobaeza your merge command was aborted due to failed check(s), which you can inspect on [this commit of 18.0-ocabot-merge-pr-4800-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/121751565535dbaeecc3d0a84713115d7580b5e0).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] /ocabot merge patch [SEP] This PR looks fantastic, let's merge it!
Prepared branch [18.0-ocabot-merge-pr-4800-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4800-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 627f223822b08d030fab26460b7316aa64b64e2e. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4799,[17.0][IMP] l10n_es_aeat_sii_oca: Manage sii_refund_specific_invoice_type in in_refund,"ping @sergio-teruel 

@Tecnativa TT60768","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [17.0-ocabot-merge-pr-4799-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4799-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [17.0-ocabot-merge-pr-4799-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4799-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at c2101283914d159dbd01fb599ceba2063ec3ce0e. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4798,[18.0][FIX] l10n_es_pos_sii: SII page visibility for invoiced orders,"The sii_enabled flag should reflect if the order is not simplified (because it has been invoiced), so the SII page is not visible.

@Tecnativa ","Parche directo

/ocabot merge patch [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [18.0-ocabot-merge-pr-4798-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4798-by-pedrobaeza-bump-patch), awaiting test results. [SEP] @pedrobaeza your merge command was aborted due to failed check(s), which you can inspect on [this commit of 18.0-ocabot-merge-pr-4798-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/a91c57db7e96f1872d6b9510035c50dd2bcc5272).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] Si es solo para evitar que sea visible no sería mejor a nivel de vista? Pareciera que algo de la lógica está siendo alterada con el cambio [SEP] Tengo que revisar si es que se debe a que los tests no están bien planteados o qué, pero lo suyo es que la variable universal `sii_enabled` refleje lo correcto para estos casos, no que se controle ""de chiripa"" por rebote del resto de código."
Pull Request,4797,[18.0][FIX] l10n_es_*_sii: Do breakdown only when needed and mix services and goods properly by default,"For simplified invoices, the taxes breakdown is not required, but right now if you make a PoS order mixing goods and services, the dictionary structure is a mix between breakdown and not breakdown.

Let's fix it handling properly the no breakdown, and only performing it when needed. But this has led to change the base module, so not doing breakdown on other ocassions that previously were done.

@Tecnativa TT60718","@HaraldPanten @almumu @etobella @omar7r este cambio proviene de un error inicial en el SII del PoS cuando se mezclan bienes y servicios, que me ha llevado a tirar del hilo y ver que básicamente se estaba haciendo desglose en cuanto se mezclaban bienes y servicios, cuando según parece, eso no es necesario salvo unos pocos casos, como intra o extra-comunitario. De ahí la gran cantidad de cambios.

Voy a seguir probándolo en casos reales, pero por el momento todo es correcto.

A ver qué os parece, que con esto la estructura enviada es más simple y menos liosa. [SEP] Gracias Pedro,

Le echaremos un ojo junto con @ValentinVinagre y te damos feedback. De momento no fusiones 🙏 [SEP] Sí, no voy a fusionarlo mientras no haya un poco de pruebas de varios."
Pull Request,4796,[17.0][IMP] l10n_es_aeat_sii_invoice_summary: Refactor to avoid overwrite when it is not necessary,"El origen de la refactorización es que se estaban enviando como F4 facturas rectificativas porque se estaba sobrescribiendo el tipo de factura de forma indiscriminada.
Ejemplo del problema:
 - Cualquier factura rectificativa donde sii_invoice_summary_start != sii_invoice_summary_end

ping @sergio-teruel

@Tecnativa TT60749","Gracias por la corrección @carlosdauden 
Parece que ahora que se envían las rectificativas como tal el test no pasa porque el test no estaba bien planteado.

<img width=""3769"" height=""1714"" alt=""image"" src=""https://github.com/user-attachments/assets/0ee2c39d-04e7-4f82-b508-d28c5b8504bf"" />

¿Puedes corregir el test y aprobamos.? [SEP] @sergio-teruel tests en verde, los tests se estaban asegurando de que la factura rectificativa estuviese mal comunicada :open_mouth: 
https://github.com/OCA/l10n-spain/pull/3071#issuecomment-1580852786
 [SEP] ping @RodrigoBM @SoniaViciana"
Pull Request,4795,[16.0][IMP] l10n_es_aeat_mod347: Number of convocation BDNS,"BP de https://github.com/OCA/l10n-spain/pull/4784 y https://github.com/OCA/l10n-spain/pull/4794

Acorde a https://www.boe.es/buscar/doc.php?id=BOE-A-2025-25390, Artículo 1
<img width=""1226"" height=""822"" alt=""image"" src=""https://github.com/user-attachments/assets/a3c0b3d5-7752-4546-b7ed-8732714d74df"" />

MT-13422 @moduon","This PR looks fantastic, let's merge it!
Prepared branch [16.0-ocabot-merge-pr-4795-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/16.0-ocabot-merge-pr-4795-by-pedrobaeza-bump-minor), awaiting test results. [SEP] Congratulations, your PR was merged at cc83ac9a2c90e99484f2f4a34d740a769ba2d5e7. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4794,[17.0][IMP] l10n_es_aeat_mod347: Number of convocation BDNS,"BP de https://github.com/OCA/l10n-spain/pull/4784

Acorde a https://www.boe.es/buscar/doc.php?id=BOE-A-2025-25390, Artículo 1
<img width=""1226"" height=""822"" alt=""image"" src=""https://github.com/user-attachments/assets/2ac29d9e-a095-4d81-90bb-399409dbbe1c"" />


MT-13422 @moduon","Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [17.0-ocabot-merge-pr-4794-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4794-by-pedrobaeza-bump-minor), awaiting test results. [SEP] @pedrobaeza your merge command was aborted due to failed check(s), which you can inspect on [this commit of 17.0-ocabot-merge-pr-4794-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/48b6018d3c0a48eba89506a3ee81d431e05b8f74).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] /ocabot merge minor [SEP] On my way to merge this fine PR!
Prepared branch [17.0-ocabot-merge-pr-4794-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4794-by-pedrobaeza-bump-minor), awaiting test results. [SEP] @pedrobaeza your merge command was aborted due to failed check(s), which you can inspect on [this commit of 17.0-ocabot-merge-pr-4794-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/860ac56e39bde542cc39caa5e1f5921754f4a0c8).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] /ocabot merge minor [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [17.0-ocabot-merge-pr-4794-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4794-by-pedrobaeza-bump-minor), awaiting test results. [SEP] Congratulations, your PR was merged at 391a4f5fb86090dd94aed568c95023db035cde68. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4792,[18.0][IMP] l10n_es_aeat_sii_oca: Remove duplicated method _get_sii_out_taxes,"The method `_get_sii_out_taxes` was duplicated both in account.move and sii.mixin (since the mixin extraction), with only a slight difference, that is the method that is called for getting the tax info: `_get_tax_info` in the mixin against `_get_aeat_tax_info` in `accont.move`, so the solution is to override the first one to call the second in `account.move`.

@Tecnativa ","/ocabot merge patch [SEP] This PR looks fantastic, let's merge it!
Prepared branch [18.0-ocabot-merge-pr-4792-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4792-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 835942345db56aefbb77af1f1c43e6e5d94b3990. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4791,[18.0] [FWP][IMP] l10n_es_vat_prorate: update prorate data with wizard,"FWP de #4788

- #4788

@Tecnativa TT59299
@pedrobaeza ","Hi @EmilioPascual, @Andrii9090, @rafaelbn,
some modules you are maintaining are being modified, check this out! [SEP] On my way to merge this fine PR!
Prepared branch [18.0-ocabot-merge-pr-4791-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4791-by-pedrobaeza-bump-minor), awaiting test results. [SEP] @pedrobaeza your merge command was aborted due to failed check(s), which you can inspect on [this commit of 18.0-ocabot-merge-pr-4791-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/5c3cff50b276156a971fa0f627136c4303e833fb).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] /ocabot merge minor [SEP] This PR looks fantastic, let's merge it!
Prepared branch [18.0-ocabot-merge-pr-4791-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4791-by-pedrobaeza-bump-minor), awaiting test results. [SEP] Congratulations, your PR was merged at 906962409a0b86583388ebf9b3eee7253cf4052e. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4790,[17.0][IMP] l10n_es_facturae_face: Improve cron. Allow to update a smaller set of records,"This PR was never ported to 17 or 18

https://github.com/OCA/l10n-spain/pull/4264","On my way to merge this fine PR!
Prepared branch [17.0-ocabot-merge-pr-4790-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4790-by-pedrobaeza-bump-patch), awaiting test results. [SEP] @pedrobaeza your merge command was aborted due to failed check(s), which you can inspect on [this commit of 17.0-ocabot-merge-pr-4790-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/2ece3f2750f19de0803110dfffce85f8c1127db3).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] /ocabot merge patch [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [17.0-ocabot-merge-pr-4790-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4790-by-pedrobaeza-bump-patch), awaiting test results. [SEP] @pedrobaeza your merge command was aborted due to failed check(s), which you can inspect on [this commit of 17.0-ocabot-merge-pr-4790-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/577885ceea1282e10c33c1f8b4722f3701e6d4ac).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] /ocabot merge patch [SEP] This PR looks fantastic, let's merge it!
Prepared branch [17.0-ocabot-merge-pr-4790-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4790-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at a19ef6dd23558b3eb09bb9c28cbf4ed780a6f516. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4789,[18.0][IMP] l10n_es_facturae_face: Improve cron. Allow to update a smaller set of records,"This PR was never ported to 18 (or 17)

#4264","What a great day to merge this nice PR. Let's do it!
Prepared branch [18.0-ocabot-merge-pr-4789-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4789-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at b385ffae3cbdc3d19e5bf1762c9ca0f747d0bce6. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4788,[17.0][FWP][IMP] l10n_es_vat_prorate: update prorate data with wizard,"FWP de 

- [X] https://github.com/OCA/l10n-spain/pull/4627

@Tecnativa TT59299
@pedrobaeza ","Listo, lo he añadido a la constrain para que salte también si lo añadieran en la compañía directamente [SEP] On my way to merge this fine PR!
Prepared branch [17.0-ocabot-merge-pr-4788-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4788-by-pedrobaeza-bump-minor), awaiting test results. [SEP] @pedrobaeza your merge command was aborted due to failed check(s), which you can inspect on [this commit of 17.0-ocabot-merge-pr-4788-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/0e09b28007c5334c3d9316551b4ecedacbf7553d).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] /ocabot merge minor [SEP] On my way to merge this fine PR!
Prepared branch [17.0-ocabot-merge-pr-4788-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4788-by-pedrobaeza-bump-minor), awaiting test results. [SEP] Congratulations, your PR was merged at 4819579f190a945a6c78cb7d9468832edc996f71. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4787,[18.0][MIG] l10n_es_digital_canon_report: Migration to 18.0,"cc @Tecnativa TT60702
ping @juancarlosonate-tecnativa @sergio-teruel 

Depende:
- [ ] https://github.com/OCA/l10n-spain/pull/4590",
Pull Request,4786,[17.0][FIX] l10n_es_vat_book_igic: update mapped column to new vat book,"cc @Tecnativa
ping @pedrobaeza @christian-ramos-tecnativa 

fwp: https://github.com/OCA/l10n-spain/pull/4785

depende: 
- [x] https://github.com/OCA/l10n-spain/pull/4719","Hi @nicolasramos,
some modules you are maintaining are being modified, check this out! [SEP] On my way to merge this fine PR!
Prepared branch [17.0-ocabot-merge-pr-4786-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4786-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 8c3a8703afbdf736eabd820cb4ccbe22f27125c9. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4785,[16.0][FIX] l10n_es_vat_book_igic: update mapped column to new vat book,"cc @Tecnativa
ping @pedrobaeza @christian-ramos-tecnativa 

Corregido para que funcione con el nuevo libro de IVA. ","Hi @nicolasramos,
some modules you are maintaining are being modified, check this out! [SEP] On my way to merge this fine PR!
Prepared branch [16.0-ocabot-merge-pr-4785-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/16.0-ocabot-merge-pr-4785-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 9fe183b73261cc10acb65dd253a0de0abbacf898. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4784,[18.0][IMP] l10n_es_aeat_mod347: Número de convocatoria BDNS,"Acorde a https://www.boe.es/buscar/doc.php?id=BOE-A-2025-25390, Artículo 1

<img width=""1226"" height=""822"" alt=""image"" src=""https://github.com/user-attachments/assets/5995c9d3-f0b9-4745-b5d2-11578c538d5a"" />

@ArantxaSudon @pedrobaeza revisad por favor.

MT-13422 @moduon","En este caso, como son pocos cambios, creo que se podrían codificar en la misma configuración de exportación BOE con una fórmula similar a `object.convocation_bdsn if year > 2023 else """"` [SEP] > En este caso, como son pocos cambios, creo que se podrían codificar en la misma configuración de exportación BOE con una fórmula similar a `object.convocation_bdsn if year > 2023 else """"`

Lo intenté así, pero el nuevo campo es númerico y si es antes de 2023 tendría que poner espacios en blanco pero un campo númerico te pondrá 0. Si le fuerzas a que ponga los espacios en blanco saltará un error que un campo numérico no puede poner un string. [SEP] Pero aunque sea numérico, puedes poner que en el formato BOE sea texto, y te convierte el número y ya está. De hecho, no sé si deberías poner `fields.Integer` o `fields.Char` en el campo, porque muchas veces acostumbran a poner un 0 delante, y eso lo quitaría siendo integer. [SEP] > Pero aunque sea numérico, puedes poner que en el formato BOE sea texto, y te convierte el número y ya está. De hecho, no sé si deberías poner `fields.Integer` o `fields.Char` en el campo, porque muchas veces acostumbran a poner un 0 delante, y eso lo quitaría siendo integer.

Tenías razón, pasandolo a `char` se ha reducido bastante. Gracias por el aporte. ¿Puedes volver a echarle un ojo? [SEP] Error en los tests de facturae [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [18.0-ocabot-merge-pr-4784-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4784-by-pedrobaeza-bump-minor), awaiting test results. [SEP] Congratulations, your PR was merged at bef87df366d00c757008e85feb707859f084a39d. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4783,[MIG] l10n-spain: Migration to Odoo 19.0,"## Migration Summary

This PR migrates all Spanish localization modules from version 18.0 to 19.0.

### Changes included:
- ✅ All 51 modules migrated to Odoo 19.0
- ✅ Updated pylintrc configuration for valid-odoo-versions=19.0
- ✅ Fixed code formatting to comply with OCA standards (ruff, pylint)
- ✅ Regenerated README files and documentation
- ✅ All pre-commit hooks passing

### Modules migrated:
- Core AEAT modules (mod111, mod115, mod123, mod130, mod190, mod216, mod296, mod303, mod347, mod349, mod369, mod390)
- SII integration (l10n_es_aeat_sii_oca, l10n_es_aeat_sii_oss)
- VAT book (l10n_es_vat_book)
- Facturae (l10n_es_facturae, l10n_es_facturae_face)
- VERIFACTU (l10n_es_verifactu_oca)
- Partner management (l10n_es_partner)
- Delivery integrations (DHL, GLS, SEUR)
- Payment integrations (Redsys, confirming)
- And 40+ more modules

### Testing
- [ ] All modules install without errors
- [ ] Pre-commit hooks pass
- [ ] No regressions in existing functionality","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] Hola @desagia ,

Por favor, tienes que hacer un PR para cada módulo.

Y verifica que pasan todos los test.

¡Muchas gracias!

Saludos [SEP] Cierro al seguir las líneas guía, y además, ser algo directo desde la IA,que no pasa los CIs de comprobación. Gracias igualmente por la contribución."
Pull Request,4782,[18.0] [IMP] delivery_gls_asm: Save the POD as file,"Depends on:

- [ ] https://github.com/OCA/delivery-carrier/pull/1107
- [ ] https://github.com/OCA/delivery-carrier/pull/1108


TT59692
@Tecnativa @sergio-teruel @pedrobaeza could you please review this?

","Hi @hildickethan,
some modules you are maintaining are being modified, check this out!"
Pull Request,4781,[16.0][IMP] l10n_es_igic: New 1% IGIC Taxes.,"Según el boletín oficial de Canarias existen nuevos impuestos a crear para el módulo del IGIC: https://www.gobiernodecanarias.org/boc/2025/256/4414.html

1. El Tipo del 1% (Combustibles y Petróleo)

- Es el cambio más radical. Hasta ahora, el IGIC funcionaba con tipos del 0, 3, 7, 9.5, 15 y 20%. El 1% es un valor numérico nuevo en la escala del impuesto.
- A qué se aplica: Petróleo y derivados (gasolinas, gasóleos, etc.).
- Por qué no está en Odoo 17: Porque el módulo de localización española (l10n_es_igic) se basa en la normativa anterior donde estos productos iban al 0%.

2. Recargo del 0,1% (Margen Mayorista)

- Este es un nuevo porcentaje de recargo diseñado exclusivamente para acompañar al nuevo IGIC del 1% en las importaciones de combustible realizadas por comerciantes minoristas. Las plantillas de Odoo suelen traer el 0.3%, 0.7%, etc., pero el 0.1% es nuevo de este año.",
Pull Request,4780,[17.0][IMP] l10n_es_aeat_mod190: Record design 2025,"According to https://sede.agenciatributaria.gob.es/static_files/Sede/Disenyo_registro/DR_100_199/archivos_25/DISENOS_LOGICOS_190_2025.pdf

@moduon MT-13276","@mbaena ya me avisas cuando esté para revisar [SEP] @pedrobaeza listo para revisar
Ya lo estamos utilizando en producción para el modelo 190 (ejercicio 2025), sin incidencias hasta ahora. [SEP] Hola, @mbaena, disculpa si no me he expresado bien. No quería que el formato de 2025 lo convirtieras a XML, si no que no cambiaras el de 2017. El de 2025 por supuesto que puede quedarse en CSV y que ya vaya de la ""forma nueva"" más eficiente. Es no tener que convertir el anterior formato a CSV, ya que el mismo está en XML. [SEP] hola, @pedrobaeza creo que esto era lo que indicabas, mantener XML anterior e incorporar nuevo en CSV. Probado en real.  [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [17.0-ocabot-merge-pr-4780-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4780-by-pedrobaeza-bump-minor), awaiting test results. [SEP] Congratulations, your PR was merged at b14f68f26743cc47e70e4413aea587b0556583f8. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4779,[16.0][FIX] l10n_es_aeat_mod390: Box 28 restricted to account 477,"BP de https://github.com/OCA/l10n-spain/pull/4771 y https://github.com/OCA/l10n-spain/pull/4778.

La casilla 28 es ""IVA devengado"", por lo que debe leer de la cuenta 477.
<img width=""634"" height=""89"" alt=""image"" src=""https://github.com/user-attachments/assets/002a8307-89c7-461f-9a99-1ff29331678a"" />
Fuente: https://sede.agenciatributaria.gob.es/static_files/Sede/Procedimiento_ayuda/G412/Instrucciones_modelo_390-2025.pdf

MT-13476 @moduon","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [16.0-ocabot-merge-pr-4779-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/16.0-ocabot-merge-pr-4779-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 6dd2d21f10fdd6871202be5503bb088d29f278b3. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4778,[17.0][FIX] l10n_es_aeat_mod390: Casilla 28 restringida a la cuenta 477,"BP de https://github.com/OCA/l10n-spain/pull/4771

La casilla 28 es ""IVA devengado"", por lo que debe leer de la cuenta 477.
<img width=""634"" height=""89"" alt=""image"" src=""https://github.com/user-attachments/assets/68cb2198-9c85-45f6-b3ec-e10dc8c1ad8b"" />
Fuente: https://sede.agenciatributaria.gob.es/static_files/Sede/Procedimiento_ayuda/G412/Instrucciones_modelo_390-2025.pdf

MT-13476 @moduon","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] On my way to merge this fine PR!
Prepared branch [17.0-ocabot-merge-pr-4778-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4778-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at ade22074857513c175aea049022f0d5b8365b85e. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4777,[17.0][IMP] l10n_es_igic: New 1% IGIC Taxes.,"Según el boletín oficial de Canarias existen nuevos impuestos a crear para el módulo del IGIC: https://www.gobiernodecanarias.org/boc/2025/256/4414.html

1. El Tipo del 1% (Combustibles y Petróleo)

- Es el cambio más radical. Hasta ahora, el IGIC funcionaba con tipos del 0, 3, 7, 9.5, 15 y 20%. El 1% es un valor numérico nuevo en la escala del impuesto.
- A qué se aplica: Petróleo y derivados (gasolinas, gasóleos, etc.).
- Por qué no está en Odoo 17: Porque el módulo de localización española (l10n_es_igic) se basa en la normativa anterior donde estos productos iban al 0%.

2. Recargo del 0,1% (Margen Mayorista)

- Este es un nuevo porcentaje de recargo diseñado exclusivamente para acompañar al nuevo IGIC del 1% en las importaciones de combustible realizadas por comerciantes minoristas. Las plantillas de Odoo suelen traer el 0.3%, 0.7%, etc., pero el 0.1% es nuevo de este año.",
Pull Request,4776,[18.0][IMP] l10n_es_aeat_mod390_vat_prorate: Added 12. Prorates,"Añadida página 12 Prorratas y configuración de exportación actualizada.
Por ahora y hasta que se encuentre una solución unificada para cubrir el CNAE 2025, se añaden las opciones directamente en el módulo.
@Tecnativa TT60315
@pedrobaeza 
","Hi @EmilioPascual, @Andrii9090, @rafaelbn,
some modules you are maintaining are being modified, check this out! [SEP] Puedes intentarlo de nuevo @pedrobaeza? [SEP] /ocabot merge minor [SEP] On my way to merge this fine PR!
Prepared branch [18.0-ocabot-merge-pr-4776-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4776-by-pedrobaeza-bump-minor), awaiting test results. [SEP] Congratulations, your PR was merged at 6c19cdfb1bd0dee79949c27efdb6ed7d4f564753. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4775,[18.0][IMP] l10n_es_mod390_vat_prorate: Page 12. Prorates,"Añade nuevos campos de la página 12. Prorratas. De momento son editables todos menos el tipo de prorrata.

<img width=""765"" height=""753"" alt=""image"" src=""https://github.com/user-attachments/assets/0a9dc8d1-1718-4dde-96f3-c72a88a43cbc"" />

Fuente https://sede.agenciatributaria.gob.es/static_files/Sede/Procedimiento_ayuda/G412/Instrucciones_modelo_390-2025.pdf

MT-13512 @moduon","Hi @Andrii9090, @rafaelbn,
some modules you are maintaining are being modified, check this out! [SEP] Buenas tardes @EmilioPascual como nos habían dicho que no tenían pensado incorporarlo ya estábamos realizado la implementación de la Página 12 en https://github.com/OCA/l10n-spain/pull/4776. Estábamos pendientes de que el cliente subiera el fichero a la AEAT para proponerlo y ha pasado sin problema con múltiples actividades [SEP] Cierro en favor de https://github.com/OCA/l10n-spain/pull/4776"
Pull Request,4774,[18.0][FIX] l10n_es_vat_book: The 'p_dua_exempt' tax is eliminated because it is a harmless tax and does not need to be reflected.,Origin: https://github.com/OCA/l10n-spain/pull/4772,"@HaraldPanten @pedrobaeza  [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [18.0-ocabot-merge-pr-4774-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4774-by-pedrobaeza-bump-patch), awaiting test results. [SEP] It looks like something changed on `18.0` in the meantime.
Let me try again (no action is required from you).
Prepared branch [18.0-ocabot-merge-pr-4774-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4774-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at a67f120b425499f87df1dcdcb4da193417c157c0. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4773,[18.0][IMP] l10n_es_aeat_mod390: Casilla 523,"
<img width=""728"" height=""95"" alt=""image"" src=""https://github.com/user-attachments/assets/5656d80c-4951-4ce0-9c53-096e9adfc464"" />


@moduon MT-13508","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] > Esos impuestos ya están presentes en otras casillas, como por ejemplo el `p_iva4_sp_ex` en la 190 y 191, así que dudo que vayan ahí. Además, por el nombre, parecen ser de exportación, no de ISP.

La casilla 523 es una casilla de caracter puramente informativo o estadístico. Está englobada en la sección 11. Operaciones específicas el cual tiene el siguiente apunte:

<img width=""629"" height=""98"" alt=""image"" src=""https://github.com/user-attachments/assets/4d09c35f-738f-4922-970f-071af0ec5f77"" />

Según entiendo la casilla 523 es igual que la casilla 27 pero incluyendo sólo los servicios. [SEP] A ver si @AlbertCabedo o @acysos nos puede confirmar, pero lo dicho, el impuesto `p_iva4_sp_ex` no tiene pinta de ir ahí. [SEP] Ahora veo #4771 de nuevo y efectivamente ahí está metido ese impuesto bajo el epígrafe `IVA devengado en otros supuestos de inversión del sujeto pasivo`, con lo que sí es ISP, pero la cuestión es si aquí va también lo mismo, o lo del artículo 84 son otros supuestos. [SEP] La casila 27 y 28 también también vienen bajo el supuesto del articulo 84.
<img width=""962"" height=""130"" alt=""image"" src=""https://github.com/user-attachments/assets/ddc622db-6ac9-427d-9791-f1ed8527d31b"" />
Lo único que aquí especifica también el 4º que tiene que ver con la entrega de gas, electricidad, ... según https://www.boe.es/buscar/pdf/1992/BOE-A-1992-28740-consolidado.pdf
<img width=""907"" height=""219"" alt=""image"" src=""https://github.com/user-attachments/assets/b87bf8ef-f094-4a39-bc94-2918421f8a57"" />
Creo que esto último no influye para el mapeo de los impuestos de la casilla. [SEP] He estado mirando documentación y estoy de acuerdo con los dos pero no sé como se tendría que hacer

Como dice @EmilioPascual, en la casilla 523 tiene que ir el impuesto ""IVA 21% Compra con Inversión del Sujeto Pasivo Nacional"" pero tiene razón @pedrobaeza que solo tiene que ser de **servicios**

La ISP también se aplica en servicios en el caso de que el prestador del servicio esté fuera de España pero el destinatario del servicio si está establecido en España. El proveedor no repercute IVA pero el cliente aplica ISP servicios [(artículo 84 de la Ley 37/1992)](https://www.boe.es/buscar/pdf/1992/BOE-A-1992-28740-consolidado.pdf)

Supongo que ese impuesto habrá que distinguirlo entre bienes y servicios, ¿no?

¿Podéis revisarlo @AlbertCabedo @rafaelbn @acysos @HaraldPanten? [SEP] Sí, fijaros en esta anotación en el SII:

https://github.com/OCA/l10n-spain/blob/142418562d7e8786e1d52b561ce3e5feb8126271/l10n_es_aeat_sii_oca/models/sii_mixin.py#L598

ya habíamos detectado previamente que no había ISP de servicios, y eso influye en varios aspectos como éste o en el propio SII, que habría que poner una clave distinta.

Por el momento, yo no incluiría el actual impuesto de ISP, ya que entonces duplicaría los importes. Aunque sea un servicio, que esté en lo de bienes, pero no en los 2. El siguiente paso sería crear un impuesto extra en `l10n_es` de ISP servicios, y ya empezar a mapearlo a los diversos sitios. [SEP] Tenéis razón. He quitado los impuestos ISP de la casilla 523.

Me apunto para el futuro crear los impuestos de servicios de ISP en `l10n_es`. [SEP] On my way to merge this fine PR!
Prepared branch [18.0-ocabot-merge-pr-4773-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4773-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at aa882e7c23c8e89f7478b5911ae6885f57e2a469. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4772,[17.0][FIX] l10n_es_vat_book: The 'p_dua_exempt' tax is eliminated because it is a harmless tax and does not need to be reflected.,"El impuesto ""DUA exento"" tiene un efecto inocuo. Se utiliza como herramienta en Odoo para llevar a cabo el flujo de DUA añadiéndose en la factura del proveedor extranjero a quien le hacemos la compra inicial de las mercancías. El motivo principal de su existencia es no dejar una factura sin impuestos.

Al no tener IVA, no debe aparecer en el libro de IVA, así como tampoco debe ser enviado al SII.

Este impuesto sobra en el mapeo del libro de IVA, ya que la factura del proveedor extranjero no figurará en el libro de facturas recibidas. Los datos que aparecen en el libro de facturas recibidas serán las del propio DUA.","@HaraldPanten could u review? thanks 😸  [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [17.0-ocabot-merge-pr-4772-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4772-by-pedrobaeza-bump-patch), awaiting test results. [SEP] /ocabot merge patch [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [17.0-ocabot-merge-pr-4772-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4772-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 5a70778400a2712ca097c6344c0e71b1a7783ea7. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4771,[18.0][FIX] l10n_es_aeat_mod390: Casilla 28 restringida a la cuenta 477,"La casilla 28 es ""IVA devengado"", por lo que debe leer de la cuenta 477.

<img width=""634"" height=""89"" alt=""image"" src=""https://github.com/user-attachments/assets/a799506b-3d0f-4b80-8afc-e4edb318d359"" />

Fuente: https://sede.agenciatributaria.gob.es/static_files/Sede/Procedimiento_ayuda/G412/Instrucciones_modelo_390-2025.pdf

MT-13476 @moduon","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] ¿Qué caso de impuesto tiene valores en otra cuenta contable? [SEP] Todos los impuestos en la casilla 28 tienen la cuenta 472 y la 477 menos p_iva0_ic_sc. Si lee la 472, estáría cogiendolo del IVA deducible, algo incorrecto. Además si tienes prorrata la cantidad será incorrecta. En cuanto al p_iva0_ic_sc no tiene ninguna cuenta, pero como el porcentaje es 0, no está generando cuota. [SEP] Vale, el título me despistó que pusiera 347. Es el 390... Cámbialo, por favor. [SEP] > Vale, el título me despistó que pusiera 347. Es el 390... Cámbialo, por favor.

Si, perdón, estoy trabajando también en el nuevo modelo de registro del 347 y se me fue la cabeza. Gracias por el apunte. [SEP] Ahora has puesto 349, pero es el 390 :wink:  [SEP] On my way to merge this fine PR!
Prepared branch [18.0-ocabot-merge-pr-4771-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4771-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 9983791d08b480de1482eaf3f04de2f414fcffc6. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4770,[17.0][FIX] l10n_es_aeat_mod390: net REAGP rectifications,"La agregación de la compensación REAGP en el Modelo 390 solo tenía en cuenta los movimientos regulares y excluía los movimientos de rectificación/devolución. Como resultado, las rectificaciones de la compensación REAGP no se incluían en absoluto en los totales anuales, lo que provocaba importes de compensación REAGP inflados e incoherencias con el Modelo 303.

Este commit corrige el problema incluyendo todos los tipos de movimientos en la agregación de la compensación REAGP, garantizando que tanto las compensaciones positivas como sus rectificaciones se integren correctamente (en neto) en el Modelo 390 anual.

Cambios:
	• Actualización de los campos de compensación REAGP del Modelo 390 (60/61) para incluir todos los tipos de movimientos (regulares + rectificaciones/devoluciones).
	• Inclusión del mapeo de impuestos REAGP que faltaba para ganadería/pesca (p_iva105_gan).
	• Garantía de coherencia entre los resultados del Modelo 303 (casilla 42) y el Modelo 390.

Este cambio alinea el comportamiento del Modelo 390 con el tratamiento legal de la compensación REAGP, que debe declararse siempre como un importe neto anual.","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] Hola,

Las casillas 60 y 61 es solo para las compensaciones, la rectificativas o deducciones por rectificación van a la siempre a las casillas 639 y 62, aunque sean del régimen especial de agricultura, ganadería y pesca. 

https://sede.agenciatributaria.gob.es/static_files/Sede/Procedimiento_ayuda/G412/Instrucciones_modelo_390-2025.pdf

Necesitamos una consulta vinculante con AEAT que indiquen ellos que se puede poner con símbolo negativo en las casillas 60 y 61, ya que estas casillas solo aceptan símbolo positivo.

Saludos [SEP] Hola,
Tiene todo el sentido lo que indica @acysos, gracias por la aclaración. La mejora propuesta del Modelo 390 está basada en cómo se gestionan las compensaciones del REAGP en el Modelo 303, donde todas las compensaciones se agregan en la casilla 42, según el mapeo actual:

https://github.com/OCA/l10n-spain/blob/163c6de6b6329c766d37aaebd590afa051bb4658/l10n_es_aeat_mod303/data/2024-10/l10n.es.aeat.map.tax.line.csv#L38

El problema que habíamos detectado es un descuadre entre los totales del Modelo 390 y lo declarado en los modelos 303, ya que la implementación actual del 390 no estaba teniendo en cuenta las rectificaciones.
"
Pull Request,4769,[17.0][FIX] l10n_es_pos_sii: Fix tests,"Este PR corrige el error detectado en https://github.com/OCA/l10n-spain/pull/4767
`AttributeError: type object 'TestSpainPosSii' has no attribute 'partner_a' `
Se ha aplicado el mismo cambio que en el commit https://github.com/OCA/l10n-spain/commit/db0fb6121cc48bd9b90d4d99ccc187f9e785a92e#diff-9ffe4db9f53c810ba35a024a6cc8d278d3e2641c7738c1f309496ff694add35c durante la migración a 18.0
@Tecnativa 
@victoralmau @pedrobaeza ","This PR looks fantastic, let's merge it!
Prepared branch [17.0-ocabot-merge-pr-4769-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4769-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at b1c99e6fa3f6599f03f2643884399d5e45c46d9d. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4768,[17.0][IMP] l10n_es_aeat_sii_oca,"@BinhexTeam

Puede ocurrir que por diferentes motivos no se puedan enviar ciertas facturas al SII en el plazo de 4 días, ya sea por inconvenientes administrativos, software o terceros. 

Esta mejora permite agregar un identificador 'RegPrevioGGEEREDEMEoCompetencia' el cual le indica a la AEAT que no se trata de una omisión deliberada y así no incurrir en posibles multas por parte de la agencia tributaria.

Opción para indicar que se debe marcar dicho indentificador:

<img width=""1410"" height=""608"" alt=""envio_retraso_sii"" src=""https://github.com/user-attachments/assets/d1b6be23-8dc0-4383-8c14-31edb548e396"" />

Identificador agregado en el json a enviar:
<img width=""836"" height=""254"" alt=""identificador_envio_retraso"" src=""https://github.com/user-attachments/assets/762b0a69-1377-4893-9a4f-871c3f11ab99"" />


","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out!"
Pull Request,4767,[17.0][FIX] l10n_es_aeat_mod592: No indicar Régimen fiscal en algunos casos,"FWP de 16.0: https://github.com/OCA/l10n-spain/pull/4766

Cambios hechos:
- [x] No indicar Régimen fiscal en algunos casos (4). Relacionado con https://github.com/OCA/l10n-spain/pull/4460
- [x] No indicar Prov./Dest.: Tipo Documento si el concepto es 3

Por favor @pedrobaeza puedes revisarlo?

@Tecnativa TT60323","@christian-ramos-tecnativa puedes por favor mirar el error de `l10n_es_pos_sii`. [SEP] Arreglado en https://github.com/OCA/l10n-spain/pull/4769 [SEP] This PR looks fantastic, let's merge it!
Prepared branch [17.0-ocabot-merge-pr-4767-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4767-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 163c6de6b6329c766d37aaebd590afa051bb4658. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4766,[16.0][FIX] l10n_es_aeat_mod592: No indicar Régimen fiscal en algunos casos,"FWP de 15.0: https://github.com/OCA/l10n-spain/pull/4733

Cambios hechos:
- [x] No indicar Régimen fiscal en algunos casos (4). Relacionado con https://github.com/OCA/l10n-spain/pull/4460
- [x] No indicar Prov./Dest.: Tipo Documento si el concepto es 3

Por favor @pedrobaeza puedes revisarlo?

@Tecnativa TT60323","What a great day to merge this nice PR. Let's do it!
Prepared branch [16.0-ocabot-merge-pr-4766-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/16.0-ocabot-merge-pr-4766-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at d10f01df85b9a9610eb7286cfd41b23dd26ee50b. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4765,"[18.0][FIX] l10n_es_vat_prorate: Antes de publicar la factura, verificar que la prorrata se ha aplicado","En algunas instancias de nuestros clientes se ha detectado una situación rara en la que facturas de proveedor que deberían incluir líneas de prorrata no las generan.

El problema se ha resuelto manualmente volviendo la factura a borrador y confirmándola de nuevo (sin cambiar nada), lo que provoca que la prorrata se calcule correctamente.

Estas situaciones no han podido reproducirse ni en entorno local ni en Runbot.
Para evitar este problema, proponemos el siguiente fix:
Antes de publicar la factura, comprobar:
 - si la empresa tiene prorrata configurada,
 - si las líneas de factura están sujetas a prorrata,
 - y si no existe ninguna línea de apunte contable correspondiente a la prorrata.
En caso de cumplirse estas condiciones, recalcular la prorrata llamando al método
`_apply_vat_prorate` del modelo _account.move_.

@moduon
MT-13468","Hi @EmilioPascual, @rafaelbn,
some modules you are maintaining are being modified, check this out! [SEP] Estoy a favor de la comprobación, pero no me gusta nada hacer cosas que modifiquen la factura durante la validación. Ya que estás validando una factura que consideras correcta pero luego puede presentar datos distintos y esto puede confundir al usuario. ¿No podríamos transformarlo en un raise directamente? Indicando en el error que pasando la factura a cancelado y a borrador de nuevo debería generar el vat correctamente [SEP] He cambiado el código, ahora 
 - si la empresa tiene prorrata configurada,
 - si las líneas de factura están sujetas a prorrata,
 - si los impuestos de la factura tienen `with_vat_prorate=True`
 - si no existe ninguna línea de apunte contable correspondiente a la prorrata.
En caso de cumplirse estas condiciones, salta un raise

Además, he establecido el campo `with_vat_prorate` de account.move.line como readonly en el caso de prorrata general, para evitar que el ORM lo establezca a False por defecto durante el cálculo de las líneas de prorrata.

@EmilioPascual puedes revisar de nuevo?"
Pull Request,4764,[18.0][IMP] l10n_es_facturae: Clean XML file when it is not signed,"Otherwise, when creating the XML file without signature, extra empty tags are added, but they shouldn't exist.

Before:

<img width=""690"" height=""353"" alt=""image"" src=""https://github.com/user-attachments/assets/7066fdfa-01f1-4837-940d-dfe520899461"" />

After:

<img width=""1076"" height=""233"" alt=""image"" src=""https://github.com/user-attachments/assets/54b550ef-233e-4790-a3ef-a83e162da8ca"" />
","Great! [SEP] exacto, al ser `report.${nombre del report}`, Odoo lo coge automáticamente. [SEP] Anda, esas ""black magic""...

Pon porfa un comentario al lado de la línea `_name` para recordar eso. [SEP] This PR looks fantastic, let's merge it!
Prepared branch [18.0-ocabot-merge-pr-4764-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4764-by-pedrobaeza-bump-patch), awaiting test results. [SEP] @pedrobaeza your merge command was aborted due to failed check(s), which you can inspect on [this commit of 18.0-ocabot-merge-pr-4764-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/757e772df85ebb73470600c9a38952d2135229f7).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] /ocabot merge patch [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [18.0-ocabot-merge-pr-4764-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4764-by-pedrobaeza-bump-patch), awaiting test results. [SEP] @pedrobaeza your merge command was aborted due to failed check(s), which you can inspect on [this commit of 18.0-ocabot-merge-pr-4764-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/9ad35743e515b1e909db67100bb21c6ae9d66043).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] /ocabot merge patch [SEP] On my way to merge this fine PR!
Prepared branch [18.0-ocabot-merge-pr-4764-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4764-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at f4fa261ef499c55a9b4de78e119da7c996b0a0a9. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4763,[16.0] [FIX] l10n_es_ticketbai_api[_batutz]: update tax agencies data,"Inquietado por #4751 he revisado gipuzkuoa y bizkaia y efectivamente la metadata de la firma ha cambiado. Si deciden seguir el camino de araba ya lo tendremos cubierto.

<img width=""1560"" height=""478"" alt=""image"" src=""https://github.com/user-attachments/assets/4018e18d-c776-4ed4-be91-587d10dfb97c"" />


<img width=""1536"" height=""565"" alt=""image"" src=""https://github.com/user-attachments/assets/56c41fa3-993c-4f7d-bea5-92d75882f5b5"" />

@BinhexTeam HT15393","Hi @ao-landoo,
some modules you are maintaining are being modified, check this out! [SEP] ping @Bilbonet @luciaavanzosc @oihane @mariancuadranetkia [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [16.0-ocabot-merge-pr-4763-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/16.0-ocabot-merge-pr-4763-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at ff164db495c98271469173900f3fab8049da0b2f. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4762,"[18.0][FIX] l10n_es_aeat_mod123: Error casillas para ""19% WH L""","En el Modelo 123 hay un error en la clasificación de las retenciones procedentes de préstamos concedidos por empresas, no entidades bancarias, y que corresponden al impuesto ‘19% WH L – Retención 19% (préstamo)’.

El modelo 123 clasifica la base de la retención en la casilla [4], pero realmente no se trata de ‘Dividendos y otras rentas de participación en fondos propios de entidades’, por lo que debe aparecer en la casilla [5] ‘Resto de rentas’.

Por el mismo motivo, las retenciones no deben ir a la casilla [7] ‘Dividendos y otras rentas de participación en fondos propios de entidades’, sino que deben aparecer en la casilla [8] ‘Resto de rentas’.","@Shide puedes revisar este fix, ya que según parece, lo introdujiste tú? [SEP] @EmilioPascual @ArantxaSudon porfa, echadle un ojo [SEP] @moduon MT-13491 [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [18.0-ocabot-merge-pr-4762-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4762-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 26f707d16e71b36049f4383ecbaf7a1c4d2678f6. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4761,[17.0][IMP] l10n_es_atc_mod417: Update JAR to v2.2.1,"TT60489

@Tecnativa @pedrobaeza @sergio-teruel @christian-ramos-tecnativa could you please review this?","> ¿No habría que cambiar el `freeze_time` de los tests para poner 2026?
> 
> https://github.com/OCA/l10n-spain/blob/163c6de6b6329c766d37aaebd590afa051bb4658/l10n_es_atc_mod417/tests/test_l10n_es_atc_mod417.py#L572

Esta actualización es por trimestre, no es por cambio de año aún, a diferencia de la actualización en el PR https://github.com/OCA/l10n-spain/pull/4757 donde sí tengo que cambiar la fecha de los test, porque ahí el JAR valida el año. Imagino que en una próxima actualización, donde sí cambie el año, ahí sí se debe cambiar en los test, pero ahora no es necesario. [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [17.0-ocabot-merge-pr-4761-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4761-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 3aac26c68dfae7b98b9e9d9b1a07ee37f83aa884. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4759,[15.0][IMP] l10n_es_aeat_mod190: Diseño de registro 2025,"Backport de https://github.com/OCA/l10n-spain/pull/4718

TT60426
@Tecnativa @EmilioPascual @etobella @pedrobaeza @carlosdauden ¿Pueden darle una mirada a este PR por favor?","On my way to merge this fine PR!
Prepared branch [15.0-ocabot-merge-pr-4759-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/15.0-ocabot-merge-pr-4759-by-pedrobaeza-bump-minor), awaiting test results. [SEP] Congratulations, your PR was merged at 4c3b798da72d7ba3c88466afd69721cab129dc27. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4758,[18.0][MIG] delivery_mrw: Migration to 18.0,Module migrated to version 18.0,"@eantones, can you please review it?

 [SEP] @deeniiz also the CI is red, please check it out."
Pull Request,4757,[17.0][IMP] l10n_es_atc_mod425: Update JAR to v6.31 for the 2025 period,"TT59873

@Tecnativa @pedrobaeza @sergio-teruel @christian-ramos-tecnativa could you please review this?","Hi @nicolasramos,
some modules you are maintaining are being modified, check this out!"
Pull Request,4756,[FIX] l10n_es_aeat_mod130: Support multi-company environments,"The module was not working correctly in multi-company environments. The _calc_ingresos_gastos_retenciones method only searched for accounting entries in self.company_id.id, ignoring the allowed_company_ids context.

This caused calculations to return 0.00 when users switched companies in the UI.

Changed the domain filter to use 'in' operator with allowed_company_ids from context, falling back to company_id for backward compatibility.","El modelo se calcula para una sola compañía, no para varias, por lo que no entiendo el parche."
Pull Request,4755,[18.0][FIX] l10n_es_aeat_mod347: Fix report style,"- The style of the report had to be modified because if the 'col-3' tag was added to the style, the 'Amount 4Q' option was removed from the report and it was impossible to understand what it said, so it has been changed to 'col-2'

BEFORE:

<img width=""786"" height=""145"" alt=""image"" src=""https://github.com/user-attachments/assets/4a2c547b-3d19-451a-90c9-55ae6ba483b7"" />

AFTER:

<img width=""791"" height=""152"" alt=""image"" src=""https://github.com/user-attachments/assets/d945999a-de73-45a3-b50e-9b1ff75cb0f8"" />
","@pedrobaeza Puedes revisar el pr y si esta correcto le puedes dar el aprobado para que se fusione lo antes posible [SEP] This PR looks fantastic, let's merge it!
Prepared branch [18.0-ocabot-merge-pr-4755-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4755-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 1ab4e2fa97731392287419e900d86c27c31fe9e9. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4754,[17.0][FIX] l10n_es_aeat: Take into account mapped country codes when get countr_code from vat prefix,"En este método se extrae el country_code del prefijo del vat pero no se tiene en cuenta el mapeo de algunos vat como el Griego.. 
Por ejemplo para un NIF con el formato ELnnnnn se devuelve como country_code EL en lugar de GR

@Tecnativa TT60396

ping @carlosdauden @christian-ramos-tecnativa @victoralmau ","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] Habría que comprobar si esto tiene algún efecto lateral fuera del SII. Creo recordar que el 349 también utiliza esto. [SEP] Por lo que he comprobado del 349 se fuerza el `country_code` (que actualmente devuelve EL) y se pasa por la función `_map_aeat_country_code` nuevamente, con este cambio no sería necesario, ya que sería `GR` desde la primera llamada. Además en los tests del 349 tiene partner con país Grecia, por lo que habría saltado el CI en caso de que este cambio le afectara.
https://github.com/OCA/l10n-spain/blob/36eda0438efb096ed8c040418fd10893a0e3fe1c/l10n_es_aeat_mod349/models/mod349.py#L432-L440
https://github.com/OCA/l10n-spain/blob/36eda0438efb096ed8c040418fd10893a0e3fe1c/l10n_es_aeat_mod349/tests/test_l10n_es_aeat_mod349.py#L365-L367 [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [17.0-ocabot-merge-pr-4754-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4754-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at ce7d74ffb8bbaff47df4c546c264726aeff554e8. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4753,[17.0][FIX] l10n_es_aeat_sii_oca: Country vat mapped not taken into account for 'Contraparte' key generator,"No se está teniendo en cuenta que el vat para el identificador puede ser distinto que el country_code, por ejemplo, en Grecia el código de país es GR pero el identificador del VAT (vies) es EL.
Al enviar facturas al SII de un cliente griego registrado en el VIES se envia como GRnnnnn en lugar de ELnnnnnn

@Tecnatica TT60396

ping @carlosdauden @christian-ramos-tecnativa @victoralmau 

PR relacionado:
- [x] https://github.com/OCA/l10n-spain/pull/4754

","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] This PR has the `approved` label and has been created more than 5 days ago. It should therefore be ready to merge by a maintainer (or a PSC member if the concerned addon has no declared maintainer). 🤖 [SEP] Fusiono en base a las reviews existentes.

/ocabot merge patch [SEP] This PR looks fantastic, let's merge it!
Prepared branch [17.0-ocabot-merge-pr-4753-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4753-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 2294e946f91bb5df26b363517db55bd49f28fa0b. Thanks a lot for contributing to OCA. ❤️ [SEP] Llévalo por favor a 18"
Pull Request,4752,[18.0][IMP] l10n_es_aeat_sii_oca: avoid calling unnecessary write,"Este write se llama independientemente de si el SII está habilitado para esa factura/compañía y puede generar conflictos a la hora de probar módulos que restringen la modificación de campos en facturas.

@Tecnativa TT59350
@pedrobaeza @victoralmau ","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] /ocabot merge patch [SEP] On my way to merge this fine PR!
Prepared branch [18.0-ocabot-merge-pr-4752-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4752-by-pedrobaeza-bump-patch), awaiting test results. [SEP] It looks like something changed on `18.0` in the meantime.
Let me try again (no action is required from you).
Prepared branch [18.0-ocabot-merge-pr-4752-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4752-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at fc53612c021bc816bedecdf6d3a6b76db0afb0d2. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4751,[16.0][FIX] l10n_es_ticketbai_api: Fix sign file hash,,"Hi @ao-landoo,
some modules you are maintaining are being modified, check this out! [SEP] <img width=""1327"" height=""671"" alt=""image"" src=""https://github.com/user-attachments/assets/4d4551c7-e2e5-4def-b7bc-9d2b023af8e8"" />
 [SEP] This PR has the `approved` label and has been created more than 5 days ago. It should therefore be ready to merge by a maintainer (or a PSC member if the concerned addon has no declared maintainer). 🤖 [SEP] @pedrobaeza se podría mergear este? o faltaría revisar algo? [SEP] /ocabot merge patch [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [16.0-ocabot-merge-pr-4751-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/16.0-ocabot-merge-pr-4751-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 1802baf4b9001442537a69d23e0b3532ea257c5d. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4750,[14.0][FIX] l10n_es_ticketbai_api: Fix sign file hash.,,"Hi @ao-landoo,
some modules you are maintaining are being modified, check this out! [SEP] <img width=""1327"" height=""671"" alt=""image"" src=""https://github.com/user-attachments/assets/33baccee-6dff-4dde-944e-3e839631c190"" />
 [SEP] @luciaavanzosc @oihane pueden dar un poco más de contexto @Bilbonet. [SEP] Lo han empezado a validar en Álava y falla sino se cambia. LGTM [SEP] /ocabot merge patch [SEP] This PR looks fantastic, let's merge it!
Prepared branch [14.0-ocabot-merge-pr-4750-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/14.0-ocabot-merge-pr-4750-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at fd23732dee3a31ea7772a96ec338789f5a4b60df. Thanks a lot for contributing to OCA. ❤️ [SEP] @omar7r habrá que revisar si sólo es Araba"
Pull Request,4749,[16.0][IMP] l10n_es_pos_by_device: refactor Chrome for extensibility,"Extract device selection logic into separate methods:
- _selectDevice(): handles popup and device setting
- _getDeviceList(): returns formatted device list

This allows other modules to override specific parts without duplicating the entire start() method.","Hi @ao-landoo,
some modules you are maintaining are being modified, check this out! [SEP] LGTM!"
Pull Request,4748,[18.0][FIX] l10n_es_aeat_mod303: tener en cuenta redondeo en comprobaciones cuotas compensación,"En casos límite, como puede ser establecer la compensación pendiente como exactamente la cuota a compensar aplicada, podía impedir la operación por problemas de redondeo.

Fw-port de #4738 ","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [18.0-ocabot-merge-pr-4748-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4748-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at bac2dc70f1955137d9948f68d27f3d7341fd9f9c. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4747,[18.0][IMP] l10n_es_aeat_mod390: Test new export BOE config,"Forward-port of #4745 and #4746
Fine-tuning of #4690 

@Tecnativa ","/ocabot merge patch [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [18.0-ocabot-merge-pr-4747-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4747-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at df3a1d3bcc22fec63757ca9ec8b7808affc1a48e. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4746,[17.0][IMP] l10n_es_aeat_mod390: Test new export BOE config,"Forward-port of #4745
Fine-tuning of #4740 

@Tecnativa ","/ocabot merge patch [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [17.0-ocabot-merge-pr-4746-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4746-by-pedrobaeza-bump-patch), awaiting test results. [SEP] @pedrobaeza your merge command was aborted due to failed check(s), which you can inspect on [this commit of 17.0-ocabot-merge-pr-4746-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/1c888ca4dd9e0c7833ad4738054e1a047b3ab303).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] /ocabot merge patch [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [17.0-ocabot-merge-pr-4746-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4746-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 36eda0438efb096ed8c040418fd10893a0e3fe1c. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4745,[16.0][IMP] l10n_es_aeat_mod390: Test new export BOE config,"Fine-tuning of #4741 

@Tecnativa ","/ocabot merge patch [SEP] This PR looks fantastic, let's merge it!
Prepared branch [16.0-ocabot-merge-pr-4745-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/16.0-ocabot-merge-pr-4745-by-pedrobaeza-bump-patch), awaiting test results. [SEP] @EmilioPascual para la próxima, recuerda añadir la nueva configuración al test para así evitar sorpresas y regresiones. [SEP] Congratulations, your PR was merged at 7e013beb6fdbd6e13da0d148d77b65a6f35185bf. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4744,[15.0][IMP] l10n_es_aeat_mod390: 2025 BOE export format,"Backport of #4690 

Updated according https://sede.agenciatributaria.gob.es/static_files/Sede/Disenyo_registro/DR_300_399/archivos_25/dr390e2025.xlsx

@Tecnativa ","/ocabot merge minor [SEP] This PR looks fantastic, let's merge it!
Prepared branch [15.0-ocabot-merge-pr-4744-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/15.0-ocabot-merge-pr-4744-by-pedrobaeza-bump-minor), awaiting test results. [SEP] Congratulations, your PR was merged at d0c1b0c0a53259c576191e91e5d8fc52b4aa34a3. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4742,[16.0][IMP] l10n_es_vat_book: update vat book format + added IRPF,"Backport https://github.com/OCA/l10n-spain/pull/4709
cc @Tecnativa
ping @sergio-teruel @carlosdauden @pedrobaeza

TT59220","@eduezerouali-tecnativa revisa bien el backport, que en el Excel salen mezclados los datos en columnas que no corresponden.

<img width=""2347"" height=""210"" alt=""image"" src=""https://github.com/user-attachments/assets/021bba9f-964b-4acc-9a2d-8731fe549d72"" />
 [SEP] @pedrobaeza 
<img width=""1756"" height=""194"" alt=""Selección_054"" src=""https://github.com/user-attachments/assets/9b9c0c10-e077-4224-bb96-0e9c41e1a173"" />
He hecho una prueba en local y se ejecuta bien, cosa que en runboat no. El commit esta con los ultimos cambios. [SEP] /ocabot merge minor [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [16.0-ocabot-merge-pr-4742-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/16.0-ocabot-merge-pr-4742-by-pedrobaeza-bump-minor), awaiting test results. [SEP] Congratulations, your PR was merged at c0f1aad097c803f2e808c007629328a97cb1d6b3. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4741,[16.0][IMP] l10n_es_aeat_mod390: 2025 BOE export format,"BP de https://github.com/OCA/l10n-spain/pull/4690

Updated according https://sede.agenciatributaria.gob.es/static_files/Sede/Disenyo_registro/DR_300_399/archivos_25/dr390e2025.xlsx

MT-13085 @moduon","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [16.0-ocabot-merge-pr-4741-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/16.0-ocabot-merge-pr-4741-by-pedrobaeza-bump-minor), awaiting test results. [SEP] Congratulations, your PR was merged at 3af0494a8327b8903808c4ca24b9c8587a4f6697. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4740,[17.0][IMP] l10n_es_aeat_mod390: 2025 BOE export format,"BP de https://github.com/OCA/l10n-spain/pull/4690

Updated according https://sede.agenciatributaria.gob.es/static_files/Sede/Disenyo_registro/DR_300_399/archivos_25/dr390e2025.xlsx

MT-13085 @moduon","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [17.0-ocabot-merge-pr-4740-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4740-by-pedrobaeza-bump-minor), awaiting test results. [SEP] /ocabot merge minor [SEP] This PR looks fantastic, let's merge it!
Prepared branch [17.0-ocabot-merge-pr-4740-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4740-by-pedrobaeza-bump-minor), awaiting test results. [SEP] Congratulations, your PR was merged at 73dec24922ef39c6f9b3d4b40b7dc1e81dcf5319. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4739,[17.0][FIX] l10n_es_aeat_mod216: Set `apply_sign` to 0,"BP de https://github.com/OCA/l10n-spain/pull/4734

The lines with type ""Num"" have not sign according to https://sede.agenciatributaria.gob.es/static_files/Sede/Disenyo_registro/DR_200_299/archivos_24/216e2024.xlsx

MT-13343 @moduon","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] On my way to merge this fine PR!
Prepared branch [17.0-ocabot-merge-pr-4739-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4739-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 3dcd8a1e2c0454ef1641fdf9b1d6260056267108. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4738,[17.0][FIX] l10n_es_aeat_mod303: tener en cuenta redondeo en comprobaciones cuotas compensación,"En casos límite, como puede ser establecer la compensación pendiente como exactamente la cuota a compensar aplicada, podía impedir la operación por problemas de redondeo.","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [17.0-ocabot-merge-pr-4738-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4738-by-pedrobaeza-bump-patch), awaiting test results. [SEP] @pedrobaeza your merge command was aborted due to failed check(s), which you can inspect on [this commit of 17.0-ocabot-merge-pr-4738-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/ecaacf055c3a0b9c71e474fc9db9e653b10e95d4).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] /ocabot merge patch [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [17.0-ocabot-merge-pr-4738-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4738-by-pedrobaeza-bump-patch), awaiting test results. [SEP] @pedrobaeza your merge command was aborted due to failed check(s), which you can inspect on [this commit of 17.0-ocabot-merge-pr-4738-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/e3b9a06d5917ac9c41155c4be84491c429bbae84).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] /ocabot merge patch [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [17.0-ocabot-merge-pr-4738-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4738-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at b85bd887eea3f65f39d58892b1e8f3a52ac8830b. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4737,[19.0][FIX] l10n_es_partner: Force context to calculate complete_name with comercial,"fwp https://github.com/OCA/l10n-spain/pull/4658

complete_name is the field used to sort res.partner, but when calculated without context, the stored value ignored the sales rep name, producing an inconsistent visual order in the tree views when sorting by contact. The context is forced during the compute to include the sales rep in companies and contacts. In addition, a migration script is added to recalculate the affected records as it is a stored field.

@Tecnativa TT59646

@pedrobaeza @victoralmau please review","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] This PR looks fantastic, let's merge it!
Prepared branch [19.0-ocabot-merge-pr-4737-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/19.0-ocabot-merge-pr-4737-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 9bf2a1d793c262765735f5c68b3a6549cf3bd39d. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4736,[16.0][FIX] l10n_es_verifactu_oca: Fix tests,"Corrección de diferentes tests KO en l10n_es_verifactu_oca. 

Se ha ajustado el código del método test_send_invoices_to_verifactu para homogeneizar su estructura con el resto del módulo y mejorar su legibilidad.","This PR looks fantastic, let's merge it!
Prepared branch [16.0-ocabot-merge-pr-4736-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/16.0-ocabot-merge-pr-4736-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at e936d3af1229c954d2450bed3d4fc49755b40915. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4735,[18.0][FIX] l10n_es_aeat_mod190: Error when adding Partner,"Antes de este fix, a la hora de añadir un socio destinatario durante la creación del reporte, saltaba un error que lo hacía imposible.

https://www.loom.com/share/1f1df1b6ed78452cb1c06c71594690c7

MT-13290 @moduon",
Pull Request,4734,[18.0][FIX] l10n_es_aeat_mod216: Set `apply_sign` to 0,"The lines with type ""Num"" have not sign according to https://sede.agenciatributaria.gob.es/static_files/Sede/Disenyo_registro/DR_200_299/archivos_24/216e2024.xlsx

<img width=""981"" height=""37"" alt=""image"" src=""https://github.com/user-attachments/assets/c5547dff-8faf-4b1d-82e0-5e8cb9042870"" />

Todos son de tipo ""Num"" por lo que no debería aplicarse signo

<img width=""957"" height=""594"" alt=""image"" src=""https://github.com/user-attachments/assets/20988eed-98ae-484e-8ef8-a89ed0ff54c4"" />

Además, había un fallo en el final de la primera página.

Subido archivo al pre-portal de AEAT, antes daba este error 
<img width=""1868"" height=""462"" alt=""image"" src=""https://github.com/user-attachments/assets/8a518867-87b2-4ee4-97a9-577020c61731"" />

Y ahora se valida sin ningún error.

MT-13343 @moduon","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [18.0-ocabot-merge-pr-4734-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4734-by-pedrobaeza-bump-patch), awaiting test results. [SEP] @pedrobaeza your merge command was aborted due to failed check(s), which you can inspect on [this commit of 18.0-ocabot-merge-pr-4734-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/a506c1c4022a9aa9fb138bebb7da1abb4a5c277e).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] /ocabot merge patch [SEP] This PR looks fantastic, let's merge it!
Prepared branch [18.0-ocabot-merge-pr-4734-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4734-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 889ffbd41b2a65471674d8901223740a8b0f3689. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4733,[15.0][FIX] l10n_es_aeat_mod592: No indicar Régimen fiscal en algunos casos,"Cambios hechos:
- [x] No indicar Régimen fiscal en algunos casos (4). Relacionado con https://github.com/OCA/l10n-spain/pull/4460
- [x] No indicar Prov./Dest.: Tipo Documento si el concepto es 3

Por favor @pedrobaeza puedes revisarlo?

@Tecnativa TT60323","What a great day to merge this nice PR. Let's do it!
Prepared branch [15.0-ocabot-merge-pr-4733-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/15.0-ocabot-merge-pr-4733-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 51b348ea328d20bb6d903d76c7dad24016d3fd55. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4732,[18.0][FIX] l10n_es_aeat_mod303_vat_prorate: Add other exempt taxes,"Añado a la lista de los impuestos exentos otros que también deberían ser considerados para el cálculo de la prorrata.

@Tecnativa TT60315
@pedrobaeza @victoralmau ","Hi @pedrobaeza, @victoralmau,
some modules you are maintaining are being modified, check this out! [SEP] This PR looks fantastic, let's merge it!
Prepared branch [18.0-ocabot-merge-pr-4732-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4732-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 9f474d3896f86b697a368da4e1bd1699cb7e12b9. Thanks a lot for contributing to OCA. ❤️ [SEP] @christian-ramos-tecnativa ¿Puedes hacer backport a 17.0?"
Pull Request,4731,[18.0][IMP] payment_redsys: Define a specific string for the redsys_secret_key field to avoid lot warning,"Define a specific string for the `redsys_secret_key` field to avoid lot warning

`WARNING prod odoo.addons.base.models.ir_model: Two fields (stripe_secret_key, redsys_secret_key) of payment.provider() have the same label: Secret Key. [Modules: payment_stripe and payment_redsys]`

Please @pedrobaeza can you review it?

@Tecnativa","This PR looks fantastic, let's merge it!
Prepared branch [18.0-ocabot-merge-pr-4731-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4731-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 6aedd2a4047a29fb9b247fef4a245df469dacf25. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4730,[15.0][FIX] l10n_es_verifactu_oca: Fix test test_create_send_activity,"Fix donde reordenamos el código para:

1. Primero postear la factura → `action_post()`
2. Luego actualizar el mock con el nombre real → `invoice.name`
3. Finalmente ejecutar el cron","What a great day to merge this nice PR. Let's do it!
Prepared branch [15.0-ocabot-merge-pr-4730-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/15.0-ocabot-merge-pr-4730-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at a296b02aa14c9a5d1039449e3fab1d2f77eb334c. Thanks a lot for contributing to OCA. ❤️ [SEP] ¿Hace falta en 16.0? [SEP] Sí, en el PR 4736 he mirado de corregir los tests KO en este módulo..."
Pull Request,4729,[17.0][IMP] l10n_es_aeat_mod111: Compute report type,"FWP https://github.com/OCA/l10n-spain/pull/4616

¿Podrías revisarlo, @pedrobaeza ? ¡Gracias!


MT-12714 @moduon ","This PR looks fantastic, let's merge it!
Prepared branch [17.0-ocabot-merge-pr-4729-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4729-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at dbe00155799ffd353dad1a29a007c600da4aedb8. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4728,[18.0][IMP] l10n_es_aeat_mod111: Compute report type,"FWP https://github.com/OCA/l10n-spain/pull/4616

¿Podrías revisarlo, @pedrobaeza ? ¡Gracias!


MT-12714 @moduon ","On my way to merge this fine PR!
Prepared branch [18.0-ocabot-merge-pr-4728-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4728-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 0ba76c2742d8add304d1abad7d939af770a1c3ff. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4727,[19.0][MIG] l10n_es_aeat_mod390: Migration to 19.0,"Migración standard a v19.0


",/ocabot migration l10n_es_aeat_mod390
Pull Request,4726,[18.0][FIX] l10n_es_aeat_sii_oca: Raise exception is partner has not a vat but has a aeat_identification,"Forward-port of #4710

@Tecnativa ","/ocabot merge patch [SEP] On my way to merge this fine PR!
Prepared branch [18.0-ocabot-merge-pr-4726-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4726-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at a24b63c6f5e85cdf3aea31dd4062561a0fe28f8e. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4725,[16.0][FIX] l10n_es_sigaus_stock_picking_report_valued: Fix rounding of valued picking total when adding SIGAUS amounts,"@HaraldPanten @Jaimermaccione 

- Closing this PR as the issue is addressed with a different approach in another PR https://github.com/OCA/stock-logistics-reporting/pull/467",
Pull Request,4724,[17.0][FIX] l10n_es_aeat_sii_oca: Don't retry forever,"Backport of #4723 

In the case an invoice is accepted with errors, the sending date is not reset, and the system is trying to send it on each cron run, which is not correct. With accepted invoices, there's no problem, as they are not selected anymore for being sent.

Let's reset anyway for both cases the sending date for avoiding this hammering.

@Tecnativa","/ocabot merge patch [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [17.0-ocabot-merge-pr-4724-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4724-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at cd45131687afe7a1176cb11215196ecd0cc2b3a3. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4723,[18.0][FIX] l10n_es_aeat_sii_oca: Don't retry forever,"In the case an invoice is accepted with errors, the sending date is not reset, and the system is trying to send it on each cron run, which is not correct. With accepted invoices, there's no problem, as they are not selected anymore for being sent.

Let's reset anyway for both cases the sending date for avoiding this hammering.

@Tecnativa ","/ocabot merge patch [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [18.0-ocabot-merge-pr-4723-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4723-by-pedrobaeza-bump-patch), awaiting test results. [SEP] @pedrobaeza your merge command was aborted due to failed check(s), which you can inspect on [this commit of 18.0-ocabot-merge-pr-4723-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/5825061e9d4cbc740e3cba7736274c3ae51c164e).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] On my way to merge this fine PR!
Prepared branch [18.0-ocabot-merge-pr-4723-by-HaraldPanten-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4723-by-HaraldPanten-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 5f8058ce57c2ecae5d263e35ae6477d8d574c437. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4722,[18.0][FIX] l10n_es_aeat_sii_oca: Homogenize actions on error,"Forward-port of #4721 

When an exception happens, it was not the same for cancel communication than for normal one:

- The representation of the exception is not fully logged.
- The sending date is not reset.

This homogenizes the behavior on both.

@Tecnativa TT60254","/ocabot merge patch [SEP] On my way to merge this fine PR!
Prepared branch [18.0-ocabot-merge-pr-4722-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4722-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 8c4438c6968603fe10bdd6c845f107a4db2da844. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4721,[17.0][FIX] l10n_es_aeat_sii_oca: Homogenize actions on error,"When an exception happens, it was not the same for cancel communication than for normal one:

- The representation of the exception is not fully logged.
- The sending date is not reset.

This homogenizes the behavior on both.

@Tecnativa TT60254","/ocabot merge patch [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [17.0-ocabot-merge-pr-4721-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4721-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at b6d43e3ed757a88f07121c32edb1244440dd4530. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4720,[18.0][FIX] l10n_es_pos_sii: Initialize aeat_state,"Due to the way PoS orders are created from the JS app, the records are created with null in aeat_state field, so they are sent to the SII with A1 (modification) key instead of A0 (creation) one.

Let's force in the creation the value for not having this problem.

@Tecnativa TT60223","/ocabot merge patch [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [18.0-ocabot-merge-pr-4720-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4720-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 2dc85b4542fb019d0004520ffd4a7e310b81e203. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4719,[17.0][IMP] l10n_es_vat_book: update vat book format + added IRPF,"Backport https://github.com/OCA/l10n-spain/pull/4709
cc @Tecnativa 
ping @sergio-teruel @carlosdauden @pedrobaeza ","Ídem que el de 16. Las columnas del Excel no coinciden. [SEP] ping @pedrobaeza  [SEP] /ocabot merge minor [SEP] This PR looks fantastic, let's merge it!
Prepared branch [17.0-ocabot-merge-pr-4719-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4719-by-pedrobaeza-bump-minor), awaiting test results. [SEP] Congratulations, your PR was merged at b560ee1fb9878cf7b3fd0aa674f5026a66652e23. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4718,[18.0][IMP] l10n_es_aeat_mod190: Diseño de registro 2025,"According to https://sede.agenciatributaria.gob.es/static_files/Sede/Disenyo_registro/DR_100_199/archivos_25/DISENOS_LOGICOS_190_2025.pdf

Añadidos nuevos campos a los perceptores necesarios para la actualización de 2025.
Añadido nuevo formato de exportación a BOE para el 2025.
Modificados la constante CRLF en la exportación a BOE para que no convierta a ASCII ya que no está haciendo el salto de linea en el fichero.

Se han generado ficheros y probados en el preportal de AEAT con la nueva configuración.

@moduon MT-13276","Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [18.0-ocabot-merge-pr-4718-by-etobella-bump-minor](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4718-by-etobella-bump-minor), awaiting test results. [SEP] Congratulations, your PR was merged at 04f115220f183bf968e3937620a3a44b8e0c0374. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4717,[19.0][MIG] l10n_es_aeat_mod347: Migration to 19.0,"### [19.0][MIG] l10n_es_aeat_mod347: Migración a 19.0

Se adapta el módulo 347 a los cambios del método [_read_group](cci:1://file:///home/pablo/Code/odoo/19.0/odoo/odoo/odoo/orm/models.py:1859:4-1950:40) en Odoo 19.0:

*   **Sintaxis [_read_group](cci:1://file:///home/pablo/Code/odoo/19.0/odoo/odoo/odoo/orm/models.py:1859:4-1950:40)**: Ajustados los argumentos `aggregates` (no repetir campos de [groupby](cci:1://file:///home/pablo/Code/odoo/19.0/odoo/odoo/odoo/orm/models.py:2014:4-2118:23)) 
*   **Resultados por índice**: Refactorizado el acceso a datos para usar tuplas (`group[0]`, `group[1]`) en lugar de diccionarios, ya que es el nuevo retorno por defecto.
*   **Eliminación de `__domain`**: Se reconstruyen los dominios manualmente para las sub-consultas al no incluirse ya esta clave en los resultados.
*   **Limpieza**: Eliminación de llamadas innecesarias a [browse()](cci:1://file:///home/pablo/Code/odoo/19.0/odoo/odoo/odoo/orm/models.py:5875:4-5891:49) y variables no utilizadas.",/ocabot migration l10n_es_aeat_mod347
Pull Request,4716,[18.0][FIX] l10n_es_aeat_sii_oca: CoA name has changed in 18,It's es_common_mainland.,"Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] @pedrobaeza 
Same https://github.com/OCA/l10n-spain/pull/4475
 [SEP] This PR looks fantastic, let's merge it!
Prepared branch [18.0-ocabot-merge-pr-4716-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4716-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 5c39867f69b29795e62fe6f8e1f248f1332583d5. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4715,[18.0][IMP] l10n_es_atc: Adapt to l10n_es_aeat report menu,"Forward-port of #4300

@Tecnativa ","/ocabot merge patch [SEP] /ocabot merge patch [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [18.0-ocabot-merge-pr-4715-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4715-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 182d65d390dedde920534a47770d757ffd385aab. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4714,[18.0][FIX] l10n_es_aeat_mod369: Place menu inside AEAT submenu,"It was in the root.

@Tecnativa ","/ocabot merge patch [SEP] On my way to merge this fine PR!
Prepared branch [18.0-ocabot-merge-pr-4714-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4714-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 00aa4a69f0c05465ffbdb3391c8e37b7aed3bc95. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4713,[17.0][FIX] l10n_es_aeat_mod390: Calculate casilla 662,"FW-port of https://github.com/OCA/l10n-spain/pull/4617

Box 662 must include any compensation amounts generated this year that have not been applied during the year.

Befote the fix, only box 87 from the last period was included, which did not cover all cases, such as when the content of box 87 came entirely or partially from previous years.

From https://sede.agenciatributaria.gob.es/static_files/Sede/Procedimiento_ayuda/G412/instr390.pdf","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [17.0-ocabot-merge-pr-4713-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4713-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 0024eb109f9b42c8d63b837b7ab030b9d9fe2bcc. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4712,[16.0][FIX] l10n_es_verifactu_oca: Remove ES prefix from Spanish NIF,"## Summary

This PR fixes issue #4623 where Verifactu rejects invoices when the customer's VAT has the ""ES"" prefix.

**Problem:**
When a customer's VAT is stored with the country prefix (e.g., ""ESB12345678"" instead of ""B12345678""), the module sends it to Verifactu as-is. Verifactu rejects this because it expects the NIF without the ""ES"" prefix for Spanish customers.

This commonly happens when external connectors (like Prestashop) import customers with the full EU VAT format.

**Solution:**
Added validation in `_get_verifactu_receiver_dict()` to remove the ""ES"" prefix from the identifier when:
- The identifier type is empty (indicating a Spanish NIF)
- The identifier starts with ""ES"" and has more than 2 characters

## Changes

- `l10n_es_verifactu_oca/models/account_move.py`: Added ES prefix removal logic

## Test plan

- [ ] Create a customer with VAT ""ESB12345678"" (with ES prefix)
- [ ] Create and confirm an invoice for this customer
- [ ] Send the invoice to Verifactu
- [ ] Verify the NIF is sent as ""B12345678"" (without ES prefix)
- [ ] Verify the invoice is accepted by Verifactu

Closes #4623",
Pull Request,4711,[18.0][FIX] l10n_es_aeat_mod190: Export config,"Fix blank space in fields `positive_sign` and `bool_no`.

MT-13276 @moduon","Los errores vienen de la migración a 18, cuando se paso del archivo `xml` a `csv`, los espacios en blancos no los reconoce sin las comillas, esto hace que en vez de añadir un espacio en blanco como indica el diseño de registro, se añada `False` dando error al subir el archivo a AEAT. [SEP] Cierro en favor de https://github.com/OCA/l10n-spain/pull/4718 que recoge los cambios para 2025"
Pull Request,4710,[17.0][FIX] l10n_es_aeat_sii_oca: Raise exception is partner has not a vat but has a aeat_identification,"cc @Tecnativa 

La excepcion de que un contacto no tiene NIF tiene que tener en cuenta si el contacto tiene otra identificacion

ping @christian-ramos-tecnativa @carlosdauden ","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] @christian-ramos-tecnativa Changes done! [SEP] /ocabot merge patch [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [17.0-ocabot-merge-pr-4710-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4710-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 524dec78351172e3c4c06235f16ff5568a26aabc. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4709,[18.0][IMP] l10n_es_vat_book: update vat book format + added IRPF,"cc @Tecnativa TT59220
ping @pedrobaeza @carlosdauden

https://github.com/OCA/l10n-spain/issues/4444

Hemos añadido las retenciones  al libro de IVA y ademas hemos actualizado el formato de exportación para que conincida con https://sede.agenciatributaria.gob.es/Sede/iva/facturacion-registro/ejemplos-libros-registro-iva-irpf-2023/ejemplos-libros-registro-iva-irpf-2022.html

Financiado por Contaldia @AlbertCabedo ","@eduezerouali-tecnativa ¿Puedes hacer backport a 17? [SEP] > @eduezerouali-tecnativa ¿Puedes hacer backport a 17?

Si está previsto hacer backport a 16 y 17 [SEP] > Un detalle más: el periodo de deducción sí que se puede escribir, y se obtiene de la fecha contable de la factura, aunque habría que añadir un dato extra a nivel de libro de IVA: si la liquidación es trimestral o mensual.

Entonces habría que añadir `vat_settlement_period` a nivel de `l10n.es.vat.book`. Y el cálculo sería, en el caso de liquidación mensual, añadir los 30 días naturales, y en el caso de liquidación trimestral, comprobar a qué trimestre corresponde y poner la fecha del último día del trimestre. [SEP] Sí, se añade ese campo, y sería poner dentro de qué toca: el año en el ejercicio, y si es mensual, pues el mes en periodo (01, 02...), y si es trimestral, pues 1T, 2T, 3T, 4T. [SEP] Hay ejemplos en `l10n_es_aeat*` que lo calcula de manera elegante. [SEP] Lo reviso y lo añado. [SEP] ping @pedrobaeza  [SEP] This PR looks fantastic, let's merge it!
Prepared branch [18.0-ocabot-merge-pr-4709-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4709-by-pedrobaeza-bump-minor), awaiting test results. [SEP] muchas gracias!!! pues testeado y ok a merge [SEP] @pedrobaeza your merge command was aborted due to failed check(s), which you can inspect on [this commit of 18.0-ocabot-merge-pr-4709-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/1a0929b73bfa232b7e250fc7c924766591847a1b).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] /ocabot merge minor [SEP] This PR looks fantastic, let's merge it!
Prepared branch [18.0-ocabot-merge-pr-4709-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4709-by-pedrobaeza-bump-minor), awaiting test results. [SEP] Congratulations, your PR was merged at 3ddc7f91efa7e578fe6249cfb497d3d24a1ec08d. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4708,[17.0][FIX] l10n_es_verifactu_oca: Add error logging for failed API calls,"## Summary

This PR fixes issue #4591 regarding missing error logging in Verifactu module.

**Problem:**
When Verifactu API calls fail (network issues, certificate problems, etc.), no error was logged. This made debugging production issues very difficult as administrators had no visibility into what went wrong.

**Solution:**
Added proper error logging when API calls fail, including:
- Invoice reference for context
- Detailed error message
- Full stack trace with `exc_info=True`

## Changes

- `l10n_es_verifactu_oca/models/verifactu_invoice_entry.py`: Added error logging in exception handler

## Benefits

- Easier debugging in production environments
- Clear error messages with invoice context
- Full stack traces for detailed troubleshooting
- No change to existing behavior (exception is still re-raised)

## Test plan

- [ ] Configure Verifactu with invalid credentials/endpoint
- [ ] Attempt to send an invoice to Verifactu
- [ ] Verify error is logged with invoice reference and detailed message
- [ ] Verify the original exception is still raised to the user

Closes #4591",
Pull Request,4707,[18.0][IMP] l10n_es_aeat_sii_oca: multiple improvements,"En este PR se añaden las siguientes mejoras:

- Si la factura está en error, al enviarla de nuevo se crea como envío inmediato. 
  - Esto sobretodo es para evitar que lleguemos al límite de tiempo si la corrección se realiza más tarde y tenemos retardo de días.
- El check de error ahora es readonly. 
  - Esto solo debería ser modificado desde el código.
- Muestreo en el dashboard de los diarios si existen facturas con error con enlace directo.
<img width=""615"" height=""298"" alt=""image"" src=""https://github.com/user-attachments/assets/1347f8cf-c0be-4cf4-990d-3e126781a6b7"" />

@Tecnativa TT59653
@pedrobaeza ","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] Ya están todos los puntos comentados, en cuanto al PR que realizaste para `l10n_es_pos_sii` me ha parecido que los campos en este están bastante preparados con los `invisible` y `readonly` donde toca. Déjame saber si echas alguno en falta [SEP] A que te refieres con 

> las nuevas etiquetas acortadas.

@pedrobaeza? [SEP] Mira en el otro PR cómo en la vista se ponen string acortadas sin el término SII. [SEP] Listo y añadido como nuevo punto a la descripción"
Pull Request,4706,[17.0][FIX] l10n_es_aeat: Validate certificate file existence,"## Summary

This PR fixes issue #4467 regarding false positives in AEAT certificate validation.

**Problem:**
The `get_certificates()` method returned certificate paths from `ir.config_parameter` without verifying if the files actually exist on the filesystem. This caused a false positive where the system believed certificates were available when they weren't.

**Solution:**
- Added `import os` at the beginning of the file
- Implemented validation with `os.path.isfile()` to verify physical file existence
- Added descriptive error messages indicating which specific file was not found

## Changes

- `l10n_es_aeat/models/aeat_certificate.py`: Added file existence validation

## Benefits

- Clearer diagnosis of certificate configuration problems
- Prevents confusing runtime errors
- More informative error messages for administrators

## Test plan

- [ ] Configure AEAT certificates with invalid paths
- [ ] Verify that the system now raises a clear error indicating which file is missing
- [ ] Configure valid certificate paths and verify normal operation

Closes #4467","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] Gracias por el PR! 👍

Siguiendo el feedback de @pedrobaeza, aquí va una propuesta de refactorización que acumula los paths y los valida una sola vez:

```python
@api.model
def get_certificates(self, company=None):
    if not company:
        company = self.env.user.company_id

    aeat_certificates = self.search([
        (""company_id"", ""="", company.id),
        (""public_key"", ""!="", False),
        (""private_key"", ""!="", False),
        ""|"",
        (""date_start"", ""="", False),
        (""date_start"", ""<="", fields.Date.today()),
        ""|"",
        (""date_end"", ""="", False),
        (""date_end"", "">="", fields.Date.today()),
        (""state"", ""="", ""active""),
    ])

    if aeat_certificates:
        # Acumular archivos faltantes
        missing_files = []
        for aeat_certificate in aeat_certificates:
            public_crt = aeat_certificate.public_key
            private_key = aeat_certificate.private_key
            if not os.path.isfile(public_crt):
                missing_files.append(_(""Public certificate: %s"") % public_crt)
            if not os.path.isfile(private_key):
                missing_files.append(_(""Private key: %s"") % private_key)

        # Validar una sola vez
        if missing_files:
            raise exceptions.UserError(
                _(""Error! The following certificate files were not found:\n%s"")
                % ""\n"".join(missing_files)
            )

        return (
            aeat_certificates[0].public_key,
            aeat_certificates[0].private_key,
        )
    else:
        # Fallback a parámetros de configuración
        ICP = self.env[""ir.config_parameter""].sudo()
        public_crt = ICP.get_param(""l10n_es_aeat.public_key"", False)
        private_key = ICP.get_param(""l10n_es_aeat.private_key"", False)

        if not public_crt or not private_key:
            raise exceptions.UserError(_(""Error! There aren't certificates.""))

        # Paths por defecto (instalaciones nuevas)
        default_paths = (
            ""/opt/certificates/publicCert.crt"",
            ""/opt/certificates/privateKey.pem"",
        )

        missing_files = []
        if public_crt not in default_paths and not os.path.isfile(public_crt):
            missing_files.append(_(""Public certificate: %s"") % public_crt)
        if private_key not in default_paths and not os.path.isfile(private_key):
            missing_files.append(_(""Private key: %s"") % private_key)

        if missing_files:
            raise exceptions.UserError(
                _(""Error! The following certificate files were not found:\n%s\n\n""
                  ""Please configure a valid certificate through ""
                  ""Settings > AEAT > Certificates"")
                % ""\n"".join(missing_files)
            )

        return public_crt, private_key
```

**Ventajas de este enfoque:**
- ✅ El usuario ve **todos** los archivos faltantes de una vez (mejor UX)
- ✅ Evita múltiples `raise` dispersos
- ✅ Código más mantenible y DRY
"
Pull Request,4705,[18.0][FIX] l10n_es_aeat_mod390: ValueError,"Un fix del método calculate l10n.es.aeat.mod390.report.

Este error se producía cuando había más de dos compañías seleccionadas. Para evitarlo, se ha limitado la búsqueda a la compañía del informe.
<img width=""1895"" height=""934"" alt=""Captura desde 2026-01-08 13-13-15"" src=""https://github.com/user-attachments/assets/924e28c3-78fe-418b-96cd-8177d36ecc11"" />

@moduon
MT-13271","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [18.0-ocabot-merge-pr-4705-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4705-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at a4ff6c54d1f80c3284fdc94228710a5f196db037. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4704,[18.0][FIX] l10n_es_aeat_mod303_vat_prorate: error ZeroDivisionError,"Pequeño fix para evitar un ZeroDivisionError.
Por ejemplo, si el usuario crea un informe 303 y posteriormente cambia el año de la línea de prorrata en los ajustes de la empresa, al intentar recalcular ese mismo informe se produce un error ZeroDivisionError, ya que la variable theoretical_prorate tiene un valor igual a 0.
<img width=""1895"" height=""934"" alt=""Captura desde 2026-01-08 12-46-25"" src=""https://github.com/user-attachments/assets/8b7efed9-1ddc-4a70-936b-6ea04b69dbb1"" />

@moduon MT-13250","Hi @pedrobaeza, @victoralmau,
some modules you are maintaining are being modified, check this out! [SEP] On my way to merge this fine PR!
Prepared branch [18.0-ocabot-merge-pr-4704-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4704-by-pedrobaeza-bump-patch), awaiting test results. [SEP] @pedrobaeza your merge command was aborted due to failed check(s), which you can inspect on [this commit of 18.0-ocabot-merge-pr-4704-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/ad0fd5a3581e1b26937dfb0fcbd93a06d1074b36).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] /ocabot merge patch [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [18.0-ocabot-merge-pr-4704-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4704-by-pedrobaeza-bump-patch), awaiting test results. [SEP] @pedrobaeza your merge command was aborted due to failed check(s), which you can inspect on [this commit of 18.0-ocabot-merge-pr-4704-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/9d2f4cb0b643e83136f6c430d0ba02b2412863f6).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] Hice rebase para reiniciar los tests. @pedrobaeza puedes intentar fusionar de nuevo?  [SEP] /ocabot merge patch [SEP] This PR looks fantastic, let's merge it!
Prepared branch [18.0-ocabot-merge-pr-4704-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4704-by-pedrobaeza-bump-patch), awaiting test results. [SEP] @pedrobaeza your merge command was aborted due to failed check(s), which you can inspect on [this commit of 18.0-ocabot-merge-pr-4704-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/ad803b8cfc4f88662195aab5518215738ecf37fe).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] /ocabot merge patch [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [18.0-ocabot-merge-pr-4704-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4704-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 5e90b6f39949e32d5089f2ce5436767f6ea5ebb4. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4703,[15.0][FIX] delivery_gls_asm: fix obsolete link,,"Hi @hildickethan,
some modules you are maintaining are being modified, check this out! [SEP] @hildickethan 
can you merge this pr?
It's the same than #4210 , #4209 and #4208  [SEP] ideally wouldnt merge with failed tests but it looks unrelated so should be ok

/ocabot merge patch [SEP] This PR looks fantastic, let's merge it!
Prepared branch [15.0-ocabot-merge-pr-4703-by-hildickethan-bump-patch](https://github.com/OCA/l10n-spain/commits/15.0-ocabot-merge-pr-4703-by-hildickethan-bump-patch), awaiting test results. [SEP] El bot no lo va a fusionar si está en rojo. Dará error. [SEP] tenia esperanzas de que era algo puntual de conexión, pero si falla entiendo que habría que hacer backport de estos cambios que refactorizan los tests y asumo que arreglan el problema https://github.com/OCA/l10n-spain/pull/4548 [SEP] @hildickethan your merge command was aborted due to failed check(s), which you can inspect on [this commit of 15.0-ocabot-merge-pr-4703-by-hildickethan-bump-patch](https://github.com/OCA/l10n-spain/commits/c1ea7ce283918d6a61edb96fa5150e5eb5f103df).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] @mariancuadranetkia fallan los tests por algo del módulo de verifactu
<img width=""1253"" height=""168"" alt=""imagen"" src=""https://github.com/user-attachments/assets/0fe71869-043a-4786-8c59-70aa5ffab96d"" />
no pasa en las otras versiones por lo tanto seguramente será algo que habrá que hacer backport [SEP] @hildickethan he estado revisando, pero de momento no he tenido mucho éxito. He probado incluso comparando con versiones más nuevas, pero aún no he dado con 'la tecla'. 
Hasta el jueves no podré volver a mirarlo, pero lo volveré a revisar por si tuviera más suerte.

Gracias a ambos! [SEP] Generado PR #4730 [SEP] /ocabot merge patch [SEP] On my way to merge this fine PR!
Prepared branch [15.0-ocabot-merge-pr-4703-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/15.0-ocabot-merge-pr-4703-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 6cd80df98bb766d4c7d92b0938ee899c43afe8b4. Thanks a lot for contributing to OCA. ❤️ [SEP] @mariancuadranetkia no hacía falta rebase en este caso, porque el bot ya lo hace, y como has hecho push después de lanzar el comando, ahora esto consta como closed en lugar de merged. En cualquier caso, está fusionado. [SEP] @pedrobaeza pensé que sería necesario y por eso lo hice, pero a la siguiente vez me aseguraré antes revisando o incluso preguntando si tal. Muchas gracias!"
Pull Request,4702,[18.0][MIG] l10n_es_igic_verifactu_oca: Migration to 18.0,"Se corrigen mapeos de los impuestos de IGIC para VERIFACTU
Se añade nueva posición fiscal Exención arrendamientos Islas Canarias.
Nota legal y de cumplimiento
Este cambio mantiene la conformidad con la normativa aplicable al sistema
VERI*FACTU, conforme a lo establecido en:

Real Decreto 1007/2023, de 5 de diciembre, por el que se aprueba el
Reglamento que establece los requisitos que deben adoptar los sistemas
informáticos o electrónicos que soporten los procesos de facturación.
Real Decreto 254/2025, de 1 de abril, que modifica el anterior.
La modificación tiene carácter exclusivamente técnico y no altera la
estructura, integridad ni trazabilidad de los registros de facturación
ni el cumplimiento de las obligaciones establecidas por la AEAT.",Waiting to merge this pull request: https://github.com/OCA/l10n-spain/pull/4526
Pull Request,4701,[17.0][IMP]  l10n_es_aeat_sii_oca: required field BaseImponibleACoste with …,"…^ClaveRegimenEspecialOTrascendencia.*$ = 06

Como consecuencia de los cambios efectuados en la nueva versión del SII, se introducen nuevas validaciones que anteriormente eran opcionales y ahora son obligatorias.

Este PR se enfoca en resolver los siguientes errores relativos al campo ""BaseImponibleACoste"":

1272: ""El campo BaseImponibleACoste es obligatorio cuando el valor de ClaveRegimenEspecialOTrascendencia o alguna ClaveRegimenEspecialOTrascendenciaAdicional sea 06"".

<img width=""593"" height=""236"" alt=""image"" src=""https://github.com/user-attachments/assets/c63e0880-f34c-4d84-80cb-53b950cadd08"" />

","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out!"
Pull Request,4700,[18.0][IMP] l10n_es_pos_sii: Better UI,"- Hide fields when not needed, like refund type.
- Put better labels on UI. The current field strings are OK for being differentiated in parts like advanced search, but for the UI, as they are already in the SII tab, are not the best one, so let's adjust them.
- Remove useless auxiliary invisible field (since viewpocalypse).

@Tecnativa","Fusiono directamente para proceder a realizar las traducciones:

/ocabot merge patch [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [18.0-ocabot-merge-pr-4700-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4700-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 1ff183d041f2ed09e937e5b71819a83635f529da. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4699,[17.0][FIX] l10n_es_pos_sii: Send orders without closing session,"Forward-port of #4696 

When the PoS session is still opened, the orders remain in ""paid"" state, not as ""done"", so we shouldn't wait till session closing (which may not happened in several days, not complying with the sending limit).

Let's include ""done"" state in the allowed states for having the sending scheduled right after they are issued.

@Tecnativa TT60063","/ocabot merge patch [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [17.0-ocabot-merge-pr-4699-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4699-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 7a7a552b66a7c5d1bb428b7094049f3b2e432450. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4698,[17.0][FIX] l10n_es_atc_mod4*: Freeze time in tests for avoiding 2026 problem,"Backport of #4694

It seems the ATC libraries are still not prepared for 2026, so let's freeze for now the tests on 2025. When they switch, we will probably need to reset this.

@Tecnativa","Hi @Christian-RB,
some modules you are maintaining are being modified, check this out! [SEP] /ocabot merge patch [SEP] This PR looks fantastic, let's merge it!
Prepared branch [17.0-ocabot-merge-pr-4698-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4698-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 6bfe0a426fc873ec61a9d984076344c81c3a6bfe. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4697,[17.0][FIX] l10n_es_pos_sii: Send date visibility,"Backport of #4693 

To know when it's going to be sent, and to be able to send it now.

@Tecnativa ","/ocabot merge patch [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [17.0-ocabot-merge-pr-4697-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4697-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 0f58f3c77ef2541921b91e11eb241b8cb6e8e50d. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4696,[18.0][FIX] l10n_es_pos_sii: Send orders without closing session,"When the PoS session is still opened, the orders remain in ""paid"" state, not as ""done"", so we shouldn't wait till session closing (which may not happened in several days, not complying with the sending limit).

Let's include ""done"" state in the allowed states for having the sending scheduled right after they are issued.

TT60063","/ocabot merge patch [SEP] On my way to merge this fine PR!
Prepared branch [18.0-ocabot-merge-pr-4696-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4696-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 268afce573c36a58d9393e905fd4b6d65c15dbdb. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4695,[18.0][FIX] l10n_es_atc_mod420: Update maintainers,@Tecnativa ,"Hi @Christian-RB,
some modules you are maintaining are being modified, check this out! [SEP] /ocabot merge patch [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [18.0-ocabot-merge-pr-4695-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4695-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at c8d89ad439e6793fa8618dd76710b08e80b6b962. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4694,[18.0][FIX] l10n_es_atc_mod420: Freeze time in tests for avoiding 2026 problem,"It seems the ATC libraries are still not prepared for 2026, so let's freeze for now the tests on 2025. When they switch, we will probably need to reset this.

@Tecnativa ","Hi @Christian-RB,
some modules you are maintaining are being modified, check this out! [SEP] /ocabot merge patch [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [18.0-ocabot-merge-pr-4694-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4694-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 5f07ac229231c2d309f7071dad13e1dd21392792. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4693,[18.0][FIX] l10n_es_pos_sii: Send date visibility,"To know when it's going to be sent, and to be able to send it now.

@Tecnativa ","/ocabot merge patch [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [18.0-ocabot-merge-pr-4693-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4693-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at ac3d26175131d56d9e2436a571016dbb6a102227. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4692,[18.0][IMP] l10n_es_aeat_sii_oca: Make use of upstream simplified flag,"Odoo has included an extra flag at invoice level for controlling if the invoice complies with the requirements for being a simplified one, so let's use it as an extra possibility for avoiding to manually set the check on all the partners without VAT and not getting to the amount limit.

@Tecnativa ","@HaraldPanten @etobella y los demás usuarios del SII, qué os parece esta mejora? [SEP] Gracias Pedro,

Te decimos algo en breve, para revisarlo con un poco más de detalle 👍"
Pull Request,4691,[IMP] l10n_es_aeat_mod303: 2025-12 BOE export format,"Updated according to https://sede.agenciatributaria.gob.es/static_files/Sede/Disenyo_registro/DR_300_399/archivos_25/DR303e25.xlsx

MT-13202 @moduon","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] This PR has the `approved` label and has been created more than 5 days ago. It should therefore be ready to merge by a maintainer (or a PSC member if the concerned addon has no declared maintainer). 🤖 [SEP] Me comentan que han podido presentar 4T con el formato antiguo. ¿Puede ser que la actualización solo sea para 2026? [SEP] En Diciembre sacan 2 diseños de registro uno para el último período de 2025 y otro para 2026
<img width=""424"" height=""83"" alt=""image"" src=""https://github.com/user-attachments/assets/6d19f1b7-efcc-4182-aeb4-554217807fa9"" />
<img width=""689"" height=""171"" alt=""image"" src=""https://github.com/user-attachments/assets/09edcfeb-8f34-4ddc-8970-6b0c7da8d933"" />

Dentro especifica que el de 2026 (https://sede.agenciatributaria.gob.es/static_files/Sede/Disenyo_registro/DR_300_399/archivos_26/DR303e26.xlsx) es a partir de 2026
<img width=""1029"" height=""42"" alt=""image"" src=""https://github.com/user-attachments/assets/b42f8546-b295-4b54-a481-63f9ff0b8b72"" />

Mientras que el del 2025 (https://sede.agenciatributaria.gob.es/static_files/Sede/Disenyo_registro/DR_300_399/archivos_25/DR303e25.xlsx) específica para el 2025 
<img width=""560"" height=""57"" alt=""image"" src=""https://github.com/user-attachments/assets/ccc91e3a-7555-4db9-87e0-0bcafbd6c3c4"" />

Nosotros hemos presentado los 303 con el formato nuevo del 2025 y en principio no está dando errores. He estado mirando si eran compatibles porque a lo mejor alguna variables si no llevan nada, rellena con ceros que es uno de los cambios, pero me parece insalvable el cambio en las longitudes de la página 2
<img width=""1059"" height=""553"" alt=""image"" src=""https://github.com/user-attachments/assets/59a5560c-15d7-4430-b7a6-b6258c95b8fa"" />

Puede que formato anterior del 2025 no haya quedado obsoleto. Es lo que tiene AEAT que no es muy claro.

Desde luego que este no es para 2026
 [SEP] Acabo de probar a exportar con los dos formatos y subirlos al pre-portal de AEAT con una declaración bastante completita, se ha tragado los 2 sin errores. [SEP] Acabo de ver por que ha sido, la página 2 y 5 están omitidas y en la página 1 que es donde están los cambios de este PR si el año es mayor a 2024 siempre se pone ""00000"".

Parece entonces que no hace falta crear una configuración para 2025 y se puede hacer con la que hay actualmente 2024-10. Cierro PR.

Todavía quedaría pendiente hacer las adaptaciones para el 2026"
Pull Request,4690,[18.0][IMP] l10n_es_aeat_mod390: 2025 BOE export format,"Updated according https://sede.agenciatributaria.gob.es/static_files/Sede/Disenyo_registro/DR_300_399/archivos_25/dr390e2025.xlsx

MT-13085 @moduon","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] This PR has the `approved` label and has been created more than 5 days ago. It should therefore be ready to merge by a maintainer (or a PSC member if the concerned addon has no declared maintainer). 🤖 [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [18.0-ocabot-merge-pr-4690-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4690-by-pedrobaeza-bump-minor), awaiting test results. [SEP] > Técnicamente tiene buena pinta. Ya es probarlo en casos reales a ver si sale algún problema, pero eso se puede hacer en PRs posteriores.

Hemos probado todo lo que hemos podido en el pre-portal de AEAT y ya hemos subido bastantes a producción sin error.
 [SEP] Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] Congratulations, your PR was merged at e58fd456002db3847e57ba475c9bc0728b8ce6b6. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4689,[18.0][IMP] delivery_gls_asm: Fix tests by forcing service to 37 [ECONOMY],"Cuando usamos el servicio por defecto ""COURIER"", GLS devuelve error:
<img width=""638"" height=""213"" alt=""image"" src=""https://github.com/user-attachments/assets/61560e00-de5d-428c-907f-f71ab5d5c0e1"" />

Por lo contrario, el sevicio ""37 - ECONOMY"" sí que funciona

Así que con este cambio podemos volver a habilitar los tests que desactivamos en https://github.com/OCA/l10n-spain/pull/4090","Hi @hildickethan,
some modules you are maintaining are being modified, check this out! [SEP] On my way to merge this fine PR!
Prepared branch [18.0-ocabot-merge-pr-4689-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4689-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 31e1f31340496abc952a071f94949a79d4b8873e. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4688,[18.0][MIG] l10n_es_aeat_sii_match: Migration to 18.0,,/ocabot migration l10n_es_aeat_sii_match
Pull Request,4687,[17.0][BKP][IMP] l10n_es_verifactu_oca: Fix report layout conflict with stock picking address,Backport of https://github.com/OCA/l10n-spain/pull/4663,"Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [17.0-ocabot-merge-pr-4687-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4687-by-pedrobaeza-bump-patch), awaiting test results. [SEP] @pedrobaeza your merge command was aborted due to failed check(s), which you can inspect on [this commit of 17.0-ocabot-merge-pr-4687-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/9f2e1a82959ab3a44abdf467b4258b229caf1dc8).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] /ocabot merge patch [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [17.0-ocabot-merge-pr-4687-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4687-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 516c0d00c7141e38648441f27faf8b5b9ebd3da3. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4686,[18.0][IMP] delivery_gls_asm: raise UserError when validating picking with a PickUp Service,"Cuando se valida un picking donde el carrier tiene como servicio uno de los ""Pick-up service"" por ejemplo: _RECOGIDA ECONOMY_ , aparece un error 
![Kooha-2025-12-30-13-58-37 (2)](https://github.com/user-attachments/assets/4507340f-5374-49df-95aa-b9cfd7d02d66)

La propuesta es mejorar la visualización del error:
<img width=""1124"" height=""183"" alt=""image"" src=""https://github.com/user-attachments/assets/d644aa38-f356-49b5-b115-459d8543bef3"" />
","Hi @hildickethan,
some modules you are maintaining are being modified, check this out! [SEP] > Entiendo que ocurriría lo mismo si usas la función de `gls_asm_send_pickup` sin que sea de tipo pickup pero como ese proceso es manual y el botón no sale si no es del tipo correcto, ese caso no debería ser un problema

Sí, estoy de acuerdo, crees que deberíamos poner el `UserError` en lugar del `continue`, para ser coherentes? [SEP] > Sí, estoy de acuerdo, crees que deberíamos poner el `UserError` en lugar del `continue`, para ser coherentes?

Si tienes tiempo estaría bien, por coherencia más que otra cosa y vendría bien si algun dia se ejecuta por código en lugar del botón [SEP] > > Sí, estoy de acuerdo, crees que deberíamos poner el `UserError` en lugar del `continue`, para ser coherentes?
> 
> Si tienes tiempo estaría bien, por coherencia más que otra cosa y vendría bien si algun dia se ejecuta por código en lugar del botón

Okay! Ahora he añadido esta parte [SEP] On my way to merge this fine PR!
Prepared branch [18.0-ocabot-merge-pr-4686-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4686-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 6309db228e2244365fec56824471fd8fc4102758. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4685,[19.0][MIG] delivery_gls_asm: Migration to 19.0,"Se ha añadido tests. En el modo de pruebas, la cancelación de pickup devuelve el Error Desconocido -204. (Método `_cancel_pickup`) Esto no sé si es debido a estar en modo prueba o también ocurre en entornos de producción.

@ForgeFlow
","/ocabot migration delivery_gls_asm

A revisar CI."
Pull Request,4684,[16.0][IMP] l10n_es_sigaus_stock_picking_report_valued: Remove the SIGAUS total block.,"@HaraldPanten @Jaimermaccione 

- Remove the SIGAUS total block.  Now the stock_picking_report_valued module now includes logic to add totals through the `get_report_valued_total_amount method` (OCA/stock-logistics-reporting#457)

[T-9158]
","@Jaimermaccione Fixed, could you please check again?
Thanks [SEP] @HaraldPanten this PR has passed functional and technical review. Could you please review and merge it?
Thanks [SEP] On my way to merge this fine PR!
Prepared branch [16.0-ocabot-merge-pr-4684-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/16.0-ocabot-merge-pr-4684-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at dfb5e3fb2a006eb6a7cd9f36e530ba77a21fcb45. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4683,[17.0][FIX] l10n_es_atc_mod417: Rectificaciones de compra en la 34 y 35,"Siguiendo el PR https://github.com/OCA/l10n-spain/pull/4454 el modelo 417 debería ser ajustado de igual manera.

@Tecnativa TT59950
@pedrobaeza @sergio-teruel ","Hi @carlos-lopez-tecnativa,
some modules you are maintaining are being modified, check this out! [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [17.0-ocabot-merge-pr-4683-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4683-by-pedrobaeza-bump-minor), awaiting test results. [SEP] Ciertamente, para mi tampoco tiene sentido... [SEP] Congratulations, your PR was merged at 446cd1a464862e154424ae21a9acea9d145ee062. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4682,[14.0][FIX] l10n_es_ticketbai_pos: Fix AttributeError 'bool' object …,…has no attribute 'startswith'.,"Hi @ao-landoo,
some modules you are maintaining are being modified, check this out! [SEP] @luciaavanzosc estoy trabajando en algunos issues en un cliente y veo que hemos enfrentado problemas comunes. En este caso en particular me pregunto desde el punto de vista del diseño ¿es valido que l10n_es_unique_id no tenga ningún valor? @Bilbonet 
"
Pull Request,4680,[19.0][MIG]: l10n_es_aeat_mod303,"- Standard migration to 19.0 module l10n_es_aeat_mod303
- Depends: https://github.com/OCA/l10n-spain/pull/4624

","/ocabot migration l10n_es_aeat_mod303 [SEP] @sbiosca-s73 ¿puedes añadir el siguiente fix?

*  #4748 [SEP] @dalonsod hecho!"
Pull Request,4679,[16.0] [FIX] l10n_es_ticketbai_pos: fix AttributeError when validating payment from pos order to invoice,"## **Análisis del Error de TicketBAI en POS**

### **📋 Escenario Funcional**
- **Instancia:** Configurada con TicketBAI habilitado
- **Configuración de compañía:** Regímen simplificado **NO habilitado**
- **Configuración del POS específico:** Regímen simplificado **SÍ habilitado**
- **Flujo:** Se crea un pedido normal en POS → Se marca para facturar → Error

![Captura del escenario](https://github.com/user-attachments/assets/386de483-b691-4a91-91ca-366d5f96e688)

### **⚠️ Error Encontrado**
```
AttributeError: 'bool' object has no attribute 'startswith'
```
**Traza relevante:**
```python
'bool' object has no attribute 'startswith'
Traceback (most recent call last):
File ""/opt/odoo-server/odoo/http.py"", line 1823, in _serve_db
return service_model.retrying(self._serve_ir_http, self.env)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File ""/opt/odoo-server/odoo/service/model.py"", line 152, in retrying
result = func()
^^^^^^
File ""/opt/odoo-server/odoo/http.py"", line 1851, in _serve_ir_http
response = self.dispatcher.dispatch(rule.endpoint, args)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File ""/opt/odoo-server/odoo/http.py"", line 2055, in dispatch
result = self.request.registry['ir.http']._dispatch(endpoint)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File ""/opt/odoo-server/odoo/addons/base/models/ir_http.py"", line 154, in _dispatch
result = endpoint(**request.params)
^^^^^^^^^^^^^^^^^^^^^^^^^^
File ""/opt/odoo-server/odoo/http.py"", line 763, in route_wrapper
result = endpoint(self, *args, **params_ok)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File ""/opt/odoo-server/addons/web/controllers/dataset.py"", line 43, in call_kw
return self._call_kw(model, method, args, kwargs)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File ""/opt/odoo-server/addons/web/controllers/dataset.py"", line 34, in _call_kw
return call_kw(Model, method, args, kwargs)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File ""/opt/odoo-server/odoo/api.py"", line 480, in call_kw
result = _call_kw_model(method, model, args, kwargs)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File ""/opt/odoo-server/odoo/api.py"", line 451, in _call_kw_model
result = method(recs, *args, **kwargs)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File ""/opt/odoo-server/addons/point_of_sale/models/pos_order.py"", line 939, in create_from_ui
order_ids.append(self._process_order(order, draft, False))
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File ""/opt/odoo-server/extra_addons/oca/l10n-spain/l10n_es_ticketbai_pos/models/pos_order.py"", line 200, in _process_order
vals = order.tbai_prepare_invoice_values(pos_order)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File ""/opt/odoo-server/extra_addons/oca/l10n-spain/l10n_es_ticketbai_pos/models/pos_order.py"", line 60, in tbai_prepare_invoice_values
number = self.tbai_get_value_num_factura()
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File ""/opt/odoo-server/extra_addons/oca/l10n-spain/l10n_es_ticketbai_pos/models/pos_order.py"", line 259, in tbai_get_value_num_factura
if invoice_number_prefix and not self.l10n_es_unique_id.startswith(
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'bool' object has no attribute 'startswith'
```
### **🔍 Análisis Técnico**

#### **Problema 1: ✅ Solucionado en este PR**
- Se estaba accediendo a datos de `pos.order` fuera de la clave `data`
- **Ejemplo del código actual sin aplicar este PR:**
  
https://github.com/OCA/l10n-spain/blob/cb464963d188c069c266c54ba6a85309e54870c2/l10n_es_ticketbai_pos/models/pos_order.py#L96-L98

#### **Problema 2: ❌ No resuelto en este PR (Principal preocupación)**
**Situación inconsistente:**
- La orden en POS se marca como `to_invoice` (dentro de `data`)
- Pero la opción `to_invoice` (fuera de `data`) sigue siendo `False`

![Problema 2](https://github.com/user-attachments/assets/ae786ad4-3a93-490b-87ac-466900fdc39b)

Este PR cambiar el código anterior para preguntar directamente por el to_invoice dentro del data y de esta manera ""soluciona"" el issue pero ...

**Punto de verificación:**

https://github.com/OCA/l10n-spain/blob/cb464963d188c069c266c54ba6a85309e54870c2/l10n_es_ticketbai_pos/models/pos_order.py#L199

### **🧪 Limitaciones para Reproducir**
**Como especialista técnico (no funcional):**
- No puedo reproducir el error en Runboat
- Error alternativo: Firma de TicketBAI falla antes del pago (no ocurre en local)
- Dificultad para validar el flujo funcional completo

### **🎯 Resumen del Issue**
1. **Error inmediato:** Atributo booleano donde se espera string (`l10n_es_unique_id`)
2. **Causa raíz:** Discrepancia entre datos dentro/fuera de la clave `data`
3. **PR actual:** Soluciona solo el primer problema de acceso a datos
4. **Problema pendiente:** Inconsistencia en el flag `to_invoice`

### **❓ Preguntas para el Equipo Funcional**
- ¿Es válido tener configuraciones diferentes entre compañía y POS?
- ¿Cuál es el flujo esperado cuando solo el POS tiene régimen simplificado?

**Nota:** Se necesita validación funcional para entender completamente el escenario.","Hi @ao-landoo,
some modules you are maintaining are being modified, check this out! [SEP] @Bilbonet ¿podrías echarle un ojo a esto? ¿reproducirlo en runboat tal vez? [SEP] El segundo commit de este PR tiene como objetivo corregir este error:

```
tbai_datas
Traceback (most recent call last):
File ""/opt/odoo-server/odoo/http.py"", line 1823, in _serve_db
return service_model.retrying(self._serve_ir_http, self.env)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File ""/opt/odoo-server/odoo/service/model.py"", line 152, in retrying
result = func()
^^^^^^
File ""/opt/odoo-server/odoo/http.py"", line 1851, in _serve_ir_http
response = self.dispatcher.dispatch(rule.endpoint, args)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File ""/opt/odoo-server/odoo/http.py"", line 2055, in dispatch
result = self.request.registry['ir.http']._dispatch(endpoint)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File ""/opt/odoo-server/odoo/addons/base/models/ir_http.py"", line 154, in _dispatch
result = endpoint(**request.params)
^^^^^^^^^^^^^^^^^^^^^^^^^^
File ""/opt/odoo-server/odoo/http.py"", line 763, in route_wrapper
result = endpoint(self, *args, **params_ok)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File ""/opt/odoo-server/addons/web/controllers/dataset.py"", line 43, in call_kw
return self._call_kw(model, method, args, kwargs)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File ""/opt/odoo-server/addons/web/controllers/dataset.py"", line 34, in _call_kw
return call_kw(Model, method, args, kwargs)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File ""/opt/odoo-server/odoo/api.py"", line 480, in call_kw
result = _call_kw_model(method, model, args, kwargs)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File ""/opt/odoo-server/odoo/api.py"", line 451, in _call_kw_model
result = method(recs, *args, **kwargs)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File ""/opt/odoo-server/addons/point_of_sale/models/pos_order.py"", line 939, in create_from_ui
order_ids.append(self._process_order(order, draft, False))
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File ""/opt/odoo-server/extra_addons/oca/l10n-spain/l10n_es_ticketbai_pos/models/pos_order.py"", line 201, in _process_order
vals = order.tbai_prepare_invoice_values(pos_order)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File ""/opt/odoo-server/extra_addons/oca/l10n-spain/l10n_es_ticketbai_pos/models/pos_order.py"", line 107, in tbai_prepare_invoice_values
datas = base64.b64encode(order_data[""tbai_datas""].encode(""utf-8""))
~~~~~~~~~~^^^^^^^^^^^^^^
KeyError: 'tbai_datas'
```

**Posible causa principal:**  
Probablemente se debía a una condición de carrera en el código JavaScript y/o a una interrupción en la cadena de Promesas y/o a excepciones ocultas durante el proceso de generación de facturas simplificadas.  

Este problema fue particularmente difícil de abordar debido a su naturaleza intermitente, ya que ocurre de forma aleatoria y parece estar relacionado con latencias de red u otros factores de sincronización. [SEP] Buenas @rrebollo 

A que te refieres con activar ""Régimen simplificado"" en el POS?
En la configuración de la compañía si veo el check en el apartado TicketBai, pero en el POS no lo veo.

 [SEP] > A que te refieres con activar ""Régimen simplificado"" en el POS? En la configuración de la compañía si veo el check en el apartado TicketBai, pero en el POS no lo veo.

A esto:

<img width=""1354"" height=""819"" alt=""image"" src=""https://github.com/user-attachments/assets/b72b5282-49fa-4ca9-acf8-a6321768f7b5"" />

 [SEP] Sobre la discrepancia entre el valor de `to_invoice` como option y el que figura en el json de pos order, entiendo que puede tratarse de una variación en el código que no se manejó previamente. Todas las pruebas de la función `create_from_ui` de `pos.order` —que simulan la llamada desde el servicio RPC de JavaScript— pasan el mismo valor tanto en el option como en el JSON de pos order; normalmente asignan el mismo parámetro.

Adicionalmente, al realizar pruebas en un entorno Runbot ([runbot.com](https://runbot.com/)) con una versión vanilla de Odoo 16 CE, observé que, aunque en la interfaz del POS se seleccione la opción “Facturar”, el valor de `to_invoice` en options permanece en `false`.

Dada esta situación, el enfoque adoptado en este PR para resolver el problema resulta legítimo y adecuado. [SEP] Estoy trabajando en un set de pruebas js [SEP] /ocabot merge patch [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [16.0-ocabot-merge-pr-4679-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/16.0-ocabot-merge-pr-4679-by-pedrobaeza-bump-patch), awaiting test results. [SEP] This PR has the `approved` label and has been created more than 5 days ago. It should therefore be ready to merge by a maintainer (or a PSC member if the concerned addon has no declared maintainer). 🤖 [SEP] /ocabot merge patch [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [16.0-ocabot-merge-pr-4679-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/16.0-ocabot-merge-pr-4679-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at c2bca315ce4639d63faa0c2b788fcf8215cf93ab. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4676,[19.0][MIG] l10n_es_aeat_mod115: Migration to 19.0,Migración standart,/ocabot migration l10n_es_aeat_mod115
Pull Request,4675,[19.0][MIG] l10n_es_aeat_mod111: Migration to 19.0,Migración standard.,/ocabot migration l10n_es_aeat_mod111
Pull Request,4674,[17.0][IMP] l10n_es_vat_book: tax group compatibility,"Solution to issue https://github.com/OCA/l10n-spain/issues/4652 . 
**Dado que el módulo se va a refactorizar, se deja este PR en Draft, para el resto de casos que se necesite utilizar el libro de IVA con impuestos agrupados (DUA). Actualmente esta solución es viable, pero se debería de realizar más optima, esto se realizará en la refactorización. Por el momento, este PR no se mergeará para no relentizar el cálculo del libro de IVA.**","@HaraldPanten could u review please? [SEP] Probado en local y funciona correctamente. Se resuelve el error y no hay discrepancias con los resultados (tampoco con prorrata, etc.).

También probado en runboat y se resuelve el error con los grupos de impuestos.

@pedrobaeza Al margen de ajustes que queremos hacer y añadir tests, te cuadra el enfoque planteado? Sin este parche (o uno equivalente) actualmente no es posible generar el libro de IVA en instancias que utilicen DUA y tengan facturas del transitario con el grupo de impuestos aplicado.

Gracias. [SEP] En general, utilizar un enfoque con `try` + `except` no suele ser la mejor de las soluciones, ya que ese error puede ser causado por varias razones (aunque se limite la excepción a capturar), y luego, el código del `except` no asegura tampoco que vaya a salir bien. ¿No se puede detectar de otra forma la estructura? ¿Puedes resumir por aquí cómo sale de una y otra forma para ver si tenemos una mejor forma? [SEP] > En general, utilizar un enfoque con `try` + `except` no suele ser la mejor de las soluciones, ya que ese error puede ser causado por varias razones (aunque se limite la excepción a capturar), y luego, el código del `except` no asegura tampoco que vaya a salir bien. ¿No se puede detectar de otra forma la estructura? ¿Puedes resumir por aquí cómo sale de una y otra forma para ver si tenemos una mejor forma?

Cambiado con detección de longitud. Si ""res"" con la devolución de la llamada ""_process_aeat_tax_base_info"" tiene más de longitud 1 es que se está haciendo un grupo de impuestos.  [SEP] > Uhm, sigue sin convencerme demasiado... ¿No habría que mirar `si tax es de tipo grupo`, y si es el caso, entonces buscar `res[tax.child_ids]` (en seudocódigo)?

Pongo un ejemplo:
Impuesto: DUA --> account.tax(157,) 
Impuestos hijos: account.tax(9, 154)
res después de la llamada a ""_process_aeat_tax_base_info"" -> {account.tax(9,): {'tax': account.tax(9,), 'base': 5691.03, 'amount': 0, 'deductible_amount': 0}, account.tax(154,): {'tax': account.tax(154,), 'base': 5691.03, 'amount': 0, 'deductible_amount': 0}} 

1) Se puede comprobar si el ""account.tax(157,) / Tax"" de esa iteración es grupo de impuesto y entonces que haga esa ""excepción"" (sin problema).

2) Búsqueda  res[tax.child_ids], se podría realizar, pero solamente con que cojamos la base de uno de ellos ya es suficiente, el resto se pueden ignorar.

¿Te va bien con ese enfoque?  [SEP] Vale, entonces podría ser `if is_group(tax): list(res.values())[0][""base""]` [SEP] @pedrobaeza @HaraldPanten sabéis si hay algún problema con los runboats?
`Error: Docker login for 'ghcr.io' failed with exit code 1`

Ya he subido el cambio el cambio según lo que se habló ayer 😸 a ver que os parece. [SEP] > @pedrobaeza @HaraldPanten sabéis si hay algún problema con los runboats? `Error: Docker login for 'ghcr.io' failed with exit code 1`
> 
> Ya he subido el cambio el cambio según lo que se habló ayer 😸 a ver que os parece.

A nivel funcional, el runboat no me ha dado problemas. A priori funciona con normalidad.

Pedro, ya nos das feedback sobre el planteamiento técnico. A nivel funcional querré hacer algunas pruebas más; eso sí.

Gracias. [SEP] Vale @pedrobaeza  te comento...

Lo que hemos hecho ha sido compatibilizar el grupo de impuestos para sacar el libro de IVA. El desglose en dos líneas no es correcto, como bien dices. A mi entender, debería comportarse como en las versiones antiguas. Una línea con la base y la cuota según la revalorización. Al final es coger la base y la cutoa donde se aplica el impuesto de importaciones.

De todas formas, eso no lo hemos cambiado. Nosotros lo que hemos hecho ha sido compatibilizar el libro de IVA, tal y como estaba, con los grupos de impuestos. Habría que hacer un FIX para que apareciera la base y la cuota en una sola línea, como había funcionado hasta la V16. Adjunto captura.

<img width=""1502"" height=""272"" alt=""Captura de pantalla 2025-12-22 a las 14 38 57"" src=""https://github.com/user-attachments/assets/e193d61d-9f17-4cbd-9148-6a1061c3a0a6"" />

Hacemos FIX en este mismo PR en commit por separado? [SEP] Podéis ponerlo en este PR. [SEP] ¿Alguna novedad? [SEP] > ¿Alguna novedad?

Mi idea es continuarlo el viernes/lunes a más tardar, que entre fiestas y cierres.... 😅 . [SEP] @pedrobaeza @HaraldPanten indicado en la cabecera del PR y puesto en estado draft como comentamos ayer :) . [SEP] Este PR no debe ser fusionado. Es un parche circunstancial que dejamos abierto (en Draft) por si el resto de usuarios se encuentran con el mismo problema. Esto permite extraerlo, pero no es una solución definitiva. Hasta el refactoring del módulo puede utilizarse como parche temporal."
Pull Request,4673,[18.0][IMP] l10n_es_vat_book: improve search for Ram consume,"The invoice search in the vat book calculation has been modified to optimize performance on large databases.

This change avoids unnecessary prefetch and significantly improving the action's speed and memory consumption.

","Hola, veo que estáis haciendo esto en varios sitios, pero no tengo claro que mejore velocidad en general, ya que si no se hace prefetch, luego tendrá que obtener los datos ""por trozos"", y realmente Odoo ya lleva una gestión para hacer un prefetch inteligente. [SEP] @pedrobaeza con las pruebas realizadas hemos comprobado que con el prefetch, el consumo de la ram era exponencial al calcular el libro de iva de una empresa con muchas facturas, después de añadir dicho cambio el proceso acabo sin problema. [SEP] Ya, ¿pero y tiempos? ¿Esa instancia tiene modificaciones severas sobre `account.move` y `account.move.line`? Algo intermedio es hacer prefetch solo de los campos necesarios para el proceso. [SEP] > Algo intermedio es hacer prefetch solo de los campos necesarios para el proceso.

Esta es la solución ideal, el problema será que el prefetch estará calculando computes complejos que luego no se usan aquí [SEP] Bueno, en el ORM se difieren la obtención de los campos calculados hasta que se usen por primera vez, por lo que eso no debería ser."
Pull Request,4672,[17.0][FIX] l10n_es_partner: Force context to calculate complete_name with comercial,"bp https://github.com/OCA/l10n-spain/pull/4658/

complete_name is the field used to sort res.partner, but when calculated without context, the stored value ignored the sales rep name, producing an inconsistent visual order in the tree views when sorting by contact. The context is forced during the compute to include the sales rep in companies and contacts. In addition, a migration script is added to recalculate the affected records as it is a stored field.

@Tecnativa TT59646

@victoralmau @pedrobaeza please review","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [17.0-ocabot-merge-pr-4672-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4672-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 393a220daebf4090131f7b4464a393111a51eded. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4671,[18.0][FIX] l10n_es_aeat_mod390: Calculate casilla 662,"FW-port of https://github.com/OCA/l10n-spain/pull/4617

En la casilla 662 se deben incluir las cuotas a compensar generadas en este año que no se hayan aplicado en el año.
image
https://sede.agenciatributaria.gob.es/static_files/Sede/Procedimiento_ayuda/G412/instr390.pdf

Antes del fix sólo se recogía la casilla 87 del último periodo lo que no recogía todos los casos, como que el contenido de la casilla 87 proveniera integra o parcialmente de años anteriores.

¿@ArantxaSudon @pedrobaeza @LauraCForgeFlow podéis revisar por favor?

@moduon MT-8899","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] @pedrobaeza ya que fusionas para 16 y 17, que no se te pase 18. Gracias. 😊 [SEP] > Aplica los comentarios de la 16 aquí.

Es verdad, se me olvidarón. Ya está, gracias por recordarlo. [SEP] On my way to merge this fine PR!
Prepared branch [18.0-ocabot-merge-pr-4671-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4671-by-pedrobaeza-bump-patch), awaiting test results. [SEP] @pedrobaeza your merge command was aborted due to failed check(s), which you can inspect on [this commit of 18.0-ocabot-merge-pr-4671-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/f6fef01498a0bc8fe52c7b4db26bb3635b48fe62).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] /ocabot merge patch [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [18.0-ocabot-merge-pr-4671-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4671-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 334c6d4c58baafa36e72af2bf861a36338e321df. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4670,[18.0][MIG] l10n_es_facturae_sale_stock: Migration to 18.0,Module migrated to version 18.0,"@bjkumal @eantones please review it
 [SEP] This PR has the `approved` label and has been created more than 5 days ago. It should therefore be ready to merge by a maintainer (or a PSC member if the concerned addon has no declared maintainer). 🤖 [SEP] On my way to merge this fine PR!
Prepared branch [18.0-ocabot-merge-pr-4670-by-etobella-bump-nobump](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4670-by-etobella-bump-nobump), awaiting test results. [SEP] /ocabot migration l10n_es_facturae_sale_stock [SEP] Congratulations, your PR was merged at 9734cce395dbe79ab0b8ce4dc42955c1ee0320a3. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4669,[18.0][IMP] l10n_es_aeat_mod190: Add account_tax_template_p_irpf24 to tax mapping,"Add ""24% Ret IRPF"" to tax mapping for field numbers 15 and 16.

Cuando esté fusionado en 18.0 lo llevo a 17.0

¿@rafaelbn @Shide @pedrobaeza @ArantxaSudon podéis revisarlo? Gracias

MT-13024 @moduon","Los tests fallan por el módulo `l10n_es_atc_mod420`. Error de fechas https://github.com/OCA/l10n-spain/actions/runs/20652855269/job/59300462804#step:8:1311, me parece que los tests no son correctos si al cambiar de año dan error. [SEP] > Añade por favor en los tests dicho impuesto para verificar las casillas - que cambiarán -, y así detectar si en el futuro cambian los XML-IDs, que salte el error.

Hecho. Gracias. [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [18.0-ocabot-merge-pr-4669-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4669-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at a1afcd8d78181a09b94868b0e103a46936d468f7. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4668, [18.0][FIX] l10n_es_aeat_sii_oca: allow deletion when aeat_state is False,"Fixes invoice deletion for records created before `l10n_es_aeat_sii_oca` module activation.

Previously, invoices created before activating `l10n_es_aeat_sii_oca` had `aeat_state = False` and couldn't be deleted. Now deletion is allowed when `aeat_state` is either `'not_sent'` or `False`.","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [18.0-ocabot-merge-pr-4668-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4668-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at fdf41b11a53eec1565f7f2694a68aeb8df938e6a. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4667,[17.0][FIX] l10n_es_aeat_sii_oca: allow deletion when aeat_state is False,"Fixes invoice deletion for records created before `l10n_es_aeat_sii_oca` module activation.

Previously, invoices created before activating `l10n_es_aeat_sii_oca` had `aeat_state = False` and couldn't be deleted. Now deletion is allowed when `aeat_state` is either `'not_sent'` or `False`.","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [17.0-ocabot-merge-pr-4667-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4667-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 465965a147f26dc23bc164f14ac11e0e45b5679e. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4665,"[15.0][ADD] payment_redsys: Google Pay, Apple Pay, etc.","Si en el contrato con Redsys se tiene habilitado el pago con Google Pay y Apple Pay, permite que su muestren estas alternativas de pago bajo el pago por tarjeta.",
Pull Request,4664,[17.0][BKP][FIX] l10n_es_aeat_mod123: Tax 'Retenciones IRPF 19% (Compra consejero de sociedad)' added to tax mapping,"Backport de https://github.com/OCA/l10n-spain/pull/4660

MT-12991 @moduon @EmilioPascual @pedrobaeza","On my way to merge this fine PR!
Prepared branch [17.0-ocabot-merge-pr-4664-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4664-by-pedrobaeza-bump-patch), awaiting test results. [SEP] This PR has the `approved` label and has been created more than 5 days ago. It should therefore be ready to merge by a maintainer (or a PSC member if the concerned addon has no declared maintainer). 🤖 [SEP] Congratulations, your PR was merged at 174522360a73a6f8b1007ea5e2703401626f0456. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4663,[18.0] [FIX] l10n_es_verifactu_oca: Fix report layout conflict with stock picking address,"El cambio para mover el QR al encabezado del informe provocó que aparezca este bloque en el el report ""stock.report_picking"".
Origen del error: https://github.com/OCA/l10n-spain/pull/4384
Línea:
https://github.com/OCA/l10n-spain/blob/84ac9d1e30b8c561bc549c324195743a278d1f29/l10n_es_verifactu_oca/views/report_invoice.xml#L15-L18

Para replicar el error, imprimir albarán en estado ""Ready""
<img width=""1258"" height=""679"" alt=""image"" src=""https://github.com/user-attachments/assets/ffd868a0-22ef-4d87-9a18-80ff9e3882db"" />
<img width=""779"" height=""383"" alt=""image"" src=""https://github.com/user-attachments/assets/89c37573-7fa2-4454-a393-607bf7ae106f"" />

Después del fix:
<img width=""789"" height=""449"" alt=""image"" src=""https://github.com/user-attachments/assets/40d439ff-e79c-4b65-96f1-64531068bc23"" />
","@pedrobaeza @almumu [SEP] > En este módulo no se puede depender de `stock`. Mira si existe otra forma de arreglarlo sin requerir esa dependencia. Por otro lado, mira de que no se cambie README/index.html

Vale! Ahora lo intento [SEP] > En este módulo no se puede depender de `stock`. Mira si existe otra forma de arreglarlo sin requerir esa dependencia. Por otro lado, mira de que no se cambie README/index.html

En teoría, debería ser suficiente añadiendo el t-if=""address"" de la vista original de Odoo

        <div t-if=""address"" t-attf-class=""address row mb-4"" title=""This block is not always present depending on the printed document."">

https://github.com/odoo/odoo/blob/376c36336b4a2bd01c9cb9b2594abee0713bcf51/addons/web/views/report_templates.xml#L280

Con esto ya no aparece el bloque ""Address block"" [SEP] On my way to merge this fine PR!
Prepared branch [18.0-ocabot-merge-pr-4663-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4663-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 046cdd85ee6296f5e4002c7e9e3261923f6b1f45. Thanks a lot for contributing to OCA. ❤️ [SEP] @RicardCForgeFlow Creo que esto no se llevó a la V17. Podríais llevarlo/revisarlo?

@pedrobaeza @AaronHForgeFlow @LoisRForgeFlow 

Gracias por la aportación. [SEP] > @RicardCForgeFlow Creo que esto no se llevó a la V17. Podríais llevarlo/revisarlo?
> 
> @pedrobaeza @AaronHForgeFlow @LoisRForgeFlow
> 
> Gracias por la aportación.

Hola @HaraldPanten ahora he hecho el cambio para la v17: https://github.com/OCA/l10n-spain/pull/4687

Para la v16 no es necesario, ya que no existe el bloque ""Address block"" [SEP] > #4687

Perfecto! Muchas gracias por la aportación."
Pull Request,4662,[16.0][FIX] l10n_es_aeat_sii_oca: allow deletion when aeat_state is False,"Fixes invoice deletion for records created before `l10n_es_aeat_sii_oca` module activation.

Previously, invoices created before activating `l10n_es_aeat_sii_oca` had `aeat_state = False` and couldn't be deleted. Now deletion is allowed when `aeat_state` is either `'not_sent'` or `False`.","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] > Si se tiene desactivado el SII, no debe haber facturas con `aeat_state` distinto de `not_sent`, así que es algo específico de esa instancia donde tenéis el problema, pero este cambio no tiene demasiado sentido para mí ahora mismo.
> 
> ¿Cuál es el caso de uso?

Hola @pedrobaeza 
El problema es que para las facturas que se crearon **antes** de activar el módulo `l10n_es_aeat_sii_oca`, el campo `aeat_state` aparece vacío en lugar de `not_sent` y no deja eliminarlas.

¿Es correcto este comportamiento?

Igual lo mejor es modificar el campo `aeat_state` de las facturas que se crearon **antes** de activar el módulo `l10n_es_aeat_sii_oca` con una acción de servidor en nuestro caso. [SEP] Entendido el problema. Entonces cambia el filtered a que sea `rec.aeat_state not in [""not_sent"", False]`. [SEP] > Entendido el problema. Entonces cambia el filtered a que sea `rec.aeat_state not in [""not_sent"", False]`.

@pedrobaeza buena idea. Acabo de subir los cambios. [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [16.0-ocabot-merge-pr-4662-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/16.0-ocabot-merge-pr-4662-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at cb464963d188c069c266c54ba6a85309e54870c2. Thanks a lot for contributing to OCA. ❤️ [SEP] > /ocabot merge patch
> 
> ¿Puedes llevarlo a versiones superiores?

Si."
Pull Request,4661,[18.0][ADD] website_sale_insurance_caser,"Depends on:

- [ ] https://github.com/OCA/l10n-spain/pull/4646

@tecnativa TT58928
@carlosdauden @sergio-teruel @pilarvargas-tecnativa @eduezerouali-tecnativa @carlos-lopez-tecnativa Please review it if you can, thanks",
Pull Request,4660,[18.0][FIX] l10n_es_aeat_mod123: Tax 'Retenciones IRPF 19% (Compra consejero de sociedad)' added to tax mapping,"Las Retenciones IRPF 19% no se han metido en el mapeo de impuestos como en v16: https://github.com/OCA/l10n-spain/pull/3625

Cuando esté fusionado hago cherry-pick a la 17

MT-12991 @moduon @EmilioPascual @pedrobaeza porfa, revisad si queréis 😄 ","¿Puedes por favor llevarlo a la 17 también? [SEP] @pedrobaeza , lo vamos a llevar a todas las versiones ;-)

> Cuando esté fusionado hago cherry-pick a la 17 [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [18.0-ocabot-merge-pr-4660-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4660-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 84ac9d1e30b8c561bc549c324195743a278d1f29. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4659,[16.0][FIX] l10n_es_verifactu_oca: better matching an exception control in responses. Pending cherry-pick for macrodata computation,"- mejora el matching de las respuestas https://github.com/OCA/l10n-spain/pull/4378#discussion_r2482471388 y además controla excepciones. En caso de que durante el procesamiento de las respuestas diera por ejemplo un errror de python en alguna de las facturas, se guarda en la mensajería de la propia factura, similar a esto.
<img width=""1825"" height=""285"" alt=""image"" src=""https://github.com/user-attachments/assets/52303e1a-4eb7-4c09-b558-82bcb1361189"" />

o si no se envía porque una de las facturas del bloque que se está enviando no está cumpliendo el esquema, muestra el error que devuelve AEAT, aunque AEAT no especifica cual de las facturas es la que no cumple, pero al menos se sabe lo que está pasando
<img width=""1809"" height=""290"" alt=""image"" src=""https://github.com/user-attachments/assets/6360a59b-12a4-4964-9e14-a72b35299e2f"" />



- aplicado cherry-pick de https://github.com/OCA/l10n-spain/pull/4602","@pedrobaeza 
cuando se mergee este ya se podría eliminar el commit https://github.com/OCA/l10n-spain/pull/4378/commits/625d706d74df3dda6147a8f9982beb95bf803964  del PR  https://github.com/OCA/l10n-spain/pull/4378 de l10n_es_verifactu_pos_oca
"
Pull Request,4658,[18.0][FIX] l10n_es_partner: Force context to calculate complete_name with comercial,"complete_name is the field used to sort res.partner, but when calculated without context, the stored value ignored the sales rep name, producing an inconsistent visual order in the tree views when sorting by contact. The context is forced during the compute to include the sales rep in companies and contacts. In addition, a migration script is added to recalculate the affected records as it is a stored field.

@tecnativa TT59646

@pedrobaeza @victoralmau please review","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] https://github.com/odoo/odoo/blob/2dc9529af127ed4b2d451059b6ab9c83778c7814/odoo/addons/base/models/res_partner.py#L395 [SEP] Comprueba CI. @carlosdauden como tú estuviste cacharreando con esto, tal vez puedes dar pistas [SEP] > Comprueba CI. @carlosdauden como tú estuviste cacharreando con esto, tal vez puedes dar pistas

Te lo cuento, si he revisado y seguro que el error del orden también está en 17.0. El tema es que en 16.0 el order era por display_name y a partir de 17.0 el order es por complete_name. Esa es la diferencia fundamental.

https://github.com/odoo/odoo/blob/bb60d831a7cdb0606c1baae9a8985b2fdb7dc15b/odoo/addons/base/models/res_partner.py#L179

Por que no ordena bien? por que lo que vemos en pantalla es el display_name con el comercial calculado pero realmente el complete_name no se estaba calculando con el comercial (de ahí el error de los test que espera que siga sin calcularse).

Es correcto que el complete_name siga sin calcularse? No, por que entonces el orden en las vistas no será el correcto visualmente.

El test que hay ahora mismo como digo espera que se calcule el display_name con el comercial pero que el complete_name no se calcule. Por lo tanto hay que modificar el test.

Al añadir el contexto al compute que se alimenta del método _get_complete_name SI añade el comercial y el orden se corresponde con lo visual (display_name) pero claro, el test ya no es correcto. [SEP] Vale, pero recuerdo que @carlosdauden tocó eso. A ver si nos puede dar pistas o nos descarta que tenga que ver. [SEP] /ocabot merge nobump [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [18.0-ocabot-merge-pr-4658-by-pedrobaeza-bump-nobump](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4658-by-pedrobaeza-bump-nobump), awaiting test results. [SEP] Congratulations, your PR was merged at 3dcc7dd0d35d4e65db46332557db0354dd17f104. Thanks a lot for contributing to OCA. ❤️ [SEP] Only 19 fw-port pending."
Pull Request,4656,[18.0][MIG] l10n_es_pos_sii: Migration to version 18.0,"Migración estándar, a partir de https://github.com/OCA/l10n-spain/pull/4450
@Tecnativa TT59666","/ocabot migration l10n_es_pos_sii [SEP] Listo para revisión [SEP] Parece que el CI está caído por la imagen de postgres, en un rato lo vuelvo a lanzar [SEP] /ocabot merge nobump [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [18.0-ocabot-merge-pr-4656-by-pedrobaeza-bump-nobump](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4656-by-pedrobaeza-bump-nobump), awaiting test results. [SEP] Congratulations, your PR was merged at 68807f45a87a317e10d271b0e1b783ed470f4b65. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4655,[18.0][IMP] l10n_es_verifactu_oca: Invoice cancellation,"Forward-port de #4548 y #4636

- Permite la anulación de facturas en verifactu, con la posibilidad de indicar un motivo opcional de cancelación a nivel interno.
- Añade nuevos estados
- Se han refactorizado los tests para unificar métodos que se repetían.

@Tecnativa ","/ocabot merge minor [SEP] On my way to merge this fine PR!
Prepared branch [18.0-ocabot-merge-pr-4655-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4655-by-pedrobaeza-bump-minor), awaiting test results. [SEP] @pedrobaeza your merge command was aborted due to failed check(s), which you can inspect on [this commit of 18.0-ocabot-merge-pr-4655-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/ffdf47d200bee8f9170bfad477705a941b926829).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] /ocabot merge minor [SEP] On my way to merge this fine PR!
Prepared branch [18.0-ocabot-merge-pr-4655-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4655-by-pedrobaeza-bump-minor), awaiting test results. [SEP] Congratulations, your PR was merged at 10d2830d6dd464a33cc3fbf445d51eca1261b2e0. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4654,[17.0][FIX] l10n_es_facturae: Don't test thing outside module,"This module doesn't transfer the motive text to the move, so it's better to not test that kind of things inside here, as any external change (like now) will make this to fail.

@Tecnativa ","Hi @etobella,
some modules you are maintaining are being modified, check this out! [SEP] /ocabot merge patch [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [17.0-ocabot-merge-pr-4654-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4654-by-pedrobaeza-bump-patch), awaiting test results. [SEP] @pedrobaeza your merge command was aborted due to failed check(s), which you can inspect on [this commit of 17.0-ocabot-merge-pr-4654-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/0b22bbebc4767e904b260f873457127389013124).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] /ocabot merge patch [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [17.0-ocabot-merge-pr-4654-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4654-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 6dec1c2e1db952c6ee513c099d1dea5a213bca08. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4653,[17.0][IMP] l10n_es_account_statement_import_n43: Add exclude pattern,"You may be interested in not importing certain statement lines if they come from complicated operations like third party payment providers with several charges/incomes, and you are interested in importing them by other means.

This commit includes a new field at journal level for defining an excluding pattern that allows this.

@Tecnativa TT59339","Fusiono tras estar en producción funcionando.

/ocabot merge minor [SEP] On my way to merge this fine PR!
Prepared branch [17.0-ocabot-merge-pr-4653-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4653-by-pedrobaeza-bump-minor), awaiting test results. [SEP] Congratulations, your PR was merged at 064954f7b9103939d6cf29625e099dc63bd4ae96. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4651,[19.0][MIG] : l10n_es_account_banking_sepa_fsdd Migration to 19.0,,/ocabot migration l10n_es_account_banking_sepa_fsdd
Pull Request,4648,[16.0][FIX]l10n_es_aeat_sii_oca: arreglar error del sii en un corner case de céntimos con impuestos incluídos,"Arregla error del sii en un corner case de céntimos que sucede en algunas facturas con impuestos incluídos en el precio.

Para reproducir el caso, se reproduce tanto en una factura de venta o compra como en un pos_order. Lo que sucede es que se envía en el desglose de impuestos una base con un céntimo positivo y una cuota con un céntimo negativo, o viceversa.
Por lo que el sii devuelve el error 1231:  'El campo CuotaRepercutida y BaseImponible deben tener el mismo signo.',

Ejemplo: con un iva 21% impuestos incluídos en el precio
<img width=""1154"" height=""759"" alt=""image"" src=""https://github.com/user-attachments/assets/252900bf-bff5-4a0a-8eb7-e79ab1499918"" />


<img width=""537"" height=""281"" alt=""image"" src=""https://github.com/user-attachments/assets/d74663f9-303c-4acb-9527-d5aa3d60012e"" />

mismo caso pero inverso, base negativa, impuesto positivo
<img width=""1152"" height=""713"" alt=""image"" src=""https://github.com/user-attachments/assets/f85d8508-7704-4855-9085-7579dae6c60c"" />



<img width=""828"" height=""76"" alt=""image"" src=""https://github.com/user-attachments/assets/46055b5d-1865-4453-ae10-88c1cbc42163"" />
","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] This PR has the `approved` label and has been created more than 5 days ago. It should therefore be ready to merge by a maintainer (or a PSC member if the concerned addon has no declared maintainer). 🤖 [SEP] Es un caso demasiado específico como bien decís... pero no debería crearse un método específico para ello, si no ver por qué fallan los mecanismos de limpieza estándar y mejorarlos."
Pull Request,4647,"[IMP] l10n_es_aeat_mod390: Incluir el campo ""Usar 303"" en la configur…","Añade configuración a nivel de compañía para establecer el valor predeterminado del campo ""Usar informes del 303"" en nuevos informes del modelo 390.

- Nuevo campo en `res.company`: `l10n_es_aeat_mod390_use_303`
- Vista de configuración en **Contabilidad > Configuración > Ajustes > Modelo 390** 
- Script de migración para marcar el campo en las compañías existentes a partir del último reporte creado.
- Documentación y traducciones actualizadas
- Nuevo test para esta funcionalidad.


MT-12790 @moduon @EmilioPascual ","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] Este desarrollo es incorrecto. Cierra el PR y revisa la tarea por favor"
Pull Request,4646,[18.0][ADD] sale_insurance_caser,"@tecnativa TT58928
@carlosdauden @sergio-teruel @pilarvargas-tecnativa @eduezerouali-tecnativa Please review it if you can, thanks",
Pull Request,4645,[18.0][IMP] l10n_es_verifactu_oca: create response line also when no verifactu response,"La idea es que en caso de error de conexión con Verifactu, podamos visualizar desde la factura que hay un error de conexión.

<img width=""1234"" height=""476"" alt=""image"" src=""https://github.com/user-attachments/assets/83deaeac-9011-497a-af31-bf26daaee047"" />
<img width=""1228"" height=""890"" alt=""image"" src=""https://github.com/user-attachments/assets/32e7bae4-8144-479f-a091-ccda335200e2"" />

<img width=""1243"" height=""834"" alt=""image"" src=""https://github.com/user-attachments/assets/d3292b76-8b12-4c30-b1c8-fa8df2a92285"" />
",
Pull Request,4644,[19.0][MIG] l10n_es_account_statement_import_n43,,"/ocabot migration l10n_es_account_statement_import_n43 [SEP] On my way to merge this fine PR!
Prepared branch [19.0-ocabot-merge-pr-4644-by-pedrobaeza-bump-nobump](https://github.com/OCA/l10n-spain/commits/19.0-ocabot-merge-pr-4644-by-pedrobaeza-bump-nobump), awaiting test results. [SEP] Congratulations, your PR was merged at 3a7accc7a44e17f8e433fa2b4113af2553c87472. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4640,"[16.0][IMP] l10n_es_verifactu_oca: manejo de rechazos, visibilidad de botones y bloqueo de borrado","Incluye:

- Cuando una factura es rechazada por VERIFACTU (ej: por fecha futura), no había forma de corregir ciertos datos para subsanarlo. Ahora se permite cancelar facturas con aeat_state = ""incorrect"" y pasarlas a borrador nuevamente, desbloqueando la posibilidad de editar datos esenciales para la subsanación.
- Los botones ""Re-send to VERIFACTU"" y ""Cancel in VERIFACTU"" seguían visibles aunque ya se hubiesen pulsado, causando confusión. Ahora los botones desaparecen automáticamente cuando hay registros pendientes de envío (verifactu_pending_to_send = True) y evita que el usuario intente ejecutar acciones que quedarían sin efecto mientras hay cambios sin enviar.
- Se bloquea la posibilidad de borrar cualquier factura que esté habilitada para VERIFACTU (incluso en estado borrador).

**NOTA:** He incluido un par de cosas dependientes y una independiente (el bloqueo de eliminación) en este PR para un primer análisis. Os invito a opinar acerca de la necesidad de cada una de estas tres cosas antes de hacer la (o las)  propuestas definitivas.","Hola @almumu cuando tengas un rato libre, ¿podrías por favor echarle un vistazo rápido a este borrador de PR? Me gustaría especialmente tu opinión sobre la parte de la subsanación, para ver si consideras que este enfoque es el más adecuado. Cualquier aporte / sugerencia será bienvenida."
Pull Request,4638,"[16.0][IMP]l10_es_verifactu_pos_oca: QR code on ticket reprint, simplified invoice when returning orders, and status change in form view for Verifactu Send State","Improvements for the module created by Factor Libre:
QR code on ticket reprint, simplified invoice when returning orders, and status change in form view for Verifactu Send State.",
Pull Request,4636,[17.0][IMP] l10n_es_verifactu_oca: Invoice cancellation,"Forward-port de #4548

- Permite la anulación de facturas en verifactu, con la posibilidad de indicar un motivo opcional de cancelación a nivel interno.
- Añade nuevos estados
- Se han refactorizado los tests para unificar métodos que se repetían.

@Tecnativa ","/ocabot merge minor [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [17.0-ocabot-merge-pr-4636-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4636-by-pedrobaeza-bump-minor), awaiting test results. [SEP] @pedrobaeza your merge command was aborted due to failed check(s), which you can inspect on [this commit of 17.0-ocabot-merge-pr-4636-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/aefd36e6c26d272f85a3f3ed5a76f9b7a32c2e8f).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] /ocabot merge minor [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [17.0-ocabot-merge-pr-4636-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4636-by-pedrobaeza-bump-minor), awaiting test results. [SEP] Congratulations, your PR was merged at a7fb941179328d37cc002e247425a82a64433ade. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4635,[16.0][IMP] l10n_es_verifactu_oca: fecha de operación,"Propone un modo de gestionar la fecha de operación de forma acorde con Odoo: la factura se registra en una fecha y el asiento contable en otra. De este modo, aparece correctamente en el libro de IVA, en los modelos 303 y similares, donde debe figurar.","Buenas @pedrobaeza  Hace un par de meses añadimos en este PR el soporte de la fecha de servicio necesario para VeriFactu. Tenemos instalado y funcionando ya el módulo VeriFactu de la OCA con varios clientes y con nosotros mismos, por lo que nos vendría muy bien mergear este PR cuando tengas un momento para revisarlo (si consideras que es correcto). Gracias."
Pull Request,4634,[18.0][FIX] l10n_es_verifactu_oca: serial number remove third-party number,"Mandar el `thirdparty_number` como número de serie de la factura, en caso de estar establecido, puede causar errores a la hora de recibir las respuestas por parte de la AEAT y incongruencias con los datos enviados.

https://github.com/OCA/l10n-spain/blob/016933d9ba88fb920cd08f30bbb82231054eb150/l10n_es_verifactu_oca/models/account_move.py#L139-L147

https://github.com/OCA/l10n-spain/blob/016933d9ba88fb920cd08f30bbb82231054eb150/l10n_es_verifactu_oca/models/account_move.py#L208-L222

Aunque se estaba usando este dato como el número de serie de la factura, no está implementada la lógica para enviar el flag de `EmitidaPorTerceroODestinatario`, ni se envían los datos de este tercero o destinatario. 

Además, a la hora de procesar las respuestas, se busca el documentos relacionado usando el número de serie de la factura (enviado a la AEAT) y el nombre de la misma. Si las enviamos con el número de terceros, nunca podremos encontrar el documento relacionado usando este `search` y no podremos crear la respuesta correspondiente (proceso bloqueante).

https://github.com/OCA/l10n-spain/blob/016933d9ba88fb920cd08f30bbb82231054eb150/l10n_es_verifactu_oca/models/verifactu_invoice_entry.py#L339-L350

He añadido la implementación de la facturación de terceros al ROADMAP para que pueda ser implementada cuando antes. Pero de momento, quizás lo mejor sería no enviar estos datos como números de serie de las facturas para evitar erroes (es decir, de momento no está habilitada la facturación de terceros). Así, por ahora, evitamos errores y bloqueos.
","@pedrobaeza @almumu [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [18.0-ocabot-merge-pr-4634-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4634-by-pedrobaeza-bump-patch), awaiting test results. [SEP] @pedrobaeza your merge command was aborted due to failed check(s), which you can inspect on [this commit of 18.0-ocabot-merge-pr-4634-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/07e89917d3bd8a6e9744a50ba89795b0d76a24f5).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] /ocabot merge patch [SEP] This PR looks fantastic, let's merge it!
Prepared branch [18.0-ocabot-merge-pr-4634-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4634-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 3abdabbfc1243bde64b8cd0abce8abceaf4d25cc. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4633,"[16.0][IMP]l10_es_verifactu_pos_oca: QR code on ticket reprint, simpl…","Improvements for the module created by Factor Libre:
QR code on ticket reprint, simplified invoice when returning orders, and status change in form view for Verifactu Send State.",
Pull Request,4630,[15.0][IMP]l10n_es_verifactu_oca: añadido causas de exención,"- Se modifica el mapeo de impuestos de Veri*Factu y se añaden las claves para la 6 causas posibles de exención.
- Se modifica el contenido a enviar para las operaciones exentas.

@BinhexTeam",Pendiente de #4499 
Pull Request,4629,[19.0][MIG] l10n_es_aeat_partner_check: Migration to 19.0,"Module migrated to version 19.0

Depends on:

- [ l10n_es_aeat ] https://github.com/OCA/l10n-spain/pull/4624",/ocabot migration l10n_es_aeat_partner_check
Pull Request,4627,[16.0][IMP] l10n_es_vat_prorate: update prorate data with wizard,"@Tecnativa TT59299

Añadida la posibilidad de actualizar prorrata si eres responsable de AEAT y Facturación.
Similar a como funciona la actualización de las fechas de bloqueo, con la dificultad añadida del one2many. 
@pedrobaeza @etobella ","Subido con la aproximación inicial @pedrobaeza   [SEP] Pero si lo metemos en el `res.config.settings`, ¿El usuario va a necesitar permiso de `Ajustes` no? 
Si planteamos esta opción creo que mi primera aproximación con el `wizard` es más apropiada aunque quedara un poco raro el manejo del One2many, el cuál, podríamos sustituirlo con un botón que llame al modelo de `res.company.vat.prorrate` en lugar de manejarlo en el propio wizard [SEP] Con permiso de administrador de facturación no se tiene acceso a esa configuración? Si es así, entonces no nos valdría. Míralo y lo que tú veas. [SEP] @christian-ramos-tecnativa cómo quedó esto? El runboat no funciona ahora mismo. [SEP] @pedrobaeza Lo había devuelto a la primera aproximación utilizando un wizard, he hecho rebase a ver si el runboat colabora. No he encontrado otra forma que quedara mas ""limpia"" a nivel de código. La experiencia de usuario considero que si está correctamente cubierta. Si puedes pruébalo de nuevo con mas ""cariño"" y me dices que te parece 😄  [SEP] Tras volverlo a analizar, lo del m2m lo sigo sin ver. Es mejor hacer una ""copia"" de las líneas en el wizard, y luego volcarlo a lo definitivo. Se podría hacer fácilmente con una herencia con cambio de nombre, y que añada el campo inverse del wizard, y el `company_id` lo rellenas tú en el `default_get` y por contexto para las nuevas líneas, y luego sería volcarlo haciendo un read y sacando el valor del campo m2o del inverse. [SEP] Listo, he preferido hacerlo al momento de pulsar el botón `Actualizar` ya que el `inverse` estaría modificando los datos reales con cada modificación y considero que hacer eso es un wizard es muy poco intuitivo. Ya que, por lo general, el usuario cree que los cambios se aplican al cerrar el wizard. [SEP] Listo! 👍🏻  [SEP] On my way to merge this fine PR!
Prepared branch [16.0-ocabot-merge-pr-4627-by-pedrobaeza-bump-minor](https://github.com/OCA/l10n-spain/commits/16.0-ocabot-merge-pr-4627-by-pedrobaeza-bump-minor), awaiting test results. [SEP] Congratulations, your PR was merged at 7b5aa79adfa7b2b84bf80559b20fa24a6b772ac5. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4625,[17.0][MIG] l10n_es_aeat_mod347_igic : Migration to 17.0,Migración estándar.,"@adasatorres ping me when all tests are green [SEP] No hay un modelo específico para Canarias equivalente al 347? Cuál es la finalidad de esto? [SEP] Buenas tardes, @pedrobaeza.
Efectivamente, en Canarias existe un modelo equivalente (el 415). Supongo que debe haber algún caso específico que el 415 no cubre, ya que he visto que este addon existe en la versión 16.0 conviviendo con el del 415, y además hay un PR abierto para la 18.0 sobre el mismo tema.

Quizá @christian-ramos-tecnativa, que fue quien subió el addon en la 16.0, pueda aportar más información sobre si realmente es necesario, teniendo en cuenta que ya existe el addon del modelo 415. [SEP] La verdad que cuando heredé el desarrollo de este módulo no le dí muchas vueltas, pero ahora por más que lo piense no se me ocurre un ejemplo en el que tengas que presentar un 347 con igic. 
Tienen algún caso real que utilice esta funcionalidad? [SEP] @pedrobaeza @christian-ramos-tecnativa, Cierro el PR, ya que después de investigar, he comprobado que para operaciones sujetas a IGIC en Canarias, la obligación informativa anual se cumple mediante el Modelo 415. Ademas no  he encontrado ningún excepción."
Pull Request,4624,[19.0][MIG] l10n_es_aeat: Migration to 19.0,"### **Refactoring & Modernization**
*   **ORM Commands**: Replaced legacy ""magic tuples"" (e.g., [(0, 0, ...)](cci:1://file:///home/pablo/Code/odoo/19.0/oca/l10n-spain/l10n_es_aeat/wizard/export_to_boe.py:206:8-209:47), [(4, ...)](cci:1://file:///home/pablo/Code/odoo/19.0/oca/l10n-spain/l10n_es_aeat/wizard/export_to_boe.py:206:8-209:47), [(6, 0, ...)](cci:1://file:///home/pablo/Code/odoo/19.0/oca/l10n-spain/l10n_es_aeat/wizard/export_to_boe.py:206:8-209:47)) with the `Command` namespace methods (`Command.create`, `Command.link`, `Command.set`) in both Python code and XML [eval](cci:1://file:///home/pablo/Code/odoo/19.0/oca/l10n-spain/l10n_es_aeat/wizard/export_to_boe.py:195:8-204:13) attributes.
*   **Domain API**: Fixed and standardized the usage of `Domain.AND` and `Domain.OR` to correctly accept lists of domains.
*   **String Formatting**: Migrated various string formatting operations to use **f-strings** for better readability and performance.

### **Odoo 19.0 / Python Migration**
*   **`name_get` Removal**: Replaced `name_get` with [_compute_display_name](cci:1://file:///home/pablo/Code/odoo/19.0/oca/l10n-spain/l10n_es_aeat/models/l10n_es_aeat_map_tax.py:52:4-62:19) in [l10n_es_aeat_map_tax.py](cci:7://file:///home/pablo/Code/odoo/19.0/oca/l10n-spain/l10n_es_aeat/models/l10n_es_aeat_map_tax.py:0:0-0:0).
*   **Menu Items**: Renamed `groups_id` to `group_ids` and ensured fully qualified group names in [aeat_menuitem.xml](cci:7://file:///home/pablo/Code/odoo/19.0/oca/l10n-spain/l10n_es_aeat/views/aeat_menuitem.xml:0:0-0:0).

### **Test Framework Updates**
*   **Model Registration**: Replaced the external `odoo_test_helper.FakeModelLoader` with Odoo's native `odoo.orm.model_classes.add_to_registry` and `addClassCleanup` in [test_l10n_es_aeat_report.py](cci:7://file:///home/pablo/Code/odoo/19.0/oca/l10n-spain/l10n_es_aeat/tests/test_l10n_es_aeat_report.py:0:0-0:0).

### **Structure & Fixes**
*   **File Movement**: Moved `aeat_soap.py` from `models` to [wizard](cci:1://file:///home/pablo/Code/odoo/19.0/oca/l10n-spain/l10n_es_aeat/models/aeat_certificate.py:31:4-40:9).
*   **Defaults**: Updated default value definitions in [l10n_es_aeat_report.py](cci:7://file:///home/pablo/Code/odoo/19.0/oca/l10n-spain/l10n_es_aeat/models/l10n_es_aeat_report.py:0:0-0:0) to use `lambda` functions, ensuring proper context evaluation.
*   **Export Logic**: Refactored [export_to_boe.py](cci:7://file:///home/pablo/Code/odoo/19.0/oca/l10n-spain/l10n_es_aeat/wizard/export_to_boe.py:0:0-0:0) formatting logic for better precision",/ocabot migration l10n_es_aeat
Pull Request,4622,[14.0][IMP] l10n_es_verifactu_oca: añadido causas de exención,"- Se modifica el mapeo de impuestos de Veri*Factu y se añaden las claves para la 6 causas posibles de exención.
- Se modifica el contenido a enviar para las operaciones exentas.

Este PR se basa en #4499 por lo que está pendiente del mismo para poder validar toda la funcionalidad.

@BinhexTeam",
Pull Request,4619,[17.0][MIG] delivery_mrw: Migration to 17.0,"cc @Tecnativa TT59392
This was migrated from this PR: https://github.com/OCA/l10n-spain/pull/4149
ping @pedrobaeza @carlos-lopez-tecnativa ","/ocabot migration delivery_mrw [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [17.0-ocabot-merge-pr-4619-by-pedrobaeza-bump-nobump](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4619-by-pedrobaeza-bump-nobump), awaiting test results. [SEP] @pedrobaeza your merge command was aborted due to failed check(s), which you can inspect on [this commit of 17.0-ocabot-merge-pr-4619-by-pedrobaeza-bump-nobump](https://github.com/OCA/l10n-spain/commits/90f45c3b812daf9b117af505b4e1fd49ef0453eb).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] /ocabot merge nobump [SEP] This PR looks fantastic, let's merge it!
Prepared branch [17.0-ocabot-merge-pr-4619-by-pedrobaeza-bump-nobump](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4619-by-pedrobaeza-bump-nobump), awaiting test results. [SEP] @pedrobaeza your merge command was aborted due to failed check(s), which you can inspect on [this commit of 17.0-ocabot-merge-pr-4619-by-pedrobaeza-bump-nobump](https://github.com/OCA/l10n-spain/commits/69630f6756bdb07ea9d4cc2960f5fbabd0597e73).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] /ocabot merge nobump [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [17.0-ocabot-merge-pr-4619-by-pedrobaeza-bump-nobump](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4619-by-pedrobaeza-bump-nobump), awaiting test results. [SEP] Congratulations, your PR was merged at bbfe643b70dbea7c0678cdd530eedf0bc97e355f. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4617,[16.0][FIX] l10n_es_aeat_mod390: Calculate casilla 662,"En la casilla 662 se deben incluir las cuotas a compensar generadas en este año que no se hayan aplicado en el año.
<img width=""612"" height=""73"" alt=""image"" src=""https://github.com/user-attachments/assets/ed061c8b-3cd5-4040-9d21-ca4ec83c6d9b"" />
https://sede.agenciatributaria.gob.es/static_files/Sede/Procedimiento_ayuda/G412/instr390.pdf

Antes del fix sólo se recogía la casilla 87 del último periodo lo que no recogía todos los casos, como que el contenido de la casilla 87 proveniera integra o parcialmente de años anteriores.

@ArantxaSudon revisa por favor.

MT-8899 @moduon","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] ¿@pedrobaeza, @LauraCForgeFlow podéis revisar los cambios por favor? [SEP] ¿@pedrobaeza puedes volver a revisarlo, por favor? Muchas gracias 😊 [SEP] On my way to merge this fine PR!
Prepared branch [16.0-ocabot-merge-pr-4617-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/16.0-ocabot-merge-pr-4617-by-pedrobaeza-bump-patch), awaiting test results. [SEP] This PR has the `approved` label and has been created more than 5 days ago. It should therefore be ready to merge by a maintainer (or a PSC member if the concerned addon has no declared maintainer). 🤖 [SEP] @pedrobaeza your merge command was aborted due to failed check(s), which you can inspect on [this commit of 16.0-ocabot-merge-pr-4617-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/76176889882a5f83b88a26517873418b2feb92e4).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] /ocabot merge patch [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [16.0-ocabot-merge-pr-4617-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/16.0-ocabot-merge-pr-4617-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Al fusionar ha dado error en el módulo del verifactu [SEP] @pedrobaeza your merge command was aborted due to failed check(s), which you can inspect on [this commit of 16.0-ocabot-merge-pr-4617-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/6ec673c46be6640c49c60fd937eac8750b92387a).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] Uhm, ese error es extraño, pero habría que solucionarlo para limpiar la rama. [SEP] ¿@pedrobaeza puedes volver a lanzar el merge? Ya quedó resuelto el error del verifactu que saltó al fusionar. Gracias [SEP] /ocabot merge patch [SEP] This PR looks fantastic, let's merge it!
Prepared branch [16.0-ocabot-merge-pr-4617-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/16.0-ocabot-merge-pr-4617-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 7a6618f9e7915b2d71bb92ac59a5818e31718d27. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4616,[16.0][IMP] l10n_es_aeat_mod111: Calcular tipo declaración,"Con esta mejora, el campo tipo declaración es computado bajo la siguiente lógica:

- Si es el resultado (Casilla 30) es positivo o igual a 0:
   - Si hay cuenta seleccionada, se asignará la U.
   - Si la cuenta es de AEAT, se asignará la G. Se necesita crear boolean 'use_aeat_account'
   - Si no es ninguno, se asignará la I.
- Si es negativo, se asignará la N.

Con esta mejora se añade un test para probarla.

https://www.loom.com/share/f765537951664e0ea77af6536c7de433

MT-12714 @moduon @EmilioPascual ","Hasta donde sé, el resultado es automático y calculado. ¿En qué casos se necesitaría cambiar ese resultado? [SEP] > Hasta donde sé, el resultado es automático y calculado. ¿En qué casos se necesitaría cambiar ese resultado?

Creo que no, el campo no es compute y no se hace nada en el `calculate` [SEP] Ya, pues entonces creo que es lo que habría que hacer en lugar de cambiar el readonly, ¿no os parece? [SEP] @EmilioPascual @ArantxaSudon @pedrobaeza He modificado el PR para hacer la mejora del cómputo del campo tipo declaración. [SEP] @pedrobaeza ¿Podrías revisarlo? ¡Gracias! [SEP] This PR has the `approved` label and has been created more than 5 days ago. It should therefore be ready to merge by a maintainer (or a PSC member if the concerned addon has no declared maintainer). 🤖 [SEP] Hola, @pedrobaeza, ¿podrías revisar la respuesta de Emilio? ¡Gracias! [SEP] Efectivamente, como dice @pedrobaeza ""Negativa"" se refiere a 0

<img width=""674"" height=""192"" alt=""image"" src=""https://github.com/user-attachments/assets/41a107e0-bd8e-4af2-80be-16c95b1cff19"" />

Además, he añadido una restricción al confirmar de que la casilla 30 no sea negativa.

<img width=""658"" height=""106"" alt=""image"" src=""https://github.com/user-attachments/assets/a10a934f-9d06-40dd-83d4-7d6d97e69c6d"" />

Además, ¿podéis cambiar el nombre del PR para que indique la rama 16.0? Este PR está apuntando a 16.0 [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [16.0-ocabot-merge-pr-4616-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/16.0-ocabot-merge-pr-4616-by-pedrobaeza-bump-patch), awaiting test results. [SEP] @pedrobaeza your merge command was aborted due to failed check(s), which you can inspect on [this commit of 16.0-ocabot-merge-pr-4616-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/f85535a28e80a027258ed70673ba4e5dd9119b9c).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] /ocabot merge patch [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [16.0-ocabot-merge-pr-4616-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/16.0-ocabot-merge-pr-4616-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 752dc7f82ff323af1eac411cf3e3a57877999201. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4614,[18.0][MIG] l10n_es_verifactu_oca_oss: Migration to 18.0,,
Pull Request,4612,[18.0][IMP] l10n_es_verifactu_oca: Add conflict check for account_journal_restrict_mode,"Add a check to prevent conflicts with the module `account_journal_restrict_mode`.

**The issue:**
Conflict with: https://github.com/OCA/account-financial-tools/blob/2b8097e59a0fca9396305faebd66f04359ee9cb9/account_journal_restrict_mode/models/account_journal.py#L31
`account_journal_restrict_mode` forces `restrict_mode_hash_table=True` on journals (""sale"", ""purchase"", ""general"")
`l10n_es_verifactu_oca` sets this field to `True` ONLY for sales journals (forcing `False` on purchase/general journals).
Installing both causes a validation error that blocks the registry load.
<img width=""1143"" height=""171"" alt=""image"" src=""https://github.com/user-attachments/assets/3c7f0533-6c73-439e-b77a-eb3724129f79"" />
","En lugar de esto, simplemente pon en la clave `excludes` el otro módulo y deja que Odoo ya haga esta comprobación. [SEP] > En lugar de esto, simplemente pon en la clave `excludes` el otro módulo y deja que Odoo ya haga esta comprobación.

Okay! Es verdad, mucho mas simple :sweat_smile:  [SEP] This PR looks fantastic, let's merge it!
Prepared branch [18.0-ocabot-merge-pr-4612-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4612-by-pedrobaeza-bump-patch), awaiting test results. [SEP] @pedrobaeza your merge command was aborted due to failed check(s), which you can inspect on [this commit of 18.0-ocabot-merge-pr-4612-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/29ca7de9657b53bb0b4a5c9e892a07b9a9ff3c57).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] @pedrobaeza He parado el workflow ya que ha habido un push después de tu comando de merge y no sé cómo puede afectar. ¿Puedes revisar que se pueda fusionar y relanzar el comando si lo ves bien?

Gracias de antemano. [SEP] /ocabot merge patch [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [18.0-ocabot-merge-pr-4612-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4612-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 016933d9ba88fb920cd08f30bbb82231054eb150. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4611,[17.0][FIX] payment_redsys: Allow payment provider in multiple accoun…,"Actualmente, el método de pago redsys asume el modo por defecto electronic. En la lógica base de Odoo (_check_payment_method_line_ids_multiplicity), los métodos marcados como electronic tienen una restricción estricta: solo pueden estar vinculados a un único diario por compañía.

Esto impide configurar Redsys en los siguientes escenarios:

Entornos Multi-Web: Cuando una empresa gestiona varios sitios web y necesita que los cobros de cada web  vayan a diarios contables separados para facilitar la conciliación.

En este pr se quito la funcionalidad:
https://github.com/OCA/l10n-spain/pull/4172

El error que sale al crear o duplicar un nuevo diario es el siguiente:
<img width=""790"" height=""341"" alt=""image"" src=""https://github.com/user-attachments/assets/4f005bf1-6e3e-4c46-91be-c275f7deacb2"" />
",
Pull Request,4610,[16.0] [FIX] l10n_es_ticketbai_pos: fix TicketBAI crashes and silent failures,"Se corrige la regresión introducida al migrar el módulo de Odoo 15 a 16.  
La “modernización” rompió la cadena segura de Promise original, provocando:

- `TypeError: Cannot read property 'number_prefix' of undefined`
- Fallos silenciosos cuando no se podía generar una factura TicketBAI (facturas con factura, NIF ausente, errores de firma, etc.)

**Cambios**

- `js/models.js` – Garantiza que `tbai_build_invoice()` siempre devuelva una promesa que se resuelve en un objeto de factura válido o `null` (nunca `undefined`) y que maneja correctamente las promesas rechazadas.
- `js/models.js` – Hace que `push_single_order()` sea seguro cuando no se genera factura (elimina el error).
- `js/Screens/PaymentScreen/PaymentScreen.js` – Asegura que cualquier error de TicketBAI (validación, generación XML, firma, etc.) muestre un popup claro y bloquee la validación del pedido (requisito legal).
- `js/tbai_models.js` – Elimina la llamada incorrecta a popup desde la capa de modelo; los errores ahora se propagan al componente de interfaz.

**Resultado:** desaparecen los errores de ejecución, todos los fallos son visibles para el cajero y los pedidos sin TicketBAI firmado válido quedan correctamente bloqueados. El comportamiento vuelve a ser idéntico a la versión estable de Odoo 15, manteniendo la sintaxis moderna con async/await.


@BinhexTeam T17055","Hi @ao-landoo,
some modules you are maintaining are being modified, check this out! [SEP] @Bilbonet uno de nuestros clientes estaba experimentando random issues como [este](https://github.com/OCA/l10n-spain/pull/3909#issuecomment-2666406741). He realizado este patch en aras de corregirlo. En mis pruebas locales funciona correctamente. Tal vez puedas ayudarme con un review funcional. [SEP] /ocabot merge patch [SEP] On my way to merge this fine PR!
Prepared branch [16.0-ocabot-merge-pr-4610-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/16.0-ocabot-merge-pr-4610-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 9587712879dbcb63e709f541cb515964709fea74. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4609,17.0 payment redsys,,
Pull Request,4608,[16.0][FIX] l10n_es_igic_verifactu_oca: Mapeos impuestos IGIC a las nuevas claves de Exención,"Corregido los mapeos de impuestos del IGIC en las nuevas claves de exención de VERI*FACTU según #4499 . 

### Nota legal y de cumplimiento

Este cambio mantiene la conformidad con la normativa aplicable al sistema
VERI*FACTU, conforme a lo establecido en:

- Real Decreto 1007/2023, de 5 de diciembre, por el que se aprueba el
  Reglamento que establece los requisitos que deben adoptar los sistemas
  informáticos o electrónicos que soporten los procesos de facturación.
- Real Decreto 254/2025, de 1 de abril, que modifica el anterior.

La modificación tiene carácter exclusivamente técnico y no altera la
estructura, integridad ni trazabilidad de los registros de facturación
ni el cumplimiento de las obligaciones establecidas por la AEAT.

@BinhexTeam","Este PR está pendiente de solucionar https://github.com/OCA/l10n-spain/pull/4499#issuecomment-3571519427 [SEP] Buenas @syci. 

Desde el desconocimiento (no conozco el régimen tributario canario), ¿porque has asignado el impuesto ""Exento por Comercio Minorista"" a la clave S1 (Operación Sujeto No exenta)?

Por otro lado, el ""IGIC Exento Repercutido"" ¿porque su causa de exención es E6?

El ""IGIC 0% (Exportaciones)"" lo veo bien en E2 por tratarse de una exportación.

Como bien dices está pendiente del PR del módulo original."
Pull Request,4607,[17.0][MIG] l10n_es_verifactu_oca_oss: Migration to 17.0,,
Pull Request,4606,[16.0][FIX] l10n_es_vat_book-l10n_es_vat_book_oss. Compatibility with other modules for OSS taxes,"Compatibility and better inheritance for other modules when using OSS taxes and tax amount is needed.

Related issue https://github.com/OCA/l10n-spain/issues/4605","No termino de ver la relación de esto con el SII. [SEP] > No termino de ver la relación de esto con el SII.

buenos días @pedrobaeza , la relación es que después de ese cambio en https://github.com/OCA/l10n-spain/commit/fa02f05b86cf2b16c42491bcb49143d6d6be5bb8#diff-d74b92c5e46eac6d96f3fd4c432611a9c7c51c3f691dddba3342721ff660fe3fR16-R17

en el módulo **l10n_es_vat_book_oss** se establece a 0 el importe de todos los impuestos OSS
https://github.com/OCA/l10n-spain/blob/3df1c7be67052c5ec7fe8b599f4860ae951750c8/l10n_es_vat_book_oss/models/account_move.py#L16

<img width=""892"" height=""234"" alt=""image"" src=""https://github.com/user-attachments/assets/9c819e14-afa0-403f-a209-21b2e5e71d6f"" />


 y en el módulo **l10n_es_aeat_sii_oss** se buscan esos mismos impuestos oss para restarlos del importe total en el sii
[l10n_es_vat_book](https://github.com/OCA/l10n-spain/blame/3df1c7be67052c5ec7fe8b599f4860ae951750c8/l10n_es_aeat_sii_oss/models/account_move.py#L14)
<img width=""709"" height=""307"" alt=""image"" src=""https://github.com/user-attachments/assets/36ad32bb-c6f9-4b0f-9d63-7e5eba6ddba5"" />



por lo que ya no se están restando los impuestos oss del importe total porque ""amount"" siempre es 0 porque el módulo l10n_es_vat_book_oss lo establece a 0 en la función _process_aeat_tax_fee_info que es la que se utiliza dentro de _get_aeat_tax_info (la misma que se utiliza en el sii, y también en verifactu para obtener el desglose de impuestos)
https://github.com/OCA/l10n-spain/blob/3df1c7be67052c5ec7fe8b599f4860ae951750c8/l10n_es_aeat/models/account_move.py#L38
<img width=""1017"" height=""548"" alt=""image"" src=""https://github.com/user-attachments/assets/31c945d0-08a0-43f9-a5c9-2fa7790cb35e"" />


<img width=""1203"" height=""497"" alt=""image"" src=""https://github.com/user-attachments/assets/b7d5572b-5683-4c6e-ace3-656f4fddf369"" />


 [SEP] Ya, ahí está el tema, que la idea es que libro de IVA debería ser igual a SII/VERI*FACTU, y por eso busco que haya una fuente de verdad. Creo que lo que podemos hacer si no es tener como con la cuota: el importe y luego lo deducible, pues aquí la base y la base ""aplicable a impuestos"", y entonces quitar de uno u otro, y así seguir conteniendo todo en el mismo diccionario y llamada, pero utilizar una u otra según interese. [SEP] @pedrobaeza el problema es que ahora todas las facturas con OSS salen con incidencias en el SII. Exactamente que se debería hacer para poder cerrarlo? [SEP] ¿Qué te parece la sugerencia de tener esos cuatro valores devueltos, y leer en cada módulo (SII/vat book) lo que interese? Si no lo ves factible, vamos a solucionarlo de la manera que sea."
Pull Request,4602,[17.0][FIX] l10n_es_verifactu_oca: verifactu mixin macrodata computation,"Backport fix from:
- #4598 

Se estaba usando el método `_get_verifactu_amount_total` que se sustituyó por `_get_verifactu_taxes_and_total` y por lo tanto saltaba un error al ejecutarse el método.


(cherry picked from commit 1a7e3f323351e0fdd29f25002c126bec9b290452)","This PR looks fantastic, let's merge it!
Prepared branch [17.0-ocabot-merge-pr-4602-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4602-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 8af041d43cd184373e75b8546b94222896a614e0. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4601,[17.0][FIX] l10n_es_account_statement_import_n43: Remove invalid creation_context field,"The creation_context field does not exist in the standard account.bank.statement model in Odoo 17.0, causing a ValueError when importing N43 bank statement files.

This field was likely a remnant from a previous version or planned functionality that was never implemented. Removing it allows N43 imports to work correctly without affecting functionality, as the field was not used anywhere else in the module.

Fixes #4596","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] No es un error real según lo comentado en https://github.com/OCA/l10n-spain/issues/4596#issuecomment-3569886665, así que cierro."
Pull Request,4600,[14.0][BACKPORT] l10n_es_igic_verifactu_oca,"Backport del módulo para v14.

Nota legal y de cumplimiento
Este cambio mantiene la conformidad con la normativa aplicable al sistema
VERI*FACTU, conforme a lo establecido en:

Real Decreto 1007/2023, de 5 de diciembre, por el que se aprueba el
Reglamento que establece los requisitos que deben adoptar los sistemas
informáticos o electrónicos que soporten los procesos de facturación.
Real Decreto 254/2025, de 1 de abril, que modifica el anterior.
La modificación tiene carácter exclusivamente técnico y no altera la
estructura, integridad ni trazabilidad de los registros de facturación
ni el cumplimiento de las obligaciones establecidas por la AEAT.

@BinhexTeam",Pendiente de #4622 
Pull Request,4599,[15.0][BACKPORT] l10n_es_verifactu_pos,"Backport del módulo para v15.

Nota legal y de cumplimiento
Este cambio mantiene la conformidad con la normativa aplicable al sistema
VERI*FACTU, conforme a lo establecido en:

Real Decreto 1007/2023, de 5 de diciembre, por el que se aprueba el
Reglamento que establece los requisitos que deben adoptar los sistemas
informáticos o electrónicos que soporten los procesos de facturación.
Real Decreto 254/2025, de 1 de abril, que modifica el anterior.
La modificación tiene carácter exclusivamente técnico y no altera la
estructura, integridad ni trazabilidad de los registros de facturación
ni el cumplimiento de las obligaciones establecidas por la AEAT.

@BinhexTeam",
Pull Request,4598,[18.0][FIX] l10n_es_verifactu_oca: verifactu mixin macrodata computation,Se estaba usando el método `_get_verifactu_amount_total` que se sustituyó por `_get_verifactu_taxes_and_total` y por lo tanto saltaba un error al ejecutarse el método.,"This PR looks fantastic, let's merge it!
Prepared branch [18.0-ocabot-merge-pr-4598-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4598-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 431acdf74780f8abe623486749c76d4f9b599f79. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4595,[17.0][FIX] l10n_es_aeat: Validate certificate file existence,"The get_certificates() method was returning certificate paths from ir.config_parameter without verifying if the files actually exist on the filesystem. This caused a false positive where the system believed certificates were available when they weren't.

Now the method validates file existence using os.path.isfile() and raises a descriptive UserError if files are not found, making it easier to diagnose certificate configuration issues.

Closes #4467","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] This PR looks fantastic, let's merge it!
Prepared branch [17.0-ocabot-merge-pr-4595-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4595-by-pedrobaeza-bump-patch), awaiting test results. [SEP] @pedrobaeza your merge command was aborted due to failed check(s), which you can inspect on [this commit of 17.0-ocabot-merge-pr-4595-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/e9beaf90a5587fb40d173948f599d69e1543e8b6).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] @ramzeta por favor no quites los parámetros anteriores. El error en el CI que hay ahora mismo se debe a que FACe lleva más de 24 horas caído. A ver si lo solucionan, y si no, veremos de desactivar temporalmente los tests, aunque precisamente el módulo tampoco funciona debido a eso. [SEP] Vale subo una mejora que detecte ! Gracias [SEP] Sí, y por favor haz squash de los commits y revisa el CI de pre-commit."
Pull Request,4594,[17.0][FIX] l10n_es_verifactu_oca: Add error logging for failed API c…,"…alls

When Verifactu API calls fail, errors are now properly logged with document information and full stack trace for easier debugging.

This helps administrators identify and troubleshoot issues with Verifactu integration in production environments.

The logging includes:
- Document names being processed
- Full error message
- Complete stack trace (exc_info=True)

Closes #4591",
Pull Request,4593,[18.0][FIX] l10n_es_aeat_sii_oca: Send cancellations if previously sent,"Forward-port of #4592 

The filtering was not done correctly for cancel operations if they were on ""sent"" state.

@Tecnativa","/ocabot merge patch [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [18.0-ocabot-merge-pr-4593-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4593-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 3553e282cd4cad0d5a5f452ee61c695e4f3b5b48. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4592,[17.0][FIX] l10n_es_aeat_sii_oca: Send cancellations if previously sent,"The filtering was not done correctly for cancel operations if they were on ""sent"" state.

@Tecnativa ","/ocabot merge patch [SEP] On my way to merge this fine PR!
Prepared branch [17.0-ocabot-merge-pr-4592-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4592-by-pedrobaeza-bump-patch), awaiting test results. [SEP] @pedrobaeza your merge command was aborted due to failed check(s), which you can inspect on [this commit of 17.0-ocabot-merge-pr-4592-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/c677e71f371d07f2d21bd06b816d8f9f8a241fc4).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] /ocabot merge patch [SEP] This PR looks fantastic, let's merge it!
Prepared branch [17.0-ocabot-merge-pr-4592-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4592-by-pedrobaeza-bump-patch), awaiting test results. [SEP] /ocabot merge patch [SEP] This PR looks fantastic, let's merge it!
Prepared branch [17.0-ocabot-merge-pr-4592-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4592-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at cd13b882929971aa0f9f784ce50fb3954dc25fec. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4590,[18.0][MIG] l10n_es_digital_canon: Migration to version 18.0,"@Tecnativa TT56706
@sergio-teruel @carlosdauden @pedrobaeza ",ping @juancarlosonate-tecnativa he añadido el cuando se cambie el partner recalcule los impuestos en `sale.order`. En el caso de `purchase.order` y `account.move` ya se hace.
Pull Request,4588,[18.0][FIX] l10n_es_verifactu_oca: registro de facturas rechazadas: alta por rechazo,"Forward-port of #4429 and #4587 

- arreglado el envío de facturas incorrectas y por tanto rechazadas, se deben subsanar igual que se hace con las que están aceptadas con errores, pulsando manualmente el botón de volver a enviar desde la factura una vez arreglado el motivo del rechazo por el usuario, y se envían como alta por rechazo con los valores Subsanacion=""S"" y RechazoPrevio=""X"".
- añadido nuevo estado incorrect en aeat_state del account.move.
- unificado estados de envío de verifactu para que sean los mismos que los de aeat_state.
- actualizado el readme, quitado cosas del roadmap que ya están.
- mejorado alguna vista
- añadido contribuidor que faltaba

@Tecnativa","/ocabot merge nobump [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [18.0-ocabot-merge-pr-4588-by-pedrobaeza-bump-nobump](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4588-by-pedrobaeza-bump-nobump), awaiting test results. [SEP] Congratulations, your PR was merged at c887d9e624468fa97da94034359635e607eefa83. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4587,[17.0][FIX] l10n_es_verifactu_oca: registro de facturas rechazadas: alta por rechazo,"Forward-port of #4429

- arreglado el envío de facturas incorrectas y por tanto rechazadas, se deben subsanar igual que se hace con las que están aceptadas con errores, pulsando manualmente el botón de volver a enviar desde la factura una vez arreglado el motivo del rechazo por el usuario, y se envían como alta por rechazo con los valores Subsanacion=""S"" y RechazoPrevio=""X"".
- añadido nuevo estado incorrect en aeat_state del account.move.
- unificado estados de envío de verifactu para que sean los mismos que los de aeat_state.
- actualizado el readme, quitado cosas del roadmap que ya están.
- mejorado alguna vista
- añadido contribuidor que faltaba

@Tecnativa ","/ocabot merge nobump [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [17.0-ocabot-merge-pr-4587-by-pedrobaeza-bump-nobump](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4587-by-pedrobaeza-bump-nobump), awaiting test results. [SEP] Congratulations, your PR was merged at 468bd2f477811f83440f988ec0f7e72f3d007066. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4585,[17.0][FIX] l10n_es_partner: Enable searching by the commercial field in the search view,"cc @Tecnativa 

Backport from https://github.com/OCA/l10n-spain/pull/4504

ping @carlos-lopez-tecnativa 

The field used in the search view is complete_name, but this field cannot be inherited because, in this line of code: https://github.com/odoo/odoo/blob/5238a24752de83ef347755dc6c2d5f9c6f3e6772/odoo/addons/base/models/res_partner.py#L381

Odoo calls the _get_complete_name function without context.

When a user searches in the Contacts menu by the commercial name, no results are found. With this commit, we inject an additional domain when a search for complete_name is performed, enabling results to be found by the commercial name.","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] @carlos-lopez-tecnativa Done!! [SEP] Hey, thanks for contributing! Proceeding to merge this for you.
Prepared branch [17.0-ocabot-merge-pr-4585-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/17.0-ocabot-merge-pr-4585-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 531a2525a14caf27de84040f1da629515a303f0f. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4584,[16.0][IMP] l10n_es_aeat: allow to download Public PEM certificate,"Al final he podido hacerlo sin un transient:

<img width=""464"" height=""757"" alt=""image"" src=""https://github.com/user-attachments/assets/142f90a9-8174-4133-bacc-86dc02e3b493"" />
","Hi @pedrobaeza,
some modules you are maintaining are being modified, check this out! [SEP] What a great day to merge this nice PR. Let's do it!
Prepared branch [16.0-ocabot-merge-pr-4584-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/16.0-ocabot-merge-pr-4584-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 491f186a858791d88dee5294e74389b2d58d4766. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4583,[18.0][MIG] l10n_es_verifactu_pos_oca: Migration to 18.0 ,"Migration of the l10n_es_verifactu_pos_oca module to version 18 from PR [#4378](https://github.com/OCA/l10n-spain/pull/4378)

It depends on PR [#4549](https://github.com/OCA/l10n-spain/pull/4549)","He probado el módulo pero primero me da error que no esta instalado ""pos_hr"", creo que hay que incluir esa dependecia, el QR sale en la impresión pero cuando va a la URL no aparece el número de factura, aparece como ""false"", y logicamente da ""factura no encontrada"" [SEP] Este módulo no debe depender de `pos_hr`. [SEP] > He probado el módulo pero primero me da error que no esta instalado ""pos_hr"", creo que hay que incluir esa dependecia, el QR sale en la impresión pero cuando va a la URL no aparece el número de factura, aparece como ""false"", y logicamente da ""factura no encontrada""

A falta de revisar el error que comentas, comentar que el módulo no tiene dependencia directa con pos_hr.
Sus dependecias son: l10n_es_pos_oca y l10n_es_verifactu_oca [SEP] Sí, parece lógico mirar el flag de simplificado. [SEP] @cesarportas 
Functional review: tras añadir este módulo y hacer una venta en POS me salta el siguiente error cuando voy a validar el método de pago. Me da tanto con tarjeta como en efectivo así que el método de pago no influye en el error. 

Tengo VERIFACTU configurado correctamente y este error sólo me da dentro del POS ya que dentro de las facturas, puedo validar y confirmar una factura sin problema ninguno.


<img width=""1920"" height=""1171"" alt=""image"" src=""https://github.com/user-attachments/assets/2f30fee1-aac9-4a63-85f9-7db293dea221"" />
"
Pull Request,4582,[19.0][MIG] payment redsys WIP,,"Tiene sentido mantener esto en lugar de ir al de Odoo core? [SEP] @pedrobaeza gracias por avisarme, no me había dado cuenta que en v19. 0 estaba en el core, lo cancelo. "
Pull Request,4581,[16.0][IMP] l10n_es_facturae_face: Use new REST Services,"Después de años de espera, FACe cambia la semana que viene el sistema de envío de facturas:

<img width=""1008"" height=""254"" alt=""image"" src=""https://github.com/user-attachments/assets/9e22913f-8370-4e20-9ae6-76a2c327dcef"" />

Este PR lo prepara todo para empezar a usar el REST API y quitarnos el SOAP.

La nueva interfaz nos permitirá de forma sencilla añadir a nuestros clientes al sistema de FACe.

Falta ver cuales seran las URLs definitivas, por lo que aún no puede mergearse, aunque si probarse.

TODO:

- [ ] Migration script para pasar las URLs a lo que sea conveniente (De test a producción)","@pedrobaeza Aprovechando que estoy haciendo esto, veo que ahora lo que nos piden es enviar el .pem del certificado, no copiarlo manualmente. Teniendo en cuenta que no tiene passwords, podríamos intentar que fuera una funcionalidad parecida al show key que hay a dia de hoy, aunque en las pruebas que he hecho me implicaba hacer un campo calculado que cada vez que entrabas sacaba la parte pública. El problema es que no puedo descargar el fichero con ese onchange. Si cambiamos esa funcionalidad por un wizard te parece bien? En el wizard aparecería la clave pública escrita por si la queremos copiar y tendríamos la opción de descargar el fichero pem.

Opción con el onchange se vería así:

<img width=""584"" height=""133"" alt=""image"" src=""https://github.com/user-attachments/assets/782aa2f1-09a6-4b0b-891c-55c68ee233b2"" />

Con el botón seria más sencillo creo yo. [SEP] Con el onchange no se ve mal tampoco, ¿no? [SEP] el tema es que con el onchange no va, se debe hacer un campo compute que no depende del valor del campo no almacenado (el show public certificate), por lo tanto, el campo se recalcula cada vez que entramos en el registro, no cuando lo pedimos. Esto se hace así por que en el momento de hacer la descarga, el fichero vuelve a calcularse, y al ser el show un no stored, lo vuelve a poner a False y, por lo tanto, no hay elemento. [SEP] Bueno, si ves problemas técnicas, no creo que sea mucho problema tener un botón + popup"
Pull Request,4580,[15.0][BACKPORT] l10n_es_igic_verifactu_oca,"Backport 15 Verifactu IGIC

### Nota legal y de cumplimiento

Este cambio mantiene la conformidad con la normativa aplicable al sistema
VERI*FACTU, conforme a lo establecido en:

- Real Decreto 1007/2023, de 5 de diciembre, por el que se aprueba el
  Reglamento que establece los requisitos que deben adoptar los sistemas
  informáticos o electrónicos que soporten los procesos de facturación.
- Real Decreto 254/2025, de 1 de abril, que modifica el anterior.

La modificación tiene carácter exclusivamente técnico y no altera la
estructura, integridad ni trazabilidad de los registros de facturación
ni el cumplimiento de las obligaciones establecidas por la AEAT.","@ajfebres Recuerda que es un commit por módulo, quita el del pre-commit [SEP] @syci Estoy conservando el histórico de la versión de la cual estoy migrando, según:

https://github.com/OCA/maintainer-tools/wiki/Migration-to-version-15.0 [SEP] > @syci Estoy conservando el histórico de la versión de la cual estoy migrando, según:
> 
> https://github.com/OCA/maintainer-tools/wiki/Migration-to-version-15.0

Sí, pero este no corresponde tenerlo en el histórico. 
<img width=""1136"" height=""84"" alt=""image"" src=""https://github.com/user-attachments/assets/926bac47-53f6-40b9-bad2-aae9c238bb46"" />
 [SEP] Pendiente de #4499 "
Pull Request,4579,[14.0][BACKPORT] l10n_es_verifactu_pos,"Backport del módulo para v14. 

### Nota legal y de cumplimiento

Este cambio mantiene la conformidad con la normativa aplicable al sistema
VERI*FACTU, conforme a lo establecido en:

- Real Decreto 1007/2023, de 5 de diciembre, por el que se aprueba el
  Reglamento que establece los requisitos que deben adoptar los sistemas
  informáticos o electrónicos que soporten los procesos de facturación.
- Real Decreto 254/2025, de 1 de abril, que modifica el anterior.

La modificación tiene carácter exclusivamente técnico y no altera la
estructura, integridad ni trazabilidad de los registros de facturación
ni el cumplimiento de las obligaciones establecidas por la AEAT.

@BinhexTeam","`
    if(!result.verifactu_qr){
                    result.verifactu_qr = this._get_verifactu_qr_code_data();
                }
                return result;
`

A la hora de reimprimir no sale el qr 

En el models js me aparece correctamente con esto en el export_for_printing() al volver a reimprimir el ticket

Así ya lo ven en la 14"
Pull Request,4577,[18.0][IMP] l10n_es_account_asset: Corrected amount after non deductible,"Forward-port of #4562 and #4565 

When a tax is non deductible (because it's directly non deductible VAT, or due to the VAT prorate), the amount to depreciate should be increased with this non deductible amount, which was not taken into account before this commit.

For achieving this without requiring glue modules, we are now depending on `l10n_es_aeat`, which is a reasonable trade-off, as almost all the instances with this module will have the other installed as well.

As we only know the deductible amount at invoice level, we get the general tax info, and then apply the percentage corresponding to each line.

It includes a new test for covering this case.","/ocabot merge major [SEP] On my way to merge this fine PR!
Prepared branch [18.0-ocabot-merge-pr-4577-by-pedrobaeza-bump-major](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4577-by-pedrobaeza-bump-major), awaiting test results. [SEP] Congratulations, your PR was merged at d72dfe8658ba37e3422aa225265070a7736ee9f0. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4576,[18.0][FIX] l10n_es_aeat: Find properly the XML-ID for non deductible,"Forward-port of #4573 

The tax groups are now by company and bound to `account` module, so let's change the compare condition.

@Tecnativa","/ocabot merge patch [SEP] On my way to merge this fine PR!
Prepared branch [18.0-ocabot-merge-pr-4576-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4576-by-pedrobaeza-bump-patch), awaiting test results. [SEP] @pedrobaeza your merge command was aborted due to failed check(s), which you can inspect on [this commit of 18.0-ocabot-merge-pr-4576-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/b4a39e1696e2d3ceeb5fd39ed8a3abdaa58b9559).

After fixing the problem, you can re-issue a merge command. Please refrain from merging manually as it will most probably make the target branch red. [SEP] /ocabot merge patch [SEP] On my way to merge this fine PR!
Prepared branch [18.0-ocabot-merge-pr-4576-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4576-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 9f6c6d16ceddfdd49fa0889ffb62dc54d672cc91. Thanks a lot for contributing to OCA. ❤️"
Pull Request,4575,[18.0][FIX] l10n_es_payment_order_confirming_aef: Select properly the currency,"Forward-port of #4571, #4572, #4574

If the journal has a explicit currency, use it.

@Tecnativa","/ocabot merge patch [SEP] This PR looks fantastic, let's merge it!
Prepared branch [18.0-ocabot-merge-pr-4575-by-pedrobaeza-bump-patch](https://github.com/OCA/l10n-spain/commits/18.0-ocabot-merge-pr-4575-by-pedrobaeza-bump-patch), awaiting test results. [SEP] Congratulations, your PR was merged at 704c5b184812e910a538ead8fa921c8f1fc4d974. Thanks a lot for contributing to OCA. ❤️"
